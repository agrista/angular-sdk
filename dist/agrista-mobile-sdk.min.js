var sdkAuthorizationApp=angular.module("ag.sdk.authorization",["ag.sdk.config","ag.sdk.utilities"]);sdkAuthorizationApp.factory("authorizationApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{login:function(c,e){return b.wrap(function(b){a.post(d+"login",{email:c,password:e}).then(function(a){b.resolve(a.data)},b.reject)})},resetPassword:function(c,e){return b.wrap(function(b){a.post(d+"api/password-reset",{hash:c,password:e}).then(function(a){b.resolve(a.data)},b.reject)})},requestResetPasswordEmail:function(c){return b.wrap(function(b){a.post(d+"api/password-reset-email",{email:c}).then(function(a){b.resolve(a.data)},b.reject)})},changePassword:function(c,e,f){return b.wrap(function(b){a.post(d+"api/user/password",{password:e,newPassword:f}).then(function(a){b.resolve(a.data)},b.reject)})},getUser:function(){return b.wrap(function(b){a.get(d+"current-user",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},registerUser:function(c){return b.wrap(function(b){a.post(d+"api/register",c).then(function(a){b.resolve(a.data)},b.reject)})},updateUser:function(c){return b.wrap(function(b){a.post(d+"current-user",_.omit(c,"profilePhotoSrc"),{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},logout:function(){return a.post(d+"logout")}}}]),sdkAuthorizationApp.provider("authorization",["$httpProvider",function(a){var b={open:1,user:2,admin:4},c={open:b.open|b.user|b.admin,user:b.user|b.admin,admin:b.admin},d={email:"",role:b.open},e=void 0;return a.interceptors.push(["$q","$injector","$rootScope",function(a,b,c){return{responseError:function(b){return 401===b.status?c.$broadcast("authorization::unauthorized",b):403===b.status&&c.$broadcast("authorization::forbidden",b),a.reject(b)}}}]),{userRole:b,accessLevel:c,$get:["$rootScope","authorizationApi","localStore","promiseService",function(a,f,g,h){function i(){return g.getItem("user")||d}function j(a){return a=a||d,void 0===a.role&&(a.role="admin"==a.accessLevel?b.admin:b.user),g.setItem("user",a),a}var k=i();return f.getUser().then(function(b){null!==b.user?(k=j(b.user),a.$broadcast("authorization::login",k)):k.isActive!==!0&&a.$broadcast("authorization::unauthorized")}),a.$on("authorization::unauthorized",function(){g.removeItem("user")}),{userRole:b,accessLevel:c,lastError:function(){return e},currentUser:function(){return k},isAllowed:function(a){return 0!=(a&k.role)},isLoggedIn:function(){return 0!=(c.user&k.role)},login:function(b,c){return h.wrap(function(d){f.login(b,c).then(function(b){null!==b.user?(e=void 0,k=j(b.user),d.resolve(k),a.$broadcast("authorization::login",k)):(e={type:"error",message:"The entered e-mail and/or password is incorrect. Please try again."},g.removeItem("user"),d.reject())},function(a){g.removeItem("user"),d.reject(a)})})},requestResetPasswordEmail:f.requestResetPasswordEmail,resetPassword:f.resetPassword,changePassword:function(a,b){return f.changePassword(k.id,a,b)},changeUserDetails:function(b){return f.updateUser(b).then(function(b){return k=j(b),a.$broadcast("authorization::user-details__changed",k),b})},register:function(b){return h.wrap(function(c){f.registerUser(b).then(function(b){null!==b?(e=void 0,k=j(b),c.resolve(k),a.$broadcast("authorization::login",k)):(g.removeItem("user"),c.reject())},function(a){e={type:"error",message:"There is already an Agrista account associated with this email address. Please login."},g.removeItem("user"),c.reject(a)})})},logout:function(){return a.$broadcast("authorization::logout"),f.logout().then(function(){g.removeItem("user")})}}}]}}]);var sdkConfigApp=angular.module("ag.sdk.config",[]);sdkConfigApp.provider("configuration",["$httpProvider",function(a){var b="",c="local",d=[],e={local:"",testing:"https://enterprise-uat.agrista.com/",staging:"https://enterprise-staging.agrista.com/",production:"https://enterprise.agrista.com/"},f=function(a){return-1!==d.indexOf(a)},g=function(a){0==f(a)&&d.push(a)};return{addModule:g,hasModule:f,setServers:function(a){angular.forEach(a,function(a,b){a.lastIndexOf("/")!==a.length-1&&(a+="/"),e[b]=a}),this.useHost(c,b)},useHost:function(d,f,g){"function"==typeof f&&(g=f,f=""),b=f||"",void 0!==e[d]&&(c=d,a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]),"function"==typeof g&&g(e[c])},$get:function(){return{addModule:g,hasModule:f,getVersion:function(){return b},getHost:function(){return c},getServer:function(){return e[c]}}}}}]);var sdkIdApp=angular.module("ag.sdk.id",["ag.sdk.utilities"]);sdkIdApp.factory("objectId",["localStore",function(a){var b=function(){function c(){return this instanceof b?void("object"==typeof arguments[0]?(this.timestamp=arguments[0].timestamp,this.machine=arguments[0].machine,this.pid=arguments[0].pid,this.increment=arguments[0].increment):"string"==typeof arguments[0]&&24==arguments[0].length?(this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))):4==arguments.length&&null!=arguments[0]?(this.timestamp=arguments[0],this.machine=arguments[1],this.pid=arguments[2],this.increment=arguments[3]):(this.timestamp=Math.floor((new Date).valueOf()/1e3),this.machine=f,this.pid=e,this.increment=d++,d>16777215&&(d=0))):new b(arguments[0],arguments[1],arguments[2],arguments[3]).toString()}var d=0,e=Math.floor(32767*Math.random()),f=Math.floor(16777216*Math.random()),g=parseInt(a.getItem("mongoMachineId"));return g>=0&&16777215>=g&&(f=Math.floor(a.getItem("mongoMachineId"))),a.setItem("mongoMachineId",f),c}();return b.prototype.getDate=function(){return new Date(1e3*this.timestamp)},b.prototype.toArray=function(){var a,b=this.toString(),c=[];for(a=0;12>a;a++)c[a]=parseInt(b.slice(2*a,2*a+2),16);return c},b.prototype.toString=function(){var a=this.timestamp.toString(16),b=this.machine.toString(16),c=this.pid.toString(16),d=this.increment.toString(16);return"00000000".substr(0,8-a.length)+a+"000000".substr(0,6-b.length)+b+"0000".substr(0,4-c.length)+c+"000000".substr(0,6-d.length)+d},b.prototype.toBase64String=function(){return window.btoa(this.toString())},function(){return new b}}]),sdkIdApp.factory("generateUUID",function(){function a(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:7&c|8).toString(16)});return b}return function(){return a()}});var sdkLibraryApp=angular.module("ag.sdk.library",[]);sdkLibraryApp.constant("underscore",window._),sdkLibraryApp.constant("geojsonUtils",window.gju);var sdkMonitorApp=angular.module("ag.sdk.monitor",["ag.sdk.utilities"]);sdkMonitorApp.factory("promiseMonitor",["$log","safeApply",function(a,b){function c(d){if(!(this instanceof c))return new c(d);var e={total:0,complete:0,resolved:0,rejected:0,percent:0},f=function(){e.complete++,e.percent=100/e.total*e.complete,a.debug("MONITOR TOTAL: "+e.total+" COMPLETE: "+e.complete+" PERCENT: "+e.percent),b(function(){d(e.complete==e.total?{type:"complete",percent:e.percent,stats:e}:{type:"progress",percent:e.percent,stats:e})})};return{stats:function(){return e},clear:function(){e={total:0,complete:0,resolved:0,rejected:0,percent:0}},add:function(a){return e.total++,a.then(function(){e.resolved++,f()},function(a){e.rejected++,b(function(){d({type:"error"},a)}),f()}),a}}}return function(a){return new c(a)}}]);var skdUtilitiesApp=angular.module("ag.sdk.utilities",["ngCookies"]);skdUtilitiesApp.factory("safeApply",["$rootScope",function(a){return function(b){a.$$phase?b():a.$apply(b)}}]),skdUtilitiesApp.factory("dataMapService",[function(){return function(a,b,c){var d=[];a instanceof Array==!1&&(a=void 0!==a?[a]:[]);for(var e=0;e<a.length;e++){var f,g=a[e];if("function"==typeof b)f=b(g);else{f={};for(var h in b)b.hasOwnProperty(h)&&(f[h]=g[b[h]])}f instanceof Array?d=d.concat(f):"object"==typeof f?(c!==!0&&(f.id=f.id||g.id),d.push(f)):void 0!==f&&d.push(f)}return d}}]),skdUtilitiesApp.factory("pagingService",["$rootScope","$http","promiseService","dataMapService",function(a,b,c,d){return{initialize:function(b,e,f,g){"object"==typeof f&&(g=f,f=e,e=void 0),"object"==typeof e&&(g=e,f=void 0,e=void 0),f=f||function(b){a.$broadcast("paging::items",b)};var h=_.defaults(g||{},{limit:50,resulttype:"simple"}),i={page:_.clone(h),busy:!1,complete:!1,disabled:function(){return i.busy||i.complete||void 0!==i.searching&&i.searching.complete},search:function(a){a&&a.length>0?((void 0===i.searching||i.searching.complete===!1||i.searching.search!==a)&&(i.searching=_.defaults({search:a},h)),i.request()):delete i.searching},request:function(a){return a=a||(i.searching?i.searching:i.page),i.busy=!0,delete a.complete,b(a).then(function(b){return void 0===a.search?(i.page.offset=void 0===i.page.offset?b.length:i.page.offset+b.length,i.complete=b.length!==i.page.limit):(i.searching=a,i.searching.offset=void 0===i.searching.offset?b.length:i.searching.offset+b.length,i.searching.complete=b.length!==i.searching.limit),i.busy=!1,e&&(b=d(b,e)),f(b),b},c.throwError)}};return i},page:function(a,d){return c.wrap(function(e){var f=function(a){e.resolve(a.data)};void 0!==d?"string"==typeof d?b.get(d,{withCredentials:!0}).then(f,c.throwError):b.get(a,{params:d,withCredentials:!0}).then(f,c.throwError):b.get(a,{withCredentials:!0}).then(f,c.throwError)})}}}]),skdUtilitiesApp.factory("promiseService",["$q","safeApply",function(a,b){var c=function(){var c=a.defer();return{resolve:function(a){b(function(){c.resolve(a)})},reject:function(a){b(function(){c.reject(a)})},promise:c.promise}},d=function(b,c){var d=c,e=a.defer(),f=e.promise,g=[];b(d);var h=function(a){return f.then(function(b){return b instanceof Array?g=g.concat(b):b&&g.push(b),a?a():g},function(a){throw a})};return angular.forEach(d,function(a){f=h(a)}),e.resolve(),h()},e=function(b,c){var d=c;return b(d),a.all(d)};return{all:function(b){return a.all(b)},chain:function(a){return d(a,[])},wrap:function(a){var b=c();return a(b),b.promise},wrapAll:function(a){return e(a,[])},arrayWrap:function(a){return e(a,[])},objectWrap:function(a){return e(a,{})},throwError:function(a){throw a},defer:c}}]),skdUtilitiesApp.factory("localStore",["$cookieStore","$window",function(a,b){return{setItem:function(c,d){b.localStorage?b.localStorage.setItem(c,JSON.stringify(d)):a.put(c,d)},getItem:function(c,d){return b.localStorage?JSON.parse(b.localStorage.getItem(c))||d:a.get(c)||d},removeItem:function(c){b.localStorage?b.localStorage.removeItem(c):a.remove(c)}}}]);var sdkHelperAssetApp=angular.module("ag.sdk.helper.asset",["ag.sdk.helper.farmer","ag.sdk.helper.attachment","ag.sdk.library"]);sdkHelperAssetApp.factory("assetHelper",["$filter","attachmentHelper","landUseHelper","underscore",function(a,b,c,d){var e=function(b){if(b.data)switch(b.type){case"crop":case"permanent crop":case"plantation":return(b.data.plantedArea?a("number")(b.data.plantedArea,2)+"Ha":"")+(b.data.plantedArea&&b.data.crop?" of ":"")+(b.data.crop?b.data.crop:"")+(b.data.fieldName?" on field "+b.data.fieldName:"");case"farmland":return b.data.portionLabel?b.data.portionLabel:b.data.portionNumber?"Portion "+b.data.portionNumber:"Remainder of farm";case"improvement":return b.data.name;case"cropland":return(b.data.irrigated?b.data.irrigation+" from "+b.data.waterSource:"Non irrigable "+b.type)+(b.data.fieldName?" on field "+b.data.fieldName:"");case"livestock":return b.data.type+(b.data.category?" - "+b.data.category:"");case"pasture":return(b.data.crop?b.data.crop:"Natural")+(b.data.fieldName?" on field "+b.data.fieldName:"");case"vme":return b.data.category+(b.data.model?" model "+b.data.model:"");case"wasteland":return"Wasteland";case"water source":case"water right":return b.data.waterSource+(b.data.fieldName?" on field "+b.data.fieldName:"")}return g[type]},f=function(c,f){var g={id:c.id||c.__id,type:c.type,updatedAt:c.updatedAt};return c.data&&("crop"==c.type?(g.title=e(c),g.subtitle=c.data.season?c.data.season:"",g.groupby=c.farmId):"farmland"==c.type?(g.title=e(c),g.subtitle=void 0!==c.data.area?"Area: "+a("number")(c.data.area,2)+"Ha":"Unknown area",g.groupby=c.farmId):"improvement"==c.type?(g.title=e(c),g.subtitle=c.data.type+" - "+c.data.category,g.summary=c.data.description||"",g.groupby=c.farmId):"cropland"==c.type?(g.title=e(c),g.subtitle=void 0!==c.data.size?"Area: "+a("number")(c.data.size,2)+"Ha":"Unknown area",g.groupby=c.farmId):"livestock"==c.type?(g.title=e(c),g.subtitle=(c.data.breed?c.data.breed+" for ":"For ")+c.data.purpose,g.summary=c.data.description||"",g.groupby=c.data.type):"pasture"==c.type?(g.title=e(c),g.subtitle=c.data.plantedDate?"Planted: "+a("date")(c.data.plantedDate,"dd/MM/yy"):"",g.groupby=c.farmId):"permanent crop"==c.type?(g.title=e(c),g.subtitle=c.data.establishedDate?"Established: "+a("date")(c.data.establishedDate,"dd/MM/yy"):"",g.groupby=c.farmId):"plantation"==c.type?(g.title=e(c),g.subtitle=c.data.establishedDate?"Established: "+a("date")(c.data.establishedDate,"dd/MM/yy"):"",g.groupby=c.farmId):"vme"==c.type?(g.title=e(c),g.subtitle="Quantity: "+c.data.quantity,g.summary=c.data.description||"",g.groupby=c.data.type):"wasteland"==c.type?(g.title=e(c),g.subtitle=void 0!==c.data.size?"Area: "+a("number")(c.data.size,2)+"Ha":"Unknown area",g.groupby=c.farmId):"water right"==c.type&&(g.title=e(c),g.subtitle=void 0!==c.data.size?"Irrigatable Extent: "+a("number")(c.data.size,2)+"Ha":"Unknown area",g.groupby=c.farmId),g.image=b.getThumbnail(c.data.attachments)),f&&(g=d.extend(g,f)),g},g={crop:"Crops",farmland:"Farmlands",improvement:"Fixed Improvements",cropland:"Cropland",livestock:"Livestock",pasture:"Pastures","permanent crop":"Permanent Crops",plantation:"Plantations",vme:"Vehicles, Machinery & Equipment",wasteland:"Wasteland","water right":"Water Rights"},h={improvement:["Livestock & Game","Crop Cultivation & Processing","Residential","Business","Equipment & Utilities","Infrastructure","Recreational & Misc."],livestock:["Cattle","Sheep","Pigs","Chickens","Ostriches","Goats"],vme:["Vehicles","Machinery","Equipment"]},i={improvement:{"Livestock & Game":["Abattoir","Animal Cages","Animal Camp","Animal Feedlot","Animal Growing House","Animal Handling Equiment","Animal Handling Facility","Animal Pens","Animal Sale Facility","Animal Shelter","Animal Stable","Anti-Poaching Training Facility","Arena","Auction Facilities","Aviary","Barn","Beekeeping Room","Bottling Facility","Breeding Facility","Broiler House","Broiler House - Atmosphere","Broiler House - Semi","Broiler Unit","Cheese Factory","Chicken Coop","Chicken Run","Cooling Facility","Crocodile Dams","Dairy","Deboning Room","Dry Oven","Dry Storage","Drying Facility","Drying Ovens","Drying Racks","Drying Strips","Drying Tunnels","Egg Grading Facility","Egg Packaging Building","Elephant Enclosures","Embryo Room","Feed Dispensers","Feed Mill","Feed Storeroom","Feeding Lot","Feeding Pens","Feeding Shelter","Feeding Troughs","Filter Station","Fish Market Buildings","Flavour Shed","Game Cage Facility","Game Lodge","Game Pens","Game Room","Game Slaughter Area","Game Viewing Area","Grading Room","Handling Facilities","Hatchery","Hide Store","Hing Pen","Horse Walker","Hunters","Hide Storeroom","Inspection Room","Kennels","Kraal","Laying Hen House","Maternity House","Maternity Pens","Meat Processing Facility","Milk Bottling Plant","Milk Tank Room","Milking Parlour","Other","Packaging Complex","Packaging Facility","Paddocks","Pasteurising Facility","Pens","Pig Sty","Poison Store","Post-Feeding Shed","Processing Facility","Quarantine Area","Racing Track","Rankin Game","Refrigeration Facility","Rehab Facility","Saddle Room","Sales Facility","Selling Kraal","Shearing Facility","Shed","Shelter","Shooting Range","Skinning Facility","Slaughter Facility","Sorting Facility","Stable","Stall","Stock Handling Facility","Storage Facility","Sty","Surgery","Treatment Area","Trout Dam","Warehouse"],"Crop Cultivation & Processing":["Crop Cultivation & Processing","Barrel Maturation Room","Bottling Facility","Carton Shed","Cellar","Chemical Shed","Compost Pasteurising Unit","Compost Preparing Unit","Cooling Facility","Crushing Plant","Dark Room","Degreening Room","Dehusking Shed","Dry Oven","Dry Sow House","Dry Storage","Drying Facility","Drying Ovens","Drying Racks","Drying Strips","Drying Tunnels","Farrowing House","Fertilizer Shed","Flavour Shed","Food Plant Shed","Fruit Dry Tracks","Fruit Hopper","Gardening Facility","Germination Facility","Grading Room","Grain Handling Equipment","Grain Loading Facility","Grain Mill","Grain Silos","Grain Store","Greenhouse","Grower Unit","Handling Facilities","Hopper","Hothouse","Igloo","Inspection Room","Irrigation Dam","Irrigation Pump","Irrigation Reservoir","Irrigation System","Mill","Milling Store","Mushroom Cultivation Building","Mushroom Sweat Room","Nursery (Plant)","Nut Cracking Facility","Nut Factory","Oil Store","Onion Drying Shed","Other","Packaging Complex","Packaging Facility","Pesticide Store","Poison Store","Processing Facility","Refrigeration Facility","Sales Facility","Seed Store","Seedling Growing Facility","Seedling Packaging Facility","Shed","Silo","Sorting Facility","Sprinklers","Storage Facility","Tea Drying Facility","Tea Room","Tobacco Dryers","Warehouse","Wine Cellar","Wine Storage Shed","Wine Tanks","Winery Building"],Residential:["Ablution Facility","Accommodation Units","Attic","Balcony","Bathroom","Bedroom","Building","Bungalow","Bunk House","Cabin","Camp Accommodation","Canteen","Caretaker's Dwelling","Chalet","Cloak Room","Community Dwelling","Cottage","Dining Area","Dining Facility","Dormitory","Dressing Rooms","Drivers' Accommodation","Dwelling","Estate House","Flat","Foreman's Dwelling","Game Lodge","Guest Accommodation","Homestead","Hostels","House","Hunters' Accommodation","Hunters' Kitchen","Hut","Kitchen","Lapa","Lean-to","Lodge","Loft","Log Cabin","Longdavel","Lounge","Luncheon Areas","Luxury Accommodation","Manager's Dwelling","Manor House","Maternity House","Other","Owner's Dwelling","Parlor","Shed","Shower","Staff Ablutions","Staff Accommodation","Staff Building","Staff Compound","Staff Dining Facility","Stoop","Tavern","Teachers' Dwellings","Toilet - Outdoor","Toilet Block","Toilets","Toilets - Staff","Veranda","Winemakers' Dwelling","Workers' Ablutions","Workers' Accommodation","Workers' Kitchen","Workers' School"],Business:["Ablution Facility","Administration Block","Administrative Building","Administrative Offices","Animal Sale Facility","Auction Facilities","Barrel Maturation Room","Bathroom","Bottling Facility","Building","Charcoal Factory","Cheese Factory","Cloak Room","Cloth House","Commercial Buildings","Conference Facility","Cooling Facility","Distribution Centre","Factory Building","Fish Market Buildings","Functions Centre","Furniture Factory","Grading Room","Industrial Warehouse","Inspection Room","Ironing Room","Kiosk","Laboratory","Laundry Facility","Lean-to","Liquor Store","Loading Area","Loading Bay","Loading Platform","Loading Shed","Locker Room","Lockup Shed","Mechanical Workshop","Office","Office Building","Office Complex","Other","Packaging Complex","Packaging Facility","Pallet Factory","Pallet Stacking Area","Pill Factory","Processing Facility","Reception Area","Refrigeration Facility","Sales Facility","Saw Mill","Security Office","Shed","Shop","Sorting Facility","Staff Building","Staff Compound","Storage Facility","Studio","Toilet - Outdoor","Toilet Block","Toilets","Toilets - Client","Toilets - Office","Toilets - Staff","Transport Depot","Warehouse","Wine Cellar","Wine Shop","Wine Tasting Room","Winery Building","Work Station","Workers' Ablutions","Workers' Accommodation","Workers' Kitchen","Workers' School","Workshop"],"Equipment & Utilities":["Air Conditioners","Aircraft Hangar","Backup Generator","Boiler Room","Borehole","Borehole - Equipped","Borehole - Pump","Bulk Tank Room","Caravan Room","Carport","Carport - Double","Carton Shed","Chemical Shed","Compressor Room","Control Hut","Cooling Facility","Diesel Room","Electricity Room","Engine Room","Equipment Stores","Eskom Transformer","Filter Station","Fuel Depot","Fuel Store","Fuel Tank","Garage","Garage - Double","Garage - Triple","Generator Room","Hangar","Helipad","Hydro Tanks","Hydrophonic Pond","Laying Hen House Equipment","Machinery Room","Mechanical Workshop","Oil Store","Other","Oven","Petrol Storage","Poison Store","Power Room","Pump","Pump House Equipment","Pumphouse","Refuelling Canopy","Scale","Shed","Solar Power Room","Tank Stand","Tanks","Tool Shed","Tractor Shed","Transformer Room","Transport Depot","Truck Shelter","Truck Wash","Turbine Room","Twin Engine Generator Unit","Tyre Shed","Utility Building","Utility Room","Water Purification Plant","Water Reticulation Works","Water Storage Tanks","Water Tower"],Infrastructure:["Ablution Facility","Access Roads","All Infrastructure","Attic","Balcony","Barn","Bathroom","Bedroom","Bell Arch","Bin Compartments","Boiler Room","Borehole","Borehole - Equipped","Borehole - Pump","Building","Bulk Tank Room","Bunker","Canopy","Canteen","Cellar","Classroom","Cloak Room","Concrete Slab","Concrete Surfaces","Courtyard","Covered Area","Dam","Dam - Filter","Debris Filter Pond","Deck","Driveway","Electric Fencing","Electric Gate","Electricity Room","Entrance Building","Entrance Gate","Fencing","Fencing (Game)","Fencing (Perimeter)","Fencing (Security)","Flooring","Foyer","Gate","Gate - Sliding","Gate House","Gazebo","Guardhouse","Hall","House","Hut","Hydro Tanks","Hydrophonic Pond","Infrastructure","Irrigation Dam","Irrigation Pump","Irrigation Reservoir","Irrigation System","Kiosk","Kitchen","Koi Pond","Kraal","Laboratory","Landing Strip","Laundry Facility","Lean-to","Lockup Shed","Longdavel","Mezzanine","Other","Outbuilding","Outdoor Room","Outhouse","Parking Area","Parlor","Patio","Paving","Pens","Poles","Pool Facility","Pool House","Porch","Porte Cochere","Reservoir","Reservoir Pumphouse","Reservoir Tower","Road Stall","Rondavel","Roofing","Room","Ruin","Runway","Security Office","Shade Netting","Shade Port","Shed","Shooting Range","Shower","Silo","Slab","Splash Pool","Sprinklers","Stable","Stoop","Storage Facility","Studio","Surrounding Works","Tarmac","Tarred Area","Tarred Road Surfaces","Terrace","Toilet - Outdoor","Toilet Block","Toilets","Toilets - Client","Toilets - Office","Toilets - Staff","Trench","Tunnel","Tunnel Building","Vacant Areas","Veranda","Walkways","Walls","Walls (Boundary)","Walls (Retaining)","Walls (Security)","Warehouse","Water Feature","Water Storage Tanks","Water Tower","Wire Enclosures","Work Station"],"Recreational & Misc.":["Anti-Poaching Training Facility","Archive Room","Arena","Art Gallery","Bar","Barrel Maturation Room","BBQ","BBQ Facility","Café","Canteen","Caravan Room","Chapel","Church","Church Facility","Classroom","Cloth House","Clubhouse","Coffee Shop","Community Centre","Compost Pasteurising Unit","Compost Preparing Unit","Dark Room","Entertainment Area","Entertainment Facility","Functions Centre","Funeral Building","Furniture Factory","Gallery","Game Room","Golf Clubhouse","Gymnasium","Helipad","Hydro Tanks","Hydrophonic Pond","Igloo","Ironing Room","Jacuzzi","Judging Booth","Kiosk","Koi Pond","Laundry Facility","Liquor Store","Locker Room","Lounge","Luncheon Areas","Museum","Nursery School","Nursing Home","Other","Parlor","Pill Factory","Play Area","Pool Facility","Pool House","Pottery Room","Pub","Reception Area","Recreation Facility","Rehab Facility","Restaurant","Retirement Centre","Salon","Sauna","Saw Mill","School","Spa Baths","Spa Complex","Splash Pool","Squash Court","Sulphur Room","Surgery","Swimming Pool - Indoor","Swimming Pool - Outdoor","Swimming Pool Ablution","Tavern","Tea Room","Tennis Court","Treatment Area","Trout Dam","Venue Hall","Vitamin Room","Wedding Venue","Weigh Bridge","Weigh Bridge Control Room","Wellness Centre","Windmill"]},livestock:{Cattle:{Breeding:["Phase A Bulls","Phase B Bulls","Phase C Bulls","Phase D Bulls","Heifers","Bull Calves","Heifer Calves","Tollies 1-2","Heifers 1-2","Culls"],Dairy:["Bulls","Dry Cows","Lactating Cows","Heifers","Calves","Culls"],Slaughter:["Bulls","Cows","Heifers","Weaners","Calves","Culls"]},Sheep:{Breeding:["Rams","Young Rams","Ewes","Young Ewes","Lambs","Wethers","Culls"],Slaughter:["Rams","Ewes","Lambs","Wethers","Culls"]},Pigs:{Slaughter:["Boars","Breeding Sows","Weaned pigs","Piglets","Porkers","Baconers","Culls"]},Chickens:{Broilers:["Day Old Chicks","Broilers"],Layers:["Hens","Point of Laying Hens","Culls"]},Ostriches:{Slaughter:["Breeding Stock","Slaughter Birds > 3 months","Slaughter Birds < 3 months","Chicks"]},Goats:{Slaughter:["Rams","Breeding Ewes","Young Ewes","Kids"]}},vme:{Vehicles:["Bakkie","Car","Truck","Tractor"],Machinery:["Mower","Mower Conditioner","Hay Rake","Hay Baler","Harvester"],Equipment:["Plough","Harrow","Ridgers","Rotovator","Cultivator","Planter","Combine","Spreader","Sprayer","Mixer"]}},j=["Good","Good to fair","Fair","Fair to poor","Poor"],k={livestock:{Cattle:["Breeding","Dairy","Slaughter"],Sheep:["Breeding","Slaughter"],Pigs:["Slaughter"],Chickens:["Broilers","Layers"],Ostriches:["Slaughter"],Goats:["Slaughter"]}},l=["Cape","Summer","Fruit","Winter"],m={crop:["Cropland"],farmland:[],improvement:[],cropland:["Cropland","Irrigated Cropland"],livestock:["Grazing","Planted Pastures","Conservation"],pasture:["Grazing","Planted Pastures","Conservation"],"permanent crop":["Horticulture (Perennial)"],plantation:["Plantation"],vme:[],wasteland:["Grazing","Structures (Handling)","Structures (Processing)","Structures (Storage)","Utilities","Wasteland"],"water right":["Water Right"]},n={Cropland:["Barley","Bean","Bean (Broad)","Bean (Dry)","Bean (Sugar)","Bean (Green)","Bean (Kidney)","Canola","Cassava","Cotton","Cowpea","Grain Sorghum","Groundnut","Maize","Maize (White)","Maize (Yellow)","Oats","Pearl Millet","Potato","Rape","Rice","Rye","Soya Bean","Sunflower","Sweet Corn","Sweet Potato","Tobacco","Triticale","Wheat","Wheat (Durum)"],Grazing:["Bahia-Notatum","Bottle Brush","Buffalo","Buffalo (Blue)","Buffalo (White)","Bush","Cocksfoot","Common Setaria","Dallis","Phalaris","Rescue","Rhodes","Smuts Finger","Tall Fescue","Teff","Veld","Weeping Lovegrass"],"Horticulture (Perennial)":["Almond","Aloe","Apple","Apricot","Avocado","Banana","Cherry","Coconut","Coffee","Grape","Grape (Bush Vine)","Grape (Red)","Grape (Table)","Grape (White)","Grapefruit","Guava","Hops","Kiwi Fruit","Lemon","Litchi","Macadamia Nut","Mandarin","Mango","Nectarine","Olive","Orange","Papaya","Peach","Pear","Pecan Nut","Persimmon","Pineapple","Pistachio Nut","Plum","Rooibos","Sisal","Sugarcane","Tea","Walnuts"],"Horticulture (Seasonal)":["Asparagus","Beet","Beetroot","Blackberry","Borecole","Brinjal","Broccoli","Brussel Sprout","Cabbage","Cabbage (Chinese)","Cabbage (Savoy)","Cactus Pear","Carrot","Cauliflower","Celery","Chicory","Chili","Cucumber","Cucurbit","Garlic","Ginger","Granadilla","Kale","Kohlrabi","Leek","Lentil","Lespedeza","Lettuce","Makataan","Mustard","Mustard (White)","Onion","Paprika","Parsley","Parsnip","Pea","Pea (Dry)","Pepper","Pumpkin","Quince","Radish","Squash","Strawberry","Swede","Sweet Melon","Swiss Chard","Tomato","Turnip","Vetch (Common)","Vetch (Hairy)","Watermelon","Youngberry"],Plantation:["Bluegum","Pine","Wattle"],"Planted Pastures":["Birdsfoot Trefoil","Carribean Stylo","Clover","Clover (Arrow Leaf)","Clover (Crimson)","Clover (Persian)","Clover (Red)","Clover (Rose)","Clover (Strawberry)","Clover (Subterranean)","Clover (White)","Kikuyu","Lucerne","Lupin","Lupin (Narrow Leaf)","Lupin (White)","Lupin (Yellow)","Medic","Medic (Barrel)","Medic (Burr)","Medic (Gama)","Medic (Snail)","Medic (Strand)","Ryegrass","Ryegrass (Hybrid)","Ryegrass (Italian)","Ryegrass (Westerwolds)","Serradella","Serradella (Yellow)","Silver Leaf Desmodium"]};return{assetTypes:function(){return g},seasonTypes:function(){return l},listServiceMap:function(){return f},getAssetClass:function(a){return g[a]},getAssetTitle:function(a){return e(a)},getAssetLandUse:function(a){return m[a]},getAssetSubtypes:function(a){return h[a]||[]},getAssetCategories:function(a,b){return i[a]?i[a][b]||[]:[]},getAssetPurposes:function(a,b){return k[a]?k[a][b]||[]:[]},getCropsForLandUse:function(a){return n[a]||[]},getZoneTitle:function(b){return a("number")(b.size,2)+"Ha at Stage "+b.growthStage+" ("+b.cultivar+")"},conditionTypes:function(){return j},isFieldApplicable:function(a,b){return m[a]&&-1!==m[a].indexOf(b.landUse)},generateAssetKey:function(a,b,c){a.assetKey="entity."+b.uuid+("farmland"!==a.type&&c?"-f."+c.name:"")+("crop"===a.type&&a.data.season?"-s."+a.data.season:"")+(a.data.fieldName?"-fi."+a.data.fieldName:"")+(a.data.crop?"-c."+a.data.crop:"")+("cropland"===a.type&&a.data.irrigated?"-i."+a.data.irrigation:"")+("farmland"===a.type&&a.data.sgKey?"-"+a.data.sgKey:"")+("improvement"===a.type||"livestock"===a.type||"vme"===a.type?(a.data.type?"-t."+a.data.type:"")+(a.data.category?"-c."+a.data.category:"")+(a.data.name?"-n."+a.data.name:"")+(a.data.purpose?"-p."+a.data.purpose:"")+(a.data.model?"-m."+a.data.model:"")+(a.data.identificationNo?"-in."+a.data.identificationNo:""):"")+(a.data.waterSource?"-ws."+a.data.waterSource:"")},cleanAssetData:function(a){return"vme"==a.type?(a.data.quantity=a.data.identificationNo&&a.data.identificationNo.length>0?1:a.data.quantity,a.data.identificationNo=1!=a.data.quantity?"":a.data.identificationNo):"cropland"==a.type&&(a.data.equipped=a.data.irrigated?a.data.equipped:!1),a},calculateValuation:function(a,b){return"vme"==a.type&&0==isNaN(a.data.quantity)?b.assetValue=a.data.quantity*(b.unitValue||0):"livestock"==a.type&&0==isNaN(b.totalStock)?b.assetValue=b.totalStock*(b.unitValue||0):"crop"==a.type&&0==isNaN(b.expectedYield)?b.assetValue=b.expectedYield*(b.unitValue||0):"improvement"!=a.type&&0==isNaN(a.data.size)&&(b.assetValue=a.data.size*(b.unitValue||0)),b},generateFarmlandAssetLabels:function(a){"farmland"==a.type&&(a.data.portionLabel=a.data.portionNumber?a.data.remainder?"Rem. portion "+a.data.portionNumber:"Portion "+a.data.portionNumber:"Rem. extent",a.data.farmLabel=(a.data.officialFarmName&&!_(a.data.officialFarmName.toLowerCase()).startsWith("farm")?_(a.data.officialFarmName).titleize()+" ":"")+(a.data.farmNumber?a.data.farmNumber:""),a.data.label=a.data.portionLabel+(a.data.farmLabel&&_.words(a.data.farmLabel).length>0?" of "+("farm"==_.words(a.data.farmLabel.toLowerCase())[0]?_(a.data.farmLabel).titleize():"farm "+_(a.data.farmLabel).titleize()):"farm Unknown"))}}}]),sdkHelperAssetApp.factory("assetValuationHelper",["assetHelper","underscore",function(a,b){function c(a,b){var c=12*(b.getFullYear()-a.getFullYear());return c-=a.getMonth()+1,c+=b.getMonth(),0>=c?0:c}var d=function(a){return{title:a.organization.name,subtitle:"Valued at "+a.currency+" "+a.assetValue,date:a.date}};return{listServiceMap:function(){return d},calculateAssetValue:function(a){"vme"==a.type&&0==isNaN(a.data.quantity)?a.data.assetValue=a.data.quantity*(a.data.unitValue||0):"livestock"==a.type&&0==isNaN(a.data.totalStock)?a.data.assetValue=a.data.totalStock*(a.data.unitValue||0):"crop"==a.type&&0==isNaN(a.data.expectedYield)?a.data.assetValue=a.data.expectedYield*(a.data.unitValue||0):"improvement"==a.type?(a.data.valuation=a.data.valuation||{},a.data.valuation.totalDepreciation=b.reduce(["physicalDepreciation","functionalDepreciation","economicDepreciation","purchaserResistance"],function(b,c){return isNaN(a.data.valuation[c])?b:b+a.data.valuation[c]/100},0),a.data.assetValue=Math.round((a.data.valuation.replacementValue||0)*(1-Math.min(a.data.valuation.totalDepreciation,1)))):"improvement"!=a.type&&0==isNaN(a.data.size)&&(a.data.assetValue=a.data.size*(a.data.unitValue||0)),a.data.assetValue=Math.round(100*a.data.assetValue)/100},getApplicableGuidelines:function(d,e,f){var g=a.getAssetLandUse(e.type),h=b.chain(d).filter(function(a){return-1!==g.indexOf(a.assetClass)});if("cropland"===e.type)h=h.filter(function(a){return f.irrigated===!0&&"Irrigated Cropland"===a.assetClass||f.irrigated!==!0&&"Cropland"===a.assetClass&&(void 0===a.soilPotential||a.soilPotential===f.croppingPotential)
});else if("pasture"===e.type||"wasteland"===e.type)h=h.where({assetClass:f.landUse}).filter(function(a){return(void 0===e.data.crop&&void 0===a.crop||void 0!==a.crop&&-1!==a.crop.indexOf(e.data.crop))&&(void 0===f.terrain&&void 0===a.terrain||a.terrain===f.terrain)});else if("permanent crop"===e.type){var i=new Date(Date.parse(e.data.establishedDate)),j=c(i,new Date);h=h.filter(function(a){return(void 0===a.crop||-1!==a.crop.indexOf(e.data.crop))&&(void 0===a.irrigationType||-1!==a.irrigationType.indexOf(f.irrigation))&&(void 0===a.minAge||j>=a.minAge)&&(void 0===a.maxAge||j<a.maxAge)})}else"plantation"===e.type?h=h.filter(function(a){return void 0===a.crop||-1!==a.crop.indexOf(e.data.crop)}):"water right"===e.type&&(h=h.filter(function(a){return void 0===a.waterSource||-1!==a.waterSource.indexOf(e.data.waterSource)}));return h.value()}}}]);var sdkHelperAttachmentApp=angular.module("ag.sdk.helper.attachment",["ag.sdk.library"]);sdkHelperAttachmentApp.provider("attachmentHelper",["underscore",function(a){var b={defaultImage:"img/camera.png"};this.config=function(c){b=a.defaults(c||{},b)},this.$get=function(){var c=function(b,c){return void 0!==b?(b instanceof Array==0&&(b=[b]),a.chain(b).filter(function(a){return void 0!==a.sizes&&void 0!==a.sizes[c]}).map(function(a){return a.sizes[c].src}).last().value()):b};return{getSize:function(a,d,e){return c(a,d)||e||b.defaultImage},getThumbnail:function(a,d){return c(a,"thumb")||d||b.defaultImage}}}}]),app.factory("resizeImageService",["promiseService","underscore",function(a,b){return function(c,d){var e=function(a){var c=document.createElement("canvas"),e=c.getContext("2d");if(d=b.defaults(d||{},{width:80,height:80,center:!0,crop:!0,output:"image/png"}),c.width=d.width,c.height=d.height,d.crop){var f=0,g=0,h=d.width*a.height/d.height>a.width,i=Math.floor(h?a.width:d.width*a.height/d.height),j=Math.floor(h?d.height*a.width/d.width:a.height);d.center&&(f=h?0:Math.floor((i-d.width)/2),g=h?Math.floor((j-d.height)/2):0),e.drawImage(a,f,g,i,j,0,0,d.width,d.height)}else e.drawImage(a,0,0,d.width,d.height);return c.toDataURL(d.output,1)};return a.wrap(function(a){if("string"==typeof c){var b=new Image;loader.onload=function(){a.resolve(e(b))},loader.src=b}else a.resolve(e(c))})}}]);var sdkHelperCropInspectionApp=angular.module("ag.sdk.helper.crop-inspection",["ag.sdk.helper.document","ag.sdk.library"]);sdkHelperCropInspectionApp.factory("cropInspectionHelper",["documentHelper","underscore",function(a,b){var c=["Approved","Not Approved","Not Planted"],d=["Crop amendment","Crop re-plant","Insurance coverage discontinued","Multi-insured","Other","Without prejudice","Wrongfully reported"],e=[["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12","R13","R14"],["V0","V1","V2","V3","V4","V5","R1","R2","R3","R4","R5","R6"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","R1","R2","R3","R4","R5","R6","R7","R8","R9"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","V17","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","V17","V18","V19","V20","V21","V22","V23","V24","V25","V26","V27","V28","R1","R2","R3","R4","R5","R6","R7","R8"],["V0","V1","V2","V3","V4","V5","V6","V7","R1","R2","R3","R4","R5","R6","R7","R8","R9"],["V0","V1","V2","V3","V4","V5","V6","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12","R13","R14","R15","R16","R17","R18"],["V0","V1","V2","V3","V4","R1","R2","R3","R4","R5","R6"],["V0","V1","V2","V3","V4","V5","V6","V7","R1","R2","R3","R4","R5","R6"]],f={Barley:e[1],Bean:e[5],"Bean (Broad)":e[5],"Bean (Dry)":e[5],"Bean (Sugar)":e[5],"Bean (Green)":e[5],"Bean (Kidney)":e[5],Canola:e[7],Cotton:e[6],"Grain Sorghum":e[3],Maize:e[0],"Maize (White)":e[0],"Maize (Yellow)":e[0],"Soya Bean":e[2],Sunflower:e[4],Wheat:e[1],"Wheat (Durum)":e[1]},g={"emergence inspection":"Emergence Inspection","hail inspection":"Hail Inspection","harvest inspection":"Harvest Inspection","preharvest inspection":"Pre Harvest Inspection","progress inspection":"Progress Inspection"},h=[["Maize Commodity","Maize Hybrid","Maize Silo Fodder"]],i={Maize:h[0],"Maize (White)":h[0],"Maize (Yellow)":h[0]},j=["Hail","Multi Peril"],k={Hail:["hail inspection"],"Multi Peril":b.keys(g)},l={disease:"Disease",fading:"Fading",uneven:"Uneven",other:"Other",root:"Root",shortage:"Shortage",weed:"Weed"},m={"Dry Bean":"pod","Grain Sorghum":"panicle","Maize (White)":"ear","Maize (Yellow)":"ear",Sunflower:"flower",Wheat:"spikelet","Soya Bean":"pod"};return{approvalTypes:function(){return c},commentTypes:function(){return d},inspectionTitles:function(){return g},inspectionTypes:function(){return b.keys(g)},policyTypes:function(){return j},policyInspectionTypes:function(a){return k[a]||[]},problemTypes:function(){return l},getFlowerType:function(a){return m[a]||""},getGrowthStages:function(a){return f[a]||e[0]},getSeedTypes:function(a){return i[a]},getInspectionTitle:function(a){return g[a]||""},getProblemTitle:function(a){return l[a]||""},getSampleArea:function(a,b){return"spikelet"===m[a.data.crop]?b&&b.plantedInRows===!0?"3m":"m²":"pod"===m[a.data.crop]?"3m":"10m"},hasSeedTypes:function(a){return void 0!==i[a]},calculateProgressYield:function(a,c,d,e){d=d||0,e=void 0===e?100:e;var f=function(a,c){return b.reduce(a,function(a,b){return b[c]?a+b[c]:a},0)/a.length||0},g=b.map(a.data.zones,function(g,h){var i=b.where(c,{zone:h}),j={coverage:g.size/a.data.plantedArea,heads:f(i,"heads"),weight:f(i,"weight")};return"spikelet"===m[a.data.crop]?j.yield=j.weight*j.heads/((a.data.irrigated?3e3:3500)*(g.plantedInRows?3*g.rowWidth:1)):"pod"===m[a.data.crop]?(j.pods=f(i,"pods"),j.seeds=f(i,"seeds"),j.yield=d*j.seeds*j.pods*j.heads/(300*g.rowWidth)):j.yield=j.weight*j.heads/(1e3*g.rowWidth),j.yield*=e/100,j});return{zones:g,"yield":b.reduce(g,function(a,b){return a+b.coverage*b.yield},0)}}}}]),sdkHelperCropInspectionApp.factory("cultivarHelper",["underscore",function(a){var b={"Maize (Yellow)":{Afgri:["AFG 4222 B","AFG 4244","AFG 4270 B","AFG 4410","AFG 4412 B","AFG 4414","AFG 4416 B","AFG 4434 R","AFG 4440","AFG 4448","AFG 4452 B","AFG 4474 R","AFG 4476","AFG 4478 BR","AFG 4512","AFG 4520","AFG 4522 B","AFG 4530","AFG 4540","AFG 4546","AFG 4548","AFG 4566 B","AFG 4572 R","AFG 4660","AFG 4664","DK 618","Other"],Agricol:["IMP 50-90 BR","IMP 51-22 B","IMP 51-92","IMP 51-92 R","Other","QS 7646","SC 602","SC 608"],"Capstone Seeds":["CAP 121-30","CAP 122-60","CAP 130-120","CAP 130-140","CAP 444 NG","CAP 766 NG","CAP 9004","CAP 9444 NG","Other"],"Dekalb (Monsanto)":["DKC 61-90","DKC 62-80 BR","DKC 62-80 BR GEN","DKC 62-84 R","DKC 64-78 BR","DKC 64-78 BR GEN","DKC 66-32 B","DKC 66-36 R","DKC 66-60 BR","DKC 73-70 B GEN","DKC 73-72","DKC 73-74 BR GEN","DKC 73-76 R","DKC 80-10","DKC 80-12 B GEN","DKC 80-30 R","DKC 80-40 BR GEN","Other"],"Delta Seed":["Amber","DE 2004","DE 2006","DE 2016","DE 222","Other"],"Klein Karoo Saad":["Helen","KKS 8202","KKS 8204 B","KKS 8400","KKS 8402","Other"],Linksaad:["LS 8518","LS 8524 R","LS 8526","LS 8528 R","LS 8532 B","LS 8536 B","Other"],Pannar:["BG 3268","BG 3292","BG 3492BR","BG 3568R","BG 3592R","BG 3768BR","BG 4296","BG 6308B","Other","PAN 14","PAN 3D-736 BR","PAN 3P-502 R","PAN 3P-730 BR","PAN 3Q-222","PAN 3Q-240","PAN 3Q-740 BR","PAN 3R-644 R","PAN 4P-228","PAN 4P-716 BR","PAN 6126 ","PAN 66","PAN 6616","PAN 6P-110","PAN 6P110","PAN 6Q-408B","PAN 6Q-508 R","PAN 6Q-708 BR"],Pioneer:["Other","P 1615 R","P 2048","Phb 31D21 B","Phb 31D24","Phb 31D46 BR","Phb 31D48 B","Phb 31G54 BR","Phb 31G56 R","Phb 31K58 B","Phb 32D95 BR","Phb 32D96 B","Phb 32D99","Phb 32P68 R","Phb 32T50","Phb 32W71","Phb 32W72 B","Phb 33A14 B","Phb 33H52 B","Phb 33H56","Phb 33Y72 B","Phb 33Y74","Phb 3442","Phb 34N44 B","Phb 34N45 BR","Phb 35T05 R"],"Sensako (Monsanto)":["Other","SNK 2472","SNK 2682","SNK 2778","SNK 2900","SNK 2942","SNK 2972","SNK 6326 B","SNK 7510 Y","SNK 8520"],Other:["Brasco","Cobber Flint","Cumbre","Energy","Gold Finger","High Flyer","IMP 50-10 R","IMP 51-22","IMP 52-12","MEH 114","MMH 1765","MMH 8825","Maverik","NK Arma","NK MAYOR B","NS 5000","NS 5004","NS 5066","NS 5914","NS 5916","NS 5918","NS 5920","Other","Premium Flex","QS 7608","RO 430","SA 24","SABI 7004","SABI 7200","Silmaster","Syncerus","US 9570","US 9580","US 9600","US 9610","US 9620","US 9770","US 9772","Woodriver"]},"Maize (White)":{Afgri:["AFG 4211","AFG 4321","AFG 4331","AFG 4333","AFG 4361","AFG 4383","AFG 4411","AFG 4445","AFG 4447","AFG 4471","AFG 4475 B","AFG 4477","AFG 4479 R","AFG 4501","AFG 4517","AFG 4555","AFG 4571 B","AFG 4573 B","AFG 4575","AFG 4577 B","AFG 4579 B","AFG 4581 BR","AFG 4611","AFG 4663","AFRIC 1","Other"],Agricol:["IMP 52-11","Other","SC 701","SC 709"],"Capstone Seeds":["CAP 341 NG","CAP 341 T NG","CAP 441 NG","CAP 775 NG","CAP 9001","CAP 9013","CAP 9421","Other"],"Dekalb (Monsanto)":["CRN 3505","CRN 4141","DKC 77-61 B","DKC 77-85 B GEN","DKC 78-15 B","DKC 78-17 B","DKC 78-35 R","DKC 78-45 BR","DKC 78-45 BR GEN","DKC 79-05","Other"],"Delta Seed":["DE 111","DE 303","Other"],"Klein Karoo Saad":["KKS 4383","KKS 4445","KKS 4447","KKS 4471","KKS 4473","KKS 4477","KKS 4479 R","KKS 4485","KKS 4501","KKS 4517","KKS 4519","KKS 4555","KKS 4575","KKS 4581 BR","KKS 8401","Other"],Linksaad:["LS 8519","LS 8529","LS 8533 R","LS 8535 B","LS 8537","LS 8539 B","Other"],Pannar:["BG 5485B","BG 5685R","BG4201","BG4401B","BG5285","BG5785BR","BG6683R","Other","PAN 413","PAN 4P-767BR","PAN 53","PAN 5Q-649 R","PAN 5Q-749 BR","PAN 5Q-751BR","PAN 6227","PAN 6479","PAN 6611","PAN 6671","PAN 67","PAN 6777","PAN 69","PAN 6Q-745BR","PAN 93","PAN413","PAN53","PAN6Q245","PAN6Q345CB","SC 701 (Green mealie)"],Pioneer:["Other","P 2369 W","P 2653 WB","P 2823 WB","P 2961 W","Phb 30B95 B","Phb 30B97 BR","Phb 30D04 R","Phb 30D07 B","Phb 30D09 BR","Phb 30Y79 B","Phb 30Y81 R","Phb 30Y83","Phb 31M09","Phb 31M84 BR","Phb 31T91","Phb 31V31","Phb 3210B","Phb 32A05 B","Phb 32B07 BR","Phb 32Y85","Phb 32Y87 B"],"Sensako (Monsanto)":["SNK 2021","SNK 2147","SNK 2401","SNK 2551","SNK 2721","SNK 2911","SNK 2969","SNK 6025","SNK 7811 B"],Other:["CG 4141","GM 2000","KGALAGADI","MRI 514","MRI 624","NG 761","NS 5913","NS 5917","NS 5919","Other","PGS 7053","PGS 7061","PGS 7071","PLATINUM","Panthera","QS 7707","RO 413","RO 413","RO 419","SAFFIER","SC 401","SC 403","SC 405","SC 407","SC 513","SC 627","SC 631","SC 633","SC 713","SC 715","Scout"]},"Soya Bean":{Agriocare:["AGC 58007 R","AGC 60104 R","AGC 64107 R","AS 4801 R","Other"],Linksaad:["LS 6146 R","LS 6150 R","LS 6161 R","LS 6164 R","LS 6248 R","LS 6261 R","LS 6444 R","LS 6466 R","Other"],Pannar:["A 5409 RG","Other","PAN 1454 R","PAN 1583 R","PAN 1664 R","PAN 1666 R"],Pioneer:["Other","Phb 94Y80 R","Phb 95B53 R","Phb 95Y20 R","Phb 95Y40 R"],Other:["AG 5601","AMSTEL NO 1","DUMELA","DUNDEE","EGRET","HERON","HIGHVELD TOP","IBIS 2000","JF 91","JIMMY","KIAAT","KNAP","LEX 1233 R","LEX 1235 R","LEX 2257 R","LEX 2685 R","LIGHTNING","MARULA","MARUTI","MOPANIE","MPIMBO","MUKWA","NQUTU","OCTA","Other","SONOP","SPITFIRE","STORK","TAMBOTIE","WENNER"]},Sunflower:{Agricol:["AGSUN 5161 CL","AGSUN 5182 CL","Agsun 5264","Agsun 5671","Agsun 8251","Nonjana","Other","SUNSTRIPE"],"Klein Karoo Saad":["AFG 271","HYSUN 333","KKS 318","NK ADAGIO","NK Armoni","NK FERTI","Other","Sirena","Sunbird"],Pannar:["Other","PAN 7033","PAN 7049","PAN 7050","PAN 7057","PAN 7063 CL","PAN 7080","PAN 7086 HO","PAN 7095 CL","PAN 7351"],Other:["Ella","Grainco Sunstripe","HV 3037","HYSUN 334","HYSUN 338","HYSUN 346","HYSUN 350","Jade Emperor","Marica-2","NK Adagio CL","Nallimi CL","Other","SEA 2088 CL AO","SY 4045","SY 4200","Sikllos CL","WBS 3100"]}};b.Maize=angular.copy(b["Maize (Yellow)"]),angular.forEach(b["Maize (White)"],function(a,c){b.Maize[c]=_.chain(b.Maize[c]||[]).union(a).compact().uniq().sortBy(function(a){return a}).value()});var c={"Phb 30F40":23,"Phb 31G54 BR":19,"Phb 31G58":21,"Phb 32D95BR":18,"Phb 32D96 B":18,"Phb 32P68 R":20,"Phb 32T50":18,"Phb 32W71":21,"Phb 32W72 B":20,"Phb 33A14 B":19,"Phb 33H56":20,"Phb 33R78 B":21,"Phb 33Y72B":17,"Phb 3442":21,"Phb 30B95 B":23,"Phb 30B97 BR":23,"Phb 30D09 BR":20,"Phb 31M09":18,"Phb 32A05 B":19,"Phb 32B10":18,"Phb 32Y85":21,"Phb 31D48 BR":21,"Phb 32D91 R":20,"Phb 32D99":20,"Phb 32Y68":20,"Phb 3394":19,"Phb 33A13":19,"Phb 33H52 B":19,"Phb 33H54 BR":19,"Phb 33P34":20,"Phb 33P66":20,"Phb 33P67":20,"X 70200 T":23,"X 7268 TR":21,"Phb 30N35":23,"Phb 32A03":19,"Phb 32Y52":19,"Phb 32Y53":20,"Phb 33A03":19,"Phb 30H22":21,"Phb 32P75":20,"Phb 3335":20,"DKC62-74R":20,"DKC62-80BR":18,"DKC64-78BR":17,"DKC66-32B":21,"DKC66-36R":19,"DKC73-70BGEN":20,"DKC73-74BR":20,"DKC73-74BRGEN":20,"DKC73-76R":20,"DKC80-10":20,"DKC80-12B":20,"DKC80-30R":20,"DKC80-40BR":19,"DKC80-40BRGEN":21,CRN3505:21,"DKC77-61B":20,"DKC77-71R":20,"DKC77-85B":21,"DKC78-15B":20,"DKC78-35BR":21,"DKC78-45BRGEN":21,"DKC 78-79 BR":21,"CRN 3604":21,"CRN 37-60":20,"CRN 4760 B":23,"DKC 63-20":20,"DKC 66-21":21,"DKC 66-38 B":21,"DKC 63-28 R":21,"CRN 3549":21,"DKC 71-21":20,"SNK 2472":23,"SNK 2682":23,"SNK 2778":23,"SNK 2900":20,"SNK 2942":24,"SNK 2972":21,"SNK 6326 B":21,"SNK 8520":24,"SNK 2911":21,"SNK 6025":18,"LS 8504":20,"LS 8512":20,"LS 8518":19,"LS 8522 R":19,"LS 8511":19,"LS 8513":19,"LS 8519":19,"LS 8521 B":19,"LS 8523 B":19,"LS 8527 BR":19,"LS 8506":21,"LS 8508":20,"LS 8524 R":20,"LEX 800":23,"LS 8509":21,"LS 8517":23,"LS 8525":21,"LS 8529":21,"LS 8533 R":21,"LS 8536 B":19,"PAN 3D-432Bt ":18,"PAN 3D-736BR":18,"PAN 3P-502RR":19,"PAN 3P-730BR":18,"PAN 3Q-422B":18,"PAN 3Q-740BR":19,"PAN 3R-644R":18,"PAN 4P-116":19,"PAN 4P-316Bt":19,"PAN 4P-516RR":20,"PAN 4P-716BR":19,"PAN 6114":19,"PAN 6126":18,"PAN 6146":24,"PAN 6236Bt":18,"PAN 6238RR":18,"PAN 6480":23,"PAN 6616":23,"PAN 6724Bt":25,"PAN 6734":23,"PAN 6P-110":21,"PAN 6Q-308 B":21,"PAN 6Q-308 Bt":21,"PAN 6Q-408 CB":21,"PAN 6Q-508R":21,"PAN 6Q-508RR":20,"PAN 4P-767BR":19,"PAN 5Q-433Bt *":20,"PAN 5R-541RR":19,"PAN 6013Bt":23,"PAN 6017":21,"PAN 6043":23,"PAN 6053":23,"PAN 6223Bt":21,"PAN 6479":23,"PAN 6611":23,"PAN 6723":23,"PAN 6777":25,"PAN 6Q-419B":20,"PAN 6Q-445Bt":21,"PAN 6000 Bt":19,"PAN 6012 Bt":21,"PAN 6118":19,"PAN 6124 Bt":19,"PAN 6128 RR":19,"PAN 6256":24,"PAN 6310":24,"PAN 6316":25,"PAN 6320":25,"PAN 6432 B":23,"PAN 6568":23,"PAN 6622":25,"PAN 6710":21,"PAN 6804":20,"PAN 6844":25,"PAN 6994 Bt":24,"PAN 5Q-749 BR":23,"PAN 6243":24,"PAN 6335":23,"PAN 6573":23,"PAN 6633":23,"PAN 6757":25,"PAN 6839":23,"PAN 6Q-321 B":23,"PAN 6Q-345 CB":21,"AFG 4270B":18,"AFG 4412B":19,"AFG 4434R":20,"AFG 4522B":20,"AFG 4530":19,"AFG 4222 B":19,"AFG 4244":19,"AFG 4410":19,"AFG 4414":20,"AFG 4416 B":20,"AFG 4448":20,"AFG 4474 R":19,"AFG 4476":20,"AFG 4512":23,"AFG 4520":20,"AFG 4540":20,"DK 618":21,"EXPG 5002":20,"EXP Stack":20,"AFG 4321":19,"AFG 4331":20,"AFG 4333":20,"AFG 4411":21,"AFG 4445":21,"AFG 4447":21,"AFG 4471":23,"AFG 4475 B":21,"AFG 4477":20,"AFG 4479 R":21,"AFG 4573 B":21,"AFG 4577 B":21,"AFG 4611":23,"KKS 8204B":15,"KKS 4581 BR":21,"KKS 8301":19,"IMP 50 - 90BR":18,"IMP 51 - 22":19,"IMP 51-92":19,"IMP 52-12":20,"NS 5920":20,"QS 7646":20,"BG 5485 B":23,"BG 8285":23,Brasco:19,Energy:18,"Gold Finger":19,Helen:17,"High Flyer":17,Maverik:19,"NK Arma":18,"QS 7608":23,"SC 506":19,"SC 602":21,Woodriver:18,"P 1615 R":19,"P 1973 Y":19,"P 2653 WB":20,"P 2048":20,"IMP 52-11 B":18,Panthera:21,"QS 7707":23,"SC 401":18,"SC 403":20,"SC 405":20,"SC 407":20,"SC 533":21,"SC 719":24,Scout:20};return{getCultivars:function(a,c){return b[a]&&b[a][c]?b[a][c]:[]},getCultivarLeafCount:function(a){return c[a]||22},getSeedProviders:function(c){return b[c]?a.keys(b[c]):[]}}}]);var sdkHelperDocumentApp=angular.module("ag.sdk.helper.document",["ag.sdk.helper.task","ag.sdk.library"]);sdkHelperDocumentApp.provider("documentHelper",function(){var a=[],b={},c=function(a,b){return 1!=b?a.lastIndexOf("y")==a.length-1?a.substr(0,a.length-1)+"ies":a+"s":a};this.registerDocuments=function(c){c instanceof Array==!1&&(c=[c]),angular.forEach(c,function(c){-1===a.indexOf(c.docType)&&a.push(c.docType),c.deletable=c.deletable===!0,c.state=c.state||"document."+c.docType.replace(" ","-"),b[c.docType]=c})},this.getDocument=function(a){return b[a]},this.$get=["$filter","$injector","taskHelper","underscore",function(d,e,f,g){var h=function(a){if(b[a.docType]){var c=b[a.docType],f={id:a.id||a.__id,title:a.documentId?a.documentId:"",subtitle:(a.author?"By "+a.author+" on ":"On ")+d("date")(a.createdAt),docType:a.docType,group:c.title};return a.organization&&a.organization.name&&(f.title=a.organization.name,f.subtitle=a.documentId?a.documentId:""),a.data&&c&&c.listServiceMap&&(c.listServiceMap instanceof Array&&(c.listServiceMap=e.invoke(c.listServiceMap)),c.listServiceMap(f,a)),f}},i=function(a){if(b[a.docType]){var c=h(a),d=g.findWhere(a.tasks,{type:"parent"});return c&&d&&(c.status={text:d.status,label:f.getTaskLabel(d.status)}),c}};return{listServiceMap:function(){return h},listServiceWithTaskMap:function(){return i},filterDocuments:function(a){return g.filter(a,function(a){return void 0!==b[a.docType]})},pluralMap:function(a,b){return c(a,b)},documentTypes:function(){return a},documentTitles:function(){return g.pluck(b,"title")},getDocumentTitle:function(a){return b[a]?b[a].title:void 0},getDocumentState:function(a){return b[a]?b[a].state:void 0},getDocumentMap:function(a){return b[a]}}}]});var sdkHelperEnterpriseBudgetApp=angular.module("ag.sdk.helper.enterprise-budget",["ag.sdk.library"]);sdkHelperEnterpriseBudgetApp.factory("enterpriseBudgetHelper",["underscore",function(a){function b(a){a.data=a.data||{},a.data.details=a.data.details||{},a.data.sections=a.data.sections||[]}function c(a){return l[a]||a}function d(b,c){return angular.forEach(["income","expenses"],function(d){var e=a.findWhere(b.data.sections,void 0===c?{code:g[d].code}:{code:g[d].code,horticultureStage:c});void 0===e&&(e={code:g[d].code,name:g[d].name,productCategoryGroups:[],total:{value:0}},void 0!==c&&(e.horticultureStage=c),b.data.sections.push(e))}),b}var e=function(a){return{id:a.id||a.__id,title:a.name,subtitle:a.commodityType+(a.regionName?" in "+a.regionName:""),status:a.published?{text:"published",label:"label-success"}:!1}},f={crop:"Field Crop",livestock:"Livestock",horticulture:"Horticulture"},g={expenses:{code:"EXP",name:"Expenses"},income:{code:"INC",name:"Income"}},h=a.indexBy([{code:"INC-CPS",name:"Crop Sales"},{code:"INC-FRS",name:"Fruit Sales"},{code:"HVT",name:"Harvest"},{code:"HVP",name:"Preharvest"},{code:"INC-LSS",name:"Livestock Sales"},{code:"INC-LSP",name:"Product Sales"},{code:"EXP-AMF",name:"Animal Feed"},{code:"HBD",name:"Husbandry"},{code:"IDR",name:"Indirect Costs"},{code:"MRK",name:"Marketing"},{code:"RPM",name:"Replacements"}],"name"),i=a.indexBy([{code:"INC-LSS-SLAMB",name:"Lamb",unit:"head"},{code:"INC-LSS-SWEAN",name:"Weaner lambs",unit:"head"},{code:"INC-LSS-SEWE",name:"Ewe",unit:"head"},{code:"INC-LSS-SWTH",name:"Wether (2-tooth plus)",unit:"head"},{code:"INC-LSS-SRAM",name:"Ram",unit:"head"},{code:"INC-LSS-CCALV",name:"Calf",unit:"head"},{code:"INC-LSS-CWEN",name:"Weaner calves",unit:"head"},{code:"INC-LSS-CCOW",name:"Cow or heifer",unit:"head"},{code:"INC-LSS-CST18",name:"Steer (18 moths plus)",unit:"head"},{code:"INC-LSS-CST36",name:"Steer (3 years plus)",unit:"head"},{code:"INC-LSS-CBULL",name:"Bull (3 years plus)",unit:"head"},{code:"INC-LSS-GKID",name:"Kid",unit:"head"},{code:"INC-LSS-GWEAN",name:"Weaner kids",unit:"head"},{code:"INC-LSS-GEWE",name:"Ewe (2-tooth plus)",unit:"head"},{code:"INC-LSS-GCAST",name:"Castrate (2-tooth plus)",unit:"head"},{code:"INC-LSS-GRAM",name:"Ram (2-tooth plus)",unit:"head"},{code:"INC-LSP-MILK",name:"Milk",unit:"l"},{code:"INC-LSP-WOOL",name:"Wool",unit:"kg"},{code:"INC-HVT-CROP",name:"Crop",unit:"t"},{code:"INC-HVT-FRUT",name:"Fruit",unit:"t"},{code:"EXP-HVP-SEED",name:"Seed",unit:"kg"},{code:"EXP-HVP-PLTM",name:"Plant Material",unit:"each"},{code:"EXP-HVP-FERT",name:"Fertiliser",unit:"t"},{code:"EXP-HVP-LIME",name:"Lime",unit:"t"},{code:"EXP-HVP-HERB",name:"Herbicides",unit:"l"},{code:"EXP-HVP-PEST",name:"Pesticides",unit:"l"},{code:"EXP-HVP-SPYA",name:"Aerial spraying",unit:"ha"},{code:"EXP-HVP-INSH",name:"Crop Insurance (Hail)",unit:"t"},{code:"EXP-HVP-INSM",name:"Crop Insurance (Multiperil)",unit:"t"},{code:"EXP-HVP-HEDG",name:"Hedging cost",unit:"t"},{code:"EXP-HVT-LABC",name:"Contract work (Harvest)",unit:"ha"},{code:"EXP-HVT-STOR",name:"Storage",unit:"days"},{code:"EXP-HVT-PAKM",name:"Packaging material",unit:"each"},{code:"EXP-HVT-DYCL",name:"Drying and cleaning",unit:"t"},{code:"EXP-HVT-PAKC",name:"Packing cost",unit:"each"},{code:"EXP-IDR-FUEL",name:"Fuel",unit:"l"},{code:"EXP-IDR-REPP",name:"Repairs & parts",unit:"Total"},{code:"EXP-IDR-ELEC",name:"Electricity",unit:"Total"},{code:"EXP-IDR-WATR",name:"Water",unit:"Total"},{code:"EXP-IDR-LABP",name:"Permanent labour",unit:"Total"},{code:"EXP-IDR-SCHED",name:"Scheduling",unit:"Total"},{code:"EXP-IDR-LICS",name:"License",unit:"Total"},{code:"EXP-IDR-INSA",name:"Insurance assets",unit:"Total"},{code:"EXP-IDR-OTHER",name:"Other costs",unit:"Total"},{code:"EXP-RPM-SLAMB",name:"Lamb",unit:"head"},{code:"EXP-RPM-SWEAN",name:"Weaner lambs",unit:"head"},{code:"EXP-RPM-SEWE",name:"Ewe",unit:"head"},{code:"EXP-RPM-SWTH",name:"Wether (2-tooth plus)",unit:"head"},{code:"EXP-RPM-SRAM",name:"Ram",unit:"head"},{code:"EXP-RPM-CCALV",name:"Calf",unit:"head"},{code:"EXP-RPM-CWEN",name:"Weaner calves",unit:"head"},{code:"EXP-RPM-CCOW",name:"Cow or heifer",unit:"head"},{code:"EXP-RPM-CST18",name:"Steer (18 moths plus)",unit:"head"},{code:"EXP-RPM-CST36",name:"Steer (3 years plus)",unit:"head"},{code:"EXP-RPM-CBULL",name:"Bull (3 years plus)",unit:"head"},{code:"EXP-RPM-GKID",name:"Kid",unit:"head"},{code:"EXP-RPM-GWEAN",name:"Weaner kids",unit:"head"},{code:"EXP-RPM-GEWE",name:"Ewe (2-tooth plus)",unit:"head"},{code:"EXP-RPM-GCAST",name:"Castrate (2-tooth plus)",unit:"head"},{code:"EXP-RPM-GRAM",name:"Ram (2-tooth plus)",unit:"head"},{code:"EXP-AMF-LICK",name:"Lick",unit:"kg"},{code:"EXP-HBD-VACC",name:"Drenching & vaccination",unit:"head"},{code:"EXP-HBD-DIPP",name:"Dipping & jetting",unit:"head"},{code:"EXP-HBD-VETY",name:"Veterinary",unit:"head"},{code:"EXP-HBD-SHER",name:"Shearing",unit:"head"},{code:"EXP-HBD-CRCH",name:"Crutching",unit:"head"},{code:"EXP-MRK-LSSF",name:"Livestock sales marketing fees",incomeGroup:"Livestock Sales",unit:"%"},{code:"EXP-MRK-LSPF",name:"Livestock products marketing fees",incomeGroup:"Product Sales",unit:"%"},{code:"EXP-MRK-HOTF",name:"Horticulture marketing fees",incomeGroup:"Fruit Sales",unit:"%"},{code:"EXP-MRK-CRPF",name:"Crop marketing fees",incomeGroup:"Crop Sales",unit:"%"},{code:"EXP-MRK-LSTP",name:"Livestock transport",unit:"head"},{code:"EXP-MRK-HOTT",name:"Horticulture transport",unit:"t"},{code:"EXP-MRK-CRPT",name:"Crop transport",unit:"t"}],"code"),j={crop:{income:{"Crop Sales":[i["INC-HVT-CROP"]]},expenses:{Preharvest:[i["EXP-HVP-SEED"],i["EXP-HVP-FERT"],i["EXP-HVP-LIME"],i["EXP-HVP-HERB"],i["EXP-HVP-PEST"],i["EXP-HVP-SPYA"],i["EXP-HVP-INSH"],i["EXP-HVP-INSM"],i["EXP-HVP-HEDG"]],Harvest:[i["EXP-HVT-LABC"]],Marketing:[i["EXP-MRK-CRPF"],i["EXP-MRK-CRPT"]],"Indirect Costs":[i["EXP-IDR-FUEL"],i["EXP-IDR-REPP"],i["EXP-IDR-ELEC"],i["EXP-IDR-WATR"],i["EXP-IDR-LABP"],i["EXP-IDR-SCHED"],i["EXP-IDR-OTHER"]]}},horticulture:{income:{"Fruit Sales":[i["INC-HVT-FRUT"]]},expenses:{Preharvest:[i["EXP-HVP-PLTM"],i["EXP-HVP-FERT"],i["EXP-HVP-LIME"],i["EXP-HVP-HERB"],i["EXP-HVP-PEST"],i["EXP-HVP-SPYA"],i["EXP-HVP-INSH"],i["EXP-HVP-INSM"]],Harvest:[i["EXP-HVT-LABC"],i["EXP-HVT-STOR"],i["EXP-HVT-PAKM"],i["EXP-HVT-DYCL"],i["EXP-HVT-PAKC"]],Marketing:[i["EXP-MRK-HOTF"],i["EXP-MRK-HOTT"]],"Indirect Costs":[i["EXP-IDR-FUEL"],i["EXP-IDR-REPP"],i["EXP-IDR-ELEC"],i["EXP-IDR-WATR"],i["EXP-IDR-LABP"],i["EXP-IDR-SCHED"],i["EXP-IDR-LICS"],i["EXP-IDR-INSA"],i["EXP-IDR-OTHER"]]}},livestock:{Cattle:{income:{"Livestock Sales":[i["INC-LSS-CCALV"],i["INC-LSS-CWEN"],i["INC-LSS-CCOW"],i["INC-LSS-CST18"],i["INC-LSS-CST36"],i["INC-LSS-CBULL"]],"Product Sales":[i["INC-LSP-MILK"]]},expenses:{Replacements:[i["EXP-RPM-CCALV"],i["EXP-RPM-CWEN"],i["EXP-RPM-CCOW"],i["EXP-RPM-CST18"],i["EXP-RPM-CST36"],i["EXP-RPM-CBULL"]],"Animal Feed":[i["EXP-AMF-LICK"]],Husbandry:[i["EXP-HBD-VACC"],i["EXP-HBD-DIPP"],i["EXP-HBD-VETY"]],Marketing:[i["EXP-MRK-LSSF"],i["EXP-MRK-LSPF"],i["EXP-MRK-LSTP"]],"Indirect Costs":[i["EXP-IDR-FUEL"],i["EXP-IDR-REPP"],i["EXP-IDR-ELEC"],i["EXP-IDR-WATR"],i["EXP-IDR-LABP"],i["EXP-IDR-LICS"],i["EXP-IDR-INSA"],i["EXP-IDR-OTHER"]]}},Goats:{income:{"Livestock Sales":[i["INC-LSS-GKID"],i["INC-LSS-GWEAN"],i["INC-LSS-GEWE"],i["INC-LSS-GCAST"],i["INC-LSS-GRAM"]],"Product Sales":[i["INC-LSP-WOOL"],i["INC-LSP-MILK"]]},expenses:{Replacements:[i["EXP-RPM-GKID"],i["EXP-RPM-GWEAN"],i["EXP-RPM-GEWE"],i["EXP-RPM-GCAST"],i["EXP-RPM-GRAM"]],"Animal Feed":[i["EXP-AMF-LICK"]],Husbandry:[i["EXP-HBD-VACC"],i["EXP-HBD-DIPP"],i["EXP-HBD-VETY"],i["EXP-HBD-SHER"],i["EXP-HBD-CRCH"]],Marketing:[i["EXP-MRK-LSSF"],i["EXP-MRK-LSPF"],i["EXP-MRK-LSTP"]],"Indirect Costs":[i["EXP-IDR-FUEL"],i["EXP-IDR-REPP"],i["EXP-IDR-ELEC"],i["EXP-IDR-WATR"],i["EXP-IDR-LABP"],i["EXP-IDR-LICS"],i["EXP-IDR-INSA"],i["EXP-IDR-OTHER"]]}},Sheep:{income:{"Livestock Sales":[i["INC-LSS-SLAMB"],i["INC-LSS-SWEAN"],i["INC-LSS-SEWE"],i["INC-LSS-SWTH"],i["INC-LSS-SRAM"]],"Product Sales":[i["INC-LSP-WOOL"],i["INC-LSP-MILK"]]},expenses:{Replacements:[i["EXP-RPM-SLAMB"],i["EXP-RPM-SWEAN"],i["EXP-RPM-SEWE"],i["EXP-RPM-SWTH"],i["EXP-RPM-SRAM"]],"Animal Feed":[i["EXP-AMF-LICK"]],Husbandry:[i["EXP-HBD-VACC"],i["EXP-HBD-DIPP"],i["EXP-HBD-VETY"],i["EXP-HBD-SHER"],i["EXP-HBD-CRCH"]],Marketing:[i["EXP-MRK-LSSF"],i["EXP-MRK-LSPF"],i["EXP-MRK-LSTP"]],"Indirect Costs":[i["EXP-IDR-FUEL"],i["EXP-IDR-REPP"],i["EXP-IDR-ELEC"],i["EXP-IDR-WATR"],i["EXP-IDR-LABP"],i["EXP-IDR-LICS"],i["EXP-IDR-INSA"],i["EXP-IDR-OTHER"]]}}}},k={Cattle:"Cow or heifer",Sheep:"Ewe",Goats:"Ewe (2-tooth plus)"},l={"Cattle (Extensive)":"Cattle","Cattle (Feedlot)":"Cattle","Cattle (Stud)":"Cattle","Sheep (Extensive)":"Sheep","Sheep (Feedlot)":"Sheep","Sheep (Stud)":"Sheep"},m={Cattle:{Calf:.32,"Weaner calves":.44,"Cow or heifer":1.1,"Steer (18  months plus)":.75,"Steer (3 years plus)":1.1,"Bull (3 years plus)":1.36},Sheep:{Lamb:.08,"Weaner Lambs":.11,Ewe:.16,"Wether (2-tooth plus)":.23,"Ram (2-tooth plus)":.23},Goats:{Kid:.12,"Weaner kids":.12,"Ewe (2-tooth plus)":.17,"Castrate (2-tooth plus)":.17,"Ram (2-tooth plus)":.12}},n={crop:"Field Crops",horticulture:"Horticulture",livestock:"Livestock"},o={crop:["Barley","Bean (Dry)","Bean (Green)","Canola","Cotton","Cowpea","Grain Sorghum","Groundnut","Lucerne","Maize (Fodder)","Maize (Green)","Maize (Seed)","Maize (White)","Maize (Yellow)","Oats","Potato","Rye","Soya Bean","Sunflower","Sweet Corn","Tobacco","Triticale","Wheat"],horticulture:["Almond","Apple","Apricot","Avocado","Banana","Blueberry","Cherry","Chicory","Chili","Citrus (Hardpeel)","Citrus (Softpeel)","Coffee","Fig","Garlic","Grapes (Table)","Grapes (Wine)","Guava","Hops","Kiwi","Lemon","Lentil","Macadamia Nut","Mango","Melon","Nectarine","Olive","Onion","Orange","Papaya","Pea","Peach","Peanut","Pear","Pecan Nut","Persimmon","Pineapple","Pistachio Nut","Plum","Pomegranate","Prune","Pumpkin","Quince","Rooibos","Strawberry","Sugarcane","Tomato","Watermelon"],livestock:["Cattle (Extensive)","Cattle (Feedlot)","Cattle (Stud)","Chicken (Broilers)","Chicken (Layers)","Dairy","Game","Goats","Horses","Ostrich","Pigs","Sheep (Extensive)","Sheep (Feedlot)","Sheep (Stud)"]},p={Apple:["0-3 years","3-10 years","10-15 years","15-25 years","25+ years"],Apricot:["0-2 years","2-5 years","5-15 years","15-18 years","18+ years"],Avocado:["0-1 years","1-3 years","3-5 years","5-8 years","8+ years"],Blueberry:["0-1 years","1-3 years","3-5 years","5-8 years","8+ years"],"Citrus (Hardpeel)":["0-1 years","1-4 years","4-8 years","8-20 years","20-25 years","25+ years"],"Citrus (Softpeel)":["0-1 years","1-4 years","4-8 years","8-20 years","20-25 years","25+ years"],Fig:["0-1 years","1-3 years","3-6 years","6-18 years","18-30 years","30+ years"],"Grape (Table)":["0-3 years","3-10 years","10-15 years","15-25 years","25+ years"],"Grape (Wine)":["0-3 years","3-10 years","10-15 years","15-25 years","25+ years"],"Macadamia Nut":["0-1 years","1-3 years","3-6 years","6-9 years","10+ years"],Mango:["0-1 years","1-3 years","3-5 years","5-18 years","18-30 years","30+ years"],Nectarine:["0-2 years","2-5 years","5-15 years","15-18 years","18+ years"],Olive:["0-1 years","1-3 years","3-5 years","5-10 years","10+ years"],Orange:["0-1 years","1-4 years","4-8 years","8-20 years","20-25 years","25+ years"],"Pecan Nut":["0-1 years","1-3 years","3-7 years","7-10 years","10+ years"],Peach:["0-2 years","2-5 years","5-15 years","15-18 years","18+ years"],Pear:["0-3 years","3-10 years","10-15 years","15-25 years","25+ years"],Persimmon:["0-1 years","1-4 years","4-12 years","12-20 years","20+ years"],Plum:["0-2 years","2-5 years","5-15 years","15-18 years","18+ years"],Pomegranate:["0-1 years","1-3 years","3-5 years","5-18 years","18-30 years","30+ years"],Rooibos:["0-1 years","1-2 years","2-4 years","4-5 years","5+ years"]};return{listServiceMap:function(){return e},commodityTypes:function(){return n},commodities:function(){return o},getRepresentativeAnimal:function(a){return k[c(a)]},getConversionRate:function(a){return m[c(a)][k[c(a)]]},getConversionRates:function(a){return m[c(a)]},getCommodities:function(a){return o[a]||""},getHorticultureStages:function(a){return p[a]||[]},getCategories:function(a,b,d,e,f){var g={};"livestock"==b&&j[b][c(d)]&&(g=angular.copy(j[b][c(d)][e])||{}),"crop"==b&&j[b][e]&&(g=angular.copy(j[b][e])||{}),"horticulture"==b&&j[b][e]&&(g=angular.copy(j[b][e])||{}),angular.forEach(a.data.sections,function(b){b.name.toLowerCase().indexOf(e)>-1&&("horticulture"!=a.assetType||"horticulture"==a.assetType&&b.horticultureStage==f)&&angular.forEach(b.productCategoryGroups,function(a){angular.forEach(a.productCategories,function(b){angular.forEach(g[a.name],function(c,d){c.code==b.code&&g[a.name].splice(d,1)})})})});var h=[];for(var i in g)g[i].forEach(function(a){a.groupBy=i,h.push(a)});return h},getModelType:function(a){return f[a]||""},validateBudgetData:function(a,c){return b(a),d(a,c),this.calculateTotals(a)},initNewSections:function(a,b){return d(a,b)},addCategoryToBudget:function(a,b,d,e,f){var j=angular.copy(i[e]);j.quantity=0,j.pricePerUnit=0,j.value=0,"livestock"==a.assetType&&(j.valuePerLSU=0,m[c(a.commodityType)][j.name]&&(j.conversionRate=m[c(a.commodityType)][j.name]));var k=!0,l=!0,n=-1,o=-1,p=angular.copy(g[b]),q=angular.copy(h[d]);return p.productCategoryGroups=[],q.productCategories=[],angular.forEach(a.data.sections,function(b,c){("horticulture"!=a.assetType&&b.name==p.name||"horticulture"==a.assetType&&b.name==p.name&&b.horticultureStage==f)&&(k=!1,n=c,p=b,b.productCategoryGroups.forEach(function(a,b){a.name==d&&(l=!1,o=b,q=a)}))}),k&&("horticulture"==a.assetType&&f&&(p.horticultureStage=f),a.data.sections.push(p),n=a.data.sections.length-1),l&&(a.data.sections[n].productCategoryGroups.push(q),o=a.data.sections[n].productCategoryGroups.length-1),a.data.sections[n].productCategoryGroups[o].productCategories.push(j),a},calculateTotals:function(d){b(d),"livestock"==d.assetType&&(d.data.details.calculatedLSU=d.data.details.herdSize*m[c(d.commodityType)][k[c(d.commodityType)]]);var e=0,f=0;return d.data.sections.forEach(function(b){b.total={value:0},"livestock"==d.assetType&&(b.total.valuePerLSU=0),b.productCategoryGroups.forEach(function(e){e.total={value:0},"livestock"==d.assetType&&(e.total.valuePerLSU=0),e.productCategories.forEach(function(b){if("%"==b.unit){var f=a.chain(d.data.sections).pluck("productCategoryGroups").flatten().reduce(function(a,c){return c.name==b.incomeGroup&&void 0!==c.total?a+c.total.value:a},0).value();b.value=b.pricePerUnit*f/100,"livestock"==d.assetType&&(b.valuePerLSU=b.pricePerUnit/m[c(d.commodityType)][b.name])
}else"Total"==b.unit&&(b.quantity=1),b.value=b.pricePerUnit*b.quantity,"livestock"==d.assetType&&(b.valuePerLSU=b.pricePerUnit/m[c(d.commodityType)][b.name]);e.total.value+=b.value,"livestock"==d.assetType&&(e.total.valuePerLSU+=b.valuePerLSU)}),b.total.value+=e.total.value,"livestock"==d.assetType&&(b.total.valuePerLSU+=e.total.valuePerLSU)}),"Income"==b.name?e=b.total.value:f+=b.total.value}),d.data.details.grossProfit=e-f,"horticulture"==d.assetType&&(d.data.details.grossProfitByStage={},angular.forEach(p[d.commodityType],function(b){d.data.details.grossProfitByStage[b]=a.chain(d.data.sections).where({horticultureStage:b}).reduce(function(a,b){return"Income"===b.name?a+b.total.value:"Expenses"===b.name?a-b.total.value:a},0).value()})),"livestock"==d.assetType&&(d.data.details.grossProfitPerLSU=d.data.details.grossProfit/d.data.details.calculatedLSU),d}}}]);var sdkHelperExpenseApp=angular.module("ag.sdk.helper.expense",["ag.sdk.library"]);sdkHelperExpenseApp.factory("expenseHelper",["underscore",function(){var a={area:"Area",distance:"Distance",hours:"Hours"},b={area:"Ha",distance:"km",hours:"h"},c={area:"inspected",distance:"travelled",hours:"worked"};return{expenseTypes:function(){return a},getExpenseTitle:function(b){return a[b]||""},getExpenseUnit:function(a){return b[a]||""},getExpenseAction:function(a){return c[a]||""}}}]);var sdkHelperFarmerApp=angular.module("ag.sdk.helper.farmer",["ag.sdk.interface.map","ag.sdk.helper.attachment","ag.sdk.library"]);sdkHelperFarmerApp.factory("farmerHelper",["geoJSONHelper",function(a){var b=function(a){function b(a){var b=[];return angular.forEach(a.legalEntities,function(a){b.push(a.name),a.registrationNumber&&b.push(a.registrationNumber)}),b}return{id:a.id||a.__id,title:a.name,subtitle:a.operationType,profileImage:a.profilePhotoSrc,searchingIndex:b(a)}},c=["Commercial","Recreational","Smallholder"],d={Commercial:"Large scale agricultural production",Recreational:"Leisure or hobby farming",Smallholder:"Small farm, limited production"};return{listServiceMap:function(){return b},businessEntityTypes:function(){return c},getBusinessEntityDescription:function(a){return d[a]||""},getFarmerLocation:function(b){if(b){if(b.data&&b.data.loc)return b.data.loc.geometry?b.data.loc.geometry.coordinates:b.data.loc.coordinates;if(b.legalEntities){var c=a();return angular.forEach(b.legalEntities,function(a){a.assets&&angular.forEach(a.assets,function(a){c.addGeometry(a.data.loc)})}),c.getCenter().reverse()}}return null}}}]),sdkHelperFarmerApp.factory("legalEntityHelper",["attachmentHelper","underscore",function(a,b){function c(a){this.enterprises=b.map(a||[],function(a){return a.name?a.name:a}),this.selection={category:void 0,item:void 0}}var d=function(b){var c={id:b.id||b.__id,title:b.name,subtitle:b.type};return b.data&&(c.image=a.getThumbnail(b.data.attachments)),c},e=["Individual","Sole Proprietary","Joint account","Partnership","Close Corporation","Private Company","Public Company","Trust","Non-Profitable companies","Cooperatives","In- Cooperatives","Other Financial Intermediaries"],f={"Field Crops":["Barley","Bean (Dry)","Bean (Green)","Canola","Cotton","Cowpea","Grain Sorghum","Groundnut","Lucerne","Maize (Fodder)","Maize (Green)","Maize (Seed)","Maize (White)","Maize (Yellow)","Oats","Potato","Rye","Soya Bean","Sunflower","Sweet Corn","Tobacco","Triticale","Wheat"],Horticulture:["Almond","Apple","Apricot","Avocado","Banana","Cherry","Chicory","Chili","Citrus (Hardpeel)","Citrus (Softpeel)","Coffee","Fig","Garlic","Grapes (Table)","Grapes (Wine)","Guava","Hops","Kiwi","Lemon","Lentil","Macadamia Nut","Mango","Melon","Nectarine","Olive","Onion","Orange","Papaya","Pea","Peach","Peanut","Pear","Pecan Nut","Persimmon","Pineapple","Pistachio Nut","Plum","Pomegranate","Prune","Pumpkin","Quince","Rooibos","Strawberry","Sugarcane","Tomato","Watermelon"],Livestock:["Cattle (Extensive)","Cattle (Feedlot)","Cattle (Stud)","Chicken (Broilers)","Chicken (Layers)","Dairy","Game","Goats","Horses","Ostrich","Pigs","Sheep (Extensive)","Sheep (Feedlot)","Sheep (Stud)"]};return c.prototype.addEnterprise=function(a){a=a||this.selection.item,-1==this.enterprises.indexOf(a)&&(this.enterprises.push(a),this.selection.item=void 0)},c.prototype.removeEnterprise=function(a){"string"==typeof a&&(a=this.enterprises.indexOf(a)),-1!==a&&this.enterprises.splice(a,1)},{listServiceMap:function(){return d},legalEntityTypes:function(){return e},enterpriseTypes:function(){return f},enterpriseEditor:function(a){return new c(a)}}}]),sdkHelperFarmerApp.factory("landUseHelper",function(){var a=["High","Medium","Low"],b=["0 - 30cm","30 - 60cm","60 - 90cm","90 - 120cm","120cm +"],c=["Centre-Pivot","Flood","Micro","Sub-drainage","Sprinkler","Drip"],d=["Cropland","Grazing","Horticulture (Intensive)","Horticulture (Perennial)","Horticulture (Seasonal)","Housing","Plantation","Planted Pastures","Structures (Handling)","Structures (Processing)","Structures (Storage)","Utilities","Wasteland","Conservation"],e=["Sand","Loamy Sand","Clay Sand","Sandy Loam","Fine Sandy Loam","Loam","Silty Loam","Sandy Clay Loam","Clay Loam","Clay","Gravel","Other","Fine Sandy Clay","Medium Sandy Clay Loam","Fine Sandy Clay Loam","Loamy Medium Sand","Medium Sandy Loam","Coarse Sandy Clay Loam","Coarse Sand","Loamy Fine Sand","Loamy Coarse Sand","Fine Sand","Silty Clay","Coarse Sandy Loam","Medium Sand","Medium Sandy Clay","Coarse Sandy Clay","Sandy Clay"],f=["Plains","Mountains"],g=["Irrigation Scheme","River","Dam","Borehole"];return{croppingPotentialTypes:function(){return a},effectiveDepthTypes:function(){return b},irrigationTypes:function(){return c},landUseTypes:function(){return d},soilTextureTypes:function(){return e},terrainTypes:function(){return f},waterSourceTypes:function(){return g},isCroppingPotentialRequired:function(a){return"Cropland"==a},isTerrainRequired:function(a){return"Grazing"==a}}}),sdkHelperFarmerApp.factory("farmHelper",["geoJSONHelper","geojsonUtils","underscore",function(a,b,c){var d=function(a){return{id:a.id||a.__id,title:a.name}};return{listServiceMap:function(){return d},containsPoint:function(a,c,d){var e=!1;return angular.forEach(c,function(c){"farmland"==c.type&&c.farmId&&c.farmId==d.id&&b.pointInPolygon(a,c.data.loc)&&(e=!0)}),e},getCenter:function(b,c){var d=a();return angular.forEach(b,function(a){"farmland"==a.type&&a.farmId&&a.farmId==c.id&&d.addGeometry(a.data.loc)}),d.getCenterAsGeojson()},validateFieldName:function(a,b,d){b.fieldName=b.fieldName?b.fieldName.toUpperCase().replace(/[^0-9A-Z]/g,""):b.fieldName;var e=c.findWhere(a.data.fields,{fieldName:b.fieldName});return angular.isObject(e)?angular.isObject(d)&&e.fieldName===d.fieldName:!0}}}]);var sdkHelperFavouritesApp=angular.module("ag.sdk.helper.favourites",["ag.sdk.helper.document","ag.sdk.helper.task"]);sdkHelperFavouritesApp.factory("activityHelper",["documentHelper",function(a){var b=function(b){var f={id:b.id||b.__id,date:b.date};return"object"==typeof b.actor?(b.actor.displayName?(f.title=b.actor.displayName,f.subtitle=b.actor.displayName):(f.title=b.actor.firstName+" "+b.actor.lastName,f.subtitle=b.actor.firstName+" "+b.actor.lastName),b.actor.position&&(f.title+=" ("+b.actor.position+")"),f.profilePhotoSrc=b.actor.profilePhotoSrc):b.organization?(f.title=b.organization.name,f.subtitle=b.organization.name):(f.title="Someone",f.subtitle="Someone"),f.subtitle+=" "+d(b.action)+" ",f.referenceId="farmer"==b.referenceType?b.organization.id:b[b.referenceType+"Id"],"farmer"==b.referenceType?(f.subtitle+="invite"==b.action?b.organization.name+" to create an Agrista account":"register"==b.action?"your request to join Agrista":"create"==b.action?"a customer portfolio for "+b.organization.name:"decline"==b.action?"a task for "+b.organization.name:"the portfolio of "+b.organization.name,f.referenceState="customer.details"):(void 0!==b[b.referenceType]?"document"==b.referenceType?(f.subtitle+=e(b[b.referenceType].docType)+" "+a.getDocumentTitle(b[b.referenceType].docType)+" "+b.referenceType,f.referenceState=a.getDocumentState(b[b.referenceType].docType)):"task"==b.referenceType?(f.subtitle+="the "+taskHelper.getTaskTitle(b[b.referenceType].todo)+" "+b.referenceType,f.referenceState=a.getTaskState(b[b.referenceType].todo)):f.subtitle+=e(b.referenceType)+" "+b.referenceType:f.subtitle+=e(b.referenceType)+" "+b.referenceType,b.actor&&b.organization&&b.organization.name&&(f.subtitle+=" "+c(b.action)+" "+b.organization.name)),f},c=function(a){return f[a]||"for"},d=function(a){return g[a]||(a.lastIndexOf("e")==a.length-1?a+"d":a+"ed")},e=function(a){var b=["a","e","i","o","u"];return h[a]||(-1!=b.indexOf(a.substr(0,1))?"an":"a")},f={share:"of",sent:"to"},g={register:"accepted",sent:"sent"},h={"asset register":"an"};return{listServiceMap:function(){return b},getActionVerb:d,getReferenceArticle:e}}]),sdkHelperFavouritesApp.factory("notificationHelper",["taskHelper","documentHelper",function(){var a=function(a){return{id:a.id||a.__id,title:a.sender,subtitle:a.message,state:b(a.notificationType,a.dataType)}},b=function(a,b){var d=c[a]?c[a].state:"view";return"notification."+d+"-"+b},c={reassign:{title:"Reassign",state:"manage"},"import":{title:"Import",state:"import"},view:{title:"View",state:"view"},reject:{title:"Rejected",state:"view"},review:{title:"Review",state:"view"}};return{listServiceMap:function(){return a},getNotificationState:function(a,c){return b(a,c)},getNotificationTitle:function(a){return c[a]?c[a].title:""}}}]);var sdkHelperMerchantApp=angular.module("ag.sdk.helper.merchant",["ag.sdk.library"]);sdkHelperMerchantApp.factory("merchantHelper",["underscore",function(a){function b(b,c){b=b||[],this.services=a.map(c||[],function(a){return a.name?a.name:a}),this.selection={list:b,mode:0==b.length?"add":"select",text:""}}var c=function(a){return{id:a.id||a.__id,title:a.name,subtitle:(a.subscriptionPlan?g(a.subscriptionPlan)+" ":"")+(a.partnerType?f(a.partnerType)+" partner":""),status:a.registered?{text:"registered",label:"label-success"}:!1}},d={benefit:"Benefit",standard:"Standard"},e={small:"Small",medium:"Medium",large:"Large",association:"Association"},f=function(a){return d[a]||""},g=function(a){return e[a]||""};return b.prototype.toggleMode=function(){this.selection.list.length>0&&(this.selection.mode="select"==this.selection.mode?"add":"select",this.selection.text="")},b.prototype.addService=function(a){a=a||this.selection.text,-1==this.services.indexOf(a)&&(this.services.push(a),this.selection.text="")},b.prototype.removeService=function(a){"string"==typeof a&&(a=this.services.indexOf(a)),-1!==a&&this.services.splice(a,1)},{listServiceMap:function(){return c},partnerTypes:function(){return d},getPartnerType:f,subscriptionPlans:function(){return e},getSubscriptionPlan:g,serviceEditor:function(a,c){return new b(a,c)}}}]);var sdkHelperRegionApp=angular.module("ag.sdk.helper.region",[]);sdkHelperRegionApp.factory("regionHelper",[function(){var a=function(a){var b={title:a.name,subtitle:a.region.province,region:a.region.name};return a.subRegionNumber&&(b.subtitle+=" - "+a.subRegionNumber),a.plotCode&&(b.subtitle+=" - "+a.plotCode),b};return{listServiceMap:function(){return a}}}]);var sdkHelperTaskApp=angular.module("ag.sdk.helper.task",["ag.sdk.authorization","ag.sdk.utilities","ag.sdk.interface.list","ag.sdk.library"]);sdkHelperTaskApp.provider("taskHelper",["underscore",function(a){var b=["assigned","in progress","in review"],c=function(c){var d=c.documentKey,e=a.filter(c.subtasks,function(a){return a.type&&-1!==b.indexOf(a.status)&&"child"==a.type}).map(function(a){return{id:a.id||c.__id,title:c.organization.name,subtitle:g(a.todo,a),todo:a.todo,groupby:d,status:{text:a.status||" ",label:j(a.status)}}});return e.length?e:void 0},d=function(a){return{id:a.documentId,title:a.organization.name,subtitle:a.documentKey,status:{text:a.status||" ",label:j(a.status)}}},e={},f=function(a){return e[a]?e[a].state:void 0},g=function(a,b){var c=e[a];return void 0!==c?"string"==typeof c.title?c.title:c.title(b):void 0},h=function(a){return k[a]||a||" "},i=function(a){return l[a]||a||" "},j=function(a){switch(a){case"in progress":case"in review":return"label-warning";case"done":return"label-success";default:return"label-default"}},k={backlog:"Backlog",assigned:"Assigned","in progress":"In Progress","in review":"In Review",done:"Done",archive:"Archived"},l={accept:"Accept",decline:"Decline",assign:"Assign",start:"Start",complete:"Complete",approve:"Approve",reject:"Reject",release:"Release"};this.addTasks=function(b){e=a.extend(e,b)},this.$get=["authorization","listService","dataMapService",function(e,k,l){return{listServiceMap:function(){return c},parentListServiceMap:function(){return d},getTaskState:f,getTaskTitle:g,getTaskStatusTitle:h,getTaskActionTitle:i,getTaskLabel:j,filterTasks:function(b){return a.filter(b,function(a){return void 0!==f(a.todo)})},updateListService:function(d,f,g,h){var i=e.currentUser(),j=a.findWhere(g,{id:d});k.addItems(l({id:j.parentTaskId,documentKey:j.documentKey,type:"parent",todo:f,organization:h,subtasks:a.filter(g,function(a){return a&&a.assignedTo==i.username})},c)),j&&-1===b.indexOf(j.status)&&k.removeItems(j.id)}}}]}]),sdkHelperTaskApp.factory("taskWorkflowHelper",function(){var a={accept:["backlog","assigned","in progress","in review","complete"],decline:["assigned"],start:["assigned","in progress"],assign:["backlog","assigned","in progress","in review"],complete:["assigned","in progress"],approve:["in review"],reject:["assigned","in review"],release:["done"]};return{canChangeToState:function(b,c){return a[c]?-1!==a[c].indexOf(b.status):!0}}});var sdkHelperTeamApp=angular.module("ag.sdk.helper.team",["ag.sdk.library"]);sdkHelperTeamApp.factory("teamHelper",["underscore",function(a){function b(b,c){b=b||[],c=c||[],this.teams=a.map(c,function(a){return a.name?a.name:a}),this.teamsDetails=angular.copy(c),this.selection={list:b,mode:0==b.length?"add":"select",text:""}}return b.prototype.toggleMode=function(){this.selection.list.length>0&&(this.selection.mode="select"==this.selection.mode?"add":"select",this.selection.text="")},b.prototype.addTeam=function(b){b=b||this.selection.text,-1==this.teams.indexOf(b)&&(this.teams.push(b),this.teamsDetails.push(a.findWhere(this.selection.list,{name:b})),this.selection.text="")},b.prototype.removeTeam=function(a){"string"==typeof a&&(a=this.teams.indexOf(a)),-1!==a&&(this.teams.splice(a,1),this.teamsDetails.splice(a,1),this.selection.text="")},{teamEditor:function(a,c){return new b(a,c)}}}]);var sdkHelperUserApp=angular.module("ag.sdk.helper.user",[]);sdkHelperUserApp.factory("userHelper",[function(){var a=function(a){return{id:a.id||a.__id,title:a.firstName+" "+a.lastName,subtitle:a.position,teams:a.teams}},b=["English"];return{listServiceMap:function(){return a},languageList:function(){return b}}}]);var sdkInterfaceInputApp=angular.module("ag.sdk.interface.input",[]);sdkInterfaceInputApp.filter("location",["$filter",function(a){return function(b){return(b&&b.geometry?a("number")(b.geometry.coordinates[0],3)+", "+a("number")(b.geometry.coordinates[1],3):"")+(b&&b.properties&&b.properties.accuracy?" at "+a("number")(b.properties.accuracy,2)+"m":"")}}]),sdkInterfaceInputApp.directive("locationFormatter",["$filter",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$formatters.push(function(c){var e="";return void 0!==c&&(e=a("location")(c),d.ngChange&&b.$eval(d.ngChange)),e})}}}]),sdkInterfaceInputApp.directive("dateFormatter",["$filter",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$formatters.push(function(b){return void 0!==b?a("date")(new Date(b),d.dateFormat||"yyyy-MM-dd"):""})}}}]),sdkInterfaceInputApp.directive("dateParser",["$filter",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$parsers.push(function(b){return void 0!==b?a("date")(new Date(b),d.dateFormat||"yyyy-MM-dd"):""})}}}]),sdkInterfaceInputApp.directive("inputNumber",["$filter",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f=d.max?parseFloat(d.max):!1,g=d.min?parseFloat(d.min):!1,h=d.round?parseInt(d.round):!1;e.$formatters.push(function(b){return h===!1?b:a("number")(b,h)}),e.$parsers.push(function(a){var b=isNaN(a);if(e.$setValidity("number",b===!1),b===!1){var c=parseFloat(a);return e.$setValidity("range",(g===!1||c>=g)&&(f===!1||f>=c)),c}return a})}}}]);var sdkInterfaceListApp=angular.module("ag.sdk.interface.list",["ag.sdk.id"]);sdkInterfaceListApp.factory("listService",["$rootScope","objectId",function(a,b){var c,d,e,f,g,h=[],i=function(){a.$broadcast("list::button__clicked")},j=function(b){c!==b&&("object"==typeof b?(c=b,c.click=c.click||i):c=void 0,a.$broadcast("list::button__changed",c))},k=function(b){d!==b&&(d=void 0!==b?b:void 0,a.$broadcast("list::groupby__changed",d))},l=function(b){e!==b&&(void 0!==b?(h=[],e=b):e=void 0,a.$broadcast("list::scroll__changed",e))},m=function(b){f!==b&&(f=void 0!==b?b:void 0,a.$broadcast("list::search__changed",f))},n=function(a){if(g=a,h instanceof Array)for(var b=0;b<h.length;b++)h[b].active=!1,void 0!==a&&(h[b].id==a?h[b].active=!0:h[b].type==a&&(h[b].active=!0));else for(var c in h)h.hasOwnProperty(c)&&(h[c].active=c==a)},o=function(){if(h instanceof Array){for(var a=0;a<h.length;a++)if(h[a].id==g)return h[a]}else for(var b in h)if(h.hasOwnProperty(b)&&b==g)return h[b];return null};return a.$on("$stateChangeSuccess",function(a,b,c){n(c.id?c.id:c.type)}),a.$on("list::item__selected",function(a,b){n("object"==typeof b?b.id?b.id:b.type:b)}),{config:function(a){a.reset&&(c=void 0,d=void 0,e=void 0,f=void 0,h=[],g=void 0),j(a.button),k(a.groupby),l(a.infiniteScroll),m(a.search)},button:function(a){return 1==arguments.length&&j(a),c},groupby:function(a){return 1==arguments.length&&k(a),d},infiniteScroll:function(a){return 1==arguments.length&&l(a),e},search:function(a){return 1==arguments.length&&m(a),f},items:function(b){return void 0!==b&&(h=angular.copy(b),g=void 0,a.$broadcast("list::items__changed",h)),h},length:function(){return h.length},addItems:function(c,d){if(void 0!==c){c instanceof Array==!1&&(c=[c]);for(var e=0;e<c.length;e++){var f=c[e];if(f.id=f.id||b().toBase64String(),h instanceof Array){for(var i=!1,j=0;j<h.length;j++)if(f.id==h[j].id){h[j]=f,h[j].active=void 0!==g&&g==f.id,i=!0;break}0==i&&(d===!0?h.unshift(f):h.push(f))}else h[f.id]=f,h[f.id].active=void 0!==g&&g==f.id}a.$broadcast("list::items__changed",h)}},removeItems:function(b){if(void 0!==b){b instanceof Array==!1&&(b=[b]);for(var c=0;c<b.length;c++){var d=b[c];if(h instanceof Array){for(var e=0;e<h.length;e++)if(d==h[e].id){if(h.splice(e,1),d==g&&h.length){var f=h[e]?h[e]:h[e-1];a.$broadcast("list::item__selected",f)}break}}else delete h[d]}h instanceof Array&&0==h.length&&a.$broadcast("list::items__empty"),a.$broadcast("list::items__changed",h)}},selectFirstItem:function(){a.$broadcast("list::selectFirst__requested")},setActiveItem:function(a){n(a)},getActiveItem:function(){return o()}}}]);var sdkInterfaceMapApp=angular.module("ag.sdk.interface.map",["ag.sdk.utilities","ag.sdk.id","ag.sdk.config","ag.sdk.library"]);sdkInterfaceMapApp.factory("geoJSONHelper",function(){function a(b,c){return this instanceof a?void this.addGeometry(b,c):new a(b,c)}function b(a,c){c&&(angular.isArray(c[0])?angular.forEach(c,function(c){b(a,c)}):angular.isArray(c)&&a.push([c[1],c[0]]))}return a.prototype={getJson:function(){return this._json},getType:function(){return this._json.type},getGeometryType:function(){return this._json.geometry?this._json.geometry.type:this._json.type},getBounds:function(){var a=[];if(this._json){var c=this._json.features||[this._json];angular.forEach(c,function(c){var d=c.geometry||c;b(a,d.coordinates)})}return a},getCenter:function(a){a=a||this.getBounds();var b=0,c=0,d=0,e=0;return angular.forEach(a,function(a,f){0==f?(b=c=a[0],d=e=a[1]):(b=b<a[0]?b:a[0],c=c<a[0]?a[0]:c,d=d<a[1]?d:a[1],e=e<a[1]?a[1]:e)}),[b+(c-b)/2,d+(e-d)/2]},getCenterAsGeojson:function(a){return{coordinates:this.getCenter(a).reverse(),type:"Point"}},getProperty:function(a){return this._json&&this._json.properties?this._json.properties[a]:void 0},setCoordinates:function(a){this._json&&"FeatureCollection"!=this._json.type&&(this._json.geometry?this._json.geometry.coordinates=a:this._json.coordinates=a)},addProperties:function(a){var b=this;return this._json&&a&&("FeatureCollection"!=b._json.type&&"Feature"!=b._json.type?b._json={type:"Feature",geometry:b._json,properties:a}:(b._json.properties=b._json.properties||{},angular.forEach(a,function(a,c){b._json.properties[c]=a}))),b},addGeometry:function(a,b){return a&&(void 0===this._json?(this._json=a,this.addProperties(b)):("FeatureCollection"!=this._json.type&&"Feature"!=this._json.type&&(this._json={type:"Feature",geometry:this._json}),"Feature"==this._json.type&&(this._json={type:"FeatureCollection",features:[this._json]}),"FeatureCollection"==this._json.type&&this._json.features.push({type:"Feature",geometry:a,properties:b}))),this},formatGeoJson:function(a,b){if("point"==b.toLowerCase())switch(a&&a.type&&a.type.toLowerCase()){case"feature":if(a.geometry&&a.geometry.type&&"Point"==a.geometry.type)return console.log(a.geometry),a.geometry;break;case"featurecollection":break;case"geometrycollection":}return a},validGeoJson:function(a,b){var c=!0;if(!a||void 0==a.type||"string"!=typeof a.type||b&&a.type.toLowerCase()!=b)return!1;switch(a.type.toLowerCase()){case"feature":break;case"featurecollection":break;case"geometrycollection":break;default:if(!a.coordinates||!a.coordinates instanceof Array)return!1;var d=_.flatten(a.coordinates);d.forEach(function(a){"number"!=typeof a&&(c=!1)})}return c}},function(b,c){return new a(b,c)}}),sdkInterfaceMapApp.provider("mapMarkerHelper",["underscore",function(a){var b=function(b,c,d){return a.defaults(d||{},{iconUrl:"img/icons/"+b+"."+(c?c:"default")+".png",shadowUrl:"img/icons/"+b+".shadow.png",iconSize:[48,48],iconAnchor:[22,42],shadowSize:[73,48],shadowAnchor:[22,40],labelAnchor:[12,-24]})},c=this.getMarker=function(a,c,d){return"object"==typeof c&&(d=c,c="default"),b(a,c,d)},d=this.getMarkerStates=function(a,c,d){var e={};return"string"==typeof a&&angular.forEach(c,function(c){e[c]=b(a,c,d)}),e};this.$get=function(){return{getMarker:c,getMarkerStates:d}}}]),sdkInterfaceMapApp.provider("mapStyleHelper",["mapMarkerHelperProvider",function(a){var b={asset:a.getMarkerStates("asset",["default","success","error"]),zone:a.getMarkerStates("marker",["default","success","error"])},c={foreground:{district:{style:{weight:2,color:"white",opacity:.8,fillColor:"#0094D6",fillOpacity:.5}},farmland:{style:{weight:2,color:"white",opacity:.8,fillColor:"blue",fillOpacity:.3}},field:{icon:"success",style:{weight:2,color:"white",opacity:.8,fillColor:"#5b4723",fillOpacity:.8}},crop:{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#aa64b0",fillOpacity:.8}},improvement:{icon:"success",style:{weight:4,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.8}},cropland:{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#4573d5",fillOpacity:.8}},pasture:{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#ffde40",fillOpacity:.8}},"permanent crop":{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#487811",fillOpacity:.8}},plantation:{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#00e64a",fillOpacity:.8}},zone:{icon:b.zone.success,style:{weight:4,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.8}},farmgate:{icon:"success"},homestead:{icon:"success"}},background:{district:{style:{weight:1,color:"white",opacity:.8,fillColor:"#0094D6",fillOpacity:.2}},farmland:{style:{weight:1,color:"white",opacity:.8,fillColor:"blue",fillOpacity:.1}},field:{icon:"default",style:{weight:1,color:"white",opacity:.8,fillColor:"#5b4723",fillOpacity:.4}},crop:{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#aa64b0",fillOpacity:.4}},improvement:{icon:"default",style:{weight:4,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.5}},cropland:{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#4573d5",fillOpacity:.4}},pasture:{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#ffde40",fillOpacity:.4}},"permanent crop":{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#487811",fillOpacity:.4}},plantation:{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#00e64a",fillOpacity:.4}},zone:{icon:b.zone.default,style:{weight:2,color:"white",opacity:.5,fillColor:"#ff6666",fillOpacity:.5}},farmgate:{icon:"default"},homestead:{icon:"default",label:{message:"Homestead"}}}},d=this.getStyle=function(d,e,f){var g=c[d]&&c[d][e]?angular.copy(c[d][e]):{};return"string"==typeof g.icon&&(void 0===b[e]&&(b[e]=a.getMarkerStates(e,["default","success","error"])),g.icon=b[e][g.icon]),"object"==typeof f&&(g.label=f),g},e=this.setStyle=function(a,b,d){c[a]=c[a]||{},c[a][b]=d};this.$get=function(){return{getStyle:d,setStyle:e}}}]),sdkInterfaceMapApp.provider("mapboxService",["underscore",function(a){var b={options:{attributionControl:!0,layersControl:!0,scrollWheelZoom:!1,zoomControl:!0},layerControl:{baseTile:{autoscale:!0,bounds:[-180,-85,180,85],cache:{maxzoom:16,minzoom:5},center:[24.631347656249993,-28.97931203672245,6],data:["http://a.tiles.mapbox.com/v3/agrista.map-65ftbmpi/markers.geojsonp"],geocoder:"http://a.tiles.mapbox.com/v3/agrista.map-65ftbmpi/geocode/{query}.jsonp",id:"agrista.map-65ftbmpi",maxzoom:19,minzoom:0,name:"SA Agri Backdrop","private":!0,scheme:"xyz",tilejson:"2.0.0",tiles:["http://a.tiles.mapbox.com/v3/agrista.map-65ftbmpi/{z}/{x}/{y}.png","http://b.tiles.mapbox.com/v3/agrista.map-65ftbmpi/{z}/{x}/{y}.png"],vector_layers:[{fields:{},id:"mapbox_streets"},{description:"",fields:{},id:"agrista_agri_backdrop"}]},baseLayers:{Agriculture:{base:!0,type:"mapbox"},Satellite:{type:"mapbox",tiles:{autoscale:!0,bounds:[-180,-85,180,85],cache:{maxzoom:16,minzoom:15},center:[23.843663473727442,-29.652475838000733,7],data:["http://a.tiles.mapbox.com/v3/agrista.map-tlsadyhb/markers.geojsonp"],geocoder:"http://a.tiles.mapbox.com/v3/agrista.map-tlsadyhb/geocode/{query}.jsonp",id:"agrista.map-tlsadyhb",maxzoom:22,minzoom:0,name:"Satellite backdrop","private":!0,scheme:"xyz",tilejson:"2.0.0",tiles:["http://a.tiles.mapbox.com/v3/agrista.map-tlsadyhb/{z}/{x}/{y}.png","http://b.tiles.mapbox.com/v3/agrista.map-tlsadyhb/{z}/{x}/{y}.png"],vector_layers:[{fields:{},id:"mapbox_satellite_full"},{fields:{},id:"mapbox_satellite_plus"},{fields:{},id:"mapbox_satellite_open"},{fields:{},id:"mapbox_satellite_watermask"},{fields:{},id:"mapbox_streets"}]}},Hybrid:{tiles:"agrista.h13nehk2",type:"mapbox"}},overlays:{}},controls:{},events:{},view:{coordinates:[-28.691,24.714],zoom:6},bounds:{},layers:{},geojson:{}},c={};this.config=function(c){b=a.defaults(c||{},b)},this.$get=["$rootScope","objectId",function(d,e){function f(a,c){var e=this;e._id=a,e._ready=!1,e._options=c,e._show=e._options.show||!1,e._config=angular.copy(b),e._requestQueue=[],d.$on("mapbox-"+e._id+"::init",function(){e.dequeueRequests(),e._ready=!0}),d.$on("mapbox-"+e._id+"::destroy",function(){e._ready=!1,e._options.persist!==!0&&(e._config=angular.copy(b))})}return f.prototype={getId:function(){return this._id},reset:function(){this._config=angular.copy(b),d.$broadcast("mapbox-"+this._id+"::reset")},clearLayers:function(){this.removeOverlays(),this.removeLayers(),this.removeGeoJSON()},enqueueRequest:function(a,b){this._ready?d.$broadcast(a,b):this._requestQueue.push({event:a,args:b})},dequeueRequests:function(){if(this._requestQueue.length)do{var a=this._requestQueue.shift();d.$broadcast(a.event,a.args)}while(this._requestQueue.length)},shouldShow:function(){return this._show},hide:function(){this._show=!1,this.enqueueRequest("mapbox-"+this._id+"::hide",{})},show:function(){this._show=!0,this.enqueueRequest("mapbox-"+this._id+"::show",{})},invalidateSize:function(){this.enqueueRequest("mapbox-"+this._id+"::invalidate-size",{})},getOptions:function(){return this._config.options},setOptions:function(a){var b=this;angular.forEach(a,function(a,c){b._config.options[c]=a})},getMapCenter:function(a){this.enqueueRequest("mapbox-"+this._id+"::get-center",a)},getMapBounds:function(a){this.enqueueRequest("mapbox-"+this._id+"::get-bounds",a)},getMapControl:function(a,b){this.enqueueRequest("mapbox-"+this._id+"::get-control",{control:a,handler:b})},getBaseTile:function(){return this._config.layerControl.baseTile},setBaseTile:function(a){this._config.layerControl.baseTile=a,this.enqueueRequest("mapbox-"+this._id+"::set-basetile",a)},getBaseLayers:function(){return this._config.layerControl.baseLayers},setBaseLayers:function(a){this._config.layerControl.baseLayers=a,this.enqueueRequest("mapbox-"+this._id+"::set-baselayers",a)},getOverlays:function(){return this._config.layerControl.overlays},addOverlay:function(a,b){a&&void 0==this._config.layerControl.overlays[a]&&(this._config.layerControl.overlays[a]=b,this.enqueueRequest("mapbox-"+this._id+"::add-overlay",{layerName:a,name:b||a}))},removeOverlay:function(a){a&&this._config.layerControl.overlays[a]&&(d.$broadcast("mapbox-"+this._id+"::remove-overlay",a),delete this._config.layerControl.overlays[a])},removeOverlays:function(){var a=this;angular.forEach(this._config.layerControl.overlays,function(b,c){d.$broadcast("mapbox-"+a._id+"::remove-overlay",c),delete a._config.layerControl.overlays[c]})},getControls:function(){return this._config.controls},addControl:function(a,b){this._config.controls[a]={name:a,options:b},d.$broadcast("mapbox-"+this._id+"::add-control",this._config.controls[a])},removeControl:function(a){delete this._config.controls[a],d.$broadcast("mapbox-"+this._id+"::remove-control",a)},getEventHandlers:function(){return this._config.events},addEventHandler:function(a,b){a=a instanceof Array?a:[a];var c=this;angular.forEach(a,function(a){c.removeEventHandler(a),c._config.events[a]=b,d.$broadcast("mapbox-"+c._id+"::add-event-handler",{event:a,handler:b})})},removeEventHandler:function(a){a=a instanceof Array?a:[a];var b=this;angular.forEach(a,function(a){void 0!==b._config.events[a]&&(d.$broadcast("mapbox-"+b._id+"::remove-event-handler",{event:a,handler:b._config.events[a]}),delete b._config.events[a])})},getView:function(){return{coordinates:this._config.view.coordinates,zoom:this._config.view.zoom}},setView:function(a,b){a instanceof Array&&(this._config.view.coordinates=a,this._config.view.zoom=b||this._config.view.zoom,d.$broadcast("mapbox-"+this._id+"::set-view",this._config.view))},getBounds:function(){return this._config.bounds},setBounds:function(a,b){this._config.bounds={coordinates:a,options:b||{reset:!1}},d.$broadcast("mapbox-"+this._id+"::set-bounds",this._config.bounds)},zoomTo:function(a,b,c){d.$broadcast("mapbox-"+this._id+"::zoom-to",{coordinates:a,zoom:b,options:c})},createLayer:function(a,b,c,d){"function"==typeof c&&(d=c,c={});var e=this;this.enqueueRequest("mapbox-"+this._id+"::create-layer",{name:a,type:b,options:c,handler:function(b){e._config.layers[a]=b,d(b)}})},getLayer:function(a){return this._config.layers[a]},getLayers:function(){return this._config.layers},addLayer:function(a,b){this._config.layers[a]=b,d.$broadcast("mapbox-"+this._id+"::add-layer",a)},removeLayer:function(a){a instanceof Array==!1&&(a=[a]);var b=this;angular.forEach(a,function(a){d.$broadcast("mapbox-"+b._id+"::remove-layer",a),delete b._config.layers[a]})},removeLayers:function(){var a=this;angular.forEach(this._config.layers,function(b,c){d.$broadcast("mapbox-"+-this._id+"::remove-layer",c),delete a._config.layers[c]})},showLayer:function(a){d.$broadcast("mapbox-"+this._id+"::show-layer",a)},hideLayer:function(a){d.$broadcast("mapbox-"+this._id+"::hide-layer",a)},fitLayer:function(a,b){this.enqueueRequest("mapbox-"+this._id+"::fit-layer",{name:a,options:b||{reset:!1}})},getGeoJSON:function(){return this._config.geojson
},getGeoJSONFeature:function(a,b){return this._config.geojson[a]&&this._config.geojson[a][b]?this._config.geojson[a][b]:null},getGeoJSONLayer:function(a){return this._config.geojson[a]?this._config.geojson[a]:null},addGeoJSON:function(b,c,f,g,h){"function"==typeof g&&(h=g,g={}),g=a.defaults(g||{},{featureId:e().toString()});var i={layerName:b,geojson:c,options:f,properties:g,onAddCallback:h};return this._config.geojson[b]=this._config.geojson[b]||{},this._config.geojson[b][g.featureId]=i,d.$broadcast("mapbox-"+this._id+"::add-geojson",i),g.featureId},addPhotoMarker:function(b,c,f,g,h){"function"==typeof g&&(h=g,g={}),g=a.defaults(g||{},{featureId:e().toString()});var i={layerName:b,geojson:c,options:f,properties:g,onAddCallback:h};return i.properties.isMedia=!0,this._config.geojson[b]=this._config.geojson[b]||{},this._config.geojson[b][g.featureId]=i,d.$broadcast("mapbox-"+this._id+"::add-photo-marker",i),g.featureId},removeGeoJSONFeature:function(a,b){this._config.geojson[a]&&this._config.geojson[a][b]&&(d.$broadcast("mapbox-"+this._id+"::remove-geojson-feature",this._config.geojson[a][b]),delete this._config.geojson[a][b])},removeGeoJSONLayer:function(a){a instanceof Array==!1&&(a=[a]);var b=this;angular.forEach(a,function(a){b._config.geojson[a]&&(d.$broadcast("mapbox-"+b._id+"::remove-geojson-layer",a),delete b._config.geojson[a])})},removeGeoJSON:function(){var a=this;angular.forEach(a._config.geojson,function(b,c){d.$broadcast("mapbox-"+a._id+"::remove-geojson-layer",c),delete a._config.geojson[c]})},editingOn:function(a,b,c,d,e){"string"==typeof c&&(c={exclude:"exclude"==c}),this.enqueueRequest("mapbox-"+this._id+"::edit-on",{layerName:a,controls:b,controlOptions:c,styleOptions:d,addLayer:e})},editingUpdate:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-update")},editingClear:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-clear")},editingOff:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-off")},pickPortionOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-portion-on")},pickDistrictOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-district-on")},pickFieldOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-field-on")},defineFarmOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-on")},defineServiceAreaOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-service-area-on")},defineFieldGroupOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-field-group-on")},featureClickOn:function(){this.enqueueRequest("mapbox-"+this._id+"::feature-click-on")},pickPortionOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-portion-off")},pickDistrictOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-district-off")},pickFieldOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-field-off")},defineFarmOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-off")},defineServiceAreaOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-off")},defineFieldGroupOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-field-group-off")},featureClickOff:function(){this.enqueueRequest("mapbox-"+this._id+"::feature-click-off")},enableSidebar:function(){this.enqueueRequest("mapbox-"+this._id+"::enable-sidebar")},showSidebar:function(){this.enqueueRequest("mapbox-"+this._id+"::sidebar-show")},hideSidebar:function(){this.enqueueRequest("mapbox-"+this._id+"::sidebar-hide")},toggleSidebar:function(){this.enqueueRequest("mapbox-"+this._id+"::sidebar-toggle")}},function(a,b){return b=b||{},void 0===c[a]&&(c[a]=new f(a,b)),b.clean===!0&&c[a].reset(),c[a]}}]}]),sdkInterfaceMapApp.directive("mapbox",["$rootScope","$http","$log","$timeout","configuration","mapboxService","geoJSONHelper","objectId","underscore",function(a,b,c,d,e,f,g,h,i){function j(a,b){var c=this;c._id=a.id,c._optionSchema={},c._editing=!1,c._editableLayer,c._editableFeature=L.featureGroup(),c._featureClickable,c._geoJSON={},c._layers={},c._controls={},c._layerControls={baseTile:"",baseLayers:{},overlays:{}},c._draw={exclude:!1,addLayer:!0,options:{},controls:{}},a.delay=a.delay||0,d(function(){c.mapInit(),c.addListeners(b),c.broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::init",c._map)},a.delay)}var k={};return j.prototype.mapInit=function(){var a=this;a._mapboxServiceInstance=f(a._id);var b=a._mapboxServiceInstance.getView(),c=a._mapboxServiceInstance.getOptions();a._map=L.map(a._id,c).setView(b.coordinates,b.zoom),a._map.whenReady(function(){a.broadcast("mapbox-"+a._mapboxServiceInstance.getId()+"::ready",a._map)}),a._editableFeature=L.featureGroup(),a._editableFeature.addTo(a._map),a.setEventHandlers(a._mapboxServiceInstance.getEventHandlers()),a.resetLayers(a._mapboxServiceInstance.getLayers()),a.resetGeoJSON(a._mapboxServiceInstance.getGeoJSON()),a.resetLayerControls(a._mapboxServiceInstance.getBaseTile(),a._mapboxServiceInstance.getBaseLayers(),a._mapboxServiceInstance.getOverlays()),a.addControls(a._mapboxServiceInstance.getControls()),a.setBounds(a._mapboxServiceInstance.getBounds()),a._map.on("draw:drawstart",a.onDrawStart,a),a._map.on("draw:editstart",a.onDrawStart,a),a._map.on("draw:deletestart",a.onDrawStart,a),a._map.on("draw:drawstop",a.onDrawStop,a),a._map.on("draw:editstop",a.onDrawStop,a),a._map.on("draw:deletestop",a.onDrawStop,a)},j.prototype.addListeners=function(a){a.hidden=!this._mapboxServiceInstance.shouldShow();var b=this,c=this._mapboxServiceInstance.getId();a.$on("mapbox-"+c+"::get-center",function(a,c){"function"==typeof c&&c(b._map.getCenter())}),a.$on("mapbox-"+c+"::get-bounds",function(a,c){"function"==typeof c&&c(b._map.getBounds())}),a.$on("mapbox-"+c+"::get-control",function(a,c){"function"==typeof c.handler&&c.handler(b._controls[c.control])}),a.$on("$destroy",function(){delete k[c],b.mapDestroy(),b.broadcast("mapbox-"+c+"::destroy")}),a.$on("mapbox-"+c+"::set-basetile",function(a,c){b.setBaseTile(c)}),a.$on("mapbox-"+c+"::set-baselayers",function(a,c){b.setBaseLayers(c)}),a.$on("mapbox-"+c+"::add-overlay",function(a,c){b.addOverlay(c.layerName,c.name)}),a.$on("mapbox-"+c+"::remove-overlay",function(a,c){b.removeOverlay(c)}),a.$on("mapbox-"+c+"::add-control",function(a,c){b.addControls({control:c})}),a.$on("mapbox-"+c+"::remove-control",function(a,c){b.removeControl(c)}),a.$on("mapbox-"+c+"::add-event-handler",function(a,c){b.addEventHandler(c.event,c.handler)}),a.$on("mapbox-"+c+"::remove-event-handler",function(a,c){b.removeEventHandler(c.event,c.handler)}),a.$on("mapbox-"+c+"::set-view",function(a,c){b.setView(c)}),a.$on("mapbox-"+c+"::set-bounds",function(a,c){b.setBounds(c)}),a.$on("mapbox-"+c+"::zoom-to",function(a,c){b.zoomTo(c)}),a.$on("mapbox-"+c+"::create-layer",function(a,c){"function"==typeof c.handler&&c.handler(b.createLayer(c.name,c.type,c.options))}),a.$on("mapbox-"+c+"::add-layer",function(a,c){b.addLayer(c)}),a.$on("mapbox-"+c+"::remove-layer",function(a,c){b.removeLayer(c)}),a.$on("mapbox-"+c+"::show-layer",function(a,c){b.showLayer(c)}),a.$on("mapbox-"+c+"::hide-layer",function(a,c){b.hideLayer(c)}),a.$on("mapbox-"+c+"::fit-layer",function(a,c){b.fitLayer(c)}),a.$on("mapbox-"+c+"::add-geojson",function(a,c){b.addGeoJSONFeature(c)}),a.$on("mapbox-"+c+"::add-photo-marker",function(a,c){b.addPhotoMarker(c)}),a.$on("mapbox-"+c+"::remove-geojson-feature",function(a,c){b.removeGeoJSONFeature(c)}),a.$on("mapbox-"+c+"::remove-geojson-layer",function(a,c){b.removeGeoJSONLayer(c)}),a.$on("mapbox-"+c+"::hide",function(){a.hidden=!0}),a.$on("mapbox-"+c+"::show",function(){a.hidden=!1}),a.$on("mapbox-"+c+"::invalidate-size",function(){b._map.invalidateSize()}),a.$on("mapbox-"+c+"::edit-on",function(a,c){b.setOptionSchema(c.styleOptions),b.makeEditable(c.layerName,c.addLayer,!0),b.setDrawControls(c.controls,c.controlOptions),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-update",function(){b.makeEditable(b._editableLayer,b._draw.addLayer,!1),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-clear",function(){b.cleanEditable(),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-off",function(){b.makeEditable(void 0,{},!0),b.updateDrawControls()}),a.$on("mapbox-"+c+"::pick-portion-on",function(){b._map.on("click",b.pickPortion,b)}),a.$on("mapbox-"+c+"::pick-district-on",function(){b._map.on("click",b.pickDistrict,b)}),a.$on("mapbox-"+c+"::pick-field-on",function(){b._map.on("click",b.pickField,b)}),a.$on("mapbox-"+c+"::define-farm-on",function(){b._map.on("click",b.defineNewFarm,b)}),a.$on("mapbox-"+c+"::define-service-area-on",function(){b._map.on("click",b.defineServiceArea,b)}),a.$on("mapbox-"+c+"::define-field-group-on",function(){b._map.on("click",b.defineFieldGroup,b)}),a.$on("mapbox-"+c+"::feature-click-on",function(){b._featureClickable=!0}),a.$on("mapbox-"+c+"::pick-portion-off",function(){b._map.off("click",b.pickPortion,b)}),a.$on("mapbox-"+c+"::pick-field-off",function(){b._map.off("click",b.pickField,b)}),a.$on("mapbox-"+c+"::pick-district-off",function(){b._map.off("click",b.pickDistrict,b)}),a.$on("mapbox-"+c+"::define-farm-off",function(){b._map.off("click",b.defineNewFarm,b)}),a.$on("mapbox-"+c+"::define-service-area-off",function(){b._map.off("click",b.defineServiceArea,b)}),a.$on("mapbox-"+c+"::define-field-group-off",function(){b._map.off("click",b.defineFieldGroup,b)}),a.$on("mapbox-"+c+"::feature-click-off",function(){b._featureClickable=!1}),a.$on("mapbox-"+c+"::enable-sidebar",function(){var a=L.control.sidebar("sidebar",{closeButton:!0,position:"right"});b._sidebar=a,b._map.addControl(a)}),a.$on("mapbox-"+c+"::sidebar-show",function(){null!=b._sidebar&&b._sidebar.show()}),a.$on("mapbox-"+c+"::sidebar-hide",function(){null!=b._sidebar&&b._sidebar.hide()}),a.$on("mapbox-"+c+"::sidebar-toggle",function(){null!=b._sidebar&&b._sidebar.toggle()})},j.prototype.mapDestroy=function(){for(var a in this._map._layers)this._map._layers.hasOwnProperty(a)&&this._map.removeLayer(this._map._layers[a]);this._optionSchema={},this._editing=!1,this._editableLayer=null,this._editableFeature=null,this._geoJSON={},this._layers={},this._layerControls={baseTile:"",baseLayers:{},overlays:{}},this._draw={exclude:!1,addLayer:!0,options:{},controls:{}},this._map.remove(),this._map=null},j.prototype.broadcast=function(b,d){c.debug(b),a.$broadcast(b,d)},j.prototype.resetLayerControls=function(a,b,c){this._layerControls.baseTile=a;try{this.map.removeControl(this._layerControls.control)}catch(d){}this.setBaseLayers(b),this.setOverlays(c)},j.prototype.resetLayers=function(a){var b=this;angular.forEach(b._layers,function(a,c){b._map.removeLayer(a),delete b._layers[c]}),angular.forEach(a,function(a,c){b._layers[c]=a,b._map.addLayer(a)})},j.prototype.resetGeoJSON=function(a){var b=this;angular.forEach(b._geoJSON,function(a,c){b._layers[c]&&(b._map.removeLayer(b._layers[c]),delete b._layers[c])}),angular.forEach(a,function(a){b.addGeoJSONLayer(a)})},j.prototype.setBaseTile=function(a){var b=this;b._layerControls.baseTile=a,angular.forEach(b._layerControls.baseLayers,function(b){b.base&&b.layer&&b.layer.setUrl(a)})},j.prototype.setBaseLayers=function(a){var b=this,c=b._mapboxServiceInstance.getOptions();void 0===b._layerControls.control&&(b._layerControls.control=L.control.layers({},{}),c.layersControl&&b._map.addControl(b._layerControls.control)),angular.forEach(b._layerControls.baseLayers,function(c,d){void 0===a[d]?b._layerControls.control.removeLayer(c.layer):void 0===c.layer&&b.addBaseLayer(c,d)}),angular.forEach(a,function(a,c){void 0===b._layerControls.baseLayers[c]?b.addBaseLayer(a,c):(a=b._layerControls.baseLayers[c],a.base&&a.layer.addTo(this._map))})},j.prototype.addBaseLayer=function(a,b){a.base&&(a.tiles=this._layerControls.baseTile),"tile"==a.type?a.layer=L.tileLayer(a.tiles):"mapbox"==a.type?a.layer=L.mapbox.tileLayer(a.tiles):"google"==a.type&&"function"==typeof L.Google&&(a.layer=new L.Google(a.tiles)),a.base&&a.layer.addTo(this._map),this._layerControls.baseLayers[b]=a,this._layerControls.control.addBaseLayer(a.layer,b)},j.prototype.setOverlays=function(a){var b=this;angular.forEach(b._layerControls.overlays,function(c,d){void 0===a[d]&&b.removeOverlay(d,c)}),angular.forEach(a,function(a,c){b.addOverlay(c,a)})},j.prototype.addOverlay=function(a,b){var c=this._layers[a];b=b||a,this._layerControls.control&&c&&void 0===this._layerControls.overlays[a]&&(this._layerControls.overlays[a]=c,this._layerControls.control.addOverlay(c,b))},j.prototype.removeOverlay=function(a,b){var c=b||this._layers[a];this._layerControls.control&&c&&(this._layerControls.control.removeLayer(c),delete this._layerControls.overlays[a])},j.prototype.addControls=function(a){var b=this;angular.forEach(a,function(a){"function"==typeof L.control[a.name]&&(b.removeControl(a.name),b._controls[a.name]=L.control[a.name](a.options),b._map.addControl(b._controls[a.name]))})},j.prototype.removeControl=function(a){this._controls[a]&&(this._map.removeControl(this._controls[a]),delete this._controls[a])},j.prototype.setEventHandlers=function(a){var b=this;angular.forEach(a,function(a,c){b.addEventHandler(c,a)})},j.prototype.addEventHandler=function(a,b){this._map.on(a,b)},j.prototype.removeEventHandler=function(a,b){this._map.off(a,b)},j.prototype.setView=function(a){this._map&&void 0!==a&&this._map.setView(a.coordinates,a.zoom)},j.prototype.setBounds=function(a){this._map&&a.coordinates&&(a.coordinates instanceof Array?a.coordinates.length>1?this._map.fitBounds(a.coordinates,a.options):1==a.coordinates.length&&this._map.fitBounds(a.coordinates.concat(a.coordinates),a.options):this._map.fitBounds(a.coordinates,a.options))},j.prototype.zoomTo=function(a){this._map&&a.coordinates&&a.zoom&&this._map.setZoomAround(a.coordinates,a.zoom,a.options)},j.prototype.createLayer=function(a,b,c){return b=b||"featureGroup",c=c||{},void 0===this._layers[a]&&("featureGroup"==b&&L.featureGroup?this._layers[a]=L.featureGroup(c):"markerClusterGroup"==b&&L.markerClusterGroup&&(this._layers[a]=L.markerClusterGroup(c)),this._layers[a]&&this._layers[a].addTo(this._map)),this._layers[a]},j.prototype.addLayer=function(a){var b=this._mapboxServiceInstance.getLayer(a);b&&(this._layers[a]=b,this._map.addLayer(b))},j.prototype.addLayerToLayer=function(a,b,c){var d=this._layers[c];d&&(this._layers[a]=b,d.addLayer(b))},j.prototype.removeLayer=function(a){var b=this._layers[a];b&&(this.removeOverlay(a),this._map.removeLayer(b),delete this._layers[a])},j.prototype.removeLayerFromLayer=function(a,b){var c=this._layers[b],d=this._layers[a];c&&(c.removeLayer(d),delete this._layers[a])},j.prototype.showLayer=function(a){var b=this._layers[a];b&&0==this._map.hasLayer(b)&&(this._map.addLayer(b),b.eachLayer(function(a){a.bindLabel&&a.feature.properties.label&&a.bindLabel(a.feature.properties.label.message,a.feature.properties.label.options)}))},j.prototype.hideLayer=function(a){var b=this._layers[a];b&&this._map.hasLayer(b)&&this._map.removeLayer(b)},j.prototype.fitLayer=function(a){if(a.name){var b=this._layers[a.name];if(b&&this._map.hasLayer(b)){var c=b.getBounds();this._map.fitBounds(c,a.options)}}},j.prototype.addGeoJSONLayer=function(a){var b=this;angular.forEach(a,function(a){b.addGeoJSONFeature(a)})},j.prototype.makeIcon=function(a){return a?a.type&&L[a.type]&&L[a.type].icon?L[a.type].icon(a):L.icon(a):L.Icon.Default()},j.prototype.addLabel=function(a,b,c){var d=this,e=g(b);if("object"==typeof a&&"Point"!==b.geometry.type)if(a.options=a.options||{},(a.options.centered||a.options.noHide)&&"function"==typeof d._map.showLabel){var f=new L.Label(i.extend(a.options),{offset:[6,-15]});f.setContent(a.message),f.setLatLng(e.getCenter()),1==a.options.noHide?(d._map.showLabel(f),c.on("add",function(){d._map.showLabel(f)}),c.on("remove",function(){d._map.removeLayer(f)})):(c.on("mouseover",function(){d._map.showLabel(f)}),c.on("mouseout",function(){d._map.removeLayer(f)}))}else"function"==typeof c.bindLabel&&c.bindLabel(a.message,a.options)},j.prototype.addPhotoMarker=function(a){this.addGeoJSONFeature(a)},j.prototype.addGeoJSONFeature=function(a){var b=this,c=g(a.geojson,a.properties);b.createLayer(a.layerName,a.type,a.options),b._geoJSON[a.layerName]=b._geoJSON[a.layerName]||{},b._geoJSON[a.layerName][a.properties.featureId]=a;var d=a.options?angular.copy(a.options):{};if(d.icon&&(d.icon=b.makeIcon(d.icon)),a.properties.isMedia){var e=a,f={iconSize:[40,40],className:"leaflet-marker-agrista-photo"},h={helpers:{overlay:{css:{background:"rgba(0,0,0,0.7)"}}},aspectRatio:!0,autoSize:!1,width:640,height:640};L.geoJson(c.getJson(),{pointToLayer:function(a,b){var c=L.marker(b,{icon:L.icon(L.extend({iconUrl:e.geojson.properties.data.src},f)),title:e.caption||""});return c},onEachFeature:function(c,d){console.log("calling add layer to layer"),b.addLayerToLayer(c.properties.featureId,d,a.layerName),"function"==typeof a.onAddCallback&&a.onAddCallback(c,d),d.on("click",function(){$.fancybox({href:c.properties.data.src,title:(c.properties.data.photoDate||c.properties.data.uploadDate)+" @ "+c.geometry.coordinates[1].toFixed(4)+(c.geometry.coordinates[1]>0?" N":" S")+" "+c.geometry.coordinates[0].toFixed(4)+(c.geometry.coordinates[0]>0?" E":"  W"),type:"image"},h)})}})}else L.geoJson(c.getJson(),{style:d.style,pointToLayer:function(a,b){var c=L.marker(b,d);return d.label&&c.bindLabel(d.label.message,d.label.options),c},onEachFeature:function(c,e){b.addLayerToLayer(c.properties.featureId,e,a.layerName),b.addLabel(d.label,c,e),"function"==typeof a.onAddCallback&&a.onAddCallback(c,e),!b._featureClickable||"Polygon"!==c.geometry.type&&"MultiPolygon"!==c.geometry.type||e.on("click",function(){c&&c.properties&&(c.properties.highlighted?(c.properties.highlighted=!1,e.setStyle({color:e.options.fillColor||"blue",opacity:e.options.fillOpacity||.4})):(c.properties.highlighted=!0,e.setStyle({color:"white",opacity:1,fillColor:e.options.fillColor||"blue",fillOpacity:e.options.fillOpacity||.4}))),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::polygon-clicked",{properties:c.properties,highlighted:c.properties.highlighted})})}})},j.prototype.removeGeoJSONFeature=function(a){this._geoJSON[a.layerName]&&this._geoJSON[a.layerName][a.properties.featureId]&&(this.removeLayerFromLayer(a.properties.featureId,a.layerName),delete this._geoJSON[a.layerName][a.properties.featureId])},j.prototype.removeGeoJSONLayer=function(a){this._geoJSON[a]&&(this.removeLayer(a),delete this._geoJSON[a])},j.prototype.makeEditable=function(a,b,c){var d=this;1==c&&d.cleanEditable(),a&&d._layers[a]&&d._layers[a].eachLayer(function(b){d._layers[a].removeLayer(b),d._editableFeature.addLayer(b)}),d._editableLayer=a,d._draw.addLayer=void 0==b?!0:b},j.prototype.cleanEditable=function(){var a=this;a._editableFeature.eachLayer(function(b){a._editableFeature.removeLayer(b)})},j.prototype.setDrawControls=function(a,b){this._draw.controlOptions=b||{},this._draw.controls={},a instanceof Array&&"function"==typeof L.Control.Draw&&(this._draw.controls.polyline=new L.Control.Draw({draw:{polyline:-1!=a.indexOf("polyline"),polygon:!1,rectangle:!1,circle:!1,marker:!1}}),this._draw.controls.polygon=new L.Control.Draw({draw:{polyline:!1,polygon:-1==a.indexOf("polygon")?!1:{allowIntersection:!1,showArea:!0,metric:!0},rectangle:!1,circle:!1,marker:!1}}),this._draw.controls.marker=new L.Control.Draw({draw:{polyline:!1,polygon:!1,rectangle:!1,circle:!1,marker:-1==a.indexOf("marker")?!1:{icon:this._optionSchema.icon?L.icon(this._optionSchema.icon):L.Icon.Default()}}}),this._draw.controls.edit=new L.Control.Draw({draw:!1,edit:{featureGroup:this._editableFeature,remove:1!=this._draw.controlOptions.nodelete}}))},j.prototype.setOptionSchema=function(a){this._optionSchema=a||{}},j.prototype.updateDrawControls=function(){try{this._map.removeControl(this._draw.controls.polyline)}catch(a){}try{this._map.removeControl(this._draw.controls.polygon)}catch(a){}try{this._map.removeControl(this._draw.controls.marker)}catch(a){}try{this._map.removeControl(this._draw.controls.edit)}catch(a){}try{this._map.off("draw:created",this.onDrawn,this),this._map.off("draw:edited",this.onEdited,this),this._map.off("draw:deleted",this.onDeleted,this)}catch(a){}if(this._editableFeature.getLayers().length>0&&(this._map.on("draw:edited",this.onEdited,this),this._map.on("draw:deleted",this.onDeleted,this),this._draw.controls.edit&&this._map.addControl(this._draw.controls.edit)),this._editableLayer&&(0==this._editableFeature.getLayers().length||this._draw.controlOptions.multidraw)){var b={polyline:!0,polygon:!0,marker:!0};this._editableFeature.eachLayer(function(a){if(a.feature&&a.feature.geometry&&a.feature.geometry.type)switch(a.feature.geometry.type){case"LineString":b.polyline=!1;break;case"Polygon":b.polygon=!1;break;case"Point":b.marker=!1}}),this._draw.controlOptions.exclude?(b.polyline&&this._map.addControl(this._draw.controls.polyline),b.polygon&&this._map.addControl(this._draw.controls.polygon),b.marker&&this._map.addControl(this._draw.controls.marker),this._map.on("draw:created",this.onDrawn,this)):(this._draw.controls.polyline&&this._map.addControl(this._draw.controls.polyline),this._draw.controls.polygon&&this._map.addControl(this._draw.controls.polygon),this._draw.controls.marker&&this._map.addControl(this._draw.controls.marker),this._map.on("draw:created",this.onDrawn,this))}},j.prototype.pickPortion=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/portion-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::portion-added",a))}).error(function(a){c.debug(a)})}},j.prototype.defineNewFarm=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/portion-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey,portion:a}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::portion-added",a))}).error(function(a){c.debug(a)})}},j.prototype.pickDistrict=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/district-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::district-added",a))}).error(function(a){c.debug(a)})}},j.prototype.defineServiceArea=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/district-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey,districtName:a.name}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::district-added",a))}).error(function(a){c.debug(a)})}},j.prototype.pickField=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/field-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::field-added",a))}).error(function(a){c.debug(a)})}},j.prototype.defineFieldGroup=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/field-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::field-added",a))}).error(function(a){c.debug(a)})}},j.prototype.onDrawStart=function(){this._editing=!0,this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-editing",this._editing)},j.prototype.onDrawStop=function(){this._editing=!1,this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-editing",this._editing)},j.prototype.onDrawn=function(a){var b={type:"Feature",geometry:{},properties:{featureId:h().toString()}};switch(a.layerType){case"polyline":b.geometry={type:"LineString",coordinates:[]},angular.forEach(a.layer._latlngs,function(a){b.geometry.coordinates.push([a.lng,a.lat])}),this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b);break;case"polygon":if(b.geometry={type:"Polygon",coordinates:[[]]},angular.forEach(a.layer._latlngs,function(a){b.geometry.coordinates[0].push([a.lng,a.lat])}),b.geometry.coordinates[0].length>0&&b.geometry.coordinates[0][0]!=b.geometry.coordinates[0][b.geometry.coordinates[0].length-1]&&b.geometry.coordinates[0].push(b.geometry.coordinates[0][0]),this._draw.controls.polygon.options.draw.polygon.showArea){var c=L.GeometryUtil.geodesicArea(a.layer._latlngs),d=1.19599*c;b.properties.area={m_sq:c,ha:1e-4*c,mi_sq:d/3097600,acres:d/4840,yd_sq:d}}this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b);break;case"marker":b.geometry={type:"Point",coordinates:[a.layer._latlng.lng,a.layer._latlng.lat]},this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b)}this._draw.addLayer&&(this._mapboxServiceInstance.addGeoJSON(this._editableLayer,b,this._optionSchema,b.properties),this.makeEditable(this._editableLayer),this.updateDrawControls())},j.prototype.onEdited=function(b){var c=this;b.layers.eachLayer(function(b){var d={type:"Feature",geometry:{type:b.feature.geometry.type},properties:{featureId:b.feature.properties.featureId}};c._draw.controls.polygon.options.draw.polygon.showArea&&(d.properties.area={m_sq:0,ha:0,mi_sq:0,acres:0,yd_sq:0});var e=function(a,b){var c=[];if(angular.forEach(a._latlngs,function(a){c.push([a.lng,a.lat])}),c.length>0&&c[0]!=c[c.length-1]&&c.push(c[0]),void 0!==b.properties.area){var d=L.GeometryUtil.geodesicArea(a._latlngs),e=1.19599*d;b.properties.area.m_sq+=d,b.properties.area.ha+=1e-4*d,b.properties.area.mi_sq+=e/3097600,b.properties.area.acres+=e/4840,b.properties.area.yd_sq+=e}return c};switch(b.feature.geometry.type){case"Point":d.geometry.coordinates=[b._latlng.lng,b._latlng.lat],c.broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d);break;case"Polygon":d.geometry.coordinates=[e(b,d)],a.$broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d);break;case"MultiPolygon":d.geometry.coordinates=[[]],b.eachLayer(function(a){d.geometry.coordinates[0].push(e(a,d))}),c.broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d);break;case"LineString":d.geometry.coordinates=[],angular.forEach(b._latlngs,function(a){d.geometry.coordinates.push([a.lng,a.lat])}),c.broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d)}})},j.prototype.onDeleted=function(a){var b=this,c=function(a){b._editableFeature.removeLayer(a),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-deleted",a.feature.properties.featureId)};a.layers.getLayers().length>0?a.layers.eachLayer(function(a){void 0!==a.feature?c(a):b._editableFeature.eachLayer(function(b){b.hasLayer(a)&&c(b)})}):(b._editableFeature.clearLayers(),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-deleted")),b.updateDrawControls()},{restrict:"E",template:'<div class="map" ng-hide="hidden" ng-transclude></div>',replace:!0,transclude:!0,link:function(a,b,c){void 0===k[c.id]&&(k[c.id]=new j(c,a))},controller:function(a,b){this.getMap=function(){return k[b.id]._map}}}}]),sdkInterfaceMapApp.directive("mapboxControl",["$rootScope",function(a){function b(b){var e=b.parent();a.$on("mapbox-"+e.attr("id")+"::init",function(){e.find(".leaflet-control-container "+d[c]).prepend(b)})}var c,d={topleft:".leaflet-top.leaflet-left",topright:".leaflet-top.leaflet-right",bottomleft:".leaflet-bottom.leaflet-left",bottomright:".leaflet-bottom.leaflet-right"};return{restrict:"E",require:"^mapbox",replace:!0,transclude:!0,template:'<div class="leaflet-control"><div class="leaflet-bar" ng-transclude></div></div>',link:function(a,b,d){c=void 0==d.position?"bottomright":d.position},controller:function(a){b(a)}}}]);var sdkInterfaceNavigiationApp=angular.module("ag.sdk.interface.navigation",["ag.sdk.authorization","ag.sdk.library"]);sdkInterfaceNavigiationApp.provider("navigationService",["underscore",function(a){var b={},c=[],d={Favourites:1,Assets:2,Apps:3,Administration:4},e={left:[],right:[]},f=function(a,b){return a.order-b.order},g=this.registerApps=function(c){c=c instanceof Array?c:[c],angular.forEach(c,function(c){c=a.defaults(c,{id:c.title,order:100,group:"Apps",include:function(a,b){return-1!==b.indexOf(a.id)}}),c.title&&c.state&&(b[c.title]=c)})};this.$get=["$rootScope","$state","authorization",function(h,i,j){var k=!1,l="",m=function(b){var e=a.findWhere(c,{title:b.group});void 0===e&&(e={title:b.group,order:d[b.group]||100,items:[]},c.push(e),c=c.sort(f));var g=a.findWhere(e.items,{id:b.id});void 0===g&&(b.active=i.includes(b.state),e.items.push(b),e.items=e.items.sort(f),h.$broadcast("navigation::items__changed",c),h.$broadcast("navigation::app__allowed",b))},n=function(){c=[],h.$broadcast("navigation::items__changed",c)},o=function(c){var d=c||j.currentUser(),e=d.userRole?a.pluck(d.userRole.apps,"name"):[],f=d.organization?a.pluck(d.organization.services,"serviceType"):[];n(),angular.forEach(b,function(a){("function"==typeof a.include&&a.include(a,e,f)||a.include===!0)&&m(a)})},p=function(a,b){b&&(b instanceof Array==!1?e[a].push(b):e[a]=b,h.$broadcast("navigation::"+a+"-buttons__changed",e[a]),h.$broadcast("navigation::buttons__changed"))};return h.$on("$stateChangeSuccess",function(){angular.forEach(c,function(a){angular.forEach(a.items,function(a){a.active=i.includes(a.state)})})}),h.$on("navigation::item__selected",function(a,b){i.go(b)}),h.$on("authorization::login",function(a,b){o(b)}),h.$on("authorization::unauthorized",function(){n()}),h.$on("authorization::logout",function(){n()}),o(),{getGroupedApps:function(){return c},renameApp:function(d,e){var f=a.findWhere(b,{id:d});f&&(f.title=e,h.$broadcast("navigation::items__changed",c))},registerApps:function(a){g(a)},unregisterApps:function(){b={},c=[]},allowApp:function(a){b[a]&&m(b[a])},toggleSlim:function(){k=!k,h.$broadcast("navigation::slim__changed",k)},isSlim:function(){return k},footerText:function(a){return void 0!==a&&(l=a,h.$broadcast("navigation::footerText",l)),l},leftButtons:function(a){return p("left",a),e.left},rightButtons:function(a){return p("right",a),e.right}}}]}]);var cordovaHelperApp=angular.module("ag.mobile-sdk.helper",["ag.sdk.utilities","ag.mobile-sdk.cordova.geolocation","ag.mobile-sdk.cordova.camera"]);cordovaHelperApp.factory("geolocationHelper",["promiseService","geolocationService",function(a,b){function c(a){return this instanceof c?(this._options=a.options||{},this._onGet=a.onGet||angular.noop,this._onWatch=a.onWatch||angular.noop,this._onError=a.onError||angular.noop,void(this._watcher=null)):new c(a)}function d(a){return{type:"Feature",geometry:{coordinates:[a.coords.longitude,a.coords.latitude],type:"Point"},properties:{accuracy:a.coords.accuracy,altitude:a.coords.altitude}}}return c.prototype={busy:!1,getPosition:function(a){var c=this;c.busy=!0,a=a||c._options,b.getPosition(a).then(function(a){c.busy=!1,c._onGet(d(a),a)
},function(a){c.busy=!1,c._onError(a)})},watchPosition:function(a){var c=this;a=a||c._options,c._watcher=b.watchPosition(a,function(a,b){a?c._onWatch(d(a),a):c._onError(b)})},cancelWatch:function(){this._watcher&&(this._watcher.cancel(),this._watcher=null)}},function(a){return new c(a)}}]),cordovaHelperApp.factory("cameraHelper",["promiseService","geolocationService","cameraService",function(a,b,c){var d={geolocation:{timeout:2e4},camera:{quality:50,targetWidth:1280,targetHeight:720,correctOrientation:!0,encodingType:c.getEncodingTypes.JPEG,destinationType:c.getDestinationTypes.FILE_URI}},e={0:"image/jpeg",1:"image/png"};return{capturePhotoWithLocation:function(f,g){return f=f||d.geolocation,g=g||d.camera,a.wrap(function(d){a.all({geolocation:b.getPosition(f),camera:c.capture(g)}).then(function(a){d.resolve({geolocation:{type:"Feature",geometry:{coordinates:[a.geolocation.coords.longitude,a.geolocation.coords.latitude],type:"Point"},properties:{source:"gps",accuracy:a.geolocation.coords.accuracy,altitude:a.geolocation.coords.altitude}},camera:{src:a.camera,type:e[g.encodingType]}})},d.reject)})}}}]);var sdkTestDataApp=angular.module("ag.sdk.test.data",["ag.sdk.utilities","ag.sdk.id","ag.sdk.library"]);sdkTestDataApp.provider("mockDataService",["underscore",function(a){var b={},c={localStore:!0};this.config=function(b){c=a.defaults(b,c)},this.$get=["localStore","objectId","promiseService",function(d,e,f){return c.localStore&&(b=d.getItem("mockdata")||{}),{setItem:function(a,f){f instanceof Array?(b[a]={},angular.forEach(f,function(c){c.id=c.id||e().toString(),b[a][c.id]=c})):(f.id=f.id||e().toString(),b[a]=b[a]||{},b[a][f.id]=f),c.localStore&&d.setItem("mockdata",b)},getItem:function(c,d){return f.wrap(function(e){b[c]=b[c]||{},void 0===d?e.resolve(a.toArray(b[c]||{})):b[c][d]?e.resolve(b[c][d]):e.reject()})}}}]}]);var cordovaCameraApp=angular.module("ag.mobile-sdk.cordova.camera",["ag.sdk.utilities","ag.sdk.library"]);cordovaCameraApp.factory("cameraService",["promiseService","underscore",function(a,b){function c(b){var c=a.defer();return void 0!==navigator.camera?navigator.camera.getPicture(function(a){c.resolve(a)},function(a){c.reject(a)},b):c.reject({code:"NoCamera",message:"No camera available"}),c.promise}"undefined"==typeof window.Camera&&(window.Camera={});var d=Camera.PictureSourceType,e=Camera.DestinationType,f=Camera.EncodingType;return{getDestinationTypes:e,getEncodingTypes:f,getPictureSourceTypes:d,capture:function(a){return"object"!=typeof a&&(a={}),c(b.defaults(a,{quality:50,destinationType:e.DATA_URL,source:d.CAMERA}))},captureAndEdit:function(a){return"object"!=typeof a&&(a={}),c(b.defaults(a,{quality:50,allowEdit:!0,destinationType:e.DATA_URL,source:d.CAMERA}))},retrieve:function(a){return"object"!=typeof a&&(a={}),c(b.defaults(a,{quality:50,destinationType:e.FILE_URI,source:d.PHOTOLIBRARY}))}}}]);var cordovaConnectionApp=angular.module("ag.mobile-sdk.cordova.connection",[]);cordovaConnectionApp.factory("connectionService",["$timeout",function(a){var b=[],c=void 0,d=function(){navigator.connection&&c!==navigator.connection.type&&(c=navigator.connection.type,angular.forEach(b,function(a){a(c)})),a(d,1e4)};return d(),{watchConnection:function(a){"function"==typeof a&&b.push(a)},isOnline:function(){return navigator.connection.type!==Connection.NONE&&navigator.connection.type!==Connection.UNKNOWN},isMobile:function(){return navigator.connection.type===Connection.CELL||navigator.connection.type===Connection.CELL_2G||navigator.connection.type===Connection.CELL_3G||navigator.connection.type===Connection.CELL_4G}}}]);var cordovaGeolocationApp=angular.module("ag.mobile-sdk.cordova.geolocation",["ag.sdk.utilities","ag.sdk.library"]);cordovaGeolocationApp.factory("geolocationService",["promiseService","underscore",function(a,b){function c(a,b){switch(a){case PositionError.PERMISSION_DENIED:return f.PermissionDenied;case PositionError.POSITION_UNAVAILABLE:return f.PositionUnavailable;case PositionError.TIMEOUT:return f.Timeout;default:return{err:"Unknown",msg:b}}}var d=navigator.geolocation,e={enableHighAccuracy:!0},f={PermissionDenied:{err:"PermissionDenied",msg:"Not authorizated to request position"},PositionUnavailable:{err:"PositionUnavailable",msg:"Unable to receive position"},Timeout:{err:"Timeout",msg:"Unable to receive position within timeout"},Unknown:{err:"Unknown",msg:"An unknown error occured"}};return{getPosition:function(f){"object"!=typeof f&&(f={}),f=b.defaults(f,e);var g=a.defer();return d.getCurrentPosition(function(a){g.resolve(a)},function(a){g.reject(c(a.code,a.msg))},f),g.promise},watchPosition:function(a,f){function g(){var b=void 0;this.start=function(){void 0===b&&(b=d.watchPosition(function(a){f(a)},function(a){f(null,c(a.code,a.msg))},a))},this.cancel=function(){void 0!==b&&(d.clearWatch(b),b=void 0)},this.start()}return"function"==typeof a&&(f=a,a={}),"object"!=typeof a&&(a={}),a=b.defaults(a,e),new g}}}]);var cordovaStorageApp=angular.module("ag.mobile-sdk.cordova.storage",["ag.sdk.utilities"]);cordovaStorageApp.factory("fileStorageService",["$log","promiseService",function(a,b){var c=void 0,d={noFileSystem:{err:"NoFileSystem",msg:"Could not initialize file system"},directoryNotFound:{err:"directoryNotFound",msg:"Could not find requested directory"},fileNotFound:{err:"FileNotFound",msg:"Could not find requested file"},fileNotReadable:{err:"FileNotReadable",msg:"Could not read from file"},fileNotWritable:{err:"FileNotWritable",msg:"Could not write to file"}},e=function(a,b){void 0===c?window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(b){c=b,a()},b):a()},f=function(a,f){var g=b.defer(),h=function(a){g.resolve(a)},i=function(){g.reject(d.fileNotFound)};return e(function(){0===a.indexOf("file://")?window.resolveLocalFileSystemURI(a,h,i):c.root.getFile(a,f,h,i)},function(){g.reject(d.noFileSystem)}),g.promise};return a.debug("Initialized storageService"),{exists:function(a){var c=b.defer();return f(a,{create:!1}).then(function(a){c.resolve({exists:!0,file:a.name})},function(a){c.reject(a)}),c.promise},read:function(a,c){var e=b.defer();return f(a,{create:!1}).then(function(a){a.file(function(b){var f=new FileReader;f.onloadend=function(){e.resolve({read:!0,file:a.name,content:f.result})},f.onerror=function(){e.reject(d.fileNotReadable)},c===!0?f.readAsDataURL(b):f.readAsText(b)},function(){e.reject(d.fileNotFound)})},function(a){e.reject(a)}),e.promise},copy:function(a,e){var g=b.defer();return f(a,{create:!1}).then(function(a){c.root.getDirectory(e,{create:!0,exclusive:!1},function(b){a.copyTo(b,a.name,function(a){g.resolve({copy:!0,file:a.name,path:a.fullPath})},function(){g.reject(d.fileNotFound)})},function(){g.reject(d.directoryNotFound)})},function(a){g.reject(a)}),g.promise},move:function(a,e){var g=b.defer();return f(a,{create:!1}).then(function(a){c.root.getDirectory(e,{create:!0,exclusive:!1},function(b){a.moveTo(b,a.name,function(a){g.resolve({move:!0,file:a.name,path:a.fullPath})},function(){g.reject(d.fileNotFound)})},function(){g.reject(d.directoryNotFound)})},function(a){g.reject(a)}),g.promise},write:function(a,c){var e=b.defer();return f(a,{create:!0}).then(function(a){a.createWriter(function(b){b.onwriteend=function(){e.resolve({write:!0,file:a.name})},b.onerror=function(){e.reject(d.fileNotWritable)},b.write(c)},function(){e.reject(d.fileNotFound)})},function(a){e.reject(a)}),e.promise},remove:function(a){var c=b.defer();return f(a,{create:!1}).then(function(a){a.remove(function(){c.resolve({remove:!0,file:a.name})},function(){c.reject(d.fileNotFound)})},function(a){c.reject(a)}),c.promise}}}]);var cordovaToasterApp=angular.module("ag.mobile-sdk.cordova.toaster",[]);cordovaToasterApp.factory("toasterService",[function(){var a=window.plugins&&window.plugins.toast?window.plugins.toast:void 0,b=function(b,c,d){void 0!==a&&a.show(b,c,d)};return{show:function(a,c,d){b(a,c,d)},showLongBottom:function(a){b(a,"long","bottom")}}}]);var mobileSdkApiApp=angular.module("ag.mobile-sdk.api",["ag.sdk.utilities","ag.sdk.monitor","ag.mobile-sdk.hydration","ag.mobile-sdk.data","ag.mobile-sdk.cordova.storage","ag.sdk.library"]),_errors={TypeParamRequired:{code:"TypeParamRequired",message:"Type parameter is required"},UploadPhotoError:{code:"UploadPhotoError",message:"Error occured uploading photo"}};mobileSdkApiApp.provider("apiSynchronizationService",["underscore",function(a){var b={models:["budgets","documents","expenses","farmers","tasks","organizational-units"],local:{readLocal:!0,hydrate:!1},remote:{readLocal:!1,readRemote:!0,hydrate:!1}};this.config=function(c){b=a.extend(b,c)},this.$get=["$http","$log","assetApi","configuration","documentApi","enterpriseBudgetApi","expenseApi","farmApi","farmerApi","fileStorageService","legalEntityApi","organizationalUnitApi","pagingService","promiseService","taskApi",function(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(a){return a=a||{limit:20,resulttype:"simple"},k.purgeFarmer({template:"farmers",options:{force:!1}}).then(function(){return p.wrap(function(c){var d=o.initialize(function(a){return k.getFarmers({params:a,options:b.remote})},function(){d.complete?c.resolve():d.request().catch(c.reject)},a);d.request().catch(c.reject)})})}function s(a){return a=a||{limit:20,resulttype:"simple"},g.purgeDocument({template:"documents",options:{force:!1}}).then(function(){return p.wrap(function(c){var d=o.initialize(function(a){return g.getDocuments({params:a,options:b.remote})},function(){d.complete?c.resolve():d.request().catch(c.reject)},a);d.request().catch(c.reject)})})}function t(a){return a=a||{limit:20,resulttype:"full"},i.purgeExpense({template:"expenses",options:{force:!1}}).then(function(){return p.wrap(function(c){var d=o.initialize(function(a){return i.getExpenses({params:a,options:b.remote})},function(){d.complete?c.resolve():d.request().catch(c.reject)},a);d.request().catch(c.reject)})})}function u(a){return a=a||{limit:20,resulttype:"simple"},q.purgeTask({template:"tasks",options:{force:!1}}).then(function(){return p.wrap(function(c){var d=o.initialize(function(a){return q.getTasks({params:a,options:b.remote})},function(){d.complete?q.getTasks({options:{fallbackRemote:!0,hydrate:["organization","subtasks"]}}).then(c.resolve,c.reject):d.request().catch(c.reject)},a);d.request().catch(c.reject)})})}function v(){return h.getEnterpriseBudgets({options:b.remote})}function w(a){return a=a||{limit:20,resulttype:"simple"},n.purgeOrganizationalUnit({template:"organizational-units",options:{force:!1}}).then(function(){return p.wrap(function(c){var d=o.initialize(function(a){return n.getOrganizationalUnits({params:a,options:b.remote})},function(){d.complete?c.resolve():d.request().catch(c.reject)},a);d.request().catch(c.reject)})})}function x(){return k.getFarmers({options:{readLocal:!0,hydrate:["primaryContact"]}}).then(function(a){return p.chain(function(b){angular.forEach(a,function(a){b.push(function(){return y(a)})})})},p.throwError)}function y(a){return p.chain(function(b){a.__dirty===!0&&b.push(function(){return k.postFarmer({data:a})}),b.push(function(){return z(a.id)},function(){return A(a.id)})})}function z(a){return j.getFarms({id:a,options:b.local}).then(function(a){return p.chain(function(b){angular.forEach(a,function(a){a.__dirty===!0&&b.push(function(){return j.postFarm({data:a})})})})},p.throwError)}function A(a){return m.getEntities({id:a,options:b.local}).then(function(a){return p.chain(function(b){angular.forEach(a,function(a){a.__dirty===!0&&b.push(function(){return B(a)}),b.push(function(){return C(a.id)})})})},p.throwError)}function B(b){b.data=b.data||{};var c=b.data.attachments?angular.copy(b.data.attachments):[],d=a.where(c,{local:!0});return b.data.attachments=a.difference(c,d),m.postEntity({data:b}).then(function(a){return p.chain(function(b){angular.forEach(d,function(c){b.push(function(){return J("legalentity",a.id,c)})})})},p.throwError)}function C(a){return e.getAssets({id:a,options:b.local}).then(function(a){return p.chain(function(b){angular.forEach(a,function(a){a.__dirty===!0&&b.push(function(){return D(a)})})})},p.throwError)}function D(b){b.data=b.data||{};var c=b.data.attachments?angular.copy(b.data.attachments):[],d=a.where(c,{local:!0});return b.data.attachments=a.difference(c,d),e.postAsset({data:b}).then(function(a){return a=a&&a.length?a[0]:a,p.chain(function(b){angular.forEach(d,function(c){b.push(function(){return J("asset",a.id,c)})})})},p.throwError)}function E(){return g.getDocuments({options:b.local}).then(function(a){return p.chain(function(b){angular.forEach(a,function(a){a.__dirty===!0&&b.push(function(){return F(a)})})})},p.throwError)}function F(b){b.data=b.data||{};var c=b.data.attachments?angular.copy(b.data.attachments):[],d=a.where(c,{local:!0});return b.data.attachments=a.difference(c,d),g.postDocument({data:b}).then(function(a){return p.chain(function(b){angular.forEach(d,function(c){b.push(function(){return J("document",a.id,c)})})})},p.throwError)}function G(){return i.getExpenses({options:b.local}).then(function(a){return p.chain(function(b){angular.forEach(a,function(a){a.__dirty===!0&&b.push(function(){return i.postExpense({data:a})})})})},p.throwError)}function H(a){var c=void 0!==a?{template:"tasks/:id",schema:{id:a.id},options:b.local}:{options:b.local};return q.getTasks(c).then(function(b){return p.chain(function(c){angular.forEach(b,function(b){void 0===a?c.push(function(){return H(b)}):b.__dirty===!0&&c.push(function(){return I(b)})}),a&&a.__dirty===!0&&c.push(function(){return I(a)})})},p.throwError)}function I(b){b.data=b.data||{};var c=b.data.attachments?angular.copy(b.data.attachments):[],d=a.where(c,{local:!0});return b.data.attachments=a.difference(c,d),q.postTask({data:b}).then(function(a){return p.chain(function(b){angular.forEach(d,function(c){b.push(function(){return J("task",a.id,c)})})})},p.throwError)}function J(b,d,e){return l.read(e.src,!0).then(function(g){return c.post(f.getServer()+"api/"+b+"/"+d+"/attach",{archive:a.extend(a.omit(e,["src","local","key","sizes"]),{filename:g.file,content:g.content.substring(g.content.indexOf(",")+1)})},{withCredentials:!0})},p.throwError)}return{synchronize:function(a){a=a||b.models;var c=this;return c.upload(a).then(function(){return c.download(a)})},upload:function(a){return a=a||b.models,p.chain(function(b){-1!==a.indexOf("farmers")&&b.push(x),-1!==a.indexOf("documents")&&b.push(E),-1!==a.indexOf("tasks")&&b.push(H),-1!==a.indexOf("expenses")&&b.push(G)}).catch(p.throwError)},download:function(a){return a=a||b.models,p.chain(function(b){-1!==a.indexOf("farmers")&&b.push(r),-1!==a.indexOf("documents")&&b.push(s),-1!==a.indexOf("tasks")&&b.push(u),-1!==a.indexOf("budgets")&&b.push(v),-1!==a.indexOf("expenses")&&b.push(t),-1!==a.indexOf("organizational-units")&&b.push(w)}).catch(p.throwError)}}}]}]),mobileSdkApiApp.constant("apiConstants",{MissingParams:{code:"MissingParams",message:"Missing parameters for api call"}}),mobileSdkApiApp.factory("api",["apiConstants","dataStore","promiseService","underscore",function(a,b,c,d){return function(e){"String"==typeof e&&(e={singular:e,plural:e+"s"}),void 0===e.plural&&(e.plural=e.singular+"s");var f=b(e.singular,{apiTemplate:e.singular+"/:id",hydrate:e.hydrate,dehydrate:e.dehydrate}),g=function(a){return e.strip?d.omit(a,e.strip):a};return{getItems:function(a){return a=a?angular.copy(a):{},a.options=d.defaults(a.options||{},{one:!1}),f.transaction().then(function(b){return a.template?b.getItems({template:a.template,schema:a.schema,options:a.options,params:a.params}):a.search?(a.options.readLocal=!1,a.options.readRemote=!0,b.getItems({template:e.plural+"?search=:query",schema:{query:a.search},options:a.options,params:a.params})):b.getItems(a.id?{template:e.plural+"/:id",schema:{id:a.id},options:a.options,params:a.params}:{template:e.plural,options:a.options,params:a.params})})},createItem:function(b){return b=b?angular.copy(b):{},f.transaction().then(function(d){return b.data?d.createItems({template:b.template,schema:b.schema,data:b.data,options:b.options}):void c.throwError(a.MissingParams)})},getItem:function(b){return b=b?angular.copy(b):{},f.transaction().then(function(d){return b.id?d.getItems({template:b.template,schema:{id:b.id},options:b.options}):void c.throwError(a.MissingParams)})},findItem:function(b){return b=b?angular.copy(b):{},f.transaction().then(function(d){return b.key?d.findItems({key:b.key,column:b.column,options:b.options}):void c.throwError(a.MissingParams)})},updateItem:function(b){return b=b?angular.copy(b):{},f.transaction().then(function(d){return b.data?d.updateItems({data:g(b.data),options:b.options}):void c.throwError(a.MissingParams)})},postItem:function(b){return b=b?angular.copy(b):{},f.transaction().then(function(d){return b.data?d.postItems({template:b.template,schema:b.schema,data:g(b.data)}):void c.throwError(a.MissingParams)})},deleteItem:function(b){return b=b?angular.copy(b):{},f.transaction().then(function(d){return b.data?d.removeItems({template:e.singular+"/:id/delete",data:b.data}):void c.throwError(a.MissingParams)})},purgeItem:function(a){return a=a?angular.copy(a):{},f.transaction().then(function(b){return b.purgeItems({template:a.template,schema:a.schema,options:a.options})})}}}}]),mobileSdkApiApp.factory("userApi",["api",function(a){var b=a({plural:"users",singular:"user"});return{getUsers:b.getItems,createUser:b.createItem,getUser:b.getItem,findUser:b.findItem,updateUser:b.updateItem,postUser:b.postItem,deleteUser:b.deleteItem}}]),mobileSdkApiApp.factory("organizationalUnitApi",["api",function(a){var b=a({plural:"organizational-units",singular:"organizational-unit"});return{getOrganizationalUnits:b.getItems,createOrganizationalUnit:b.createItem,getOrganizationalUnit:b.getItem,findOrganizationalUnit:b.findItem,updateOrganizationalUnit:b.updateItem,postOrganizationalUnit:b.postItem,deleteOrganizationalUnit:b.deleteItem,purgeOrganizationalUnit:b.purgeItem}}]),mobileSdkApiApp.factory("notificationApi",["api",function(a){var b=a({plural:"notifications",singular:"notification"});return{getNotifications:b.getItems,getNotification:b.getItem,deleteNotification:b.deleteItem}}]),mobileSdkApiApp.provider("taskApi",["hydrationProvider",function(a){a.registerHydrate("subtasks",["taskApi",function(a){return function(b){return a.getTasks({template:"tasks/:id",schema:{id:b.__id}})}}]),a.registerDehydrate("subtasks",["taskApi","promiseService",function(a,b){return function(c){var d=void 0!==c.__id?c.__id:c.id;return a.purgeTask({template:"tasks/:id",schema:{id:d},options:{force:!1}}).then(function(){return b.arrayWrap(function(b){angular.forEach(c.subtasks,function(e){b.push(a.createTask({template:"tasks/:id",schema:{id:d},data:e,options:{replace:c.__complete,complete:c.__complete,dirty:!1}}))})})},b.throwError)}}]),this.$get=["api","hydration",function(a,b){var c=["document","organization","subtasks"],d=a({plural:"tasks",singular:"task",strip:c,hydrate:function(a,d){return d=d instanceof Array?d:d===!0?c:[],b.hydrate(a,"task",d)},dehydrate:function(a,d){return d=d instanceof Array?d:d===!1?[]:c,b.dehydrate(a,"task",d)}});return{getTasks:d.getItems,createTask:d.createItem,getTask:d.getItem,findTask:d.findItem,updateTask:d.updateItem,postTask:d.postItem,deleteTask:d.deleteItem,purgeTask:d.purgeItem}}]}]),mobileSdkApiApp.factory("merchantApi",["api",function(a){var b=a({plural:"merchants",singular:"merchant"});return{getMerchants:b.getItems,createMerchant:b.createItem,getMerchant:b.getItem,updateMerchant:b.updateItem,postMerchant:b.postItem,deleteMerchant:b.deleteItem}}]),mobileSdkApiApp.provider("farmerApi",["hydrationProvider",function(a){a.registerHydrate("organization",["farmerApi",function(a){return function(b){return a.findFarmer({key:b.organizationId,options:{one:!0}})}}]),a.registerDehydrate("organization",["farmerApi","promiseService",function(a,b){return function(c){return b.wrap(function(b){c.organization?(c.organization.id=c.organization.id||c.organizationId,a.createFarmer({template:"farmers",data:c.organization,options:{replace:c.__complete,complete:c.__complete,dirty:!1}}).then(b.resolve,b.reject)):b.resolve(c)})}}]),this.$get=["api","hydration",function(a,b){var c=["farms","legalEntities","primaryContact"],d=a({plural:"farmers",singular:"farmer",strip:["farms","legalEntities"],hydrate:function(a,d){return d=d instanceof Array?d:d===!0?c:[],b.hydrate(a,"farmer",d)},dehydrate:function(a,d){return d=d instanceof Array?d:d===!1?[]:c,b.dehydrate(a,"farmer",d)}});return{getFarmers:d.getItems,createFarmer:d.createItem,getFarmer:d.getItem,findFarmer:d.findItem,updateFarmer:d.updateItem,postFarmer:d.postItem,deleteFarmer:d.deleteItem,purgeFarmer:d.purgeItem}}]}]),mobileSdkApiApp.provider("legalEntityApi",["hydrationProvider",function(a){a.registerHydrate("legalEntity",["legalEntityApi",function(a){return function(b){return a.findEntity({key:b.legalEntityId,options:{one:!0,hydrate:!0}})}}]),a.registerHydrate("legalEntities",["legalEntityApi",function(a){return function(b){return a.getEntities({id:b.__id,options:{hydrate:!0}})}}]),a.registerHydrate("primaryContact",["legalEntityApi","underscore",function(a,b){return function(c){return a.getEntities({id:c.__id}).then(function(a){return b.findWhere(a,{isPrimary:!0})})}}]),a.registerDehydrate("legalEntities",["legalEntityApi","promiseService",function(a,b){return function(c){var d=void 0!==c.__id?c.__id:c.id;return a.purgeEntity({template:"legalentities/:id",schema:{id:d},options:{force:!1}}).then(function(){return b.arrayWrap(function(b){angular.forEach(c.legalEntities,function(e){b.push(a.createEntity({template:"legalentities/:id",schema:{id:d},data:e,options:{replace:c.__complete,complete:c.__complete,dirty:!1}}))})})},b.throwError)}}]),this.$get=["api","hydration",function(a,b){var c=["assets"],d=a({plural:"legalentities",singular:"legalentity",strip:c,hydrate:function(a,d){return d=d instanceof Array?d:d===!0?c:[],b.hydrate(a,"legalentity",d)},dehydrate:function(a,d){return d=d instanceof Array?d:d===!1?[]:c,b.dehydrate(a,"legalentity",d)}});return{getEntities:d.getItems,createEntity:d.createItem,getEntity:d.getItem,findEntity:d.findItem,updateEntity:d.updateItem,postEntity:d.postItem,deleteEntity:d.deleteItem,purgeEntity:d.purgeItem}}]}]),mobileSdkApiApp.provider("farmApi",["hydrationProvider",function(a){a.registerHydrate("farm",["farmApi",function(a){return function(b){return a.findFarm({key:b.farmId,options:{one:!0}})}}]),a.registerHydrate("farms",["farmApi",function(a){return function(b){return a.getFarms({id:b.__id})}}]),a.registerDehydrate("farms",["farmApi","promiseService",function(a,b){return function(c){var d=void 0!==c.__id?c.__id:c.id;return a.purgeFarm({template:"farms/:id",schema:{id:d},options:{force:!1}}).then(function(){return b.arrayWrap(function(b){angular.forEach(c.farms,function(e){b.push(a.createFarm({template:"farms/:id",schema:{id:d},data:e,options:{replace:c.__complete,complete:c.__complete,dirty:!1}}))})})},b.throwError)}}]),this.$get=["api","hydration",function(a){var b=a({plural:"farms",singular:"farm"});return{getFarms:b.getItems,createFarm:b.createItem,getFarm:b.getItem,findFarm:b.findItem,updateFarm:b.updateItem,postFarm:b.postItem,deleteFarm:b.deleteItem,purgeFarm:b.purgeItem}}]}]),mobileSdkApiApp.provider("assetApi",["hydrationProvider",function(a){a.registerHydrate("assets",["assetApi",function(a){return function(b){return a.getAssets({id:b.__id})}}]),a.registerDehydrate("assets",["assetApi","promiseService",function(a,b){return function(c){var d=void 0!==c.__id?c.__id:c.id;return a.purgeAsset({template:"assets/:id",schema:{id:d},options:{force:!1}}).then(function(){return b.arrayWrap(function(b){angular.forEach(c.assets,function(e){b.push(a.createAsset({template:"assets/:id",schema:{id:d},data:e,options:{replace:c.__complete,complete:c.__complete,dirty:!1}}))})})},b.throwError)}}]),this.$get=["api","hydration",function(a,b){var c=a({plural:"assets",singular:"asset",strip:["farm","legalEntity"],hydrate:function(a,c){return c=c instanceof Array?c:[],b.hydrate(a,"asset",c)},dehydrate:function(a,c){return c=c instanceof Array?c:[],b.dehydrate(a,"asset",c)}});return{getAssets:c.getItems,createAsset:c.createItem,getAsset:c.getItem,findAsset:c.findItem,updateAsset:c.updateItem,postAsset:c.postItem,deleteAsset:c.deleteItem,purgeAsset:c.purgeItem}}]}]),mobileSdkApiApp.provider("documentApi",["hydrationProvider",function(a){a.registerHydrate("document",["documentApi",function(a){return function(b){return a.findDocument({key:b.documentId,options:{one:!0}})}}]),a.registerDehydrate("document",["documentApi",function(a){return function(b){return a.createDocument({template:"documents",data:b.document,options:{replace:b.__complete,complete:b.__complete,dirty:!1}})}}]),this.$get=["api","hydration",function(a,b){var c=["organization"],d=a({plural:"documents",singular:"document",strip:["organization","tasks"],hydrate:function(a,d){return d=d instanceof Array?d:d===!0?c:[],b.hydrate(a,"document",d)},dehydrate:function(a,d){return d=d instanceof Array?d:d===!1?[]:c,b.dehydrate(a,"document",d)}});return{getDocuments:d.getItems,createDocument:d.createItem,getDocument:d.getItem,findDocument:d.findItem,updateDocument:d.updateItem,postDocument:d.postItem,deleteDocument:d.deleteItem,purgeDocument:d.purgeItem}}]}]),mobileSdkApiApp.factory("activityApi",["api",function(a){var b=a({plural:"activities",singular:"activity"});return{getActivities:b.getItems,createActivity:b.createItem,getActivity:b.getItem,deleteActivity:b.deleteItem}}]),mobileSdkApiApp.factory("enterpriseBudgetApi",["api",function(a){var b=a({plural:"budgets",singular:"budget"});return{getEnterpriseBudgets:b.getItems,createEnterpriseBudget:b.createItem,getEnterpriseBudget:b.getItem,findEnterpriseBudget:b.findItem,updateEnterpriseBudget:b.updateItem,postEnterpriseBudget:b.postItem,deleteEnterpriseBudget:b.deleteItem,purgeEnterpriseBudget:b.purgeItem}}]),mobileSdkApiApp.factory("expenseApi",["api","hydration","promiseService","underscore",function(a,b,c,d){var e=["document","organization"],f=a({plural:"expenses",singular:"expense",strip:["document","organization","user"],hydrate:function(a,c){return c=c instanceof Array?c:c===!0?e:[],b.hydrate(a,"expense",c)},dehydrate:function(a,b){return c.wrap(function(c){c.resolve(d.omit(a,b||e))})}});return{getExpenses:f.getItems,createExpense:f.createItem,getExpense:f.getItem,findExpense:f.findItem,updateExpense:f.updateItem,postExpense:f.postItem,purgeExpense:f.purgeItem}}]),mobileSdkApiApp.factory("pipGeoApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getFieldPolygon:function(c,e){return b.wrap(function(b){a.get(d+"api/geo/field-polygon?x="+c+"&y="+e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getPortionPolygon:function(c,e){return b.wrap(function(b){a.get(d+"api/geo/portion-polygon?x="+c+"&y="+e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getDistrictPolygon:function(c,e){return b.wrap(function(b){a.get(d+"api/geo/district-polygon?x="+c+"&y="+e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getProvincePolygon:function(c,e){return b.wrap(function(b){a.get(d+"api/geo/province-polygon?x="+c+"&y="+e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]);var mobileSdkDataApp=angular.module("ag.mobile-sdk.data",["ag.sdk.utilities","ag.sdk.config","ag.sdk.monitor","ag.sdk.library"]);mobileSdkDataApp.provider("dataPurge",function(){this.$get=["promiseService","dataStore",function(a,b){return function(c){return a.wrapAll(function(a){angular.forEach(c,function(c){a.push(b(c).transaction().then(function(a){return a.purgeItems()}))})})}}]}),mobileSdkDataApp.constant("dataStoreConstants",{NoStoreParams:{code:"NoStoreParams",message:"No DataStore parameters defined"},NoConfigDBNameParams:{code:"NoConfigDBNameParams",message:"No Config database name defined"},NoConfigAPIParams:{code:"NoConfigAPIParams",message:"No Config API parameters defined"},NoConfigPagingParams:{code:"NoConfigPagingParams",message:"No Config Paging parameters defined"},NoReadParams:{code:"NoReadParams",message:"No DataRead parameters defined"},NoPagingDefined:{code:"NoPagingDefined",message:"No Paging parameters have been defined in config"},LocalDataStoreError:{code:"LocalDataStoreError",message:"Can not perform action on local data store"},RemoteDataStoreError:{code:"RemoteDataStoreError",message:"Can not perform action on remote data store"},RemoteNoDataError:{code:"RemoteNoDataError",message:"No data response from remote store"}}),mobileSdkDataApp.factory("dataStoreUtilities",["$log","$timeout","dataStoreConstants","promiseService","underscore",function(a,b,c,d,e){function f(b){a.warn("string"==typeof b?"Error: "+b:void 0!==b.message?"Error: "+b.message+"("+b.code+")":b)}return{parseRequest:function(a,b){return void 0!==a&&angular.forEach(b,function(b,c){a=a.replace("/:"+c,void 0!==b?"/"+b:"")}),a},generateItemIndex:function(){return 2e9+Math.round(147483647*Math.random())},injectMetadata:function(a){return e.extend("object"==typeof a.data?a.data:JSON.parse(a.data),{__id:a.id,__uri:a.uri,__complete:1==a.complete,__dirty:1==a.dirty,__local:1==a.local,__saved:!0})},extractMetadata:function(a){return{id:a.__id,uri:a.__uri,complete:a.__complete,dirty:a.__dirty,local:a.__local,data:e.omit(a,["__id","__uri","__complete","__dirty","__local","__saved"])}},transactionPromise:function(e){var f=0,g=function(c){f++,e.transaction(function(a){c.resolve(a)},function(d){10>=f?(a.warn("Waiting for transaction"),a.warn(JSON.stringify(d)),b(function(){g(c)},250)):c.reject(d)})};return d.wrap(function(a){e?g(a):a.reject(c.LocalDataStoreError)})},executeSqlPromise:function(a,b,e){return e=e||[],d.wrap(function(d){a?a.executeSql(b,e,function(a,b){d.resolve(b)},function(a,b){f(b),d.reject(b)}):d.reject(c.LocalDataStoreError)})}}}]),mobileSdkDataApp.provider("dataStore",["dataStoreConstants","underscore",function(a,b){var c,d={pageLimit:10,dbName:void 0,readLocal:!0,readRemote:!0};this.config=function(a){d=b.defaults(a||{},d)},this.$get=["$http","$log","$rootScope","localStore","promiseService","safeApply","configuration","dataStoreUtilities",function(e,f,g,h,i,j,k,l){function m(a){f.error("_errorCallback"),f.error(a),f.error(JSON.stringify(a))}function n(){function a(c){f.debug("_processMigration");var d=h.getItem("dataStore-dbVersion","");if(f.debug("Current version: "+d),b.length>0){var e=b[0];b.splice(0,1),e.current===d?(f.debug("Database ("+d+") has a newer version "+e.next),l.transactionPromise(c).then(e.process).then(function(){f.debug("Database version migrated from "+e.current+" to "+e.next),h.setItem("dataStore-dbVersion",e.next),a(c)})):a(c)}}var b=[{current:"",next:"1",process:function(a){return l.executeSqlPromise(a,"SELECT name FROM sqlite_master WHERE type = ? ",["table"]).then(function(b){return i.wrapAll(function(c){for(var d=0;d<b.rows.length;d++){var e=b.rows.item(d);-1===e.name.indexOf("__")&&c.push(l.executeSqlPromise(a,"ALTER TABLE "+e.name+" ADD COLUMN complete INT DEFAULT 1"))}})})}}];c=window.openDatabase(d.dbName,"",d.dbName,4194304),a(c)}function o(g,h){function j(){return l.transactionPromise(c).then(function(a){return i.all([l.executeSqlPromise(a,"CREATE TABLE IF NOT EXISTS "+g+" (id INT UNIQUE, uri TEXT, complete INT DEFAULT 0, dirty INT DEFAULT 0, local INT DEFAULT 0, data TEXT, updated TIMESTAMP DEFAULT current_timestamp)",[]),l.executeSqlPromise(a,"CREATE TRIGGER IF NOT EXISTS "+g+"_timestamp AFTER UPDATE ON "+g+" BEGIN UPDATE "+g+"  SET updated = datetime('now') WHERE id = old.id AND uri = old.uri; END",[])])},i.throwError)}function k(){return l.transactionPromise(c).then(function(a){return l.executeSqlPromise(a,"DELETE FROM "+g,[])},i.throwError)}function n(a,b){return void 0===a[s.indexerProperty]&&f.warn("Configured indexer property not defined"),a[s.indexerProperty]||a.id||b}function r(){return this instanceof r?{createItems:function(a){var c=b.defaults(a||{},{template:s.apiTemplate,schema:{},data:[],options:{}});return c.options=b.defaults(c.options,{replace:!0,force:!1,complete:!0,dirty:!0}),i.wrapAll(function(a){c.data instanceof Array==!1&&(c.data=[c.data]),angular.forEach(c.data,function(d){var e=n(d,l.generateItemIndex());
a.push(s.dehydrate(l.injectMetadata({id:e,uri:l.parseRequest(c.template,b.defaults(c.schema,{id:e})),data:d,complete:c.options.complete,dirty:c.options.dirty,local:c.options.dirty}),c.options.dehydrate))})},i.throwError).then(function(a){return w(b.compact(a),c)},i.throwError).then(function(a){return F(a,!0)},i.throwError)},getItems:function(c){var d=b.defaults(c||{},{template:s.apiTemplate,schema:{},options:{}});return d.options=b.defaults(d.options,{fallbackRemote:!1,one:void 0!==d.options.one?d.options.one:void 0!==d.schema.id,passThrough:!1,readLocal:s.readLocal,readRemote:s.readRemote}),i.wrap(function(c){var e=function(a){z(a,d).then(function(e){d.options.passThrough===!0?c.resolve(F(b.map(e,function(a){var c=n(a,l.generateItemIndex());return l.injectMetadata({id:c,uri:l.parseRequest(d.template,b.defaults(d.schema,{id:c})),data:a,complete:d.options.one||void 0===d.params||"simple"!==d.params.resulttype,dirty:!1,local:!1})}),d.options.one)):void 0===d.params&&d.options.readLocal===!0?v(e,a,d).then(function(a){c.resolve(F(a,d.options.one))},c.reject):w(e,d).then(function(a){c.resolve(F(a,d.options.one))},c.reject)},function(b){d.options.readLocal===!0?t(a,d).then(function(a){c.resolve(F(a,d.options.one))},c.reject):(m(b),c.reject(b))})};if("object"==typeof d.schema){var f=l.parseRequest(d.template,d.schema);d.options.readRemote===!0?e(f):t(f,d).then(function(a){0==a.length&&d.options.fallbackRemote===!0?e(f):G(a,d,d.options.one).then(c.resolve,c.reject)},function(a){m(a),c.reject(a)})}else c.reject(a.NoReadParams)})},findItems:function(a){var c=b.defaults(a||{},{key:"",column:"id",options:{}});return c.options=b.defaults(c.options,{fallbackRemote:!0,like:!1,one:!1}),u(c.key,c.column,c.options).then(function(a){return G(a,c,!0)},i.throwError)},updateItems:function(a){var c=b.defaults(a||{},{data:[],options:{}});return c.options=b.defaults(c.options,{dirty:!0}),c.data instanceof Array==!1&&(c.data=[c.data]),w(c.data,c).then(function(a){return F(a,!0)},i.throwError)},postItems:function(a){var c=b.defaults(a||{},{template:s.apiTemplate,schema:{},data:[]});return c.data instanceof Array==!1&&(c.data=[c.data]),A(c.data,c).then(function(a){return F(a,!0)},i.throwError)},removeItems:function(a){var c=b.defaults(a||{},{template:void 0,schema:{},data:[]});return c.data instanceof Array==!1&&(c.data=[c.data]),i.wrapAll(function(a){angular.forEach(c.data,function(b){a.push(b.__local===!0?x(b):B(b,c.template,c.schema))})}).then(function(a){return F(a,!0)},i.throwError)},purgeItems:function(a){var c=b.defaults(a||{},{template:void 0,schema:{},options:{},callback:angular.noop});return c.options=b.defaults(c.options,{force:!0}),i.wrap(function(a){if(void 0!==c.template){var d=l.parseRequest(c.template,c.schema);t(d,c).then(function(a){var d=b.filter(a,function(a){return 0==a.__dirty||1==c.options.force});return x(d)},i.throwError).then(a.resolve,a.reject)}else k().then(a.resolve,a.reject)})}}:new r}if(!(this instanceof o))return new o(g,h);if("string"!=typeof g)throw new Error(a.NoStoreParams.msg);if(void 0===d.dbName)throw new Error(a.NoConfigDBNameParams.msg);g=g.replace("-","");var s=b.defaults(h||{},{apiTemplate:void 0,paging:void 0,indexerProperty:"id",readLocal:d.readLocal,readRemote:d.readRemote,hydrate:q,dehydrate:q});void 0!==s.paging&&(s.paging=b.defaults(s.paging,{template:"",schema:{},data:{page:1,limit:d.pageLimit}}));var t=function(a,b){return f.debug("_getLocal"),b.options=b.options||{},l.transactionPromise(c).then(function(b){return l.executeSqlPromise(b,"SELECT * FROM "+g+" WHERE uri = ?",[a])},i.throwError).then(function(a){return i.wrapAll(function(c){for(var d=0;d<a.rows.length;d++)c.push(s.hydrate(l.injectMetadata(a.rows.item(d)),b.options.hydrate))})},i.throwError)},u=function(a,b,d){return f.debug("_findLocal"),l.transactionPromise(c).then(function(c){return l.executeSqlPromise(c,"SELECT * FROM "+g+" WHERE "+b+" "+(d.like?"LIKE":"=")+" ?",[d.like?"%"+a+"%":a])},i.throwError).then(function(a){return i.wrapAll(function(b){for(var c=0;c<a.rows.length;c++)b.push(s.hydrate(l.injectMetadata(a.rows.item(c)),d.hydrate))})},i.throwError)},v=function(a,b,c){return f.debug("_syncLocal"),y(b).then(function(){return w(a,{})},i.throwError).then(function(){return t(b,c)},i.throwError)},w=function(a,d){return f.debug("_updateLocal"),a instanceof Array==!1&&(a=[a]),d.options=b.defaults(d.options||{},{replace:!0,force:!1}),i.wrapAll(function(b){angular.forEach(a,function(a){b.push(s.dehydrate(a,d.options.dehydrate))})}).then(function(a){return l.transactionPromise(c).then(function(b){return i.wrapAll(function(c){angular.forEach(a,function(a){var e=l.extractMetadata(a),f=JSON.stringify(e.data),h=function(){return a};e.dirty=d.options.dirty===!0?!0:e.dirty,c.push(l.executeSqlPromise(b,"INSERT INTO "+g+" (id, uri, data, complete, dirty, local) VALUES (?, ?, ?, ?, ?, ?)",[e.id,e.uri,f,e.complete?1:0,e.dirty?1:0,e.local?1:0]).then(h,function(){return d.options.replace===!0?e.dirty===!0||e.local===!0||d.options.force?l.executeSqlPromise(b,"UPDATE "+g+" SET uri = ?, data = ?, complete = ?, dirty = ?, local = ? WHERE id = ?",[e.uri,f,e.complete?1:0,e.dirty?1:0,e.local?1:0,e.id]).then(h):l.executeSqlPromise(b,"UPDATE "+g+" SET uri = ?, data = ?, complete = ?, dirty = ?, local = ? WHERE id = ? AND dirty = 0 AND local = 0",[e.uri,f,e.complete?1:0,e.dirty?1:0,e.local?1:0,e.id]).then(h):null}))})})})},i.throwError).then(function(a){return i.wrapAll(function(c){angular.forEach(b.compact(a),function(a){c.push(s.dehydrate(a,d.options.dehydrate))})})},i.throwError)},x=function(a){return f.debug("_deleteLocal"),a instanceof Array==!1&&(a=[a]),l.transactionPromise(c).then(function(b){return i.wrapAll(function(c){angular.forEach(a,function(a){var d=l.extractMetadata(a);c.push(l.executeSqlPromise(b,"DELETE FROM "+g+" WHERE id = ? AND uri = ?",[d.id,d.uri]))})})},i.throwError).then(function(){return a},i.throwError)},y=function(a,d){return f.debug("_deleteAllLocal"),d=b.defaults(d||{},{force:!1}),l.transactionPromise(c).then(function(b){return d.force===!0?(f.debug("_deleteAllLocal force"),l.executeSqlPromise(b,"DELETE FROM "+g+" WHERE uri = ?",[a])):(f.debug("_deleteAllLocal not force"),l.executeSqlPromise(b,"DELETE FROM "+g+" WHERE uri = ? AND local = ? AND dirty = ?",[a,0,0]))})},z=function(b,c){return f.debug("_getRemote"),c.options=c.options||{},i.wrap(function(d){void 0!==s.apiTemplate?e.get(p+b,{params:c.params,withCredentials:!0}).then(function(a){return a&&a.data?a.data instanceof Array?a.data:[a.data]:[]},i.throwError).then(function(a){return i.wrapAll(function(d){angular.forEach(a,function(a){d.push(s.dehydrate(l.injectMetadata({id:n(a),uri:c.options.forceUri||b,data:a,complete:c.options.one||void 0===c.params||"simple"!==c.params.resulttype,dirty:!1,local:!1}),!0))})})},i.throwError).then(d.resolve,d.reject):d.reject(a.RemoteDataStoreError)})},A=function(c,d){return f.debug("_updateRemote"),i.wrap(function(f){void 0!==c&&void 0!==s.apiTemplate?(c instanceof Array==!1&&(c=[c]),i.wrapAll(function(a){angular.forEach(c,function(c){var f=l.extractMetadata(c),g=f.uri;f.dirty===!0&&((f.local||void 0!==d.template)&&(f.local&&void 0!==f.data[s.indexerProperty]&&delete f.data[s.indexerProperty],g=l.parseRequest(d.template||s.apiTemplate,b.extend(d.schema,{id:f.local?void 0:f.id}))),a.push(e.post(p+g,f.data,{withCredentials:!0}).then(function(a){var b=l.injectMetadata({id:n(a.data,f.id),uri:f.uri,data:a.data,complete:!0,dirty:!1,local:!1});return 1==f.local?(b.id=b.__id,x(c).then(function(){return b})):b},i.throwError)))})},i.throwError).then(function(a){return d.options=b.defaults({force:!0},d.options),w(b.compact(a),d)},i.throwError).then(f.resolve,f.reject)):f.reject(a.RemoteDataStoreError)})},B=function(c,d,g){return f.debug("_deleteRemote"),i.wrap(function(f){void 0!==c&&void 0!==d?(c instanceof Array==!1&&(c=[c]),i.wrapAll(function(a){angular.forEach(c,function(c){if(c.local===!1){var f=l.extractMetadata(c),h=l.parseRequest(d,b.defaults(g,{id:f.id}));a.push(e.post(p+h,{withCredentials:!0}).then(function(){return x(f)},i.throwError))}})}).then(f.resolve,f.reject)):f.reject(a.RemoteDataStoreError)})},C=!1,D=[],E=function(){if(C&&void 0!==c)for(;D.length>0;){var a=D.shift();a.resolve(new r)}},F=function(a,b){return b===!0&&a instanceof Array&&a.length>0?a[0]:a},G=function(a,c,d){return c.options.one=!0,c.schema=c.schema||{},i.chain(function(d){angular.forEach(a,function(a){d.push(function(){if(a.__complete===!1&&c.options.fallbackRemote){var d=l.parseRequest(s.apiTemplate,b.defaults({id:a.__id},c.schema));return c.options.forceUri=a.__uri,z(d,c).then(function(a){return w(a,c)})}return a})})}).then(function(a){return F(a,d)})};return j().then(function(){f.debug("table initialized"),C=!0,E()}),{defaults:d,config:s,transaction:function(){var a=i.defer();return D.push(a),E(),a.promise}}}var p=k.getServer()+"api/",q=function(a){return i.wrap(function(b){b.resolve(a)})};return n(),function(a,b){return new o(a,b)}}]}]);var mobileSdkHydrationApp=angular.module("ag.mobile-sdk.hydration",["ag.sdk.utilities","ag.sdk.library"]);mobileSdkHydrationApp.provider("hydration",[function(){var a={};this.registerHydrate=function(b,c){a[b]=a[b]||{},a[b].hydrate=c},this.registerDehydrate=function(b,c){a[b]=a[b]||{},a[b].dehydrate=c},this.$get=["$injector","promiseService","underscore",function(b,c,d){return{hydrate:function(e,f,g){return g=g||[],c.objectWrap(function(c){angular.forEach(g,function(d){var g=a[d];g&&g.hydrate&&(g.hydrate instanceof Array&&(a[d].hydrate=b.invoke(g.hydrate)),c[d]=g.hydrate(e,f))})}).then(function(a){return d.extend(e,a)},function(a){return d.extend(e,a)})},dehydrate:function(e,f,g){return g=g||[],c.objectWrap(function(c){angular.forEach(g,function(d){var g=a[d];e[d]&&g&&g.dehydrate&&(g.dehydrate instanceof Array&&(a[d].dehydrate=b.invoke(g.dehydrate)),c[d]=g.dehydrate(e,f))})}).then(function(){return d.omit(e,g)},function(){return d.omit(e,g)})}}}]}]),angular.module("ag.sdk.helper",["ag.sdk.helper.asset","ag.sdk.helper.attachment","ag.sdk.helper.crop-inspection","ag.sdk.helper.document","ag.sdk.helper.enterprise-budget","ag.sdk.helper.expense","ag.sdk.helper.farmer","ag.sdk.helper.favourites","ag.sdk.helper.merchant","ag.sdk.helper.region","ag.sdk.helper.task","ag.sdk.helper.team","ag.sdk.helper.user"]),angular.module("ag.sdk.interface",["ag.sdk.interface.input","ag.sdk.interface.list","ag.sdk.interface.map","ag.sdk.interface.navigation"]),angular.module("ag.sdk.test",["ag.sdk.test.data"]),angular.module("ag.mobile-sdk",["ag.sdk.authorization","ag.sdk.id","ag.sdk.utilities","ag.sdk.monitor","ag.sdk.interface.map","ag.sdk.helper","ag.sdk.library","ag.sdk.test","ag.mobile-sdk.helper","ag.mobile-sdk.api","ag.mobile-sdk.data","ag.mobile-sdk.hydration"]);