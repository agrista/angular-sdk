var sdkAuthorizationApp=angular.module("ag.sdk.authorization",["ag.sdk.config","ag.sdk.utilities"]);sdkAuthorizationApp.factory("authorizationApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{login:function(c,e){return b.wrap(function(b){a.post(d+"login",{email:c,password:e}).then(function(a){b.resolve(a.data)},b.reject)})},resetPassword:function(c,e){return b.wrap(function(b){a.post(d+"api/password-reset",{hash:c,password:e}).then(function(a){b.resolve(a.data)},b.reject)})},requestResetPasswordEmail:function(c){return b.wrap(function(b){a.post(d+"api/password-reset-email",{email:c}).then(function(a){b.resolve(a.data)},b.reject)})},changePassword:function(c,e,f){return b.wrap(function(b){a.post(d+"api/user/password",{password:e,newPassword:f}).then(function(a){b.resolve(a.data)},b.reject)})},getUser:function(){return b.wrap(function(b){a.get(d+"current-user",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},registerUser:function(c){return b.wrap(function(b){a.post(d+"api/register",c).then(function(a){b.resolve(a.data)},b.reject)})},logout:function(){return a.post(d+"logout")}}}]),sdkAuthorizationApp.provider("authorization",["$httpProvider",function(a){var b={open:1,user:2,admin:4},c={open:b.open|b.user|b.admin,user:b.user|b.admin,admin:b.admin},d={email:"",role:b.open},e=void 0;return a.interceptors.push(["$q","$injector","$rootScope",function(a,b,c){return{responseError:function(b){return 401===b.status&&c.$broadcast("authorization::unauthorized"),a.reject(b)}}}]),{userRole:b,accessLevel:c,$get:["$rootScope","authorizationApi","localStore","promiseService",function(a,f,g,h){function i(){return g.getItem("user")||d}function j(a){return a=a||d,void 0===a.role&&(a.role="admin"==a.accessLevel?b.admin:b.user),g.setItem("user",a),a}var k=i();return f.getUser().then(function(b){null!==b.user?(k=j(b.user),a.$broadcast("authorization::login",k)):k.isActive!==!0&&a.$broadcast("authorization::unauthorized")}),{userRole:b,accessLevel:c,lastError:function(){return e},currentUser:function(){return k},isAllowed:function(a){return 0!=(a&k.role)},isLoggedIn:function(){return 0!=(c.user&k.role)},login:function(b,c){return h.wrap(function(g){f.login(b,c).then(function(b){null!==b.user?(e=void 0,k=j(b.user),g.resolve(k),a.$broadcast("authorization::login",k)):(e={type:"error",message:"The entered e-mail and/or password is incorrect. Please try again."},k=j(d),g.reject())},function(a){k=j(d),g.reject(a)})})},requestResetPasswordEmail:f.requestResetPasswordEmail,resetPassword:f.resetPassword,changePassword:function(a,b){return f.changePassword(k.id,a,b)},changeUserDetails:function(a){return f.updateUser(k.id,a).then(function(){k=j(a)})},register:function(b){return h.wrap(function(c){f.registerUser(b).then(function(b){null!==b?(e=void 0,k=j(b),c.resolve(k),a.$broadcast("authorization::login",k)):(k=j(d),c.reject())},function(a){e={type:"error",message:"There is already an Agrista account associated with this email address. Please login."},k=j(d),c.reject(a)})})},logout:function(){return a.$broadcast("authorization::logout"),f.logout().then(function(){k=j(d)})}}}]}}]);var sdkConfigApp=angular.module("ag.sdk.config",[]);sdkConfigApp.provider("configuration",["$httpProvider",function(a){var b="",c="local",d={local:"/",alpha:"http://staging.farmer.agrista.net/",beta:"http://farmer.agrista.net/"};return{setServers:function(a){angular.forEach(a,function(a,b){a.lastIndexOf("/")!==a.length-1&&(a+="/"),d[b]=a}),this.useHost(c,b)},useHost:function(e,f,g){"function"==typeof f&&(g=f,f=""),b=f||"",void 0!==d[e]&&(c=e,a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]),"function"==typeof g&&g(d[c])},$get:function(){return{getVersion:function(){return b},getHost:function(){return c},getServer:function(){return d[c]}}}}}]);var sdkIdApp=angular.module("ag.sdk.id",["ag.sdk.utilities"]);sdkIdApp.factory("objectId",["localStore",function(a){var b=function(){function c(){return this instanceof b?void("object"==typeof arguments[0]?(this.timestamp=arguments[0].timestamp,this.machine=arguments[0].machine,this.pid=arguments[0].pid,this.increment=arguments[0].increment):"string"==typeof arguments[0]&&24==arguments[0].length?(this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))):4==arguments.length&&null!=arguments[0]?(this.timestamp=arguments[0],this.machine=arguments[1],this.pid=arguments[2],this.increment=arguments[3]):(this.timestamp=Math.floor((new Date).valueOf()/1e3),this.machine=f,this.pid=e,this.increment=d++,d>16777215&&(d=0))):new b(arguments[0],arguments[1],arguments[2],arguments[3]).toString()}var d=0,e=Math.floor(32767*Math.random()),f=Math.floor(16777216*Math.random()),g=parseInt(a.getItem("mongoMachineId"));return g>=0&&16777215>=g&&(f=Math.floor(a.getItem("mongoMachineId"))),a.setItem("mongoMachineId",f),c}();return b.prototype.getDate=function(){return new Date(1e3*this.timestamp)},b.prototype.toArray=function(){var a,b=this.toString(),c=[];for(a=0;12>a;a++)c[a]=parseInt(b.slice(2*a,2*a+2),16);return c},b.prototype.toString=function(){var a=this.timestamp.toString(16),b=this.machine.toString(16),c=this.pid.toString(16),d=this.increment.toString(16);return"00000000".substr(0,8-a.length)+a+"000000".substr(0,6-b.length)+b+"0000".substr(0,4-c.length)+c+"000000".substr(0,6-d.length)+d},b.prototype.toBase64String=function(){return window.btoa(this.toString())},function(){return new b}}]),sdkIdApp.factory("generateUUID",function(){function a(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:7&c|8).toString(16)});return b}return function(){return a()}});var sdkMonitorApp=angular.module("ag.sdk.monitor",["ag.sdk.utilities"]);sdkMonitorApp.factory("queueService",["$log","$q","promiseService",function(a,b,c){function d(b,e){if(!(this instanceof d))return new d(b,e);"function"==typeof b&&(e=b,b={limit:1}),"object"!=typeof b&&(b={limit:1}),"function"!=typeof e&&(e=angular.noop);var f=[],g=b.limit||1,h={total:0,complete:0},i=function(){g++,h.complete<h.total&&h.complete++,m()},j=i,k=function(){e({type:"error"}),i()},l=function(a,b){h.total++,f.push([a,b]),m()},m=function(){if(e({type:"progress",percent:100/h.total*h.complete}),a.log("QUEUE TOTAL: "+h.total+" COMPLETE: "+h.complete+" PERCENT: "+100/h.total*h.complete),0===f.length&&h.total===h.complete&&(h.total=0,h.complete=0,e({type:"complete"})),!(0>=g||0===f.length)){g--;var b=f.shift(),c=b[0],d=b[1];d.promise.then(j,k),c(d)}},n=function(){h.total=0,h.complete=0,f.length=0},o=function(a){var b=c.defer();return l(a,b),b.promise};return{wrapPush:o,push:l,pop:m,clear:n}}return function(a,b){return new d(a,b)}}]),sdkMonitorApp.factory("promiseMonitor",["$log","safeApply",function(a,b){function c(d){if(!(this instanceof c))return new c(d);var e={total:0,complete:0,resolved:0,rejected:0,percent:0},f=function(){e.complete++,e.percent=100/e.total*e.complete,a.log("MONITOR TOTAL: "+e.total+" COMPLETE: "+e.complete+" PERCENT: "+e.percent),b(function(){d(e.complete==e.total?{type:"complete",percent:e.percent,stats:e}:{type:"progress",percent:e.percent,stats:e})})};return{stats:function(){return e},clear:function(){e={total:0,complete:0,resolved:0,rejected:0,percent:0}},add:function(a){return e.total++,a.then(function(){e.resolved++,f()},function(a){e.rejected++,b(function(){d({type:"error"},a)}),f()}),a}}}return function(a){return new c(a)}}]);var skdUtilitiesApp=angular.module("ag.sdk.utilities",["ngCookies"]);skdUtilitiesApp.run(["stateResolver",function(){}]),skdUtilitiesApp.provider("stateResolver",function(){var a={};this.when=function(b,c){return b instanceof Array?angular.forEach(b,function(b){a[b]=c}):a[b]=c,this},this.resolver=function(){return{data:["stateResolver",function(a){return a.getData()}]}},this.$get=["$rootScope","$state","$injector",function(b,c,d){var e=void 0;return b.$on("$stateChangeStart",function(a,b){e=b}),{getData:function(){return e&&a[e.name]?d.invoke(a[e.name]):void 0}}}]}),skdUtilitiesApp.factory("safeApply",["$rootScope",function(a){return function(b){a.$$phase?b():a.$apply(b)}}]),skdUtilitiesApp.factory("dataMapService",[function(){return function(a,b,c){var d=[];a instanceof Array==!1&&(a=void 0!==a?[a]:[]);for(var e=0;e<a.length;e++){var f,g=a[e];if("function"==typeof b)f=b(g);else{f={};for(var h in b)b.hasOwnProperty(h)&&(f[h]=g[b[h]])}f instanceof Array?d=d.concat(f):"object"==typeof f?(c!==!0&&(f.id=f.id||g.id),d.push(f)):void 0!==f&&d.push(f)}return d}}]),skdUtilitiesApp.factory("pagingService",["$rootScope","$http","promiseService","dataMapService",function(a,b,c,d){return{initialize:function(b,e,f){f=f||function(b){a.$broadcast("paging::items",b)};var g={page:{limit:50},busy:!1,complete:!1,disabled:function(){return g.busy||g.complete},request:function(){return c.wrap(function(a){g.busy=!0,b(g.page).then(function(b){g.page=b.paging,g.complete=void 0===g.page,g.busy=!1,void 0!==g.page&&(b=b.data),e&&(b=d(b,e)),f(b),a.resolve(b)},a.reject)})}};return g},page:function(a,d){return c.wrap(function(c){var e=function(a){c.resolve(a.data)};void 0!==d?"string"==typeof d?b.get(d,{withCredentials:!0}).then(e,c.reject):b.get(a,{params:d,withCredentials:!0}).then(e,c.reject):b.get(a,{withCredentials:!0}).then(e,c.reject)})}}}]),skdUtilitiesApp.factory("promiseService",["$q","safeApply",function(a,b){var c=function(){var c=a.defer();return{resolve:function(a){b(function(){c.resolve(a)})},reject:function(a){b(function(){c.reject(a)})},promise:c.promise}},d=function(b,c){var d=c;return b(d),a.all(d)};return{all:function(b){return a.all(b)},wrap:function(a){var b=c();return a(b),b.promise},wrapAll:function(a){return d(a,[])},arrayWrap:function(a){return d(a,[])},objectWrap:function(a){return d(a,{})},defer:c}}]),skdUtilitiesApp.factory("localStore",["$cookieStore","$window",function(a,b){return{setItem:function(c,d){b.localStorage?b.localStorage.setItem(c,JSON.stringify(d)):a.put(c,d)},getItem:function(c){return b.localStorage?JSON.parse(b.localStorage.getItem(c)):a.get(c)},removeItem:function(c){b.localStorage?b.localStorage.removeItem(c):a.remove(c)}}}]);var sdkHelperAssetApp=angular.module("ag.sdk.helper.asset",["ag.sdk.helper.farmer"]);sdkHelperAssetApp.factory("assetHelper",["$filter","landUseHelper",function(a,b){var c=function(b,c){var d={type:b.type,updatedAt:b.updatedAt};if(b.data&&("crop"==b.type?(d.title=(b.data.plantedArea?b.data.plantedArea.toFixed(2)+"Ha of ":"")+(b.data.crop?b.data.crop:"")+(b.data.fieldName?" on field "+b.data.fieldName:""),d.subtitle=b.data.season?b.data.season:"",d.groupby=b.farmId):"farmland"==b.type?(d.title=0==b.data.portionNumber?"Remainder of farm":"Portion "+b.data.portionNumber,d.subtitle="Area: "+b.data.area.toFixed(2)+"Ha",d.groupby=b.farmId):"improvement"==b.type?(d.title=b.data.name,d.subtitle=b.data.type+" - "+b.data.category,d.summary=b.data.description||"",d.groupby=b.farmId):"irrigated cropland"==b.type?(d.title=b.data.irrigation+(b.data.fieldName?" on field "+b.data.fieldName:""),d.subtitle="Equipped Area: "+b.data.size.toFixed(2)+"Ha",d.groupby=b.farmId):"livestock"==b.type?(d.title=b.data.type+" - "+b.data.category,d.subtitle=(b.data.breed?b.data.breed+" for ":"For ")+b.data.purpose,d.summary=b.data.description||"",d.groupby=b.data.type):"pasture"==b.type?(d.title=(b.data.crop?b.data.crop:"Natural")+(b.data.fieldName?" on field "+b.data.fieldName:""),d.subtitle=b.data.plantedDate?"Planted: "+a("date")(b.data.plantedDate,"dd/MM/yy"):"",d.groupby=b.farmId):"permanent crop"==b.type?(d.title=b.data.crop+(b.data.fieldName?" on field "+b.data.fieldName:""),d.subtitle=b.data.establishedDate?"Established: "+a("date")(b.data.establishedDate,"dd/MM/yy"):"",d.groupby=b.farmId):"plantation"==b.type?(d.title=b.data.crop+(b.data.fieldName?" on field "+b.data.fieldName:""),d.subtitle=b.data.establishedDate?"Established: "+a("date")(b.data.establishedDate,"dd/MM/yy"):"",d.groupby=b.farmId):"vme"==b.type?(d.title=b.data.category+(b.data.model?" model "+b.data.model:""),d.subtitle="Quantity: "+b.data.quantity,d.summary=b.data.description||"",d.groupby=b.data.type):"water right"==b.type&&(d.title=b.data.waterSource+(b.data.fieldName?" on field "+b.data.fieldName:""),d.subtitle="Irrigatable Extent: "+b.data.size.toFixed(2)+"Ha",d.groupby=b.farmId),b.data.attachments))for(var e=["png","jpg","jpeg","gif"],f=0;f<b.data.attachments.length;f++)for(var g=b.data.attachments[f],h=0;h<e.length;h++)-1!=g.key.indexOf(e[h])&&(d.image=g.src);return c&&(d=_.extend(d,c)),d},d={crop:"Crops",farmland:"Farmlands",improvement:"Fixed Improvements","irrigated cropland":"Irrigated Cropland",livestock:"Livestock",pasture:"Pastures","permanent crop":"Permanent Crops",plantation:"Plantations",vme:"Vehicles, Machinery & Equipment","water right":"Water Rights"},e={improvement:["Livestock & Game","Crop Cultivation & Processing","Residential","Business","Equipment & Utilities","Infrastructure","Recreational & Misc."],livestock:["Cattle","Sheep","Pigs","Chickens","Ostriches","Goats"],vme:["Vehicles","Machinery","Equipment"]},f={improvement:{"Livestock & Game":["Abattoir","Animal Cages","Animal Camp","Animal Feedlot","Animal Growing House","Animal Handling Equiment","Animal Handling Facility","Animal Pens","Animal Sale Facility","Animal Shelter","Animal Stable","Anti-Poaching Training Facility","Arena","Auction Facilities","Aviary","Barn","Beekeeping Room","Bottling Facility","Breeding Facility","Broiler House","Broiler House - Atmosphere","Broiler House - Semi","Broiler Unit","Cheese Factory","Chicken Coop","Chicken Run","Cooling Facility","Crocodile Dams","Dairy","Deboning Room","Dry Oven","Dry Storage","Drying Facility","Drying Ovens","Drying Racks","Drying Strips","Drying Tunnels","Egg Grading Facility","Egg Packaging Building","Elephant Enclosures","Embryo Room","Feed Dispensers","Feed Mill","Feed Storeroom","Feeding Lot","Feeding Pens","Feeding Shelter","Feeding Troughs","Filter Station","Fish Market Buildings","Flavour Shed","Game Cage Facility","Game Lodge","Game Pens","Game Room","Game Slaughter Area","Game Viewing Area","Grading Room","Handling Facilities","Hatchery","Hide Store","Hing Pen","Horse Walker","Hunters","Hide Storeroom","Inspection Room","Kennels","Kraal","Laying Hen House","Maternity House","Maternity Pens","Meat Processing Facility","Milk Bottling Plant","Milk Tank Room","Milking Parlour","Other","Packaging Complex","Packaging Facility","Paddocks","Pasteurising Facility","Pens","Pig Sty","Poison Store","Post-Feeding Shed","Processing Facility","Quarantine Area","Racing Track","Rankin Game","Refrigeration Facility","Rehab Facility","Saddle Room","Sales Facility","Selling Kraal","Shearing Facility","Shed","Shelter","Shooting Range","Skinning Facility","Slaughter Facility","Sorting Facility","Stable","Stall","Stock Handling Facility","Storage Facility","Sty","Surgery","Treatment Area","Trout Dam","Warehouse"],"Crop Cultivation & Processing":["Crop Cultivation & Processing","Barrel Maturation Room","Bottling Facility","Carton Shed","Cellar","Chemical Shed","Compost Pasteurising Unit","Compost Preparing Unit","Cooling Facility","Crushing Plant","Dark Room","Degreening Room","Dehusking Shed","Dry Oven","Dry Sow House","Dry Storage","Drying Facility","Drying Ovens","Drying Racks","Drying Strips","Drying Tunnels","Farrowing House","Fertilizer Shed","Flavour Shed","Food Plant Shed","Fruit Dry Tracks","Fruit Hopper","Gardening Facility","Germination Facility","Grading Room","Grain Handling Equipment","Grain Loading Facility","Grain Mill","Grain Silos","Grain Store","Greenhouse","Grower Unit","Handling Facilities","Hopper","Hothouse","Igloo","Inspection Room","Irrigation Dam","Irrigation Pump","Irrigation Reservoir","Irrigation System","Mill","Milling Store","Mushroom Cultivation Building","Mushroom Sweat Room","Nursery (Plant)","Nut Cracking Facility","Nut Factory","Oil Store","Onion Drying Shed","Other","Packaging Complex","Packaging Facility","Pesticide Store","Poison Store","Processing Facility","Refrigeration Facility","Sales Facility","Seed Store","Seedling Growing Facility","Seedling Packaging Facility","Shed","Silo","Sorting Facility","Sprinklers","Storage Facility","Tea Drying Facility","Tea Room","Tobacco Dryers","Warehouse","Wine Cellar","Wine Storage Shed","Wine Tanks","Winery Building"],Residential:["Ablution Facility","Accommodation Units","Attic","Balcony","Bathroom","Bedroom","Building","Bungalow","Bunk House","Cabin","Camp Accommodation","Canteen","Caretaker's Dwelling","Chalet","Cloak Room","Community Dwelling","Cottage","Dining Area","Dining Facility","Dormitory","Dressing Rooms","Drivers' Accommodation","Dwelling","Estate House","Flat","Foreman's Dwelling","Game Lodge","Guest Accommodation","Homestead","Hostels","House","Hunters' Accommodation","Hunters' Kitchen","Hut","Kitchen","Lapa","Lean-to","Lodge","Loft","Log Cabin","Longdavel","Lounge","Luncheon Areas","Luxury Accommodation","Manager's Dwelling","Manor House","Maternity House","Other","Owner's Dwelling","Parlor","Shed","Shower","Staff Ablutions","Staff Accommodation","Staff Building","Staff Compound","Staff Dining Facility","Stoop","Tavern","Teachers' Dwellings","Toilet - Outdoor","Toilet Block","Toilets","Toilets - Staff","Veranda","Winemakers' Dwelling","Workers' Ablutions","Workers' Accommodation","Workers' Kitchen","Workers' School"],Business:["Ablution Facility","Administration Block","Administrative Building","Administrative Offices","Animal Sale Facility","Auction Facilities","Barrel Maturation Room","Bathroom","Bottling Facility","Building","Charcoal Factory","Cheese Factory","Cloak Room","Cloth House","Commercial Buildings","Conference Facility","Cooling Facility","Distribution Centre","Factory Building","Fish Market Buildings","Functions Centre","Furniture Factory","Grading Room","Industrial Warehouse","Inspection Room","Ironing Room","Kiosk","Laboratory","Laundry Facility","Lean-to","Liquor Store","Loading Area","Loading Bay","Loading Platform","Loading Shed","Locker Room","Lockup Shed","Mechanical Workshop","Office","Office Building","Office Complex","Other","Packaging Complex","Packaging Facility","Pallet Factory","Pallet Stacking Area","Pill Factory","Processing Facility","Reception Area","Refrigeration Facility","Sales Facility","Saw Mill","Security Office","Shed","Shop","Sorting Facility","Staff Building","Staff Compound","Storage Facility","Studio","Toilet - Outdoor","Toilet Block","Toilets","Toilets - Client","Toilets - Office","Toilets - Staff","Transport Depot","Warehouse","Wine Cellar","Wine Shop","Wine Tasting Room","Winery Building","Work Station","Workers' Ablutions","Workers' Accommodation","Workers' Kitchen","Workers' School","Workshop"],"Equipment & Utilities":["Air Conditioners","Aircraft Hangar","Backup Generator","Boiler Room","Borehole","Borehole - Equipped","Borehole - Pump","Bulk Tank Room","Caravan Room","Carport","Carport - Double","Carton Shed","Chemical Shed","Compressor Room","Control Hut","Cooling Facility","Diesel Room","Electricity Room","Engine Room","Equipment Stores","Eskom Transformer","Filter Station","Fuel Depot","Fuel Store","Fuel Tank","Garage","Garage - Double","Garage - Triple","Generator Room","Hangar","Helipad","Hydro Tanks","Hydrophonic Pond","Laying Hen House Equipment","Machinery Room","Mechanical Workshop","Oil Store","Other","Oven","Petrol Storage","Poison Store","Power Room","Pump","Pump House Equipment","Pumphouse","Refuelling Canopy","Scale","Shed","Solar Power Room","Tank Stand","Tanks","Tool Shed","Tractor Shed","Transformer Room","Transport Depot","Truck Shelter","Truck Wash","Turbine Room","Twin Engine Generator Unit","Tyre Shed","Utility Building","Utility Room","Water Purification Plant","Water Reticulation Works","Water Storage Tanks","Water Tower"],Infrastructure:["Ablution Facility","Access Roads","All Infrastructure","Attic","Balcony","Barn","Bathroom","Bedroom","Bell Arch","Bin Compartments","Boiler Room","Borehole","Borehole - Equipped","Borehole - Pump","Building","Bulk Tank Room","Bunker","Canopy","Canteen","Cellar","Classroom","Cloak Room","Concrete Slab","Concrete Surfaces","Courtyard","Covered Area","Dam","Dam - Filter","Debris Filter Pond","Deck","Driveway","Electric Fencing","Electric Gate","Electricity Room","Entrance Building","Entrance Gate","Fencing","Fencing (Game)","Fencing (Perimeter)","Fencing (Security)","Flooring","Foyer","Gate","Gate - Sliding","Gate House","Gazebo","Guardhouse","Hall","House","Hut","Hydro Tanks","Hydrophonic Pond","Infrastructure","Irrigation Dam","Irrigation Pump","Irrigation Reservoir","Irrigation System","Kiosk","Kitchen","Koi Pond","Kraal","Laboratory","Landing Strip","Laundry Facility","Lean-to","Lockup Shed","Longdavel","Mezzanine","Other","Outbuilding","Outdoor Room","Outhouse","Parking Area","Parlor","Patio","Paving","Pens","Poles","Pool Facility","Pool House","Porch","Porte Cochere","Reservoir","Reservoir Pumphouse","Reservoir Tower","Road Stall","Rondavel","Roofing","Room","Ruin","Runway","Security Office","Shade Netting","Shade Port","Shed","Shooting Range","Shower","Silo","Slab","Splash Pool","Sprinklers","Stable","Stoop","Storage Facility","Studio","Surrounding Works","Tarmac","Tarred Area","Tarred Road Surfaces","Terrace","Toilet - Outdoor","Toilet Block","Toilets","Toilets - Client","Toilets - Office","Toilets - Staff","Trench","Tunnel","Tunnel Building","Vacant Areas","Veranda","Walkways","Walls","Walls (Boundary)","Walls (Retaining)","Walls (Security)","Warehouse","Water Feature","Water Storage Tanks","Water Tower","Wire Enclosures","Work Station"],"Recreational & Misc.":["Anti-Poaching Training Facility","Archive Room","Arena","Art Gallery","Bar","Barrel Maturation Room","BBQ","BBQ Facility","Café","Canteen","Caravan Room","Chapel","Church","Church Facility","Classroom","Cloth House","Clubhouse","Coffee Shop","Community Centre","Compost Pasteurising Unit","Compost Preparing Unit","Dark Room","Entertainment Area","Entertainment Facility","Functions Centre","Funeral Building","Furniture Factory","Gallery","Game Room","Golf Clubhouse","Gymnasium","Helipad","Hydro Tanks","Hydrophonic Pond","Igloo","Ironing Room","Jacuzzi","Judging Booth","Kiosk","Koi Pond","Laundry Facility","Liquor Store","Locker Room","Lounge","Luncheon Areas","Museum","Nursery School","Nursing Home","Other","Parlor","Pill Factory","Play Area","Pool Facility","Pool House","Pottery Room","Pub","Reception Area","Recreation Facility","Rehab Facility","Restaurant","Retirement Centre","Salon","Sauna","Saw Mill","School","Spa Baths","Spa Complex","Splash Pool","Squash Court","Sulphur Room","Surgery","Swimming Pool - Indoor","Swimming Pool - Outdoor","Swimming Pool Ablution","Tavern","Tea Room","Tennis Court","Treatment Area","Trout Dam","Venue Hall","Vitamin Room","Wedding Venue","Weigh Bridge","Weigh Bridge Control Room","Wellness Centre","Windmill"]},livestock:{Cattle:{Breeding:["Phase A Bulls","Phase B Bulls","Phase C Bulls","Phase D Bulls","Heifers","Bull Calves","Heifer Calves","Tollies 1-2","Heifers 1-2","Culls"],Dairy:["Bulls","Dry Cows","Lactating Cows","Heifers","Calves","Culls"],Slaughter:["Bulls","Cows","Heifers","Weaners","Calves","Culls"]},Sheep:{Breeding:["Rams","Young Rams","Ewes","Young Ewes","Lambs","Wethers","Culls"],Slaughter:["Rams","Ewes","Lambs","Wethers","Culls"]},Pigs:{Slaughter:["Boars","Breeding Sows","Weaned pigs","Piglets","Porkers","Baconers","Culls"]},Chickens:{Broilers:["Day Old Chicks","Broilers"],Layers:["Hens","Point of Laying Hens","Culls"]},Ostriches:{Slaughter:["Breeding Stock","Slaughter Birds > 3 months","Slaughter Birds < 3 months","Chicks"]},Goats:{Slaughter:["Rams","Breeding Ewes","Young Ewes","Kids"]}},vme:{Vehicles:["Bakkie","Car","Truck","Tractor"],Machinery:["Mower","Mower Conditioner","Hay Rake","Hay Baler","Harvester"],Equipment:["Plough","Harrow","Ridgers","Rotovator","Cultivator","Planter","Combine","Spreader","Sprayer","Mixer"]}},g=["Good","Good to fair","Fair","Fair to poor","Poor"],h={livestock:{Cattle:["Breeding","Dairy","Slaughter"],Sheep:["Breeding","Slaughter"],Pigs:["Slaughter"],Chickens:["Broilers","Layers"],Ostriches:["Slaughter"],Goats:["Slaughter"]}},i=["Cape","Summer","Fruit","Winter"],j={crop:["Cropland"],farmland:b.landUseTypes(),improvement:[],"irrigated cropland":["Cropland"],livestock:["Grazing","Planted Pastures","Conservation"],pasture:["Grazing","Planted Pastures","Conservation"],"permanent crop":["Horticulture (Perennial)"],plantation:["Plantation"],vme:[],"water right":b.landUseTypes()};return{assetTypes:function(){return d},seasonTypes:function(){return i},listServiceMap:function(){return c},getAssetTitle:function(a){return d[a]},getAssetSubtypes:function(a){return e[a]||[]},getAssetCategories:function(a,b){return f[a]?f[a][b]||[]:[]},getAssetPurposes:function(a,b){return h[a]?h[a][b]||[]:[]},conditionTypes:function(){return g},isFieldApplicable:function(a,b){var c=-1!==j[a].indexOf(b.landUse);return"irrigated cropland"==a?c&&b.irrigated:c},cleanAssetData:function(a){return"vme"==a.type&&(a.data.quantity=a.data.identificationNo&&a.data.identificationNo.length>0?1:a.data.quantity,a.data.identificationNo=1!=a.data.quantity?"":a.data.identificationNo),a},calculateValuation:function(a,b){return"vme"==a.type&&0==isNaN(a.data.quantity)?b.assetValue=a.data.quantity*(b.unitValue||0):"livestock"==a.type&&0==isNaN(b.totalStock)?b.assetValue=b.totalStock*(b.unitValue||0):"crop"==a.type&&0==isNaN(b.expectedYield)?b.assetValue=b.expectedYield*(b.unitValue||0):"improvement"!=a.type&&0==isNaN(a.data.size)&&(b.assetValue=a.data.size*(b.unitValue||0)),b}}}]),sdkHelperAssetApp.factory("assetValuationHelper",function(){var a=function(a){if(a.data&&a.data.valuations){var b=[];return angular.forEach(a.data.valuations,function(a){var c={title:a.organization.name,date:a.date};b.push(c)}),b}};return{listServiceMap:function(){return a},calculateValuation:function(a,b){return"vme"==a.type&&0==isNaN(a.data.quantity)?b.assetValue=a.data.quantity*(b.unitValue||0):"livestock"==a.type&&0==isNaN(b.totalStock)?b.assetValue=b.totalStock*(b.unitValue||0):"crop"==a.type&&0==isNaN(b.expectedYield)?b.assetValue=b.expectedYield*(b.unitValue||0):"improvement"!=a.type&&0==isNaN(a.data.size)&&(b.assetValue=a.data.size*(b.unitValue||0)),b}}});var sdkHelperDocumentApp=angular.module("ag.sdk.helper.document",[]);sdkHelperDocumentApp.provider("documentHelper",function(){var a=[],b={},c=function(a,b){return 1!=b?a.lastIndexOf("y")==a.length-1?a.substr(0,a.length-1)+"ies":a+"s":a};this.registerDocuments=function(c){c instanceof Array==!1&&(c=[c]),angular.forEach(c,function(c){-1===a.indexOf(c.docType)&&a.push(c.docType),c.state=c.state||"document."+c.docType.replace(" ","-"),b[c.docType]=c})},this.getDocument=function(a){return b[a]},this.$get=["$injector",function(d){var e=function(a){if(b[a.docType]){var c=b[a.docType],e={title:a.author?a.author:"",subtitle:"",docType:a.docType,group:c.title,updatedAt:a.updatedAt};return a.organization&&a.organization.name&&(e.subtitle=a.author?"From "+a.author+": ":"",e.title=a.organization.name),a.data&&c&&c.listServiceMap&&(c.listServiceMap instanceof Array&&(c.listServiceMap=d.invoke(c.listServiceMap)),c.listServiceMap(e,a)),e}};return{listServiceMap:function(){return e},pluralMap:function(a,b){return c(a,b)},documentTypes:function(){return a},documentTitles:function(){return _.pluck(b,"title")},getDocumentTitle:function(a){return b[a]?b[a].title:void 0},getDocumentState:function(a){return b[a]?b[a].state:void 0},getDocumentMap:function(a){return b[a]}}}]});var sdkHelperFarmerApp=angular.module("ag.sdk.helper.farmer",["ag.sdk.interface.map"]);sdkHelperFarmerApp.factory("farmerHelper",["geoJSONHelper",function(a){var b=function(a){function b(a){var b=[];return angular.forEach(a.legalEntities,function(a){b.push(a.name),a.registrationNumber&&b.push(a.registrationNumber)}),b}return{title:a.name,subtitle:a.operationType,profileImage:a.profilePhotoSrc,searchingIndex:b(a)}},c=["Commercial","Cooperative","Corporate","Smallholder"];return{listServiceMap:function(){return b},businessEntityTypes:function(){return c},getFarmerLocation:function(b){if(b){if(b.data&&b.data.loc)return b.data.loc.coordinates;if(b.legalEntities){var c=a();return angular.forEach(b.legalEntities,function(a){a.assets&&angular.forEach(a.assets,function(a){c.addGeometry(a.loc)})}),c.getCenter()}}return null}}}]),sdkHelperFarmerApp.factory("legalEntityHelper",[function(){function a(a){this.enterprises=_.map(a||[],function(a){return a.name?a.name:a}),this.selection={category:void 0,item:void 0}}var b=function(a){return{title:a.name,subtitle:a.type}},c=["Individual","Sole Proprietary","Joint account","Partnership","Close Corporation","Company","Trust","Non-Profitable companies","Cooperatives","In- Cooperatives","Clubs","Body Corporates"],d={"Field Crops":["Barley","Cabbage","Canola","Chicory","Citrus (Hardpeel)","Cotton","Cow Peas","Dry Bean","Dry Grapes","Dry Peas","Garlic","Grain Sorghum","Green Bean","Ground Nut","Hybrid Maize Seed","Lentils","Lucerne","Maize (Fodder)","Maize (Green)","Maize (Seed)","Maize (White)","Maize (Yellow)","Oats","Onion","Onion (Seed)","Popcorn","Potato","Pumpkin","Rye","Soya Bean","Sugar Cane","Sunflower","Sweetcorn","Tobacco","Tobacco (Oven dry)","Tomatoes","Watermelon","Wheat"],Horticulture:["Almonds","Apples","Apricots","Avo","Avocado","Bananas","Cherries","Chilli","Citrus (Hardpeel Class 1)","Citrus (Softpeel)","Coffee","Figs","Grapes (Table)","Grapes (Wine)","Guavas","Hops","Kiwi Fruit","Lemons","Macadamia Nut","Mango","Mangos","Melons","Nectarines","Olives","Oranges","Papaya","Peaches","Peanut","Pears","Pecan Nuts","Persimmons","Pineapples","Pistachio Nuts","Plums","Pomegranates","Prunes","Quinces","Rooibos","Strawberries","Triticale","Watermelons"],Livestock:["Cattle (Extensive)","Cattle (Feedlot)","Cattle (Stud)","Chicken (Broilers)","Chicken (Layers)","Dairy","Game","Goats","Horses","Ostrich","Pigs","Sheep (Extensive)","Sheep (Feedlot)","Sheep (Stud)"]};return a.prototype.addEnterprise=function(a){a=a||this.selection.item,-1==this.enterprises.indexOf(a)&&(this.enterprises.push(a),this.selection.item=void 0)},a.prototype.removeEnterprise=function(a){"string"==typeof a&&(a=this.enterprises.indexOf(a)),-1!==a&&this.enterprises.splice(a,1)},{listServiceMap:function(){return b},legalEntityTypes:function(){return c},enterpriseTypes:function(){return d},enterpriseEditor:function(b){return new a(b)}}}]),sdkHelperFarmerApp.factory("landUseHelper",function(){var a=["High","Medium","Low"],b=["0 - 30cm","30 - 60cm","60 - 90cm","90 - 120cm","120cm +"],c=["Centre-Pivot","Flood","Micro","Sub-drainage","Sprinkler","Drip"],d=["Cropland","Grazing","Horticulture (Intensive)","Horticulture (Perennial)","Horticulture (Seasonal)","Housing","Plantation","Planted Pastures","Structures (Handling)","Structures (Processing)","Structures (Storage)","Utilities","Wasteland","Conservation"],e=["Sand","Loamy Sand","Clay Sand","Sandy Loam","Fine Sandy Loam","Loam","Silty Loam","Sandy Clay Loam","Clay Loam","Clay","Gravel","Other","Fine Sandy Clay","Medium Sandy Clay Loam","Fine Sandy Clay Loam","Loamy Medium Sand","Medium Sandy Loam","Coarse Sandy Clay Loam","Coarse Sand","Loamy Fine Sand","Loamy Coarse Sand","Fine Sand","Silty Clay","Coarse Sandy Loam","Medium Sand","Medium Sandy Clay","Coarse Sandy Clay","Sandy Clay"],f=["Plains","Mountains"],g=["Irrigation Scheme","River","Dam","Borehole"],h={Cropland:["Barley","Bean","Bean (Broad)","Bean (Dry)","Bean (Sugar)","Bean (Green)","Bean (Kidney)","Canola","Cassava","Cotton","Cowpea","Grain Sorghum","Groundnut","Maize","Maize (White)","Maize (Yellow)","Oats","Pearl Millet","Potato","Rape","Rice","Rye","Soybean","Sunflower","Sweet Corn","Sweet Potato","Tobacco","Triticale","Wheat","Wheat (Durum)"],Grazing:["Bahia-Notatum","Bottle Brush","Buffalo","Buffalo (Blue)","Buffalo (White)","Bush","Cocksfoot","Common Setaria","Dallis","Phalaris","Rescue","Rhodes","Smuts Finger","Tall Fescue","Teff","Veld","Weeping Lovegrass"],"Horticulture (Perennial)":["Almond","Aloe","Apple","Apricot","Avocado","Banana","Cherry","Coconut","Coffee","Grape","Grape (Bush Vine)","Grape (Red)","Grape (Table)","Grape (White)","Grapefruit","Guava","Hops","Kiwi Fruit","Lemon","Litchi","Macadamia Nut","Mandarin","Mango","Nectarine","Olive","Orange","Papaya","Peach","Pear","Pecan Nut","Persimmon","Pineapple","Pistachio Nut","Plum","Rooibos","Sisal","Sugarcane","Tea","Walnuts"],"Horticulture (Seasonal)":["Asparagus","Beet","Beetroot","Blackberry","Borecole","Brinjal","Broccoli","Brussel Sprout","Cabbage","Cabbage (Chinese)","Cabbage (Savoy)","Cactus Pear","Carrot","Cauliflower","Celery","Chicory","Chilly","Cucumber","Cucurbit","Dry Pea","Garlic","Ginger","Granadilla","Kale","Kohlrabi","Leek","Lespedeza","Lettuce","Makataan","Mustard","Mustard (White)","Onion","Paprika","Parsley","Parsnip","Pea","Pepper","Pumpkin","Quince","Radish","Squash","Strawberry","Swede","Sweet Melon","Swiss Chard","Tomato","Turnip","Vetch (Common)","Vetch (Hairy)","Watermelon","Youngberry"],Plantation:["Bluegum","Pine","Wattle"],"Planted Pastures":["Birdsfoot Trefoil","Carribean Stylo","Clover","Clover (Arrow Leaf)","Clover (Crimson)","Clover (Persian)","Clover (Red)","Clover (Rose)","Clover (Strawberry)","Clover (Subterranean)","Clover (White)","Kikuyu","Lucerne","Lupin","Lupin (Narrow Leaf)","Lupin (White)","Lupin (Yellow)","Medic","Medic (Barrel)","Medic (Burr)","Medic (Gama)","Medic (Snail)","Medic (Strand)","Ryegrass","Ryegrass (Hybrid)","Ryegrass (Italian)","Ryegrass (Westerwolds)","Serradella","Serradella (Yellow)","Silver Leaf Desmodium"]};
return{croppingPotentialTypes:function(){return a},effectiveDepthTypes:function(){return b},irrigationTypes:function(){return c},landUseTypes:function(){return d},soilTextureTypes:function(){return e},terrainTypes:function(){return f},waterSourceTypes:function(){return g},getCropsForLandUse:function(a){return h[a]||[]},isCroppingPotentialRequired:function(a){return"Cropland"==a},isTerrainRequired:function(a){return"Grazing"==a}}}),sdkHelperFarmerApp.factory("farmHelper",[function(){var a=function(a){return{title:a.name}};return{listServiceMap:function(){return a}}}]);var sdkHelperFavouritesApp=angular.module("ag.sdk.helper.favourites",["ag.sdk.helper.document","ag.sdk.helper.task"]);sdkHelperFavouritesApp.factory("activityHelper",["documentHelper",function(a){var b=function(b){var f={date:b.date};return"object"==typeof b.actor?(b.actor.displayName?(f.title=b.actor.displayName,f.subtitle=b.actor.displayName):(f.title=b.actor.firstName+" "+b.actor.lastName,f.subtitle=b.actor.firstName+" "+b.actor.lastName),b.actor.position&&(f.title+=" ("+b.actor.position+")"),f.profilePhotoSrc=b.actor.profilePhotoSrc):b.organization?(f.title=b.organization.name,f.subtitle=b.organization.name):(f.title="Someone",f.subtitle="Someone"),f.subtitle+=" "+d(b.action)+" ",f.referenceId="farmer"==b.referenceType?b.organization.id:b[b.referenceType+"Id"],"farmer"==b.referenceType?(f.subtitle+="invite"==b.action?b.organization.name+" to create an Agrista account":"register"==b.action?"your request to join Agrista":"create"==b.action?"a customer portfolio for "+b.organization.name:"decline"==b.action?"a task for "+b.organization.name:"the portfolio of "+b.organization.name,f.referenceState="customer.details"):(void 0!==b[b.referenceType]?"document"==b.referenceType?(f.subtitle+=e(b[b.referenceType].docType)+" "+a.getDocumentTitle(b[b.referenceType].docType)+" "+b.referenceType,f.referenceState=a.getDocumentState(b[b.referenceType].docType)):"task"==b.referenceType?(f.subtitle+="the "+taskHelper.getTaskTitle(b[b.referenceType].todo)+" "+b.referenceType,f.referenceState=a.getTaskState(b[b.referenceType].todo)):f.subtitle+=e(b.referenceType)+" "+b.referenceType:f.subtitle+=e(b.referenceType)+" "+b.referenceType,b.actor&&b.organization&&b.organization.name&&(f.subtitle+=" "+c(b.action)+" "+b.organization.name)),f},c=function(a){return f[a]||"for"},d=function(a){return g[a]||(a.lastIndexOf("e")==a.length-1?a+"d":a+"ed")},e=function(a){var b=["a","e","i","o","u"];return h[a]||(-1!=b.indexOf(a.substr(0,1))?"an":"a")},f={share:"with",sent:"to"},g={register:"accepted",sent:"sent"},h={"asset register":"an"};return{listServiceMap:function(){return b},getActionVerb:d,getReferenceArticle:e}}]),sdkHelperFavouritesApp.factory("notificationHelper",["taskHelper","documentHelper",function(a,b){var c=function(c){var f={title:c.sender,subtitle:e[c.notificationType].title,state:d(c.notificationType,c.dataType)};return"task"==c.dataType?f.subtitle+=" "+a.getTaskTitle(c.sharedData.todo):"document"==c.dataType&&(f.subtitle+=" "+b.getDocumentTitle(c.sharedData.docType)),f.subtitle+=" "+c.dataType+(null==c.organization?"":" for "+c.organization.name),f},d=function(a,b){var c=e[a]?e[a].state:"view";return"notification."+c+"-"+b},e={"import":{title:"Import",state:"import"},view:{title:"View",state:"view"},reject:{title:"Reassign",state:"manage"},review:{title:"Review",state:"view"}};return{listServiceMap:function(){return c},getNotificationState:function(a,b){return d(a,b)},getNotificationTitle:function(a){return e[a]?e[a].title:""}}}]);var sdkHelperMerchantApp=angular.module("ag.sdk.helper.merchant",[]);sdkHelperMerchantApp.factory("merchantHelper",[function(){function a(a,b){a=a||[],this.services=_.map(b||[],function(a){return a.name?a.name:a}),this.selection={list:a,mode:0==a.length?"add":"select",text:""}}var b=function(a){return{title:a.name,subtitle:a.primaryContact,status:a.registered?{text:"registered",label:"label-success"}:!1}},c={benefit:"Benefit Partner",standard:"Standard"};return a.prototype.toggleMode=function(){this.selection.list.length>0&&(this.selection.mode="select"==this.selection.mode?"add":"select",this.selection.text="")},a.prototype.addService=function(a){a=a||this.selection.text,-1==this.services.indexOf(a)&&(this.services.push(a),this.selection.text="")},a.prototype.removeService=function(a){"string"==typeof a&&(a=this.services.indexOf(a)),-1!==a&&this.services.splice(a,1)},{listServiceMap:function(){return b},partnerTypes:function(){return c},getPartnerType:function(a){return c[a]},serviceEditor:function(b,c){return new a(b,c)}}}]);var sdkHelperTaskApp=angular.module("ag.sdk.helper.task",["ag.sdk.authorization","ag.sdk.utilities","ag.sdk.interface.list"]);sdkHelperTaskApp.provider("taskHelper",function(){var a=["assigned","in progress","in review"],b=function(b){var c=b.documentKey,d=_.filter(b.subtasks,function(b){return b.type&&-1!==a.indexOf(b.status)&&"child"==b.type}).map(function(a){return{id:a.id,title:b.organization.name,subtitle:f(a.todo),todo:a.todo,groupby:c,status:{text:a.status||" ",label:i(a.status)}}});return d.length?d:void 0},c=function(a){return{id:a.documentId,title:a.organization.name,subtitle:a.documentKey,status:{text:a.status||" ",label:i(a.status)}}},d={},e=function(a){return d[a]?d[a].state:void 0},f=function(a){return d[a]?d[a].title:void 0},g=function(a){return j[a]||a||" "},h=function(a){return k[a]||a||" "},i=function(a){switch(a){case"in progress":case"in review":return"label-warning";case"done":return"label-success";default:return"label-default"}},j={backlog:"Backlog",assigned:"Assigned","in progress":"In Progress","in review":"In Review",done:"Done",archive:"Archived"},k={accept:"Accept",decline:"Decline",assign:"Assign",start:"Start",complete:"Complete",approve:"Approve",reject:"Reject",release:"Release"};this.addTasks=function(a){d=_.extend(d,a)},this.$get=["authorization","listService","dataMapService",function(d,j,k){return{listServiceMap:function(){return b},parentListServiceMap:function(){return c},getTaskState:e,getTaskTitle:f,getTaskStatusTitle:g,getTaskActionTitle:h,getTaskLabel:i,filterTasks:function(a){return _.filter(a,function(a){return void 0!==e(a.todo)})},updateListService:function(c,e,f,g){var h=d.currentUser(),i=_.findWhere(f,{id:c});j.addItems(k({id:i.parentTaskId,documentKey:i.documentKey,type:"parent",todo:e,organization:g,subtasks:_.filter(f,function(a){return a&&a.assignedTo==h.username})},b)),i&&-1===a.indexOf(i.status)&&j.removeItems(i.id)}}}]}),sdkHelperTaskApp.factory("taskWorkflowHelper",function(){var a={accept:["backlog","assigned","in progress","in review","complete"],decline:["assigned"],start:["assigned","in progress"],assign:["backlog","assigned","in progress","in review"],complete:["assigned","in progress"],approve:["in review"],reject:["assigned","in review"],release:["done"]};return{canChangeToState:function(b,c){return a[c]?-1!==a[c].indexOf(b.status):!0}}});var sdkHelperTeamApp=angular.module("ag.sdk.helper.team",[]);sdkHelperTeamApp.factory("teamHelper",[function(){function a(a,b){a=a||[],this.teams=_.map(b||[],function(a){return a.name?a.name:a}),this.teamsDetails=_.map(b||[],function(a){return a}),this.selection={list:a,mode:0==a.length?"add":"select",text:""}}return a.prototype.toggleMode=function(){this.selection.list.length>0&&(this.selection.mode="select"==this.selection.mode?"add":"select",this.selection.text="")},a.prototype.addTeam=function(a){a=a||this.selection.text,-1!=this.teams.indexOf(a)||_.findWhere(this.teamsDetails,a)||(this.teams.push(a),this.teamsDetails.push(a),this.selection.text="")},a.prototype.removeTeam=function(a){"string"==typeof a&&(a=this.teams.indexOf(a)),-1!==a&&(this.teams.splice(a,1),this.teamsDetails.splice(a,1))},{teamEditor:function(b,c){return new a(b,c)}}}]);var sdkHelperUserApp=angular.module("ag.sdk.helper.user",[]);sdkHelperUserApp.factory("userHelper",[function(){var a=function(a){return{title:a.firstName+" "+a.lastName,subtitle:a.position,teams:a.teams}},b=["English"];return{listServiceMap:function(){return a},languageList:function(){return b}}}]);var sdkInterfaceListApp=angular.module("ag.sdk.interface.list",["ag.sdk.id"]);sdkInterfaceListApp.factory("listService",["$rootScope","objectId",function(a,b){var c,d,e,f,g,h=[],i=function(){a.$broadcast("list::button__clicked")},j=function(b){c!==b&&("object"==typeof b?(c=b,c.click=c.click||i):c=void 0,a.$broadcast("list::button__changed",c))},k=function(b){d!==b&&(d=void 0!==b?b:void 0,a.$broadcast("list::groupby__changed",d))},l=function(b){e!==b&&(void 0!==b?(h=[],e=b):e=void 0,a.$broadcast("list::scroll__changed",e))},m=function(b){f!==b&&(f=void 0!==b?b:void 0,a.$broadcast("list::search__changed",f))},n=function(a){if(g=a,h instanceof Array)for(var b=0;b<h.length;b++)h[b].active=!1,void 0!==a&&(h[b].id==a?h[b].active=!0:h[b].type==a&&(h[b].active=!0));else for(var c in h)h.hasOwnProperty(c)&&(h[c].active=c==a)},o=function(){if(h instanceof Array){for(var a=0;a<h.length;a++)if(h[a].id==g)return h[a]}else for(var b in h)if(h.hasOwnProperty(b)&&b==g)return h[b];return null};return a.$on("$stateChangeSuccess",function(a,b,c){n(c.id?c.id:c.type)}),a.$on("list::item__selected",function(a,b){n("object"==typeof b?b.id?b.id:b.type:b)}),{config:function(a){a.reset&&(c=void 0,d=void 0,e=void 0,f=void 0,h=[],g=void 0),j(a.button),k(a.groupby),l(a.infiniteScroll),m(a.search)},button:function(a){return 1==arguments.length&&j(a),c},groupby:function(a){return 1==arguments.length&&k(a),d},infiniteScroll:function(a){return 1==arguments.length&&l(a),e},search:function(a){return 1==arguments.length&&m(a),f},items:function(b){return void 0!==b&&(h=angular.copy(b),g=void 0,a.$broadcast("list::items__changed",h)),h},length:function(){return h.length},addItems:function(c){if(void 0!==c){c instanceof Array==!1&&(c=[c]);for(var d=0;d<c.length;d++){var e=c[d];if(e.id=e.id||b().toBase64String(),h instanceof Array){for(var f=!1,i=0;i<h.length;i++)if(e.id==h[i].id){h[i]=e,h[i].active=void 0!==g&&g==e.id,f=!0;break}0==f&&h.push(e)}else h[e.id]=e,h[e.id].active=void 0!==g&&g==e.id}a.$broadcast("list::items__changed",h)}},removeItems:function(b){if(void 0!==b){b instanceof Array==!1&&(b=[b]);for(var c=0;c<b.length;c++){var d=b[c];if(h instanceof Array){for(var e=0;e<h.length;e++)if(d==h[e].id){if(h.splice(e,1),d==g&&h.length){var f=h[e]?h[e]:h[e-1];a.$broadcast("list::item__selected",f)}break}}else delete h[d]}h instanceof Array&&0==h.length&&a.$broadcast("list::items__empty"),a.$broadcast("list::items__changed",h)}},selectFirstItem:function(){a.$broadcast("list::selectFirst__requested")},setActiveItem:function(a){n(a)},getActiveItem:function(){return o()}}}]);var sdkInterfaceMapApp=angular.module("ag.sdk.interface.map",["ag.sdk.utilities","ag.sdk.id"]);sdkInterfaceMapApp.factory("geoJSONHelper",function(){function a(b,c){return this instanceof a?void this.addGeometry(b,c):new a(b,c)}function b(a,c){c&&(angular.isArray(c[0])?angular.forEach(c,function(c){b(a,c)}):angular.isArray(c)&&a.push([c[1],c[0]]))}return a.prototype={getJson:function(){return this._json},getType:function(){return this._json.type},getCenter:function(a){var a=a||this.getBounds(),b=[0,0];return angular.forEach(a,function(a){b[0]+=a[0],b[1]+=a[1]}),a.length?[b[0]/a.length,b[1]/a.length]:null},getBounds:function(){var a=[];if(this._json){var c=this._json.features||[this._json];angular.forEach(c,function(c){var d=c.geometry||c;b(a,d.coordinates)})}return a},addProperties:function(a){var b=this;return this._json&&a&&("FeatureCollection"!=b._json.type&&"Feature"!=b._json.type?b._json={type:"Feature",geometry:b._json,properties:a}:(b._json.properties=b._json.properties||{},angular.forEach(a,function(a,c){b._json.properties[c]=a}))),b},addGeometry:function(a,b){return a&&(void 0===this._json?(this._json=a,this.addProperties(b)):("FeatureCollection"!=this._json.type&&"Feature"!=this._json.type&&(this._json={type:"Feature",geometry:this._json}),"Feature"==this._json.type&&(this._json={type:"FeatureCollection",features:[this._json]}),"FeatureCollection"==this._json.type&&this._json.features.push({type:"Feature",geometry:a,properties:b}))),this}},function(b,c){return new a(b,c)}}),sdkInterfaceMapApp.provider("mapMarkerHelper",function(){var a=function(a,b,c){return _.defaults(c||{},{iconUrl:"img/icons/"+a+"."+b+".png",shadowUrl:"img/icons/"+a+".shadow.png",iconSize:[48,48],iconAnchor:[24,48],shadowSize:[73,48],shadowAnchor:[24,48],labelAnchor:[12,-24]})},b=this.getMarker=function(b,c){var d={};return"string"==typeof b&&(d=a(b,"default",c)),d},c=this.getMarkerStates=function(b,c,d){var e={};return"string"==typeof b&&angular.forEach(c,function(c){e[c]=a(b,c,d)}),e};this.$get=function(){return{getMarker:b,getMarkerStates:c}}}),sdkInterfaceMapApp.provider("mapStyleHelper",["mapMarkerHelperProvider",function(a){var b={improvement:a.getMarkerStates("improvement",["default","success"]),homestead:a.getMarkerStates("homestead",["default","success"])},c={foreground:{farmland:{style:{weight:2,color:"white",opacity:.8,fillColor:"blue",fillOpacity:.3}},field:{style:{weight:2,color:"white",opacity:.8,fillColor:"#5b4723",fillOpacity:.8}},crop:{style:{weight:2,color:"white",opacity:.8,fillColor:"#aa64b0",fillOpacity:.8}},improvement:{icon:b.improvement.success,style:{weight:4,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.8}},"irrigated cropland":{style:{weight:2,color:"white",opacity:.8,fillColor:"#4573d5",fillOpacity:.8}},pasture:{style:{weight:2,color:"white",opacity:.8,fillColor:"#ffde40",fillOpacity:.8}},"permanent crop":{style:{weight:2,color:"white",opacity:.8,fillColor:"#487811",fillOpacity:.8}},plantation:{style:{weight:2,color:"white",opacity:.8,fillColor:"#00e64a",fillOpacity:.8}},homestead:{icon:b.homestead.success}},background:{farmland:{style:{weight:1,color:"white",opacity:.8,fillColor:"blue",fillOpacity:.1}},field:{style:{weight:1,color:"white",opacity:.8,fillColor:"#5b4723",fillOpacity:.4}},crop:{style:{weight:1,color:"white",opacity:.8,fillColor:"#aa64b0",fillOpacity:.4}},improvement:{icon:b.improvement.default,style:{weight:4,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.5}},"irrigated cropland":{style:{weight:1,color:"white",opacity:.8,fillColor:"#4573d5",fillOpacity:.4}},pasture:{style:{weight:1,color:"white",opacity:.8,fillColor:"#ffde40",fillOpacity:.4}},"permanent crop":{style:{weight:1,color:"white",opacity:.8,fillColor:"#487811",fillOpacity:.4}},plantation:{style:{weight:1,color:"white",opacity:.8,fillColor:"#00e64a",fillOpacity:.4}},homestead:{icon:b.homestead.default,label:{message:"Homestead"}}}},d=this.getStyle=function(a,b,d){var e=angular.copy(c[a]?c[a][b]||{}:{});return"object"==typeof d&&(e.label=d),e},e=this.setStyle=function(a,b,d){c[a]=c[a]||{},c[a][b]=d};this.$get=function(){return{getStyle:d,setStyle:e}}}]),sdkInterfaceMapApp.provider("mapboxService",function(){var a={options:{attributionControl:!0,layersControl:!0,scrollWheelZoom:!1,zoomControl:!0},layerControl:{baseTile:"agrista.map-65ftbmpi",baseLayers:{Agrista:{base:!0,type:"mapbox"},Google:{type:"google",tiles:"SATELLITE"}},overlays:{}},controls:{},events:{},view:{coordinates:[-28.691,24.714],zoom:6},bounds:{},layers:{},geojson:{}},b={};this.config=function(b){a=_.defaults(b||{},a)},this.$get=["$rootScope","objectId",function(c,d){function e(b,d){var e=this;e._id=b,e._ready=!1,e._options=d,e._show=e._options.show||!1,e._config=angular.copy(a),e._requestQueue=[],c.$on("mapbox-"+e._id+"::init",function(){e.dequeueRequests(),e._ready=!0}),c.$on("mapbox-"+e._id+"::destroy",function(){e._ready=!1,e._options.persist!==!0&&(e._config=angular.copy(a))})}return e.prototype={getId:function(){return this._id},reset:function(){this._config=angular.copy(a),c.$broadcast("mapbox-"+this._id+"::reset")},clearLayers:function(){this.removeOverlays(),this.removeLayers(),this.removeGeoJSON()},enqueueRequest:function(a,b){this._ready?c.$broadcast(a,b):this._requestQueue.push({event:a,args:b})},dequeueRequests:function(){if(this._requestQueue.length)do{var a=this._requestQueue.shift();c.$broadcast(a.event,a.args)}while(this._requestQueue.length)},shouldShow:function(){return this._show},hide:function(){this._show=!1,this.enqueueRequest("mapbox-"+this._id+"::hide",{})},show:function(){this._show=!0,this.enqueueRequest("mapbox-"+this._id+"::show",{})},invalidateSize:function(){this.enqueueRequest("mapbox-"+this._id+"::invalidate-size",{})},getOptions:function(){return this._config.options},setOptions:function(a){var b=this;angular.forEach(a,function(a,c){b._config.options[c]=a})},getMapBounds:function(a){this.enqueueRequest("mapbox-"+this._id+"::get-bounds",a)},getMapControl:function(a,b){this.enqueueRequest("mapbox-"+this._id+"::get-control",{control:a,handler:b})},getBaseTile:function(){return this._config.layerControl.baseTile},setBaseTile:function(a){this._config.layerControl.baseTile=a,c.$broadcast("mapbox-"+this._id+"::set-basetile",a)},getBaseLayers:function(){return this._config.layerControl.baseLayers},setBaseLayers:function(a){this._config.layerControl.baseLayers=a,c.$broadcast("mapbox-"+this._id+"::set-baselayers",a)},getOverlays:function(){return this._config.layerControl.overlays},addOverlay:function(a,b){a&&void 0==this._config.layerControl.overlays[a]&&(this._config.layerControl.overlays[a]=b,c.$broadcast("mapbox-"+this._id+"::add-overlay",{layerName:a,name:b||a}))},removeOverlay:function(a){a&&this._config.layerControl.overlays[a]&&(c.$broadcast("mapbox-"+this._id+"::remove-overlay",a),delete this._config.layerControl.overlays[a])},removeOverlays:function(){var a=this;angular.forEach(this._config.layerControl.overlays,function(b,d){c.$broadcast("mapbox-"+a._id+"::remove-overlay",d),delete a._config.layerControl.overlays[d]})},getControls:function(){return this._config.controls},addControl:function(a,b){this._config.controls[a]={name:a,options:b},c.$broadcast("mapbox-"+this._id+"::add-control",this._config.controls[a])},removeControl:function(a){delete this._config.controls[a],c.$broadcast("mapbox-"+this._id+"::remove-control",a)},getEventHandlers:function(){return this._config.events},addEventHandler:function(a,b){a=a instanceof Array?a:[a];var d=this;angular.forEach(a,function(a){d.removeEventHandler(a),d._config.events[a]=b,c.$broadcast("mapbox-"+d._id+"::add-event-handler",{event:a,handler:b})})},removeEventHandler:function(a){a=a instanceof Array?a:[a];var b=this;angular.forEach(a,function(a){void 0!==b._config.events[a]&&(c.$broadcast("mapbox-"+b._id+"::remove-event-handler",{event:a,handler:b._config.events[handler]}),delete b._config.events[a])})},getView:function(){return{coordinates:this._config.view.coordinates,zoom:this._config.view.zoom}},setView:function(a,b){a instanceof Array&&(this._config.view.coordinates=a,this._config.view.zoom=b||this._config.view.zoom,c.$broadcast("mapbox-"+this._id+"::set-view",this._config.view))},getBounds:function(){return this._config.bounds},setBounds:function(a,b){this._config.bounds={coordinates:a,options:b||{reset:!1}},c.$broadcast("mapbox-"+this._id+"::set-bounds",this._config.bounds)},zoomTo:function(a,b,d){c.$broadcast("mapbox-"+this._id+"::zoom-to",{coordinates:a,zoom:b,options:d})},createLayer:function(a,b,c,d){"function"==typeof c&&(d=c,c={});var e=this;this.enqueueRequest("mapbox-"+this._id+"::create-layer",{name:a,type:b,options:c,handler:function(b){e._config.layers[a]=b,d(b)}})},getLayer:function(a){return this._config.layers[a]},getLayers:function(){return this._config.layers},addLayer:function(a,b){this._config.layers[a]=b,c.$broadcast("mapbox-"+this._id+"::add-layer",a)},removeLayer:function(a){a instanceof Array==!1&&(a=[a]);var b=this;angular.forEach(a,function(a){c.$broadcast("mapbox-"+b._id+"::remove-layer",a),delete b._config.layers[a]})},removeLayers:function(){var a=this;angular.forEach(this._config.layers,function(b,d){c.$broadcast("mapbox-"+-this._id+"::remove-layer",d),delete a._config.layers[d]})},showLayer:function(a){c.$broadcast("mapbox-"+this._id+"::show-layer",a)},hideLayer:function(a){c.$broadcast("mapbox-"+this._id+"::hide-layer",a)},getGeoJSON:function(){return this._config.geojson},getGeoJSONFeature:function(a,b){return this._config.geojson[a]&&this._config.geojson[a][b]?this._config.geojson[a][b]:null},getGeoJSONLayer:function(a){return this._config.geojson[a]?this._config.geojson[a]:null},addGeoJSON:function(a,b,e,f,g){f=_.defaults(f||{},{featureId:d().toString()});var h={layerName:a,geojson:b,options:e,properties:f,onAddCallback:g};return this._config.geojson[a]=this._config.geojson[a]||{},this._config.geojson[a][f.featureId]=h,c.$broadcast("mapbox-"+this._id+"::add-geojson",h),f.featureId},removeGeoJSONFeature:function(a,b){this._config.geojson[a]&&this._config.geojson[a][b]&&(c.$broadcast("mapbox-"+this._id+"::remove-geojson-feature",this._config.geojson[a][b]),delete this._config.geojson[a][b])},removeGeoJSONLayer:function(a){a instanceof Array==!1&&(a=[a]);var b=this;angular.forEach(a,function(a){b._config.geojson[a]&&(c.$broadcast("mapbox-"+b._id+"::remove-geojson-layer",a),delete b._config.geojson[a])})},removeGeoJSON:function(){var a=this;angular.forEach(a._config.geojson,function(b,d){c.$broadcast("mapbox-"+a._id+"::remove-geojson-layer",d),delete a._config.geojson[d]})},editingOn:function(a,b,c,d,e){"string"==typeof c&&(c={exclude:"exclude"==c}),this.enqueueRequest("mapbox-"+this._id+"::edit-on",{layerName:a,controls:b,controlOptions:c,styleOptions:d,addLayer:e})},editingUpdate:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-update")},editingClear:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-clear")},editingOff:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-off")},pickPortionOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-portion-on")},pickDistrictOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-district-on")},pickFieldOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-field-on")},defineFarmOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-on")},defineServiceAreaOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-service-area-on")},defineFieldGroupOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-field-group-on")},featureClickOn:function(){this.enqueueRequest("mapbox-"+this._id+"::feature-click-on")},pickPortionOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-portion-off")},pickDistrictOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-district-off")},pickFieldOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-field-off")},defineFarmOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-off")},defineServiceAreaOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-off")},defineFieldGroupOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-field-group-off")},featureClickOff:function(){this.enqueueRequest("mapbox-"+this._id+"::feature-click-off")},printMap:function(){this.enqueueRequest("mapbox-"+this._id+"::print-map")}},function(a,c){return c=c||{},void 0===b[a]&&(b[a]=new e(a,c)),c.clean===!0&&b[a].reset(),b[a]}}]}),sdkInterfaceMapApp.directive("mapbox",["$rootScope","$http","$log","$timeout","mapboxService","geoJSONHelper","objectId",function(a,b,c,d,e,f,g){function h(b,c){var e=this;e._id=b.id,e._optionSchema={},e._editing=!1,e._editableLayer,e._editableFeature=L.featureGroup(),e._featureClickable,e._geoJSON={},e._layers={},e._controls={},e._layerControls={baseTile:"",baseLayers:{},overlays:{}},e._draw={exclude:!1,addLayer:!0,options:{},controls:{}},b.delay=b.delay||0,d(function(){e.mapInit(),e.addListeners(c),a.$broadcast("mapbox-"+e._mapboxServiceInstance.getId()+"::init",e._map)},b.delay)}var i={};return h.prototype.mapInit=function(){this._mapboxServiceInstance=e(this._id);var a=this._mapboxServiceInstance.getView(),b=this._mapboxServiceInstance.getOptions();this._map=L.map(this._id,b).setView(a.coordinates,a.zoom),this._editableFeature=L.featureGroup(),this._editableFeature.addTo(this._map),this.setEventHandlers(this._mapboxServiceInstance.getEventHandlers()),this.resetLayers(this._mapboxServiceInstance.getLayers()),this.resetGeoJSON(this._mapboxServiceInstance.getGeoJSON()),this.resetLayerControls(this._mapboxServiceInstance.getBaseTile(),this._mapboxServiceInstance.getBaseLayers(),this._mapboxServiceInstance.getOverlays()),this.addControls(this._mapboxServiceInstance.getControls()),this.setBounds(this._mapboxServiceInstance.getBounds()),this._map.on("draw:drawstart",this.onDrawStart,this),this._map.on("draw:editstart",this.onDrawStart,this),this._map.on("draw:deletestart",this.onDrawStart,this),this._map.on("draw:drawstop",this.onDrawStop,this),this._map.on("draw:editstop",this.onDrawStop,this),this._map.on("draw:deletestop",this.onDrawStop,this)},h.prototype.addListeners=function(b){b.hidden=!this._mapboxServiceInstance.shouldShow();var c=this,d=this._mapboxServiceInstance.getId();b.$on("mapbox-"+d+"::get-bounds",function(a,b){"function"==typeof b&&b(c._map.getBounds())}),b.$on("mapbox-"+d+"::get-control",function(a,b){"function"==typeof b.handler&&b.handler(c._controls[b.control])}),b.$on("$destroy",function(){delete i[d],c.mapDestroy(),a.$broadcast("mapbox-"+d+"::destroy")}),b.$on("mapbox-"+d+"::set-basetile",function(a,b){c.setBaseTile(b)}),b.$on("mapbox-"+d+"::set-baselayers",function(a,b){c.setBaseLayers(b)}),b.$on("mapbox-"+d+"::add-overlay",function(a,b){c.addOverlay(b.layerName,b.name)}),b.$on("mapbox-"+d+"::remove-overlay",function(a,b){c.removeOverlay(b)}),b.$on("mapbox-"+d+"::add-control",function(a,b){c.addControls({control:b})}),b.$on("mapbox-"+d+"::remove-control",function(a,b){c.removeControl(b)}),b.$on("mapbox-"+d+"::add-event-handler",function(a,b){c.addEventHandler(b.event,b.handler)}),b.$on("mapbox-"+d+"::remove-event-handler",function(a,b){c.removeEventHandler(b.event,b.handler)}),b.$on("mapbox-"+d+"::set-view",function(a,b){c.setView(b)}),b.$on("mapbox-"+d+"::set-bounds",function(a,b){c.setBounds(b)}),b.$on("mapbox-"+d+"::zoom-to",function(a,b){c.zoomTo(b)}),b.$on("mapbox-"+d+"::create-layer",function(a,b){"function"==typeof b.handler&&b.handler(c.createLayer(b.name,b.type,b.options))}),b.$on("mapbox-"+d+"::add-layer",function(a,b){c.addLayer(b)}),b.$on("mapbox-"+d+"::remove-layer",function(a,b){c.removeLayer(b)}),b.$on("mapbox-"+d+"::show-layer",function(a,b){c.showLayer(b)}),b.$on("mapbox-"+d+"::hide-layer",function(a,b){c.hideLayer(b)}),b.$on("mapbox-"+d+"::add-geojson",function(a,b){c.addGeoJSONFeature(b)}),b.$on("mapbox-"+d+"::remove-geojson-feature",function(a,b){c.removeGeoJSONFeature(b)}),b.$on("mapbox-"+d+"::remove-geojson-layer",function(a,b){c.removeGeoJSONLayer(b)}),b.$on("mapbox-"+d+"::hide",function(){b.hidden=!0}),b.$on("mapbox-"+d+"::show",function(){b.hidden=!1}),b.$on("mapbox-"+d+"::invalidate-size",function(){c._map.invalidateSize()}),b.$on("mapbox-"+d+"::edit-on",function(a,b){c.setOptionSchema(b.styleOptions),c.makeEditable(b.layerName,b.addLayer,!0),c.setDrawControls(b.controls,b.controlOptions),c.updateDrawControls()}),b.$on("mapbox-"+d+"::edit-update",function(){c.makeEditable(c._editableLayer,c._draw.addLayer,!1),c.updateDrawControls()}),b.$on("mapbox-"+d+"::edit-clear",function(){c.cleanEditable(),c.updateDrawControls()}),b.$on("mapbox-"+d+"::edit-off",function(){c.makeEditable(void 0,{},!0),c.updateDrawControls()}),b.$on("mapbox-"+d+"::pick-portion-on",function(){c._map.on("click",c.pickPortion,c)}),b.$on("mapbox-"+d+"::pick-district-on",function(){c._map.on("click",c.pickDistrict,c)}),b.$on("mapbox-"+d+"::pick-field-on",function(){c._map.on("click",c.pickField,c)}),b.$on("mapbox-"+d+"::define-farm-on",function(){c._map.on("click",c.defineNewFarm,c)}),b.$on("mapbox-"+d+"::define-service-area-on",function(){c._map.on("click",c.defineServiceArea,c)}),b.$on("mapbox-"+d+"::define-field-group-on",function(){c._map.on("click",c.defineFieldGroup,c)}),b.$on("mapbox-"+d+"::feature-click-on",function(){c._featureClickable=!0}),b.$on("mapbox-"+d+"::pick-portion-off",function(){c._map.off("click",c.pickPortion,c)}),b.$on("mapbox-"+d+"::pick-field-off",function(){c._map.off("click",c.pickField,c)}),b.$on("mapbox-"+d+"::pick-district-off",function(){c._map.off("click",c.pickDistrict,c)}),b.$on("mapbox-"+d+"::define-farm-off",function(){c._map.off("click",c.defineNewFarm,c)}),b.$on("mapbox-"+d+"::define-service-area-off",function(){c._map.off("click",c.defineServiceArea,c)}),b.$on("mapbox-"+d+"::define-field-group-off",function(){c._map.off("click",c.defineFieldGroup,c)}),b.$on("mapbox-"+d+"::feature-click-off",function(){c._featureClickable=!1}),b.$on("mapbox-"+d+"::print-map",function(){leafletImage(c._map,function(b,e){var f=document.createElement("img"),g=c._map.getSize();f.width=g.x,f.height=g.y,f.src=e.toDataURL(),a.$broadcast("mapbox-"+d+"::print-map-done",f)})})},h.prototype.mapDestroy=function(){for(var a in this._map._layers)this._map._layers.hasOwnProperty(a)&&this._map.removeLayer(this._map._layers[a]);this._optionSchema={},this._editing=!1,this._editableLayer=null,this._editableFeature=null,this._geoJSON={},this._layers={},this._layerControls={baseTile:"",baseLayers:{},overlays:{}},this._draw={exclude:!1,addLayer:!0,options:{},controls:{}},this._map.remove(),this._map=null},h.prototype.resetLayerControls=function(a,b,c){this._layerControls.baseTile=a;try{this.map.removeControl(this._layerControls.control)}catch(d){}this.setBaseLayers(b),this.setOverlays(c)},h.prototype.resetLayers=function(a){var b=this;angular.forEach(b._layers,function(a,c){b._map.removeLayer(a),delete b._layers[c]}),angular.forEach(a,function(a,c){b._layers[c]=a,b._map.addLayer(a)})},h.prototype.resetGeoJSON=function(a){var b=this;angular.forEach(b._geoJSON,function(a,c){b._layers[c]&&(b._map.removeLayer(b._layers[c]),delete b._layers[c])}),angular.forEach(a,function(a){b.addGeoJSONLayer(a)})},h.prototype.setBaseTile=function(a){var b=this;b._layerControls.baseTile=a,angular.forEach(b._layerControls.baseLayers,function(b){b.base&&b.layer&&b.layer.setUrl(a)})},h.prototype.setBaseLayers=function(a){var b=this,c=b._mapboxServiceInstance.getOptions();void 0===b._layerControls.control&&(b._layerControls.control=L.control.layers({},{}),c.layersControl&&b._map.addControl(b._layerControls.control)),angular.forEach(b._layerControls.baseLayers,function(c,d){void 0===a[d]?b._layerControls.control.removeLayer(c.layer):void 0===c.layer&&b.addBaseLayer(c,d)}),angular.forEach(a,function(a,c){void 0===b._layerControls.baseLayers[c]?b.addBaseLayer(a,c):(a=b._layerControls.baseLayers[c],a.base&&a.layer.addTo(this._map))})},h.prototype.addBaseLayer=function(a,b){a.base&&(a.tiles=this._layerControls.baseTile),"tile"==a.type?a.layer=L.tileLayer(a.tiles):"mapbox"==a.type?a.layer=L.mapbox.tileLayer(a.tiles):"google"==a.type&&"function"==typeof L.Google&&(a.layer=new L.Google(a.tiles)),a.base&&a.layer.addTo(this._map),this._layerControls.baseLayers[b]=a,this._layerControls.control.addBaseLayer(a.layer,b)},h.prototype.setOverlays=function(a){var b=this;angular.forEach(b._layerControls.overlays,function(c,d){void 0===a[d]&&b.removeOverlay(d,c)}),angular.forEach(a,function(a,c){b.addOverlay(c,a)})},h.prototype.addOverlay=function(a,b){var c=this._layers[a];b=b||a,this._layerControls.control&&c&&void 0===this._layerControls.overlays[a]&&(this._layerControls.overlays[a]=c,this._layerControls.control.addOverlay(c,b))},h.prototype.removeOverlay=function(a,b){var c=b||this._layers[a];this._layerControls.control&&c&&(this._layerControls.control.removeLayer(c),delete this._layerControls.overlays[a])},h.prototype.addControls=function(a){var b=this;angular.forEach(a,function(a){"function"==typeof L.control[a.name]&&(b.removeControl(a.name),b._controls[a.name]=L.control[a.name](a.options),b._map.addControl(b._controls[a.name]))})},h.prototype.removeControl=function(a){this._controls[a]&&(this._map.removeControl(this._controls[a]),delete this._controls[a])},h.prototype.setEventHandlers=function(a){var b=this;angular.forEach(a,function(a,c){b.addEventHandler(c,a)})},h.prototype.addEventHandler=function(a,b){this._map.on(a,b)
},h.prototype.removeEventHandler=function(a,b){this._map.off(a,b)},h.prototype.setView=function(a){this._map&&void 0!==a&&this._map.setView(a.coordinates,a.zoom)},h.prototype.setBounds=function(a){this._map&&a.coordinates&&(a.coordinates instanceof Array?a.coordinates.length>1&&this._map.fitBounds(a.coordinates,a.options):this._map.fitBounds(a.coordinates,a.options))},h.prototype.zoomTo=function(a){this._map&&a.coordinates&&a.zoom&&this._map.setZoomAround(a.coordinates,a.zoom,a.options)},h.prototype.createLayer=function(a,b,c){return b=b||"featureGroup",c=c||{},void 0===this._layers[a]&&("featureGroup"==b&&L.featureGroup?this._layers[a]=L.featureGroup(c):"markerClusterGroup"==b&&L.markerClusterGroup&&(this._layers[a]=L.markerClusterGroup(c)),this._layers[a]&&this._layers[a].addTo(this._map)),this._layers[a]},h.prototype.addLayer=function(a){var b=this._mapboxServiceInstance.getLayer(a);b&&(this._layers[a]=b,this._map.addLayer(b))},h.prototype.addLayerToLayer=function(a,b,c){var d=this._layers[c];d&&(this._layers[a]=b,d.addLayer(b))},h.prototype.removeLayer=function(a){var b=this._layers[a];b&&(this.removeOverlay(a),this._map.removeLayer(b),delete this._layers[a])},h.prototype.removeLayerFromLayer=function(a,b){var c=this._layers[b],d=this._layers[a];c&&(c.removeLayer(d),delete this._layers[a])},h.prototype.showLayer=function(a){var b=this._layers[a];b&&0==this._map.hasLayer(b)&&(this._map.addLayer(b),b.eachLayer(function(a){a.bindLabel&&a.feature.properties.label&&a.bindLabel(a.feature.properties.label.message,a.feature.properties.label.options)}))},h.prototype.hideLayer=function(a){var b=this._layers[a];b&&this._map.hasLayer(b)&&this._map.removeLayer(b)},h.prototype.addGeoJSONLayer=function(a){var b=this;angular.forEach(a,function(a){b.addGeoJSONFeature(a)})},h.prototype.makeIcon=function(a){return a?a.type&&L[a.type]&&L[a.type].icon?L[a.type].icon(a):L.icon(a):L.Icon.Default()},h.prototype.addLabel=function(a,b,c){var d=this,e=f(b);if("object"==typeof a&&"Point"!==b.geometry.type)if(a.options=a.options||{},(a.options.centered||a.options.noHide)&&"function"==typeof d._map.showLabel){var g=new L.Label(_.extend(a.options),{offset:[6,-15]});g.setContent(a.message),g.setLatLng(e.getCenter()),1==a.options.noHide?d._map.showLabel(g):(c.on("mouseover",function(){d._map.showLabel(g)}),c.on("mouseout",function(){d._map.removeLayer(g)})),c.on("remove",function(){d._map.removeLayer(g)})}else"function"==typeof c.bindLabel&&c.bindLabel(a.message,a.options)},h.prototype.addGeoJSONFeature=function(b){var c=this,d=f(b.geojson,b.properties);c.createLayer(b.layerName),c._geoJSON[b.layerName]=c._geoJSON[b.layerName]||{},c._geoJSON[b.layerName][b.properties.featureId]=b;var e=b.options?angular.copy(b.options):{};e.icon&&(e.icon=c.makeIcon(e.icon)),L.geoJson(d.getJson(),{style:e.style,pointToLayer:function(a,b){var c=L.marker(b,e);return e.label&&c.bindLabel(e.label.message,e.label.options),c},onEachFeature:function(d,f){c.addLayerToLayer(d.properties.featureId,f,b.layerName),c.addLabel(e.label,d,f),"function"==typeof b.onAddCallback&&b.onAddCallback(d,f),!c._featureClickable||"Polygon"!==d.geometry.type&&"MultiPolygon"!==d.geometry.type||f.on("click",function(){d&&d.properties&&(d.properties.highlighted?(d.properties.highlighted=!1,f.setStyle({color:f.options.fillColor||"blue",opacity:f.options.fillOpacity||.4})):(d.properties.highlighted=!0,f.setStyle({color:"white",opacity:1,fillColor:f.options.fillColor||"blue",fillOpacity:f.options.fillOpacity||.4}))),a.$broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::polygon-clicked",{properties:d.properties,highlighted:d.properties.highlighted})})}})},h.prototype.removeGeoJSONFeature=function(a){this._geoJSON[a.layerName]&&this._geoJSON[a.layerName][a.properties.featureId]&&(this.removeLayerFromLayer(a.properties.featureId,a.layerName),delete this._geoJSON[a.layerName][a.properties.featureId])},h.prototype.removeGeoJSONLayer=function(a){this._geoJSON[a]&&(this.removeLayer(a),delete this._geoJSON[a])},h.prototype.makeEditable=function(a,b,c){var d=this;1==c&&d.cleanEditable(),a&&d._layers[a]&&d._layers[a].eachLayer(function(b){d._layers[a].removeLayer(b),d._editableFeature.addLayer(b)}),d._editableLayer=a,d._draw.addLayer=void 0==b?!0:b},h.prototype.cleanEditable=function(){var a=this;a._editableFeature.eachLayer(function(b){a._editableFeature.removeLayer(b)})},h.prototype.setDrawControls=function(a,b){this._draw.controlOptions=b||{},this._draw.controls={},a instanceof Array&&"function"==typeof L.Control.Draw&&(this._draw.controls.polyline=new L.Control.Draw({draw:{polyline:-1!=a.indexOf("polyline"),polygon:!1,rectangle:!1,circle:!1,marker:!1}}),this._draw.controls.polygon=new L.Control.Draw({draw:{polyline:!1,polygon:-1==a.indexOf("polygon")?!1:{allowIntersection:!1,showArea:!0,metric:!0},rectangle:!1,circle:!1,marker:!1}}),this._draw.controls.marker=new L.Control.Draw({draw:{polyline:!1,polygon:!1,rectangle:!1,circle:!1,marker:-1==a.indexOf("marker")?!1:{icon:this._optionSchema.icon?L.icon(this._optionSchema.icon):L.Icon.Default()}}}),this._draw.controls.edit=new L.Control.Draw({draw:!1,edit:{featureGroup:this._editableFeature,remove:1!=this._draw.controlOptions.nodelete}}))},h.prototype.setOptionSchema=function(a){this._optionSchema=a||{}},h.prototype.updateDrawControls=function(){try{this._map.removeControl(this._draw.controls.polyline)}catch(a){}try{this._map.removeControl(this._draw.controls.polygon)}catch(a){}try{this._map.removeControl(this._draw.controls.marker)}catch(a){}try{this._map.removeControl(this._draw.controls.edit)}catch(a){}try{this._map.off("draw:created",this.onDrawn,this),this._map.off("draw:edited",this.onEdited,this),this._map.off("draw:deleted",this.onDeleted,this)}catch(a){}if(this._editableFeature.getLayers().length>0&&(this._map.on("draw:edited",this.onEdited,this),this._map.on("draw:deleted",this.onDeleted,this),this._draw.controls.edit&&this._map.addControl(this._draw.controls.edit)),this._editableLayer&&(0==this._editableFeature.getLayers().length||this._draw.controlOptions.multidraw)){var b={polyline:!0,polygon:!0,marker:!0};this._editableFeature.eachLayer(function(a){if(a.feature&&a.feature.geometry&&a.feature.geometry.type)switch(a.feature.geometry.type){case"LineString":b.polyline=!1;break;case"Polygon":b.polygon=!1;break;case"Point":b.marker=!1}}),this._draw.controlOptions.exclude?(b.polyline&&this._map.addControl(this._draw.controls.polyline),b.polygon&&this._map.addControl(this._draw.controls.polygon),b.marker&&this._map.addControl(this._draw.controls.marker),this._map.on("draw:created",this.onDrawn,this)):(this._draw.controls.polyline&&this._map.addControl(this._draw.controls.polyline),this._draw.controls.polygon&&this._map.addControl(this._draw.controls.polygon),this._draw.controls.marker&&this._map.addControl(this._draw.controls.marker),this._map.on("draw:created",this.onDrawn,this))}},h.prototype.pickPortion=function(d){var e=this;if(0==e._editing){var f="?x="+d.latlng.lng+"&y="+d.latlng.lat;b.get("/api/geo/portion-polygon"+f).success(function(b){e._mapboxServiceInstance.removeGeoJSONLayer(e._editableLayer),e._mapboxServiceInstance.addGeoJSON(e._editableLayer,b.position,e._optionSchema,{featureId:b.sgKey}),a.$broadcast("mapbox-"+e._mapboxServiceInstance.getId()+"::portion-added",b)}).error(function(a){c.log(a)})}},h.prototype.defineNewFarm=function(d){var e=this;if(0==e._editing){var f="?x="+d.latlng.lng+"&y="+d.latlng.lat;b.get("/api/geo/portion-polygon"+f).success(function(b){e._mapboxServiceInstance.addGeoJSON(e._editableLayer,b.position,e._optionSchema,{featureId:b.sgKey,portion:b}),e.makeEditable(e._editableLayer,e._draw.addLayer,!1),e.updateDrawControls(),a.$broadcast("mapbox-"+e._mapboxServiceInstance.getId()+"::portion-added",b)}).error(function(a){c.log(a)})}},h.prototype.pickDistrict=function(d){var e=this;if(0==e._editing){var f="?x="+d.latlng.lng+"&y="+d.latlng.lat;b.get("/api/geo/district-polygon"+f).success(function(b){e._mapboxServiceInstance.removeGeoJSONLayer(e._editableLayer),e._mapboxServiceInstance.addGeoJSON(e._editableLayer,b.position,e._optionSchema,{featureId:b.sgKey}),a.$broadcast("mapbox-"+e._mapboxServiceInstance.getId()+"::district-added",b)}).error(function(a){c.log(a)})}},h.prototype.defineServiceArea=function(d){var e=this;if(0==e._editing){var f="?x="+d.latlng.lng+"&y="+d.latlng.lat;b.get("/api/geo/district-polygon"+f).success(function(b){e._mapboxServiceInstance.addGeoJSON(e._editableLayer,b.position,e._optionSchema,{featureId:b.sgKey,districtName:b.name}),e.makeEditable(e._editableLayer,e._draw.addLayer,!1),e.updateDrawControls(),a.$broadcast("mapbox-"+e._mapboxServiceInstance.getId()+"::district-added",b)}).error(function(a){c.log(a)})}},h.prototype.pickField=function(d){var e=this;if(0==e._editing){var f="?x="+d.latlng.lng+"&y="+d.latlng.lat;b.get("/api/geo/field-polygon"+f).success(function(b){e._mapboxServiceInstance.removeGeoJSONLayer(e._editableLayer),e._mapboxServiceInstance.addGeoJSON(e._editableLayer,b.position,e._optionSchema,{}),a.$broadcast("mapbox-"+e._mapboxServiceInstance.getId()+"::field-added",b)}).error(function(a){c.log(a)})}},h.prototype.defineFieldGroup=function(d){var e=this;if(0==e._editing){var f="?x="+d.latlng.lng+"&y="+d.latlng.lat;b.get("/api/geo/field-polygon"+f).success(function(b){e._mapboxServiceInstance.addGeoJSON(e._editableLayer,b.position,e._optionSchema,{}),e.makeEditable(e._editableLayer,e._draw.addLayer,!1),e.updateDrawControls(),a.$broadcast("mapbox-"+e._mapboxServiceInstance.getId()+"::field-added",b)}).error(function(a){c.log(a)})}},h.prototype.onDrawStart=function(){this._editing=!0,a.$broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-editing",this._editing)},h.prototype.onDrawStop=function(){this._editing=!1,a.$broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-editing",this._editing)},h.prototype.onDrawn=function(b){var c={type:"Feature",geometry:{},properties:{featureId:g().toString()}};switch(b.layerType){case"polyline":c.geometry={type:"LineString",coordinates:[]},angular.forEach(b.layer._latlngs,function(a){c.geometry.coordinates.push([a.lng,a.lat])}),a.$broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",c);break;case"polygon":if(c.geometry={type:"Polygon",coordinates:[[]]},angular.forEach(b.layer._latlngs,function(a){c.geometry.coordinates[0].push([a.lng,a.lat])}),c.geometry.coordinates[0].length>0&&c.geometry.coordinates[0][0]!=c.geometry.coordinates[0][c.geometry.coordinates[0].length-1]&&c.geometry.coordinates[0].push(c.geometry.coordinates[0][0]),this._draw.controls.polygon.options.draw.polygon.showArea){var d=L.GeometryUtil.geodesicArea(b.layer._latlngs),e=1.19599*d;c.properties.area={m_sq:d,ha:1e-4*d,mi_sq:e/3097600,acres:e/4840,yd_sq:e}}a.$broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",c);break;case"marker":c.geometry={type:"Point",coordinates:[b.layer._latlng.lng,b.layer._latlng.lat]},a.$broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",c)}this._draw.addLayer&&(this._mapboxServiceInstance.addGeoJSON(this._editableLayer,c,this._optionSchema,c.properties),this.makeEditable(this._editableLayer),this.updateDrawControls())},h.prototype.onEdited=function(b){var c=this;b.layers.eachLayer(function(b){var d={type:"Feature",geometry:{type:b.feature.geometry.type},properties:{featureId:b.feature.properties.featureId}};switch(b.feature.geometry.type){case"Point":d.geometry.coordinates=[b._latlng.lng,b._latlng.lat],a.$broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d);break;case"Polygon":if(d.geometry.coordinates=[[]],angular.forEach(b._latlngs,function(a){d.geometry.coordinates[0].push([a.lng,a.lat])}),d.geometry.coordinates[0].length>0&&d.geometry.coordinates[0][0]!=d.geometry.coordinates[0][d.geometry.coordinates[0].length-1]&&d.geometry.coordinates[0].push(d.geometry.coordinates[0][0]),c._draw.controls.polygon.options.draw.polygon.showArea){var e=L.GeometryUtil.geodesicArea(b._latlngs),f=1.19599*e;d.properties.area={m_sq:e,ha:1e-4*e,mi_sq:f/3097600,acres:f/4840,yd_sq:f}}a.$broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d);break;case"LineString":d.geometry.coordinates=[],angular.forEach(b._latlngs,function(a){d.geometry.coordinates.push([a.lng,a.lat])}),a.$broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d)}})},h.prototype.onDeleted=function(b){var c=this;b.layers.getLayers().length>0?b.layers.eachLayer(function(b){c._editableFeature.removeLayer(b),a.$broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-deleted",b.feature.properties.featureId)}):(c._editableFeature.clearLayers(),a.$broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-deleted")),c.updateDrawControls()},{restrict:"E",template:'<div class="map" ng-hide="hidden" ng-transclude></div>',replace:!0,transclude:!0,link:function(a,b,c){void 0===i[c.id]&&(i[c.id]=new h(c,a))},controller:function(a,b){this.getMap=function(){return i[b.id]._map}}}}]),sdkInterfaceMapApp.directive("mapboxControl",["$rootScope",function(a){function b(b){var e=b.parent();a.$on("mapbox-"+e.attr("id")+"::init",function(){e.find(".leaflet-control-container "+d[c]).prepend(b)})}var c,d={topleft:".leaflet-top.leaflet-left",topright:".leaflet-top.leaflet-right",bottomleft:".leaflet-bottom.leaflet-left",bottomright:".leaflet-bottom.leaflet-right"};return{restrict:"E",require:"^mapbox",replace:!0,transclude:!0,template:'<div class="leaflet-control"><div class="leaflet-bar" ng-transclude></div></div>',link:function(a,b,d){c=void 0==d.position?"bottomright":d.position},controller:function(a){b(a)}}}]);var sdkInterfaceNavigiationApp=angular.module("ag.sdk.interface.navigation",["ag.sdk.authorization"]);sdkInterfaceNavigiationApp.provider("navigationService",function(){var a={},b=[],c={Favourites:1,Assets:2,Apps:3,Administration:4},d={left:[],right:[]},e=function(a,b){return a.order-b.order},f=this.registerApps=function(b){b=b instanceof Array?b:[b],angular.forEach(b,function(b){b=_.defaults(b,{id:b.title,order:100,group:"Apps",include:function(a,b){return-1!==b.indexOf(a.title)}}),b.title&&b.state&&(a[b.title]=b)})};this.$get=["$rootScope","$state","authorization",function(g,h,i){var j=!1,k="",l=function(a){var d=_.findWhere(b,{title:a.group});void 0===d&&(d={title:a.group,order:c[a.group]||100,items:[]},b.push(d),b=b.sort(e));var f=_.findWhere(d.items,{title:a.title});void 0===f&&(a.active=h.includes(a.state),d.items.push(a),d.items=d.items.sort(e),g.$broadcast("navigation::items__changed",b),g.$broadcast("navigation::app__allowed",a))},m=function(){b=[],g.$broadcast("navigation::items__changed",b)},n=function(b){var c=b||i.currentUser(),d=c.userRole?_.pluck(c.userRole.apps,"name"):[],e=c.organization?_.pluck(c.organization.services,"serviceType"):[];m(),angular.forEach(a,function(a){("function"==typeof a.include&&a.include(a,d,e)||a.include===!0)&&l(a)})},o=function(a,b){b&&(b instanceof Array==!1?d[a].push(b):d[a]=b,g.$broadcast("navigation::"+a+"-buttons__changed",d[a]),g.$broadcast("navigation::buttons__changed"))};return g.$on("$stateChangeSuccess",function(){angular.forEach(b,function(a){angular.forEach(a.items,function(a){a.active=h.includes(a.state)})})}),g.$on("navigation::item__selected",function(a,b){h.go(b)}),g.$on("authorization::login",function(a,b){n(b)}),g.$on("authorization::unauthorized",function(){m()}),g.$on("authorization::logout",function(){m()}),n(),{getGroupedApps:function(){return b},renameApp:function(c,d){var e=_.findWhere(a,{id:c});e&&(e.title=d,g.$broadcast("navigation::items__changed",b))},registerApps:function(a){f(a)},unregisterApps:function(){a={},b=[]},allowApp:function(b){a[b]&&l(a[b])},toggleSlim:function(){j=!j,g.$broadcast("navigation::slim__changed",j)},isSlim:function(){return j},footerText:function(a){return void 0!==a&&(k=a,g.$broadcast("navigation::footerText",k)),k},leftButtons:function(a){return o("left",a),d.left},rightButtons:function(a){return o("right",a),d.right}}}]});var cordovaHelperApp=angular.module("ag.mobile-sdk.helper",["ag.sdk.utilities","ag.mobile-sdk.cordova.geolocation","ag.mobile-sdk.cordova.camera"]);cordovaHelperApp.factory("geolocationHelper",["promiseService","geolocationService",function(a,b){function c(a){return this instanceof c?(this._options=a.options||{},this._onGet=a.onGet||angular.noop,this._onWatch=a.onWatch||angular.noop,this._onError=a.onError||angular.noop,void(this._watcher=null)):new c(a)}function d(a){return{type:"Feature",geometry:{coordinates:[a.coords.longitude,a.coords.latitude],type:"Point"},properties:{accuracy:a.coords.accuracy,altitude:a.coords.altitude}}}return c.prototype={busy:!1,getPosition:function(a){var c=this;c.busy=!0,a=a||c._options,b.getPosition(a).then(function(a){c.busy=!1,c._onGet(d(a),a)},function(a){c.busy=!1,c._onError(a)})},watchPosition:function(a){var c=this;a=a||c._options,c._watcher=b.watchPosition(a,function(a,b){a?c._onWatch(d(a),a):c._onError(b)})},cancelWatch:function(){this._watcher&&(this._watcher.cancel(),this._watcher=null)}},function(a){return new c(a)}}]),cordovaHelperApp.factory("cameraHelper",["promiseService","geolocationService","cameraService",function(a,b,c){var d={geolocation:{timeout:2e4},camera:{quality:50,targetWidth:1280,targetHeight:720,correctOrientation:!0,encodingType:c.getEncodingTypes.JPEG,destinationType:c.getDestinationTypes.FILE_URI}},e={0:"image/jpeg",1:"image/png"};return{capturePhotoWithLocation:function(f,g){return f=f||d.geolocation,g=g||d.camera,a.wrap(function(d){a.all({geolocation:b.getPosition(f),camera:c.capture(g)}).then(function(a){d.resolve({geolocation:{type:"Feature",geometry:{coordinates:[a.geolocation.coords.longitude,a.geolocation.coords.latitude],type:"Point"},properties:{accuracy:a.geolocation.coords.accuracy,altitude:a.geolocation.coords.altitude}},camera:{src:a.camera,type:e[g.encodingType]}})},d.reject)})}}}]);var sdkTestDataApp=angular.module("ag.sdk.test.data",["ag.sdk.utilities","ag.sdk.id"]);sdkTestDataApp.provider("mockDataService",[function(){var a={},b={localStore:!0};this.config=function(a){b=_.defaults(a,b)},this.$get=["localStore","objectId","promiseService",function(c,d,e){return b.localStore&&(a=c.getItem("mockdata")||{}),{setItem:function(e,f){f instanceof Array?(a[e]={},angular.forEach(f,function(b){b.id=b.id||d().toString(),a[e][b.id]=b})):(f.id=f.id||ObjectId().toString(),a[e]=a[e]||{},a[e][f.id]=f),b.localStore&&c.setItem("mockdata",a)},getItem:function(b,c){return e.wrap(function(d){a[b]=a[b]||{},void 0===c?d.resolve(_.toArray(a[b]||{})):a[b][c]?d.resolve(a[b][c]):d.reject()})}}}]}]);var cordovaCameraApp=angular.module("ag.mobile-sdk.cordova.camera",["ag.sdk.utilities"]);cordovaCameraApp.factory("cameraService",["promiseService",function(a){function b(b){var c=a.defer();return void 0!==navigator.camera?navigator.camera.getPicture(function(a){c.resolve(a)},function(a){c.reject(a)},b):c.reject({code:"NoCamera",message:"No camera available"}),c.promise}"undefined"==typeof window.Camera&&(window.Camera={});var c=Camera.PictureSourceType,d=Camera.DestinationType,e=Camera.EncodingType;return{getDestinationTypes:d,getEncodingTypes:e,getPictureSourceTypes:c,capture:function(a){return"object"!=typeof a&&(a={}),b(_.defaults(a,{quality:50,destinationType:d.DATA_URL,source:c.CAMERA}))},captureAndEdit:function(a){return"object"!=typeof a&&(a={}),b(_.defaults(a,{quality:50,allowEdit:!0,destinationType:d.DATA_URL,source:c.CAMERA}))},retrieve:function(a){return"object"!=typeof a&&(a={}),b(_.defaults(a,{quality:50,destinationType:d.FILE_URI,source:c.PHOTOLIBRARY}))}}}]);var cordovaConnectionApp=angular.module("ag.mobile-sdk.cordova.connection",[]);cordovaConnectionApp.factory("connectionService",["$timeout",function(a){var b=[],c=void 0,d=function(){if(c!==navigator.connection.type){c=navigator.connection.type;for(var e=b.length-1;e>=0;e--)void 0!==b[e]?b[e](c):b.splice(e,1)}a(d,1e4)};return d(),{onConnectionChange:function(a){"function"==typeof a&&b.push(a)},isOnline:function(){return navigator.connection.type!==Connection.NONE},isMobile:function(){return navigator.connection.type===Connection.CELL||navigator.connection.type===Connection.CELL_2G||navigator.connection.type===Connection.CELL_3G||navigator.connection.type===Connection.CELL_4G}}}]);var cordovaGeolocationApp=angular.module("ag.mobile-sdk.cordova.geolocation",["ag.sdk.utilities"]);cordovaGeolocationApp.factory("geolocationService",["promiseService",function(a){function b(a,b){switch(a){case PositionError.PERMISSION_DENIED:return e.PermissionDenied;case PositionError.POSITION_UNAVAILABLE:return e.PositionUnavailable;case PositionError.TIMEOUT:return e.Timeout;default:return{err:"Unknown",msg:b}}}var c=navigator.geolocation,d={enableHighAccuracy:!0},e={PermissionDenied:{err:"PermissionDenied",msg:"Not authorizated to request position"},PositionUnavailable:{err:"PositionUnavailable",msg:"Unable to receive position"},Timeout:{err:"Timeout",msg:"Unable to receive position within timeout"},Unknown:{err:"Unknown",msg:"An unknown error occured"}};return{getPosition:function(e){"object"!=typeof e&&(e={}),e=_.defaults(e,d);var f=a.defer();return c.getCurrentPosition(function(a){f.resolve(a)},function(a){f.reject(b(a.code,a.msg))},e),f.promise},watchPosition:function(a,e){function f(){var d=void 0;this.start=function(){void 0===d&&(d=c.watchPosition(function(a){e(a)},function(a){e(null,b(a.code,a.msg))},a))},this.cancel=function(){void 0!==d&&(c.clearWatch(d),d=void 0)},this.start()}return"function"==typeof a&&(e=a,a={}),"object"!=typeof a&&(a={}),a=_.defaults(a,d),new f}}}]);var cordovaStorageApp=angular.module("ag.mobile-sdk.cordova.storage",["ag.sdk.utilities"]);cordovaStorageApp.factory("fileStorageService",["$log","promiseService",function(a,b){var c=void 0,d={noFileSystem:{err:"NoFileSystem",msg:"Could not initialize file system"},directoryNotFound:{err:"directoryNotFound",msg:"Could not find requested directory"},fileNotFound:{err:"FileNotFound",msg:"Could not find requested file"},fileNotReadable:{err:"FileNotReadable",msg:"Could not read from file"},fileNotWritable:{err:"FileNotWritable",msg:"Could not write to file"}},e=function(a,b){void 0===c?window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(b){c=b,a()},b):a()},f=function(a,f){var g=b.defer(),h=function(a){g.resolve(a)},i=function(){g.reject(d.fileNotFound)};return e(function(){0===a.indexOf("file://")?window.resolveLocalFileSystemURI(a,h,i):c.root.getFile(a,f,h,i)},function(){g.reject(d.noFileSystem)}),g.promise};return a.log("Initialized storageService"),{exists:function(a){var c=b.defer();return f(a,{create:!1}).then(function(a){c.resolve({exists:!0,file:a.name})},function(a){c.reject(a)}),c.promise},read:function(a,c){var e=b.defer();return f(a,{create:!1}).then(function(a){a.file(function(b){var f=new FileReader;f.onloadend=function(){e.resolve({read:!0,file:a.name,content:f.result})},f.onerror=function(){e.reject(d.fileNotReadable)},c===!0?f.readAsDataURL(b):f.readAsText(b)},function(){e.reject(d.fileNotFound)})},function(a){e.reject(a)}),e.promise},copy:function(a,e){var g=b.defer();return f(a,{create:!1}).then(function(a){c.root.getDirectory(e,{create:!0,exclusive:!1},function(b){a.copyTo(b,a.name,function(a){g.resolve({copy:!0,file:a.name,path:a.fullPath})},function(){g.reject(d.fileNotFound)})},function(){g.reject(d.directoryNotFound)})},function(a){g.reject(a)}),g.promise},move:function(a,e){var g=b.defer();return f(a,{create:!1}).then(function(a){c.root.getDirectory(e,{create:!0,exclusive:!1},function(b){a.moveTo(b,a.name,function(a){g.resolve({move:!0,file:a.name,path:a.fullPath})},function(){g.reject(d.fileNotFound)})},function(){g.reject(d.directoryNotFound)})},function(a){g.reject(a)}),g.promise},write:function(a,c){var e=b.defer();return f(a,{create:!0}).then(function(a){a.createWriter(function(b){b.onwriteend=function(){e.resolve({write:!0,file:a.name})},b.onerror=function(){e.reject(d.fileNotWritable)},b.write(c)},function(){e.reject(d.fileNotFound)})},function(a){e.reject(a)}),e.promise},remove:function(a){var c=b.defer();return f(a,{create:!1}).then(function(a){a.remove(function(){c.resolve({remove:!0,file:a.name})},function(){c.reject(d.fileNotFound)})},function(a){c.reject(a)}),c.promise}}}]);var mobileSdkApiApp=angular.module("ag.mobile-sdk.api",["ag.sdk.utilities","ag.sdk.monitor","ag.mobile-sdk.data","ag.mobile-sdk.cordova.storage"]),_errors={TypeParamRequired:{code:"TypeParamRequired",message:"Type parameter is required"},UploadPhotoError:{code:"UploadPhotoError",message:"Error occured uploading photo"}};mobileSdkApiApp.factory("dataUploadService",["promiseMonitor","promiseService","farmerApi","farmApi","assetApi","documentApi","taskApi","attachmentApi",function(a,b,c,d,e,f,g,h){function i(){return s.add(b.wrap(function(a){c.getFarmers().then(function(c){b.arrayWrap(function(a){angular.forEach(c,function(c){a.push(b.wrap(function(a){l(c).then(function(){b.all([m(c.id),n(c.id)]).then(a.resolve,a.reject)})}))})}).then(a.resolve,a.reject)})}))}function j(){return s.add(b.wrap(function(a){f.getDocuments().then(function(c){b.arrayWrap(function(a){angular.forEach(c,function(b){a.push(p(b))})}).then(a.resolve,a.reject)})}))}function k(){return s.add(b.wrap(function(a){g.getTasks().then(function(c){b.arrayWrap(function(a){angular.forEach(c,function(c){a.push(b.wrap(function(a){g.getTasks({template:"task/:id/tasks",schema:{id:c.id}}).then(function(d){b.arrayWrap(function(a){angular.forEach(d,function(b){a.push(r(b))})}).then(function(){return r(c)},a.reject).then(a.resolve,a.reject)},a.reject)}))})}).then(a.resolve,a.reject)})}))}function l(a){return s.add(b.wrap(function(b){a.__dirty===!0?c.postFarmer({data:a}).then(b.resolve,b.reject):b.resolve()}))}function m(a){return s.add(b.wrap(function(c){d.getFarms({id:a}).then(function(a){b.arrayWrap(function(b){angular.forEach(a,function(a){a.__dirty===!0&&b.push(d.postFarm({data:a}))})}).then(c.resolve,c.reject)})}))}function n(a){return s.add(b.wrap(function(c){e.getAssets({id:a}).then(function(a){b.arrayWrap(function(b){angular.forEach(a,function(a){b.push(o(a))})}).then(c.resolve,c.reject)})}))}function o(a){return s.add(b.wrap(function(b){a.__dirty===!0?e.postAsset({data:a}).then(function(c){c&&1==c.length?q("asset",a.id,c[0].id).then(b.resolve,b.reject):b.resolve()},b.reject):b.resolve()}))}function p(a){return s.add(b.wrap(function(b){a.__dirty===!0?f.postDocument({data:a}).then(function(c){c&&1==c.length?q("document",a.id,c[0].id).then(b.resolve,b.reject):b.resolve()},b.reject):b.resolve()}))}function q(a,c,d){return s.add(b.wrap(function(e){h.getAttachments({template:a+"/:id/attachments",schema:{id:c}}).then(function(c){b.arrayWrap(function(b){angular.forEach(c,function(c){c.__dirty===!0&&(c.uri=a+"/"+d+"/attachments",b.push(h.postAttachment({template:a+"/:id/attach",schema:{id:d},data:c})))})}).then(e.resolve,e.reject)})}))}function r(a){return s.add(b.wrap(function(b){a.__dirty===!0?g.postTask({template:"task/:id",schema:{id:a.id},data:a}).then(b.resolve,b.reject):b.resolve()}))}var s=null;return function(c){return s=c||a(),b.wrap(function(a){i().then(j).then(k).then(a.resolve,a.reject)})}}]),mobileSdkApiApp.factory("dataDownloadService",["promiseMonitor","promiseService","farmApi","assetUtility","farmerUtility","documentUtility","taskUtility",function(a,b,c,d,e,f,g){function h(){return m.add(b.wrap(function(a){e.api.getFarmers({options:n}).then(function(a){return b.arrayWrap(function(b){angular.forEach(a,function(a){b.push(e.hydration.dehydrate(a),i(a.id))})})},a.reject).then(a.resolve,a.reject)}))}function i(a){return m.add(b.wrap(function(c){d.api.getAssets({id:a,options:n}).then(function(a){return b.arrayWrap(function(b){angular.forEach(a,function(a){b.push(d.hydration.dehydrate(a))})})},c.reject).then(c.resolve,c.reject)}))}function j(){return m.add(b.wrap(function(a){f.api.getDocuments({options:n}).then(function(a){return b.arrayWrap(function(b){angular.forEach(a,function(a){b.push(f.hydration.dehydrate(a))})})},a.reject).then(a.resolve,a.reject)}))}function k(a,b){return b=b||n,m.add(f.api.getDocument({id:a,options:b}))}function l(){return m.add(b.wrap(function(a){g.api.getTasks({options:n}).then(function(a){return b.arrayWrap(function(b){angular.forEach(a,function(a){b.push(k(a.documentId,{readLocal:!0,fallbackRemote:!0})),b.push(g.hydration.dehydrate(a))})})},a.reject).then(a.resolve,a.reject)}))}var m=null,n={readLocal:!1,readRemote:!0};return function(c){return m=c||a(),b.wrap(function(a){h().then(j).then(l).then(a.resolve,a.reject)})}}]),mobileSdkApiApp.factory("dataSyncService",["promiseMonitor","promiseService","dataUploadService","dataDownloadService",function(a,b,c,d){var e=null;return function(f){e=a(f),e.add(b.wrap(function(a){c(e).then(function(){d(e).then(a.resolve,a.reject)},a.reject)}))}}]),mobileSdkApiApp.factory("api",["promiseService","dataStore",function(a,b){return function(c){"String"==typeof c?c={singular:c,plural:c+"s"}:void 0===c.plural&&(c.plural=c.singular+"s");var d=b(c.singular,{apiTemplate:c.singular+"/:id"});return{getItems:function(b){return b=b||{},a.wrap(function(a){d.transaction(function(d){b.template?d.getItems({template:b.template,schema:b.schema,options:b.options,callback:a}):b.search?(b.options.readLocal=!1,b.options.readRemote=!0,d.getItems({template:c.plural+"?search=:query",schema:{query:b.search},options:b.options,callback:a})):d.getItems(b.id?{template:c.plural+"/:id",schema:{id:b.id},options:b.options,callback:a}:{template:c.plural,options:b.options,callback:a})})})},createItem:function(b){return b=b||{},a.wrap(function(a){b.data?d.transaction(function(c){c.createItems({template:b.template,schema:b.schema,data:b.data,options:b.options,callback:a})}):a.resolve()})},getItem:function(b){return b=b||{},a.wrap(function(a){b.id?d.transaction(function(c){c.getItems({template:b.template,schema:{id:b.id},options:b.options,callback:a})}):a.resolve()})},findItem:function(b){return b=b||{},a.wrap(function(a){b.key?d.transaction(function(c){c.findItems({key:b.key,column:b.column,options:b.options,callback:a})}):a.resolve()})},updateItem:function(b){return b=b||{},a.wrap(function(a){b.data?d.transaction(function(c){c.updateItems({data:b.data,options:b.options,callback:a})}):a.resolve()})},postItem:function(b){return b=b||{},a.wrap(function(a){b.data?d.transaction(function(c){c.postItems({template:b.template,schema:b.schema,data:b.data,callback:a})}):a.resolve()})},deleteItem:function(b){return b=b||{},a.wrap(function(a){b.data?d.transaction(function(d){d.removeItems({template:c.singular+"/:id/delete",data:b.data,callback:a})}):a.resolve()})},purgeItem:function(b){return b=b||{},a.wrap(function(a){b.template?d.transaction(function(c){c.purgeItems({template:b.template,schema:b.schema,callback:a})}):a.resolve()})}}}}]),mobileSdkApiApp.factory("userApi",["api",function(a){var b=a({plural:"users",singular:"user"});return{getUsers:b.getItems,createUser:b.createItem,getUser:b.getItem,findUser:b.findItem,updateUser:b.updateItem,postUser:b.postItem,deleteUser:b.deleteItem}}]),mobileSdkApiApp.factory("teamApi",["api",function(a){var b=a({plural:"teams",singular:"team"});return{getTeams:b.getItems,createTeam:b.createItem,getTeam:b.getItem,findTeam:b.findItem,updateTeam:b.updateItem,postTeam:b.postItem,deleteTeam:b.deleteItem}}]),mobileSdkApiApp.factory("notificationApi",["api",function(a){var b=a({plural:"notifications",singular:"notification"});return{getNotifications:b.getItems,getNotification:b.getItem,deleteNotification:b.deleteItem}}]),mobileSdkApiApp.factory("taskApi",["api",function(a){var b=a({plural:"tasks",singular:"task"});return{getTasks:b.getItems,createTask:b.createItem,getTask:b.getItem,findTask:b.findItem,updateTask:b.updateItem,postTask:b.postItem,deleteTask:b.deleteItem,purgeTask:b.purgeItem}}]),mobileSdkApiApp.factory("merchantApi",["api",function(a){var b=a({plural:"merchants",singular:"merchant"});return{getMerchants:b.getItems,createMerchant:b.createItem,getMerchant:b.getItem,updateMerchant:b.updateItem,postMerchant:b.postItem,deleteMerchant:b.deleteItem}
}]),mobileSdkApiApp.factory("farmerApi",["api",function(a){var b=a({plural:"farmers",singular:"farmer"});return{getFarmers:b.getItems,createFarmer:b.createItem,getFarmer:b.getItem,findFarmer:b.findItem,updateFarmer:b.updateItem,postFarmer:b.postItem,deleteFarmer:b.deleteItem,purgeFarmer:b.purgeItem}}]),mobileSdkApiApp.factory("legalEntityApi",["api",function(a){var b=a({plural:"legalentities",singular:"legalentity"});return{getEntities:b.getItems,createEntity:b.createItem,getEntity:b.getItem,findEntity:b.findItem,updateEntity:b.updateItem,postEntity:b.postItem,deleteEntity:b.deleteItem,purgeEntity:b.purgeItem}}]),mobileSdkApiApp.factory("farmApi",["api",function(a){var b=a({plural:"farms",singular:"farm"});return{getFarms:b.getItems,createFarm:b.createItem,getFarm:b.getItem,findFarm:b.findItem,updateFarm:b.updateItem,postFarm:b.postItem,deleteFarm:b.deleteItem,purgeFarm:b.purgeItem}}]),mobileSdkApiApp.factory("assetApi",["api",function(a){var b=a({plural:"assets",singular:"asset"});return{getAssets:b.getItems,createAsset:b.createItem,getAsset:b.getItem,findAsset:b.findItem,updateAsset:b.updateItem,postAsset:b.postItem,deleteAsset:b.deleteItem,purgeAsset:b.purgeItem}}]),mobileSdkApiApp.factory("documentApi",["api",function(a){var b=a({plural:"documents",singular:"document"});return{getDocuments:b.getItems,createDocument:b.createItem,getDocument:b.getItem,findDocument:b.findItem,updateDocument:b.updateItem,postDocument:b.postItem,deleteDocument:b.deleteItem,purgeDocument:b.purgeItem}}]),mobileSdkApiApp.factory("attachmentApi",["$http","$log","api","configuration","dataStoreUtilities","promiseService","fileStorageService",function(a,b,c,d,e,f,g){var h=c({plural:"attachments",singular:"attachment"});return{getAttachments:h.getItems,createAttachment:h.createItem,getAttachment:h.getItem,findAttachment:h.findItem,updateAttachment:h.updateItem,postAttachment:function(c){return c=c||{},f.wrap(function(f){if(c.data){var i=c.data,j="api/"+(void 0!==c.template?e.parseRequest(c.template,c.schema):i.uri);g.read(i.src,!0).then(function(b){var c={archive:e.extractMetadata(i).data};return c.archive.content=b.content.substring(b.content.indexOf(",")+1),a.post(d.getServer()+j,c,{withCredentials:!0})},f.reject).then(function(){b.log("update attachment"),i.__local=!1,h.updateItem({data:i,options:{dirty:!1}}).then(f.resolve,f.reject)},f.reject)}else f.reject()})},deleteAttachment:function(a){return a=a||{data:{}},a.data.__local=!0,h.deleteItem(a)},purgeAttachment:h.purgeItem}}]),mobileSdkApiApp.factory("activityApi",["api",function(a){var b=a({plural:"activities",singular:"activity"});return{getActivities:b.getItems,createActivity:b.createItem,getActivity:b.getItem,deleteActivity:b.deleteItem}}]),mobileSdkApiApp.factory("hydration",["promiseService","taskApi","farmerApi","farmApi","assetApi","documentApi","attachmentApi","legalEntityApi",function(a,b,c,d,e,f,g,h){var i={organization:{hydrate:function(b,d){return a.wrap(function(e){c.findFarmer({key:b.organizationId,options:{one:!0}}).then(function(b){a.all({farms:i.farms.hydrate(b,d),legalEntities:i.legalEntities.hydrate(b,d),assets:i.assets.hydrate(b,d)}).then(function(a){e.resolve(_.extend(b,a))},e.reject)},e.reject)})},dehydrate:function(a){return c.createFarmer({data:a.organization,options:{replace:!1,dirty:!1}})}},farms:{hydrate:function(a){return d.getFarms({id:a.__id})},dehydrate:function(b){return a.wrap(function(c){d.purgeFarm({template:"farms/:id",schema:{id:b.__id},options:{force:!1}}).then(function(){a.arrayWrap(function(a){angular.forEach(b.farms,function(c){a.push(d.createFarm({template:"farms/:id",schema:{id:b.__id},data:c,options:{replace:!1,dirty:!1}}))})}).then(c.resolve,c.reject)},c.reject)})}},farm:{hydrate:function(a){return d.findFarm({key:a.farmId,options:{one:!0}})}},assets:{hydrate:function(a){return e.getAssets({id:a.__id})},dehydrate:function(b){return a.wrap(function(c){e.purgeAsset({template:"assets/:id",schema:{id:b.__id},options:{force:!1}}).then(function(){a.arrayWrap(function(a){angular.forEach(b.assets,function(c){a.push(e.createAsset({template:"assets/:id",schema:{id:b.__id},data:c,options:{replace:!1,dirty:!1}}))})}).then(c.resolve,c.reject)},c.reject)})}},legalEntities:{hydrate:function(a){return h.getEntities({id:a.__id})},dehydrate:function(b){return a.wrap(function(c){h.purgeEntity({template:"legalentities/:id",schema:{id:b.__id},options:{force:!1}}).then(function(){a.arrayWrap(function(a){angular.forEach(b.legalEntities,function(c){delete c.assets,a.push(h.createEntity({template:"legalentities/:id",schema:{id:b.__id},data:c,options:{replace:!1,dirty:!1}}))})}).then(c.resolve,c.reject)},c.reject)})}},legalEntity:{hydrate:function(a){return h.findEntity({key:a.legalEntityId,options:{one:!0}})}},document:{hydrate:function(a){return f.findDocument({key:a.documentId,options:{one:!0}})},dehydrate:function(a){return f.createDocument({data:a.document,options:{replace:!1,dirty:!1}})}},attachments:{hydrate:function(a,b){return g.getAttachments({template:b+"/:id/attachments",schema:{id:a.__id}})},dehydrate:function(b,c){return a.wrap(function(d){g.purgeAttachment({template:c+"/:id/attachments",schema:{id:b.__id},options:{force:!1}}).then(function(){a.arrayWrap(function(a){b.data&&b.data.attachments?angular.forEach(b.data.attachments,function(d){a.push(g.createAttachment({template:c+"/:id/attachments",schema:{id:b.__id},data:d,options:{replace:!1,dirty:!1}}))}):d.resolve()}).then(d.resolve,d.reject)},d.reject)})}},subtasks:{hydrate:function(a){return b.getTasks({template:"task/:id/tasks",schema:{id:a.__id}})},dehydrate:function(c){return a.wrap(function(d){b.purgeTask({template:"task/:id/tasks",schema:{id:c.__id},options:{force:!1}}).then(function(){a.arrayWrap(function(a){angular.forEach(c.subtasks,function(d){a.push(b.createTask({template:"task/:id/tasks",schema:{id:c.__id},data:d,options:{replace:!1,dirty:!1}}))})}).then(d.resolve,d.reject)},d.reject)})}}},j=function(b,c,d){return d=d||[],a.wrap(function(e){a.objectWrap(function(a){angular.forEach(d,function(d){var e=i[d];e&&e.hydrate&&(a[d]=e.hydrate(b,c))})}).then(function(a){e.resolve(_.extend(b,a))},function(a){e.resolve(_.extend(b,a))})})},k=function(b,c,d){return d=d||[],a.wrap(function(e){a.objectWrap(function(a){angular.forEach(d,function(d){var e=i[d];e&&e.dehydrate&&(a[d]=e.dehydrate(b,c))})}).then(function(){angular.forEach(d,function(a){delete b[a]}),e.resolve(b)},function(){e.reject()})})};return{hydrate:j,dehydrate:k}}]),mobileSdkApiApp.factory("taskUtility",["promiseService","hydration","taskApi",function(a,b,c){var d=["organization","document","subtasks"];return{hydration:{hydrate:function(e,f){return f=f||d,a.wrap(function(a){"object"!=typeof e?c.findTask({key:e,options:{one:!0}}).then(function(c){b.hydrate(c,"task",f).then(a.resolve,a.reject)},a.reject):b.hydrate(e,"task",f).then(a.resolve,a.reject)})},dehydrate:function(a,e){return e=e||d,b.dehydrate(a,"task",e).then(function(a){c.updateTask({data:a,options:{dirty:!1}})})}},api:c}}]),mobileSdkApiApp.factory("farmerUtility",["promiseService","hydration","farmerApi",function(a,b,c){var d=["farms","legalEntities","assets"];return{hydration:{hydrate:function(e,f){return f=f||d,a.wrap(function(a){"object"!=typeof e?c.findFarmer({key:e,options:{one:!0}}).then(function(c){b.hydrate(c,"farmer",f).then(a.resolve,a.reject)},a.reject):b.hydrate(e,"farmer",f).then(a.resolve,a.reject)})},dehydrate:function(a,e){return e=e||d,angular.forEach(a.teams,function(b,c){"object"==typeof b&&(a.teams[c]=b.name)}),b.dehydrate(a,"farmer",e).then(function(a){c.updateFarmer({data:a,options:{dirty:!1}})})}},api:c}}]),mobileSdkApiApp.factory("assetUtility",["promiseService","hydration","assetApi",function(a,b,c){var d=["attachments","farm","legalEntity"];return{hydration:{hydrate:function(e,f){return f=f||d,a.wrap(function(a){"object"!=typeof e?c.findAsset({key:e,options:{one:!0}}).then(function(c){b.hydrate(c,"asset",f).then(function(b){b.attachments&&(b.data.attachments=b.attachments,delete b.attachments),a.resolve(b)},a.reject)},a.reject):b.hydrate(e,"asset",f).then(function(b){b.attachments&&(b.data.attachments=b.attachments,delete b.attachments),a.resolve(b)},a.reject)})},dehydrate:function(a,e){return e=e||d,b.dehydrate(a,"asset",e).then(function(a){delete a.data.attachments,c.updateAsset({data:a,options:{dirty:!1}})})}},api:c}}]),mobileSdkApiApp.factory("documentUtility",["promiseService","hydration","documentApi",function(a,b,c){var d=["organization","attachments"];return{hydration:{hydrate:function(e,f){return f=f||d,a.wrap(function(a){"object"!=typeof e?c.findDocument({key:e,options:{one:!0}}).then(function(c){b.hydrate(c,"document",f).then(function(b){b.attachments&&(b.data.attachments=b.attachments,delete b.attachments),a.resolve(b)},a.reject)},a.reject):b.hydrate(e,"document",f).then(function(b){b.attachments&&(b.data.attachments=b.attachments,delete b.attachments),a.resolve(b)},a.reject)})},dehydrate:function(a,e){return e=e||d,b.dehydrate(a,"document",e).then(function(a){delete a.tasks,delete a.data.attachments,c.updateDocument({data:a,options:{dirty:!1}})})}},api:c}}]);var mobileSdkDataApp=angular.module("ag.mobile-sdk.data",["ag.sdk.utilities","ag.sdk.config","ag.sdk.monitor"]);mobileSdkDataApp.provider("dataPurge",function(){this.$get=["promiseService","dataStore",function(a,b){function c(c){return a.wrap(function(a){var d=b(c);d.transaction(function(b){b.purgeItems({callback:a})})})}return function(b){return a.wrapAll(function(a){for(var d=0;d<b.length;d++)a.push(c(b[d]))})}}]}),mobileSdkDataApp.factory("dataStoreUtilities",["$log",function(a){return{parseRequest:function(b,c){if(a.log("Unresolved: "+b),void 0!==b)for(var d in c)if(c.hasOwnProperty(d)){var e=void 0!==c[d]?c[d]:"";b=b.replace(":"+d,e)}return a.log("Resolved: "+b),b},generateItemIndex:function(){return 2e9+Math.round(147483647*Math.random())},injectMetadata:function(a){return _.extend("object"==typeof a.data?a.data:JSON.parse(a.data),{__id:a.id,__uri:a.uri,__dirty:1==a.dirty,__local:1==a.local})},extractMetadata:function(a){return{id:a.__id,uri:a.__uri,dirty:a.__dirty,local:a.__local,data:_.omit(a,["__id","__uri","__dirty","__local"])}}}}]),mobileSdkDataApp.provider("dataStore",[function(){var a,b={pageLimit:10,dbName:void 0,readLocal:!0,readRemote:!0},c={NoStoreParams:{code:"NoStoreParams",message:"No DataStore parameters defined"},NoConfigDBNameParams:{code:"NoConfigDBNameParams",message:"No Config database name defined"},NoConfigAPIParams:{code:"NoConfigAPIParams",message:"No Config API parameters defined"},NoConfigPagingParams:{code:"NoConfigPagingParams",message:"No Config Paging parameters defined"},NoReadParams:{code:"NoReadParams",message:"No DataRead parameters defined"},NoPagingDefined:{code:"NoPagingDefined",message:"No Paging parameters have been defined in config"},LocalDataStoreError:{code:"LocalDataStoreError",message:"Can not perform action on local data store"},RemoteDataStoreError:{code:"RemoteDataStoreError",message:"Can not perform action on remote data store"},RemoteNoDataError:{code:"RemoteNoDataError",message:"No data response from remote store"}};this.config=function(a){b=_.defaults(a||{},b)},this.$get=["$http","$log","$q","$rootScope","safeApply","configuration","dataStoreUtilities",function(d,e,f,g,h,i,j){function k(a){function c(b){if(e.log("_processMigration"),d.length>0){var f=d[0];d.splice(0,1),f.current===b.version?(e.log("Database ("+b.version+") has a newer version "+f.next),b.changeVersion(f.current,f.next,f.process,_errorCallback,function(){e.log("Database version migrated from "+f.current+" to "+f.next),c(b)})):c(b)}else a(b)}var d=[];c(window.openDatabase(b.dbName,"",b.dbName,4194304))}function l(f,g){function i(b){var c=new p(2,b);a.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS "+f+" (id INT UNIQUE, uri TEXT, dirty INT DEFAULT 0, local INT DEFAULT 0, data TEXT, updated TIMESTAMP DEFAULT current_timestamp)",[],c.done,n),a.executeSql("CREATE TRIGGER IF NOT EXISTS "+f+"_timestamp AFTER UPDATE ON "+f+" BEGIN UPDATE "+f+"  SET updated = datetime('now') WHERE id = old.id AND uri = old.uri; END",[],c.done,n)})}function k(b){a.transaction(function(a){a.executeSql("DELETE FROM "+f,[],function(){b(!0)},function(){b(!1)})})}function n(a,b){"undefined"==typeof b&&(b=a,a=void 0),e.warn("string"==typeof b?"Error: "+b:void 0!==b.message?"Error: "+b.message+"("+b.code+")":b)}function o(a,b){return void 0===a[r.indexerProperty]&&e.warn("Configured indexer property not defined"),a[r.indexerProperty]||a.id||b}function p(a,b){return this instanceof p?{done:function(){a--,0==a&&b&&b.apply(this,arguments)}}:new p(a,b)}function q(){return this instanceof q?{createItems:function(a){var b=_.defaults(a||{},{template:r.apiTemplate,schema:{},data:[],options:{replace:!0,force:!1,dirty:!0},callback:angular.noop});b.data instanceof Array==!1&&(b.data=[b.data]);var c=new p(b.data.length,function(a,c){E(b.callback,a,c)});angular.forEach(b.data,function(a){var d=o(a,j.generateItemIndex());v(j.injectMetadata({id:d,uri:j.parseRequest(b.template,_.defaults(b.schema,{id:d})),data:a,dirty:b.options.dirty,local:b.options.dirty}),b.options,c.done)})},getItems:function(a){var d=_.defaults(a||{},{template:r.apiTemplate,schema:{},options:{page:1,limit:b.pageLimit,readLocal:r.readLocal,readRemote:r.readRemote,fallbackRemote:!1},callback:angular.noop}),e=function(a){y(a,function(b){b?u(b,a,function(a,b){E(d.callback,a,b)}):s(a,d.options,function(a,b){E(d.callback,a,b)})})};if("object"==typeof d.schema){var f=j.parseRequest(d.template,d.schema);d.options.readRemote===!0?e(f):d.options.readLocal===!0&&s(f,d.options,function(a,b){0==a.length&&d.options.fallbackRemote===!0?e(f):E(d.callback,a,b)})}else E(d.callback,null,c.NoReadParams)},findItems:function(a){var b=_.defaults(a||{},{key:"",column:"id",options:{like:!1,one:!1},callback:angular.noop});t(b.key,b.column,b.options,function(a,c){E(b.callback,a,c)})},updateItems:function(a){var b=_.defaults(a||{},{data:[],options:{dirty:!0},callback:angular.noop});b.data instanceof Array==!1&&(b.data=[b.data]),b.options.dirty&&angular.forEach(b.data,function(a){a.__dirty=!0}),v(b.data,b.options,function(a,c){E(b.callback,a,c)})},postItems:function(a){var b=_.defaults(a||{},{template:r.apiTemplate,schema:{},data:[],callback:angular.noop});b.data instanceof Array==!1&&(b.data=[b.data]),z(b.data,b.template,b.schema,function(a,c){E(b.callback,a,c)})},removeItems:function(a){var b=_.defaults(a||{},{template:void 0,schema:{},data:[],callback:angular.noop});b.data instanceof Array==!1&&(b.data=[b.data]);var c=new p(b.data.length,function(a,c){E(b.callback,a,c)});angular.forEach(b.data,function(a){a.__local===!0?w(a,c.done):A(a,b.template,b.schema,c.done)})},purgeItems:function(a){var b=_.defaults(a||{},{template:void 0,schema:{},options:{force:!0},callback:angular.noop});if(void 0!==b.template){var c=j.parseRequest(b.template,b.schema);s(c,b.options,function(a){var c=[];angular.forEach(a,function(a){(0==a.__dirty||1==b.options.force)&&c.push(a)}),w(c,function(a,c){E(b.callback,a,c)})})}else k(function(a,c){E(b.callback,a,c)})}}:new q}if(!(this instanceof l))return new l(f,g);if("string"!=typeof f)throw new Error(c.NoStoreParams.msg);if(void 0===b.dbName)throw new Error(c.NoConfigDBNameParams.msg);var r=_.defaults(g||{},{apiTemplate:void 0,paging:void 0,indexerProperty:"id",readLocal:b.readLocal,readRemote:b.readRemote});void 0!==r.paging&&(r.paging=_.defaults(r.paging,{template:"",schema:{},data:{page:1,limit:b.pageLimit}}));var s=function(b,d,g){e.log("_getLocal"),"function"!=typeof g&&(g=angular.noop),a.transaction(function(a){a.executeSql("SELECT * FROM "+f+" WHERE uri = ?",[b],function(a,b){if(b.rows.length>0)if(d.one)g(j.injectMetadata(b.rows.item(0)));else{for(var c=[],e=0;e<b.rows.length;e++)c.push(j.injectMetadata(b.rows.item(e)));g(c)}else g(d.one?void 0:[])},function(a,b){n(a,b),g(null,c.LocalDataStoreError)})})},t=function(b,c,d,g){e.log("_findLocal"),"function"!=typeof g&&(g=angular.noop),a.transaction(function(a){a.executeSql("SELECT * FROM "+f+" WHERE "+c+" "+(d.like?"LIKE":"=")+" ?",[d.like?"%"+b+"%":b],function(a,b){if(b.rows.length>0)if(d.one)g(j.injectMetadata(b.rows.item(0)));else{for(var c=[],e=0;e<b.rows.length;e++)c.push(j.injectMetadata(b.rows.item(e)));g(c)}else g(d.one?void 0:[])},function(a,b){g(null,b)})})},u=function(a,b,c){e.log("_syncLocal"),"function"!=typeof c&&(c=angular.noop),x(b,function(){v(a,function(){s(b,{},c)})})},v=function(b,c,d){if(e.log("_updateLocal"),"function"==typeof c&&(d=c,c={}),"function"!=typeof d&&(d=angular.noop),b instanceof Array==!1&&(b=[b]),b.length>0){c=_.defaults(c||{},{replace:!0,force:!1});var g=new p(b.length,function(){d(b)});a.transaction(function(a){for(var d=0;d<b.length;d++){var e=j.extractMetadata(b[d]),h=JSON.stringify(e.data);a.executeSql("INSERT INTO "+f+" (id, uri, data, dirty, local) VALUES (?, ?, ?, ?, ?)",[e.id,e.uri,h,e.dirty?1:0,e.local?1:0],g.done,function(a){c.replace===!0?e.dirty===!0||e.local===!0||c.force?a.executeSql("UPDATE "+f+" SET uri = ?, data = ?, dirty = ?, local = ? WHERE id = ?",[e.uri,h,e.dirty?1:0,e.local?1:0,e.id],g.done,n):a.executeSql("UPDATE "+f+" SET uri = ?, data = ?, dirty = ?, local = ? WHERE id = ? AND dirty = 0 AND local = 0",[e.uri,h,e.dirty?1:0,e.local?1:0,e.id],g.done,n):g.done()})}})}else d(b)},w=function(b,c){if(e.log("_deleteLocal"),b instanceof Array==!1&&(b=[b]),b.length>0){var d=new p(b.length,c);a.transaction(function(a){for(var c=0;c<b.length;c++){var e=j.extractMetadata(b[c]);a.executeSql("DELETE FROM "+f+" WHERE id = ? AND uri = ?",[e.id,e.uri],d.done,function(b){n(a,b),d.done()})}})}else c(b)},x=function(b,c,d){e.log("_deleteAllLocal"),"function"==typeof c&&(d=c,c={}),c=_.defaults(c||{},{force:!1});var g=new p(1,d),h=function(){e.log("handleSuccess"),g.done()},i=function(a,b){e.log("handleError"),n(a,b),g.done()};e.log(b),a.transaction(function(a){e.log("_deleteAllLocal transaction"),c.force===!0?(e.log("_deleteAllLocal force"),a.executeSql("DELETE FROM "+f+" WHERE uri = ?",[b],h,i)):(e.log("_deleteAllLocal not force"),a.executeSql("DELETE FROM "+f+" WHERE uri = ? AND local = ? AND dirty = ?",[b,0,0],h,i))}),e.log("_deleteAllLocal end")},y=function(a,b){e.log("_getRemote"),"function"!=typeof b&&(b=angular.noop),void 0!==r.apiTemplate?h(function(){d.get(m+a,{withCredentials:!0}).then(function(d){if(null!=d.data&&"null"!==d.data){var e=d.data;if(e instanceof Array==!1)b([j.injectMetadata({id:o(e),uri:a,data:e,dirty:!1,local:!1})]);else{for(var f=[],g=0;g<e.length;g++){var h=e[g];f.push(j.injectMetadata({id:o(h),uri:a,data:h,dirty:!1,local:!1}))}b(f)}}else b(null,c.RemoteNoDataError)},function(a){n(a),b(null,c.RemoteDataStoreError)})}):b()},z=function(a,b,c,f){if(e.log("_updateRemote"),"function"==typeof c?(f=c,c={}):"function"==typeof b&&(f=b,c={},b=void 0),"function"!=typeof f&&(f=angular.noop),void 0!==a&&void 0!==r.apiTemplate){a instanceof Array==!1&&(a=[a]);for(var g=[],i=new p(a.length,function(){f(g)}),k=function(a,b){h(function(){d.post(m+b,a.data,{withCredentials:!0}).then(function(b){var c=j.injectMetadata({id:o(b.data,a.id),uri:a.uri,data:a.data,dirty:!1,local:!1});1==a.local&&(c.id=c.__id,w(a)),g.push(c),v(c,{force:!0},i.done)},function(a){n(a),i.done()})})},l=0;l<a.length;l++){var q=j.extractMetadata(a[l]);q.dirty===!0?q.local||void 0!==b?(q.local&&void 0!==q.data[r.indexerProperty]&&delete q.data[r.indexerProperty],k(q,j.parseRequest(b||r.apiTemplate,_.extend(c,{id:q.local?void 0:q.id})))):k(q,q.uri):i.done()}}else f()},A=function(a,b,c,f){if(e.log("_deleteRemote"),"function"==typeof c?(f=c,c={}):"function"==typeof b&&(f=b,c={},b=void 0),"function"!=typeof f&&(f=angular.noop),void 0!==a&&void 0!==b){a instanceof Array==!1&&(a=[a]);for(var g=new p(a.length,f),i=function(a,b){h(function(){d.post(m+b,{withCredentials:!0}).then(function(){w(a,g.done)},function(a){n(a),g.done()})})},k=0;k<a.length;k++){var l=j.extractMetadata(a[k]);l.local===!1?i(l,j.parseRequest(b,_.defaults(c,{id:l.id}))):g.done()}}else f()},B=!1,C=[],D=function(){if(void 0!==a)for(;C.length>0;){var b=C[0];b(new q),C.splice(0,1)}},E=function(a,b,c){void 0!==a&&("function"==typeof a?a(b,c):b?a.resolve(b):a.reject(c))};return i(function(){e.log("table initialized"),B=!0,D()}),{defaults:b,config:r,transaction:function(a){"function"==typeof a&&(C.push(a),D())}}}var m=i.getServer()+"api/";return k(function(b){a=b,e.log("database initialized")}),function(a,b){return new l(a,b)}}]}]),angular.module("ag.sdk.helper",["ag.sdk.helper.asset","ag.sdk.helper.document","ag.sdk.helper.farmer","ag.sdk.helper.favourites","ag.sdk.helper.merchant","ag.sdk.helper.task","ag.sdk.helper.team","ag.sdk.helper.user"]),angular.module("ag.sdk.interface",["ag.sdk.interface.list","ag.sdk.interface.map","ag.sdk.interface.navigation"]),angular.module("ag.sdk.test",["ag.sdk.test.data"]),angular.module("ag.mobile-sdk",["ag.sdk.authorization","ag.sdk.id","ag.sdk.utilities","ag.sdk.monitor","ag.sdk.interface.map","ag.sdk.helper","ag.sdk.test","ag.mobile-sdk.helper","ag.mobile-sdk.api","ag.mobile-sdk.data"]);