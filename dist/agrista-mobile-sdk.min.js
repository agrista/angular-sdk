var sdkAuthorizationApp=angular.module("ag.sdk.authorization",["ag.sdk.config","ag.sdk.utilities"]);sdkAuthorizationApp.factory("authorizationApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{login:function(c,e){return b.wrap(function(b){a.post(d+"login",{email:c,password:e}).then(function(a){b.resolve(a.data)},b.reject)})},resetPassword:function(c,e){return b.wrap(function(b){a.post(d+"api/password-reset",{hash:c,password:e}).then(function(a){b.resolve(a.data)},b.reject)})},requestResetPasswordEmail:function(c){return b.wrap(function(b){a.post(d+"api/password-reset-email",{email:c}).then(function(a){b.resolve(a.data)},b.reject)})},changePassword:function(c,e,f){return b.wrap(function(b){a.post(d+"api/user/password",{password:e,newPassword:f}).then(function(a){b.resolve(a.data)},b.reject)})},getUser:function(){return b.wrap(function(b){a.get(d+"current-user",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},registerUser:function(c){return b.wrap(function(b){a.post(d+"api/register",c).then(function(a){b.resolve(a.data)},b.reject)})},logout:function(){return a.post(d+"logout")}}}]),sdkAuthorizationApp.provider("authorization",["$httpProvider",function(a){var b={open:1,user:2,admin:4},c={open:b.open|b.user|b.admin,user:b.user|b.admin,admin:b.admin},d={email:"",role:b.open},e=void 0;return a.interceptors.push(["$q","$injector","$rootScope",function(a,b,c){return{responseError:function(b){return 401===b.status&&c.$broadcast("authorization::unauthorized"),a.reject(b)}}}]),{userRole:b,accessLevel:c,$get:["$rootScope","authorizationApi","localStore","promiseService",function(a,f,g,h){function i(){return g.getItem("user")||d}function j(a){return a=a||d,void 0===a.role&&(a.role="admin"==a.accessLevel?b.admin:b.user),g.setItem("user",a),a}var k=i();return f.getUser().then(function(b){null!==b.user?(k=j(b.user),a.$broadcast("authorization::login",k)):k.isActive!==!0&&a.$broadcast("authorization::unauthorized")}),{userRole:b,accessLevel:c,lastError:function(){return e},currentUser:function(){return k},isAllowed:function(a){return 0!=(a&k.role)},isLoggedIn:function(){return 0!=(c.user&k.role)},login:function(b,c){return h.wrap(function(g){f.login(b,c).then(function(b){null!==b.user?(e=void 0,k=j(b.user),g.resolve(k),a.$broadcast("authorization::login",k)):(e={type:"error",message:"The entered e-mail and/or password is incorrect. Please try again."},k=j(d),g.reject())},function(a){k=j(d),g.reject(a)})})},requestResetPasswordEmail:f.requestResetPasswordEmail,resetPassword:f.resetPassword,changePassword:function(a,b){return f.changePassword(k.id,a,b)},changeUserDetails:function(a){return f.updateUser(k.id,a).then(function(){k=j(a)})},register:function(b){return h.wrap(function(c){f.registerUser(b).then(function(b){null!==b?(e=void 0,k=j(b),c.resolve(k),a.$broadcast("authorization::login",k)):(k=j(d),c.reject())},function(a){e={type:"error",message:"There is already an Agrista account associated with this email address. Please login."},k=j(d),c.reject(a)})})},logout:function(){return a.$broadcast("authorization::logout"),f.logout().then(function(){k=j(d)})}}}]}}]);var sdkConfigApp=angular.module("ag.sdk.config",[]);sdkConfigApp.provider("configuration",["$httpProvider",function(a){var b="",c="local",d=[],e={local:"",testing:"https://uat.enterprise.agrista.com/",staging:"https://staging.enterprise.agrista.com/",production:"https://enterprise.agrista.com/"},f=function(a){return-1!==d.indexOf(a)},g=function(a){0==f(a)&&d.push(a)};return{addModule:g,hasModule:f,setServers:function(a){angular.forEach(a,function(a,b){a.lastIndexOf("/")!==a.length-1&&(a+="/"),e[b]=a}),this.useHost(c,b)},useHost:function(d,f,g){"function"==typeof f&&(g=f,f=""),b=f||"",void 0!==e[d]&&(c=d,a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]),"function"==typeof g&&g(e[c])},$get:function(){return{addModule:g,hasModule:f,getVersion:function(){return b},getHost:function(){return c},getServer:function(){return e[c]}}}}}]);var sdkIdApp=angular.module("ag.sdk.id",["ag.sdk.utilities"]);sdkIdApp.factory("objectId",["localStore",function(a){var b=function(){function c(){return this instanceof b?void("object"==typeof arguments[0]?(this.timestamp=arguments[0].timestamp,this.machine=arguments[0].machine,this.pid=arguments[0].pid,this.increment=arguments[0].increment):"string"==typeof arguments[0]&&24==arguments[0].length?(this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))):4==arguments.length&&null!=arguments[0]?(this.timestamp=arguments[0],this.machine=arguments[1],this.pid=arguments[2],this.increment=arguments[3]):(this.timestamp=Math.floor((new Date).valueOf()/1e3),this.machine=f,this.pid=e,this.increment=d++,d>16777215&&(d=0))):new b(arguments[0],arguments[1],arguments[2],arguments[3]).toString()}var d=0,e=Math.floor(32767*Math.random()),f=Math.floor(16777216*Math.random()),g=parseInt(a.getItem("mongoMachineId"));return g>=0&&16777215>=g&&(f=Math.floor(a.getItem("mongoMachineId"))),a.setItem("mongoMachineId",f),c}();return b.prototype.getDate=function(){return new Date(1e3*this.timestamp)},b.prototype.toArray=function(){var a,b=this.toString(),c=[];for(a=0;12>a;a++)c[a]=parseInt(b.slice(2*a,2*a+2),16);return c},b.prototype.toString=function(){var a=this.timestamp.toString(16),b=this.machine.toString(16),c=this.pid.toString(16),d=this.increment.toString(16);return"00000000".substr(0,8-a.length)+a+"000000".substr(0,6-b.length)+b+"0000".substr(0,4-c.length)+c+"000000".substr(0,6-d.length)+d},b.prototype.toBase64String=function(){return window.btoa(this.toString())},function(){return new b}}]),sdkIdApp.factory("generateUUID",function(){function a(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:7&c|8).toString(16)});return b}return function(){return a()}});var sdkLibraryApp=angular.module("ag.sdk.library",[]);sdkLibraryApp.constant("underscore",window._),sdkLibraryApp.constant("geojsonUtils",window.gju);var sdkMonitorApp=angular.module("ag.sdk.monitor",["ag.sdk.utilities"]);sdkMonitorApp.factory("promiseMonitor",["$log","safeApply",function(a,b){function c(d){if(!(this instanceof c))return new c(d);var e={total:0,complete:0,resolved:0,rejected:0,percent:0},f=function(){e.complete++,e.percent=100/e.total*e.complete,a.debug("MONITOR TOTAL: "+e.total+" COMPLETE: "+e.complete+" PERCENT: "+e.percent),b(function(){d(e.complete==e.total?{type:"complete",percent:e.percent,stats:e}:{type:"progress",percent:e.percent,stats:e})})};return{stats:function(){return e},clear:function(){e={total:0,complete:0,resolved:0,rejected:0,percent:0}},add:function(a){return e.total++,a.then(function(){e.resolved++,f()},function(a){e.rejected++,b(function(){d({type:"error"},a)}),f()}),a}}}return function(a){return new c(a)}}]);var skdUtilitiesApp=angular.module("ag.sdk.utilities",["ngCookies"]);skdUtilitiesApp.factory("safeApply",["$rootScope",function(a){return function(b){a.$$phase?b():a.$apply(b)}}]),skdUtilitiesApp.factory("dataMapService",[function(){return function(a,b,c){var d=[];a instanceof Array==!1&&(a=void 0!==a?[a]:[]);for(var e=0;e<a.length;e++){var f,g=a[e];if("function"==typeof b)f=b(g);else{f={};for(var h in b)b.hasOwnProperty(h)&&(f[h]=g[b[h]])}f instanceof Array?d=d.concat(f):"object"==typeof f?(c!==!0&&(f.id=f.id||g.id),d.push(f)):void 0!==f&&d.push(f)}return d}}]),skdUtilitiesApp.factory("pagingService",["$rootScope","$http","promiseService","dataMapService",function(a,b,c,d){return{initialize:function(b,e,f){f=f||function(b){a.$broadcast("paging::items",b)};var g={page:{limit:50},busy:!1,complete:!1,disabled:function(){return g.busy||g.complete},request:function(){return c.wrap(function(a){g.busy=!0,b(g.page).then(function(b){g.page=b.paging,g.complete=void 0===g.page,g.busy=!1,void 0!==g.page&&(b=b.data),e&&(b=d(b,e)),f(b),a.resolve(b)},a.reject)})}};return g},page:function(a,d){return c.wrap(function(c){var e=function(a){c.resolve(a.data)};void 0!==d?"string"==typeof d?b.get(d,{withCredentials:!0}).then(e,c.reject):b.get(a,{params:d,withCredentials:!0}).then(e,c.reject):b.get(a,{withCredentials:!0}).then(e,c.reject)})}}}]),skdUtilitiesApp.factory("promiseService",["$q","safeApply",function(a,b){var c=function(){var c=a.defer();return{resolve:function(a){b(function(){c.resolve(a)})},reject:function(a){b(function(){c.reject(a)})},promise:c.promise}},d=function(b,c){var d=c;return b(d),a.all(d)};return{all:function(b){return a.all(b)},wrap:function(a){var b=c();return a(b),b.promise},wrapAll:function(a){return d(a,[])},arrayWrap:function(a){return d(a,[])},objectWrap:function(a){return d(a,{})},defer:c}}]),skdUtilitiesApp.factory("localStore",["$cookieStore","$window",function(a,b){return{setItem:function(c,d){b.localStorage?b.localStorage.setItem(c,JSON.stringify(d)):a.put(c,d)},getItem:function(c){return b.localStorage?JSON.parse(b.localStorage.getItem(c)):a.get(c)},removeItem:function(c){b.localStorage?b.localStorage.removeItem(c):a.remove(c)}}}]),skdUtilitiesApp.directive("signature",["$compile",function(a){return{restrict:"E",replace:!0,template:'<div class="panel panel-default signature"><div class="panel-heading">{{ title }}<div class="btn btn-default btn-sm pull-right" ng-click="reset()">Clear</div></div></div>',scope:{onsigned:"=",name:"@",title:"@"},link:function(b,c,d){var e=a('<div class="panel-body signature-body"></div>')(b);c.append(e),b.reset=function(){e.jSignature("reset"),b.onsigned(d.name,null)},e.jSignature({width:d.width,height:d.height,showUndoButton:!1}),e.bind("change",function(){b.onsigned(d.name,e.jSignature("getData","svgbase64"))})}}}]);var sdkHelperAssetApp=angular.module("ag.sdk.helper.asset",["ag.sdk.helper.farmer","ag.sdk.library"]);sdkHelperAssetApp.factory("assetHelper",["$filter","landUseHelper","underscore",function(a,b,c){var d=function(b,d){var e={id:b.id||b.__id,type:b.type,updatedAt:b.updatedAt};if(b.data&&("crop"==b.type?(e.title=(b.data.plantedArea?b.data.plantedArea.toFixed(2)+"Ha of ":"")+(b.data.crop?b.data.crop:"")+(b.data.fieldName?" on field "+b.data.fieldName:""),e.subtitle=b.data.season?b.data.season:"",e.groupby=b.farmId):"farmland"==b.type?(e.title=0==b.data.portionNumber?"Remainder of farm":"Portion "+b.data.portionNumber,e.subtitle="Area: "+b.data.area.toFixed(2)+"Ha",e.groupby=b.farmId):"improvement"==b.type?(e.title=b.data.name,e.subtitle=b.data.type+" - "+b.data.category,e.summary=b.data.description||"",e.groupby=b.farmId):"irrigated cropland"==b.type?(e.title=b.data.irrigation+(b.data.fieldName?" on field "+b.data.fieldName:""),e.subtitle="Equipped Area: "+b.data.size.toFixed(2)+"Ha",e.groupby=b.farmId):"livestock"==b.type?(e.title=b.data.type+" - "+b.data.category,e.subtitle=(b.data.breed?b.data.breed+" for ":"For ")+b.data.purpose,e.summary=b.data.description||"",e.groupby=b.data.type):"pasture"==b.type?(e.title=(b.data.crop?b.data.crop:"Natural")+(b.data.fieldName?" on field "+b.data.fieldName:""),e.subtitle=b.data.plantedDate?"Planted: "+a("date")(b.data.plantedDate,"dd/MM/yy"):"",e.groupby=b.farmId):"permanent crop"==b.type?(e.title=b.data.crop+(b.data.fieldName?" on field "+b.data.fieldName:""),e.subtitle=b.data.establishedDate?"Established: "+a("date")(b.data.establishedDate,"dd/MM/yy"):"",e.groupby=b.farmId):"plantation"==b.type?(e.title=b.data.crop+(b.data.fieldName?" on field "+b.data.fieldName:""),e.subtitle=b.data.establishedDate?"Established: "+a("date")(b.data.establishedDate,"dd/MM/yy"):"",e.groupby=b.farmId):"vme"==b.type?(e.title=b.data.category+(b.data.model?" model "+b.data.model:""),e.subtitle="Quantity: "+b.data.quantity,e.summary=b.data.description||"",e.groupby=b.data.type):"water right"==b.type&&(e.title=b.data.waterSource+(b.data.fieldName?" on field "+b.data.fieldName:""),e.subtitle="Irrigatable Extent: "+b.data.size.toFixed(2)+"Ha",e.groupby=b.farmId),b.data.attachments))for(var f=["png","jpg","jpeg","gif"],g=0;g<b.data.attachments.length;g++)for(var h=b.data.attachments[g],i=0;i<f.length;i++)-1!=h.key.indexOf(f[i])&&(e.image=h.src);return d&&(e=c.extend(e,d)),e},e={crop:"Crops",farmland:"Farmlands",improvement:"Fixed Improvements","irrigated cropland":"Irrigated Cropland",livestock:"Livestock",pasture:"Pastures","permanent crop":"Permanent Crops",plantation:"Plantations",vme:"Vehicles, Machinery & Equipment","water right":"Water Rights"},f={improvement:["Livestock & Game","Crop Cultivation & Processing","Residential","Business","Equipment & Utilities","Infrastructure","Recreational & Misc."],livestock:["Cattle","Sheep","Pigs","Chickens","Ostriches","Goats"],vme:["Vehicles","Machinery","Equipment"]},g={improvement:{"Livestock & Game":["Abattoir","Animal Cages","Animal Camp","Animal Feedlot","Animal Growing House","Animal Handling Equiment","Animal Handling Facility","Animal Pens","Animal Sale Facility","Animal Shelter","Animal Stable","Anti-Poaching Training Facility","Arena","Auction Facilities","Aviary","Barn","Beekeeping Room","Bottling Facility","Breeding Facility","Broiler House","Broiler House - Atmosphere","Broiler House - Semi","Broiler Unit","Cheese Factory","Chicken Coop","Chicken Run","Cooling Facility","Crocodile Dams","Dairy","Deboning Room","Dry Oven","Dry Storage","Drying Facility","Drying Ovens","Drying Racks","Drying Strips","Drying Tunnels","Egg Grading Facility","Egg Packaging Building","Elephant Enclosures","Embryo Room","Feed Dispensers","Feed Mill","Feed Storeroom","Feeding Lot","Feeding Pens","Feeding Shelter","Feeding Troughs","Filter Station","Fish Market Buildings","Flavour Shed","Game Cage Facility","Game Lodge","Game Pens","Game Room","Game Slaughter Area","Game Viewing Area","Grading Room","Handling Facilities","Hatchery","Hide Store","Hing Pen","Horse Walker","Hunters","Hide Storeroom","Inspection Room","Kennels","Kraal","Laying Hen House","Maternity House","Maternity Pens","Meat Processing Facility","Milk Bottling Plant","Milk Tank Room","Milking Parlour","Other","Packaging Complex","Packaging Facility","Paddocks","Pasteurising Facility","Pens","Pig Sty","Poison Store","Post-Feeding Shed","Processing Facility","Quarantine Area","Racing Track","Rankin Game","Refrigeration Facility","Rehab Facility","Saddle Room","Sales Facility","Selling Kraal","Shearing Facility","Shed","Shelter","Shooting Range","Skinning Facility","Slaughter Facility","Sorting Facility","Stable","Stall","Stock Handling Facility","Storage Facility","Sty","Surgery","Treatment Area","Trout Dam","Warehouse"],"Crop Cultivation & Processing":["Crop Cultivation & Processing","Barrel Maturation Room","Bottling Facility","Carton Shed","Cellar","Chemical Shed","Compost Pasteurising Unit","Compost Preparing Unit","Cooling Facility","Crushing Plant","Dark Room","Degreening Room","Dehusking Shed","Dry Oven","Dry Sow House","Dry Storage","Drying Facility","Drying Ovens","Drying Racks","Drying Strips","Drying Tunnels","Farrowing House","Fertilizer Shed","Flavour Shed","Food Plant Shed","Fruit Dry Tracks","Fruit Hopper","Gardening Facility","Germination Facility","Grading Room","Grain Handling Equipment","Grain Loading Facility","Grain Mill","Grain Silos","Grain Store","Greenhouse","Grower Unit","Handling Facilities","Hopper","Hothouse","Igloo","Inspection Room","Irrigation Dam","Irrigation Pump","Irrigation Reservoir","Irrigation System","Mill","Milling Store","Mushroom Cultivation Building","Mushroom Sweat Room","Nursery (Plant)","Nut Cracking Facility","Nut Factory","Oil Store","Onion Drying Shed","Other","Packaging Complex","Packaging Facility","Pesticide Store","Poison Store","Processing Facility","Refrigeration Facility","Sales Facility","Seed Store","Seedling Growing Facility","Seedling Packaging Facility","Shed","Silo","Sorting Facility","Sprinklers","Storage Facility","Tea Drying Facility","Tea Room","Tobacco Dryers","Warehouse","Wine Cellar","Wine Storage Shed","Wine Tanks","Winery Building"],Residential:["Ablution Facility","Accommodation Units","Attic","Balcony","Bathroom","Bedroom","Building","Bungalow","Bunk House","Cabin","Camp Accommodation","Canteen","Caretaker's Dwelling","Chalet","Cloak Room","Community Dwelling","Cottage","Dining Area","Dining Facility","Dormitory","Dressing Rooms","Drivers' Accommodation","Dwelling","Estate House","Flat","Foreman's Dwelling","Game Lodge","Guest Accommodation","Homestead","Hostels","House","Hunters' Accommodation","Hunters' Kitchen","Hut","Kitchen","Lapa","Lean-to","Lodge","Loft","Log Cabin","Longdavel","Lounge","Luncheon Areas","Luxury Accommodation","Manager's Dwelling","Manor House","Maternity House","Other","Owner's Dwelling","Parlor","Shed","Shower","Staff Ablutions","Staff Accommodation","Staff Building","Staff Compound","Staff Dining Facility","Stoop","Tavern","Teachers' Dwellings","Toilet - Outdoor","Toilet Block","Toilets","Toilets - Staff","Veranda","Winemakers' Dwelling","Workers' Ablutions","Workers' Accommodation","Workers' Kitchen","Workers' School"],Business:["Ablution Facility","Administration Block","Administrative Building","Administrative Offices","Animal Sale Facility","Auction Facilities","Barrel Maturation Room","Bathroom","Bottling Facility","Building","Charcoal Factory","Cheese Factory","Cloak Room","Cloth House","Commercial Buildings","Conference Facility","Cooling Facility","Distribution Centre","Factory Building","Fish Market Buildings","Functions Centre","Furniture Factory","Grading Room","Industrial Warehouse","Inspection Room","Ironing Room","Kiosk","Laboratory","Laundry Facility","Lean-to","Liquor Store","Loading Area","Loading Bay","Loading Platform","Loading Shed","Locker Room","Lockup Shed","Mechanical Workshop","Office","Office Building","Office Complex","Other","Packaging Complex","Packaging Facility","Pallet Factory","Pallet Stacking Area","Pill Factory","Processing Facility","Reception Area","Refrigeration Facility","Sales Facility","Saw Mill","Security Office","Shed","Shop","Sorting Facility","Staff Building","Staff Compound","Storage Facility","Studio","Toilet - Outdoor","Toilet Block","Toilets","Toilets - Client","Toilets - Office","Toilets - Staff","Transport Depot","Warehouse","Wine Cellar","Wine Shop","Wine Tasting Room","Winery Building","Work Station","Workers' Ablutions","Workers' Accommodation","Workers' Kitchen","Workers' School","Workshop"],"Equipment & Utilities":["Air Conditioners","Aircraft Hangar","Backup Generator","Boiler Room","Borehole","Borehole - Equipped","Borehole - Pump","Bulk Tank Room","Caravan Room","Carport","Carport - Double","Carton Shed","Chemical Shed","Compressor Room","Control Hut","Cooling Facility","Diesel Room","Electricity Room","Engine Room","Equipment Stores","Eskom Transformer","Filter Station","Fuel Depot","Fuel Store","Fuel Tank","Garage","Garage - Double","Garage - Triple","Generator Room","Hangar","Helipad","Hydro Tanks","Hydrophonic Pond","Laying Hen House Equipment","Machinery Room","Mechanical Workshop","Oil Store","Other","Oven","Petrol Storage","Poison Store","Power Room","Pump","Pump House Equipment","Pumphouse","Refuelling Canopy","Scale","Shed","Solar Power Room","Tank Stand","Tanks","Tool Shed","Tractor Shed","Transformer Room","Transport Depot","Truck Shelter","Truck Wash","Turbine Room","Twin Engine Generator Unit","Tyre Shed","Utility Building","Utility Room","Water Purification Plant","Water Reticulation Works","Water Storage Tanks","Water Tower"],Infrastructure:["Ablution Facility","Access Roads","All Infrastructure","Attic","Balcony","Barn","Bathroom","Bedroom","Bell Arch","Bin Compartments","Boiler Room","Borehole","Borehole - Equipped","Borehole - Pump","Building","Bulk Tank Room","Bunker","Canopy","Canteen","Cellar","Classroom","Cloak Room","Concrete Slab","Concrete Surfaces","Courtyard","Covered Area","Dam","Dam - Filter","Debris Filter Pond","Deck","Driveway","Electric Fencing","Electric Gate","Electricity Room","Entrance Building","Entrance Gate","Fencing","Fencing (Game)","Fencing (Perimeter)","Fencing (Security)","Flooring","Foyer","Gate","Gate - Sliding","Gate House","Gazebo","Guardhouse","Hall","House","Hut","Hydro Tanks","Hydrophonic Pond","Infrastructure","Irrigation Dam","Irrigation Pump","Irrigation Reservoir","Irrigation System","Kiosk","Kitchen","Koi Pond","Kraal","Laboratory","Landing Strip","Laundry Facility","Lean-to","Lockup Shed","Longdavel","Mezzanine","Other","Outbuilding","Outdoor Room","Outhouse","Parking Area","Parlor","Patio","Paving","Pens","Poles","Pool Facility","Pool House","Porch","Porte Cochere","Reservoir","Reservoir Pumphouse","Reservoir Tower","Road Stall","Rondavel","Roofing","Room","Ruin","Runway","Security Office","Shade Netting","Shade Port","Shed","Shooting Range","Shower","Silo","Slab","Splash Pool","Sprinklers","Stable","Stoop","Storage Facility","Studio","Surrounding Works","Tarmac","Tarred Area","Tarred Road Surfaces","Terrace","Toilet - Outdoor","Toilet Block","Toilets","Toilets - Client","Toilets - Office","Toilets - Staff","Trench","Tunnel","Tunnel Building","Vacant Areas","Veranda","Walkways","Walls","Walls (Boundary)","Walls (Retaining)","Walls (Security)","Warehouse","Water Feature","Water Storage Tanks","Water Tower","Wire Enclosures","Work Station"],"Recreational & Misc.":["Anti-Poaching Training Facility","Archive Room","Arena","Art Gallery","Bar","Barrel Maturation Room","BBQ","BBQ Facility","CafÃ©","Canteen","Caravan Room","Chapel","Church","Church Facility","Classroom","Cloth House","Clubhouse","Coffee Shop","Community Centre","Compost Pasteurising Unit","Compost Preparing Unit","Dark Room","Entertainment Area","Entertainment Facility","Functions Centre","Funeral Building","Furniture Factory","Gallery","Game Room","Golf Clubhouse","Gymnasium","Helipad","Hydro Tanks","Hydrophonic Pond","Igloo","Ironing Room","Jacuzzi","Judging Booth","Kiosk","Koi Pond","Laundry Facility","Liquor Store","Locker Room","Lounge","Luncheon Areas","Museum","Nursery School","Nursing Home","Other","Parlor","Pill Factory","Play Area","Pool Facility","Pool House","Pottery Room","Pub","Reception Area","Recreation Facility","Rehab Facility","Restaurant","Retirement Centre","Salon","Sauna","Saw Mill","School","Spa Baths","Spa Complex","Splash Pool","Squash Court","Sulphur Room","Surgery","Swimming Pool - Indoor","Swimming Pool - Outdoor","Swimming Pool Ablution","Tavern","Tea Room","Tennis Court","Treatment Area","Trout Dam","Venue Hall","Vitamin Room","Wedding Venue","Weigh Bridge","Weigh Bridge Control Room","Wellness Centre","Windmill"]},livestock:{Cattle:{Breeding:["Phase A Bulls","Phase B Bulls","Phase C Bulls","Phase D Bulls","Heifers","Bull Calves","Heifer Calves","Tollies 1-2","Heifers 1-2","Culls"],Dairy:["Bulls","Dry Cows","Lactating Cows","Heifers","Calves","Culls"],Slaughter:["Bulls","Cows","Heifers","Weaners","Calves","Culls"]},Sheep:{Breeding:["Rams","Young Rams","Ewes","Young Ewes","Lambs","Wethers","Culls"],Slaughter:["Rams","Ewes","Lambs","Wethers","Culls"]},Pigs:{Slaughter:["Boars","Breeding Sows","Weaned pigs","Piglets","Porkers","Baconers","Culls"]},Chickens:{Broilers:["Day Old Chicks","Broilers"],Layers:["Hens","Point of Laying Hens","Culls"]},Ostriches:{Slaughter:["Breeding Stock","Slaughter Birds > 3 months","Slaughter Birds < 3 months","Chicks"]},Goats:{Slaughter:["Rams","Breeding Ewes","Young Ewes","Kids"]}},vme:{Vehicles:["Bakkie","Car","Truck","Tractor"],Machinery:["Mower","Mower Conditioner","Hay Rake","Hay Baler","Harvester"],Equipment:["Plough","Harrow","Ridgers","Rotovator","Cultivator","Planter","Combine","Spreader","Sprayer","Mixer"]}},h=["Good","Good to fair","Fair","Fair to poor","Poor"],i={livestock:{Cattle:["Breeding","Dairy","Slaughter"],Sheep:["Breeding","Slaughter"],Pigs:["Slaughter"],Chickens:["Broilers","Layers"],Ostriches:["Slaughter"],Goats:["Slaughter"]}},j=["Cape","Summer","Fruit","Winter"],k={crop:["Cropland"],farmland:b.landUseTypes(),improvement:[],"irrigated cropland":["Cropland"],livestock:["Grazing","Planted Pastures","Conservation"],pasture:["Grazing","Planted Pastures","Conservation"],"permanent crop":["Horticulture (Perennial)"],plantation:["Plantation"],vme:[],"water right":b.landUseTypes()},l={crop:"Field Crops",horticulture:"Horticulture",livestock:"Livestock"},m={crop:["Barley","Cabbage","Canola","Chicory","Citrus (Hardpeel)","Cotton","Cow Peas","Dry Bean","Dry Grapes","Dry Peas","Garlic","Grain Sorghum","Green Bean","Ground Nut","Hybrid Maize Seed","Lentils","Lucerne","Maize (Fodder)","Maize (Green)","Maize (Seed)","Maize (White)","Maize (Yellow)","Oats","Onion","Onion (Seed)","Popcorn","Potato","Pumpkin","Rye","Soya Bean","Sugar Cane","Sunflower","Sweetcorn","Tobacco","Tobacco (Oven dry)","Tomatoes","Watermelon","Wheat"],horticulture:["Almonds","Apples","Apricots","Avo","Avocado","Bananas","Cherries","Chilli","Citrus (Hardpeel Class 1)","Citrus (Softpeel)","Coffee","Figs","Grapes (Table)","Grapes (Wine)","Guavas","Hops","Kiwi Fruit","Lemons","Macadamia Nut","Mango","Mangos","Melons","Nectarines","Olives","Oranges","Papaya","Peaches","Peanut","Pears","Pecan Nuts","Persimmons","Pineapples","Pistachio Nuts","Plums","Pomegranates","Prunes","Quinces","Rooibos","Strawberries","Triticale","Watermelons"],livestock:["Cattle (Extensive)","Cattle (Feedlot)","Cattle (Stud)","Chicken (Broilers)","Chicken (Layers)","Dairy","Game","Goats","Horses","Ostrich","Pigs","Sheep (Extensive)","Sheep (Feedlot)","Sheep (Stud)"]};return{assetTypes:function(){return e},seasonTypes:function(){return j},listServiceMap:function(){return d},getAssetTitle:function(a){return e[a]},getAssetSubtypes:function(a){return f[a]||[]},getAssetCategories:function(a,b){return g[a]?g[a][b]||[]:[]},getAssetPurposes:function(a,b){return i[a]?i[a][b]||[]:[]},getCommodities:function(a){return m[a]||""},commodityTypes:function(){return l},commodities:function(){return m},conditionTypes:function(){return h},isFieldApplicable:function(a,b){var c=k[a]&&-1!==k[a].indexOf(b.landUse);return"irrigated cropland"==a?c&&b.irrigated:c},cleanAssetData:function(a){return"vme"==a.type&&(a.data.quantity=a.data.identificationNo&&a.data.identificationNo.length>0?1:a.data.quantity,a.data.identificationNo=1!=a.data.quantity?"":a.data.identificationNo),a},calculateValuation:function(a,b){return"vme"==a.type&&0==isNaN(a.data.quantity)?b.assetValue=a.data.quantity*(b.unitValue||0):"livestock"==a.type&&0==isNaN(b.totalStock)?b.assetValue=b.totalStock*(b.unitValue||0):"crop"==a.type&&0==isNaN(b.expectedYield)?b.assetValue=b.expectedYield*(b.unitValue||0):"improvement"!=a.type&&0==isNaN(a.data.size)&&(b.assetValue=a.data.size*(b.unitValue||0)),b}}}]),sdkHelperAssetApp.factory("assetValuationHelper",function(){var a=function(a){if(a.data&&a.data.valuations){var b=[];return angular.forEach(a.data.valuations,function(a){var c={title:a.organization.name,date:a.date};b.push(c)}),b}};return{listServiceMap:function(){return a},calculateValuation:function(a,b){return"vme"==a.type&&0==isNaN(a.data.quantity)?b.assetValue=a.data.quantity*(b.unitValue||0):"livestock"==a.type&&0==isNaN(b.totalStock)?b.assetValue=b.totalStock*(b.unitValue||0):"crop"==a.type&&0==isNaN(b.expectedYield)?b.assetValue=b.expectedYield*(b.unitValue||0):"improvement"!=a.type&&0==isNaN(a.data.size)&&(b.assetValue=a.data.size*(b.unitValue||0)),b}}});var sdkHelperCropInspectionApp=angular.module("ag.sdk.helper.crop-inspection",["ag.sdk.helper.document"]);sdkHelperCropInspectionApp.factory("cropInspectionHelper",["documentHelper",function(a){var b=["Approved","Not Approved","Not Planted"],c=[["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12","R13","R14"],["V0","V1","V2","V3","V4","V5","R1","R2","R3","R4","R5","R6"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","R1","R2","R3","R4","R5","R6","R7","R8","R9"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","V17","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","V17","V18","V19","V20","V21","V22","V23","V24","V25","V26","V27","V28","R1","R2","R3","R4","R5","R6","R7","R8"],["V0","V1","V2","V3","V4","V5","V6","V7","R1","R2","R3","R4","R5","R6","R7","R8","R9"],["V0","V1","V2","V3","V4","V5","V6","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12","R13","R14","R15","R16","R17","R18"],["V0","V1","V2","V3","V4","R1","R2","R3","R4","R5","R6"],["V0","V1","V2","V3","V4","V5","V6","V7","R1","R2","R3","R4","R5","R6"]],d={Barley:c[1],Bean:c[5],"Bean (Broad)":c[5],"Bean (Dry)":c[5],"Bean (Sugar)":c[5],"Bean (Green)":c[5],"Bean (Kidney)":c[5],Canola:c[7],Cotton:c[6],"Grain Sorghum":c[3],Maize:c[0],"Maize (White)":c[0],"Maize (Yellow)":c[0],Soybean:c[2],Sunflower:c[4],Wheat:c[1],"Wheat (Durum)":c[1]},e={emergence:"Emergence Inspection",hail:"Hail Inspection",harvest:"Harvest Inspection",preharvest:"Pre Harvest Inspection",progress:"Progress Inspection"},f=[["Maize Commodity","Maize Hybrid","Maize Silo Fodder"]],g={Maize:f[0],"Maize (White)":f[0],"Maize (Yellow)":f[0]},h={hail:"Hail","multi peril":"Multi Peril"},i={hail:{hail:e.hail},"multi peril":e},j={disease:"Disease",fading:"Fading",uneven:"Uneven",other:"Other",root:"Root",shortage:"Shortage",weed:"Weed"},k=function(b){var c=a.listServiceWithTaskMap()(b);return c&&b.data.request&&(c.subtitle=c.title+" - "+b.data.enterprise,c.title=b.documentId,c.group=e[b.data.inspectionType]||""),c};return{listServiceMap:function(){return k},approvalTypes:function(){return b},inspectionTypes:function(){return e},policyTypes:function(){return h},policyInspectionTypes:function(a){return i[a]||{}},problemTypes:function(){return j},getGrowthStages:function(a){return d[a]||c[0]},getSeedTypes:function(a){return g[a]},getInspectionTitle:function(a){return e[a]||""},getPolicyTitle:function(a){return h[a]||""},getProblemTitle:function(a){return j[a]||""},hasSeedTypes:function(a){return void 0!==g[a]}}}]);var sdkHelperDocumentApp=angular.module("ag.sdk.helper.document",["ag.sdk.helper.task","ag.sdk.library"]);sdkHelperDocumentApp.provider("documentHelper",function(){var a=[],b={},c=function(a,b){return 1!=b?a.lastIndexOf("y")==a.length-1?a.substr(0,a.length-1)+"ies":a+"s":a};this.registerDocuments=function(c){c instanceof Array==!1&&(c=[c]),angular.forEach(c,function(c){-1===a.indexOf(c.docType)&&a.push(c.docType),c.deletable=c.deletable===!0,c.state=c.state||"document."+c.docType.replace(" ","-"),b[c.docType]=c})},this.getDocument=function(a){return b[a]},this.$get=["$injector","taskHelper","underscore",function(d,e,f){var g=function(a){if(b[a.docType]){var c=b[a.docType],e={id:a.id||a.__id,title:a.author?a.author:"",subtitle:"",docType:a.docType,group:c.title,updatedAt:a.updatedAt};return a.organization&&a.organization.name&&(e.subtitle=a.author?"From "+a.author+": ":"",e.title=a.organization.name),a.data&&c&&c.listServiceMap&&(c.listServiceMap instanceof Array&&(c.listServiceMap=d.invoke(c.listServiceMap)),c.listServiceMap(e,a)),e}},h=function(a){if(b[a.docType]){var c=g(a),d=f.findWhere(a.tasks,{type:"parent"});return c&&d&&(c.status={text:d.status,label:e.getTaskLabel(d.status)}),c}};return{listServiceMap:function(){return g},listServiceWithTaskMap:function(){return h},pluralMap:function(a,b){return c(a,b)},documentTypes:function(){return a},documentTitles:function(){return f.pluck(b,"title")},getDocumentTitle:function(a){return b[a]?b[a].title:void 0},getDocumentState:function(a){return b[a]?b[a].state:void 0},getDocumentMap:function(a){return b[a]}}}]});var sdkHelperEnterpriseBudgetApp=angular.module("ag.sdk.helper.enterprise-budget",["ag.sdk.library"]);sdkHelperEnterpriseBudgetApp.factory("enterpriseBudgetHelper",["underscore",function(a){function b(a){a.data=a.data||{},a.data.income=a.data.income||{},a.data.expenses=a.data.expenses||{},a.data.products=a.data.products||{},a.data.total=a.data.total||{}
}var c=function(a){return{id:a.id||a.__id,title:a.name,subtitle:a.commodityType+(a.region&&a.region.properties?" in "+a.region.properties.name:"")}},d={crop:"Field Crop",livestock:"Livestock",horticulture:"Horticulture"},e=["Seed","Plant Material","Fertiliser","Lime","Herbicides","Pesticides","Fuel","Repairs & parts","Electricity","Water","Scheduling","Crop Insurance (Hail)","Crop Insurance (Multiperil)","Summer lick","Winter lick","Veterinary costs","Marketing costs","Transport","Storage","Packaging material","Drying and cleaning","Packing cost","Casual labour","Contact work (Harvest)","Hedging cost","Fuel","Repairs & parts","Electricity","License","Insurance assets","Permanent labour","Other costs"],f={crop:[e[0],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[22],e[23],e[24],e[25],e[26],e[27],e[30],e[31]],livestock:[e[13],e[14],e[15],e[16],e[17],e[22],e[25],e[26],e[27],e[28],e[29],e[30],e[31]],horticulture:[e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[16],e[17],e[18],e[19],e[20],e[21],e[22],e[25],e[26],e[27],e[28],e[29],e[30],e[31]]},g={crop:{"Yield (t/Ha)":"yield","Price (R/Ha)":"price"},livestock:{Cattle:{Bulls:{incomeSubTypeVariableName:"bulls",perCattleVariableName:"perCattle",perUnitVariableName:"perUnit"},Heifers:{incomeSubTypeVariableName:"heifers",perCattleVariableName:"perCattle",perUnitVariableName:"perUnit"},"Cull cows":{incomeSubTypeVariableName:"cull cows",perCattleVariableName:"perCattle",perUnitVariableName:"perUnit"},Calves:{incomeSubTypeVariableName:"calves",perCattleVariableName:"perCattle",perUnitVariableName:"perUnit"}},Goat:{"Goats income 1":{incomeSubTypeVariableName:"goatsIncome1",perCattleVariableName:"perGoat",perUnitVariableName:"perUnit"},"Goats income 2":{incomeSubTypeVariableName:"goatsIncome2",perCattleVariableName:"perGoat",perUnitVariableName:"perUnit"},"Goats income 3":{incomeSubTypeVariableName:"goatsIncome3",perCattleVariableName:"perGoat",perUnitVariableName:"perUnit"}}},horticulture:{"Yield (t/Ha)":"yield","Price (R/Ha)":"price"}},h={Bananas:["0-1","2-10"],Litchis:["0-1","2-3","4-5","6-19","20"],Mangos:["0-1","2","3","4","5-20"],Pineapples:["0-1","2"],Strawberries:["0-1","2"]};return{listServiceMap:function(){return c},getExpenseCategories:function(a){return f[a]||[]},getModelType:function(a){return d[a]||""},validateBudgetData:function(a){b(a);var c=f[a.assetType];return angular.forEach(a.data.expenses,function(b,d){"horticulture"==a.assetType?angular.forEach(b,function(b,e){(-1==c.indexOf(e)||"number"!=typeof b)&&(delete a.data.expenses[d][e],delete a.data.products[d][e])}):(-1==c.indexOf(d)||"number"!=typeof b)&&(delete a.data.expenses[d],delete a.data.products[d])}),this.calculateTotals(a)},addExpenseCategory:function(a,b,c){return"horticulture"==a.assetType?-1!=f[a.assetType].indexOf(b)&&void 0===a.data.expenses[c][b]&&(a.data.expenses[c][b]=0,a=this.calculateTotals(a)):-1!=f[a.assetType].indexOf(b)&&void 0===a.data.expenses[b]&&(a.data.expenses[b]=0,a=this.calculateTotals(a)),a},removeExpenseCategory:function(a,b,c){return"horticulture"==a.assetType?(delete a.data.expenses[c][b],delete a.data.products[b],this.calculateTotals(a)):(delete a.data.expenses[b],delete a.data.products[b],this.calculateTotals(a))},hasCategoryProducts:function(a,b){return void 0!==a.data.products&&void 0!==a.data.products[b]},getIncomeList:function(a,b){return"crop"==a||"horticulture"==a?g[a]:"livestock"==a?g.livestock[b]:{}},getHorticultureStages:function(a,b){return"horticulture"==a?h[b]||[]:[]},calculateTotals:function(c){if(b(c),"crop"==c.assetType)0==isNaN(c.data.income.yield)&&0==isNaN(c.data.income.price)&&(c.data.total.income=0,c.data.total.expenses=0,c.data.total.income=c.data.income.yield*c.data.income.price,angular.forEach(c.data.expenses,function(b,d){void 0!==c.data.products[d]&&(b=a.reduce(c.data.products[d],function(a,b){return a+b.price},0)),c.data.expenses[d]=b,c.data.total.expenses+=b}),c.data.total.profit=c.data.total.income-c.data.total.expenses);else if("livestock"==c.assetType)g.livestock[c.commodityType]&&(c.data.total.income=0,c.data.total.expenses=0,angular.forEach(g.livestock[c.commodityType],function(a){c.data.total.income+=c.data.income[a.incomeSubTypeVariableName][a.perUnitVariableName]}),angular.forEach(c.data.expenses,function(b,d){void 0!==c.data.products[d]&&(b=a.reduce(c.data.products[d],function(a,b){return a+b.price},0)),c.data.expenses[d]=b,c.data.total.expenses+=b}),c.data.total.profit=c.data.total.income-c.data.total.expenses);else{c.data.total={};var d=h[c.commodityType]||[];d.forEach(function(b){c.data.total[b]={},c.data.total[b].income=c.data.total[b].income>0?c.data.total[b].income:0,c.data.total[b].expenses=c.data.total[b].expenses>0?c.data.total[b].expenses:0,c.data.total[b].income+=c.data.income[b].yield*c.data.income[b].price,angular.forEach(c.data.expenses[b],function(d,e){void 0!==c.data.products[e]&&(d=a.reduce(c.data.products[e],function(a,b){return a+b.price},0)),c.data.expenses[b][e]=d,c.data.total[b].expenses+=c.data.expenses[b][e]}),c.data.total[b].profit=c.data.total[b].income-c.data.total[b].expenses})}return c}}}]);var sdkHelperFarmerApp=angular.module("ag.sdk.helper.farmer",["ag.sdk.interface.map","ag.sdk.library"]);sdkHelperFarmerApp.factory("farmerHelper",["geoJSONHelper",function(a){var b=function(a){function b(a){var b=[];return angular.forEach(a.legalEntities,function(a){b.push(a.name),a.registrationNumber&&b.push(a.registrationNumber)}),b}return{id:a.id||a.__id,title:a.name,subtitle:a.operationType,profileImage:a.profilePhotoSrc,searchingIndex:b(a)}},c=["Commercial","Cooperative","Corporate","Smallholder"];return{listServiceMap:function(){return b},businessEntityTypes:function(){return c},getFarmerLocation:function(b){if(b){if(b.data&&b.data.loc)return b.data.loc.coordinates;if(b.legalEntities){var c=a();return angular.forEach(b.legalEntities,function(a){a.assets&&angular.forEach(a.assets,function(a){c.addGeometry(a.loc)})}),c.getCenter()}}return null}}}]),sdkHelperFarmerApp.factory("legalEntityHelper",["underscore",function(a){function b(b){this.enterprises=a.map(b||[],function(a){return a.name?a.name:a}),this.selection={category:void 0,item:void 0}}var c=function(a){return{id:a.id||a.__id,title:a.name,subtitle:a.type}},d=["Individual","Sole Proprietary","Joint account","Partnership","Close Corporation","Private Company","Public Company","Trust","Non-Profitable companies","Cooperatives","In- Cooperatives","Other Financial Intermediaries"],e={"Field Crops":["Barley","Cabbage","Canola","Chicory","Citrus (Hardpeel)","Cotton","Cow Peas","Dry Bean","Dry Grapes","Dry Peas","Garlic","Grain Sorghum","Green Bean","Ground Nut","Hybrid Maize Seed","Lentils","Lucerne","Maize (Fodder)","Maize (Green)","Maize (Seed)","Maize (White)","Maize (Yellow)","Oats","Onion","Onion (Seed)","Popcorn","Potato","Pumpkin","Rye","Soya Bean","Sugar Cane","Sunflower","Sweetcorn","Tobacco","Tobacco (Oven dry)","Tomatoes","Watermelon","Wheat"],Horticulture:["Almonds","Apples","Apricots","Avo","Avocado","Bananas","Cherries","Chilli","Citrus (Hardpeel Class 1)","Citrus (Softpeel)","Coffee","Figs","Grapes (Table)","Grapes (Wine)","Guavas","Hops","Kiwi Fruit","Lemons","Macadamia Nut","Mango","Mangos","Melons","Nectarines","Olives","Oranges","Papaya","Peaches","Peanut","Pears","Pecan Nuts","Persimmons","Pineapples","Pistachio Nuts","Plums","Pomegranates","Prunes","Quinces","Rooibos","Strawberries","Triticale","Watermelons"],Livestock:["Cattle (Extensive)","Cattle (Feedlot)","Cattle (Stud)","Chicken (Broilers)","Chicken (Layers)","Dairy","Game","Goats","Horses","Ostrich","Pigs","Sheep (Extensive)","Sheep (Feedlot)","Sheep (Stud)"]};return b.prototype.addEnterprise=function(a){a=a||this.selection.item,-1==this.enterprises.indexOf(a)&&(this.enterprises.push(a),this.selection.item=void 0)},b.prototype.removeEnterprise=function(a){"string"==typeof a&&(a=this.enterprises.indexOf(a)),-1!==a&&this.enterprises.splice(a,1)},{listServiceMap:function(){return c},legalEntityTypes:function(){return d},enterpriseTypes:function(){return e},enterpriseEditor:function(a){return new b(a)}}}]),sdkHelperFarmerApp.factory("landUseHelper",function(){var a=["High","Medium","Low"],b=["0 - 30cm","30 - 60cm","60 - 90cm","90 - 120cm","120cm +"],c=["Centre-Pivot","Flood","Micro","Sub-drainage","Sprinkler","Drip"],d=["Cropland","Grazing","Horticulture (Intensive)","Horticulture (Perennial)","Horticulture (Seasonal)","Housing","Plantation","Planted Pastures","Structures (Handling)","Structures (Processing)","Structures (Storage)","Utilities","Wasteland","Conservation"],e=["Sand","Loamy Sand","Clay Sand","Sandy Loam","Fine Sandy Loam","Loam","Silty Loam","Sandy Clay Loam","Clay Loam","Clay","Gravel","Other","Fine Sandy Clay","Medium Sandy Clay Loam","Fine Sandy Clay Loam","Loamy Medium Sand","Medium Sandy Loam","Coarse Sandy Clay Loam","Coarse Sand","Loamy Fine Sand","Loamy Coarse Sand","Fine Sand","Silty Clay","Coarse Sandy Loam","Medium Sand","Medium Sandy Clay","Coarse Sandy Clay","Sandy Clay"],f=["Plains","Mountains"],g=["Irrigation Scheme","River","Dam","Borehole"],h={Cropland:["Barley","Bean","Bean (Broad)","Bean (Dry)","Bean (Sugar)","Bean (Green)","Bean (Kidney)","Canola","Cassava","Cotton","Cowpea","Grain Sorghum","Groundnut","Maize","Maize (White)","Maize (Yellow)","Oats","Pearl Millet","Potato","Rape","Rice","Rye","Soybean","Sunflower","Sweet Corn","Sweet Potato","Tobacco","Triticale","Wheat","Wheat (Durum)"],Grazing:["Bahia-Notatum","Bottle Brush","Buffalo","Buffalo (Blue)","Buffalo (White)","Bush","Cocksfoot","Common Setaria","Dallis","Phalaris","Rescue","Rhodes","Smuts Finger","Tall Fescue","Teff","Veld","Weeping Lovegrass"],"Horticulture (Perennial)":["Almond","Aloe","Apple","Apricot","Avocado","Banana","Cherry","Coconut","Coffee","Grape","Grape (Bush Vine)","Grape (Red)","Grape (Table)","Grape (White)","Grapefruit","Guava","Hops","Kiwi Fruit","Lemon","Litchi","Macadamia Nut","Mandarin","Mango","Nectarine","Olive","Orange","Papaya","Peach","Pear","Pecan Nut","Persimmon","Pineapple","Pistachio Nut","Plum","Rooibos","Sisal","Sugarcane","Tea","Walnuts"],"Horticulture (Seasonal)":["Asparagus","Beet","Beetroot","Blackberry","Borecole","Brinjal","Broccoli","Brussel Sprout","Cabbage","Cabbage (Chinese)","Cabbage (Savoy)","Cactus Pear","Carrot","Cauliflower","Celery","Chicory","Chilly","Cucumber","Cucurbit","Dry Pea","Garlic","Ginger","Granadilla","Kale","Kohlrabi","Leek","Lespedeza","Lettuce","Makataan","Mustard","Mustard (White)","Onion","Paprika","Parsley","Parsnip","Pea","Pepper","Pumpkin","Quince","Radish","Squash","Strawberry","Swede","Sweet Melon","Swiss Chard","Tomato","Turnip","Vetch (Common)","Vetch (Hairy)","Watermelon","Youngberry"],Plantation:["Bluegum","Pine","Wattle"],"Planted Pastures":["Birdsfoot Trefoil","Carribean Stylo","Clover","Clover (Arrow Leaf)","Clover (Crimson)","Clover (Persian)","Clover (Red)","Clover (Rose)","Clover (Strawberry)","Clover (Subterranean)","Clover (White)","Kikuyu","Lucerne","Lupin","Lupin (Narrow Leaf)","Lupin (White)","Lupin (Yellow)","Medic","Medic (Barrel)","Medic (Burr)","Medic (Gama)","Medic (Snail)","Medic (Strand)","Ryegrass","Ryegrass (Hybrid)","Ryegrass (Italian)","Ryegrass (Westerwolds)","Serradella","Serradella (Yellow)","Silver Leaf Desmodium"]};return{croppingPotentialTypes:function(){return a},effectiveDepthTypes:function(){return b},irrigationTypes:function(){return c},landUseTypes:function(){return d},soilTextureTypes:function(){return e},terrainTypes:function(){return f},waterSourceTypes:function(){return g},getCropsForLandUse:function(a){return h[a]||[]},isCroppingPotentialRequired:function(a){return"Cropland"==a},isTerrainRequired:function(a){return"Grazing"==a}}}),sdkHelperFarmerApp.factory("farmHelper",["geoJSONHelper","geojsonUtils","underscore",function(a,b,c){var d=function(a){return{id:a.id||a.__id,title:a.name}};return{listServiceMap:function(){return d},containsPoint:function(a,c,d){var e=!1;return angular.forEach(c,function(c){"farmland"==c.type&&c.farmId&&c.farmId==d.id&&b.pointInPolygon(a,c.data.loc)&&(e=!0)}),e},getCenter:function(b,c){var d=a();return angular.forEach(b,function(a){"farmland"==a.type&&a.farmId&&a.farmId==c.id&&d.addGeometry(a.data.loc)}),d.getCenterAsGeojson()},validateFieldName:function(a,b,d){b.fieldName=b.fieldName?b.fieldName.toUpperCase().replace(/[^0-9A-Z]/g,""):b.fieldName;var e=c.findWhere(a.data.fields,{fieldName:b.fieldName});return angular.isObject(e)?angular.isObject(d)&&e.fieldName===d.fieldName:!0}}}]);var sdkHelperFavouritesApp=angular.module("ag.sdk.helper.favourites",["ag.sdk.helper.document","ag.sdk.helper.task"]);sdkHelperFavouritesApp.factory("activityHelper",["documentHelper",function(a){var b=function(b){var f={id:b.id||b.__id,date:b.date};return"object"==typeof b.actor?(b.actor.displayName?(f.title=b.actor.displayName,f.subtitle=b.actor.displayName):(f.title=b.actor.firstName+" "+b.actor.lastName,f.subtitle=b.actor.firstName+" "+b.actor.lastName),b.actor.position&&(f.title+=" ("+b.actor.position+")"),f.profilePhotoSrc=b.actor.profilePhotoSrc):b.organization?(f.title=b.organization.name,f.subtitle=b.organization.name):(f.title="Someone",f.subtitle="Someone"),f.subtitle+=" "+d(b.action)+" ",f.referenceId="farmer"==b.referenceType?b.organization.id:b[b.referenceType+"Id"],"farmer"==b.referenceType?(f.subtitle+="invite"==b.action?b.organization.name+" to create an Agrista account":"register"==b.action?"your request to join Agrista":"create"==b.action?"a customer portfolio for "+b.organization.name:"decline"==b.action?"a task for "+b.organization.name:"the portfolio of "+b.organization.name,f.referenceState="customer.details"):(void 0!==b[b.referenceType]?"document"==b.referenceType?(f.subtitle+=e(b[b.referenceType].docType)+" "+a.getDocumentTitle(b[b.referenceType].docType)+" "+b.referenceType,f.referenceState=a.getDocumentState(b[b.referenceType].docType)):"task"==b.referenceType?(f.subtitle+="the "+taskHelper.getTaskTitle(b[b.referenceType].todo)+" "+b.referenceType,f.referenceState=a.getTaskState(b[b.referenceType].todo)):f.subtitle+=e(b.referenceType)+" "+b.referenceType:f.subtitle+=e(b.referenceType)+" "+b.referenceType,b.actor&&b.organization&&b.organization.name&&(f.subtitle+=" "+c(b.action)+" "+b.organization.name)),f},c=function(a){return f[a]||"for"},d=function(a){return g[a]||(a.lastIndexOf("e")==a.length-1?a+"d":a+"ed")},e=function(a){var b=["a","e","i","o","u"];return h[a]||(-1!=b.indexOf(a.substr(0,1))?"an":"a")},f={share:"with",sent:"to"},g={register:"accepted",sent:"sent"},h={"asset register":"an"};return{listServiceMap:function(){return b},getActionVerb:d,getReferenceArticle:e}}]),sdkHelperFavouritesApp.factory("notificationHelper",["taskHelper","documentHelper",function(a,b){var c=function(c){var f={id:c.id||c.__id,title:c.sender,subtitle:e[c.notificationType].title,state:d(c.notificationType,c.dataType)};return"task"==c.dataType?f.subtitle+=" "+a.getTaskTitle(c.sharedData.todo):"document"==c.dataType&&(f.subtitle+=" "+b.getDocumentTitle(c.sharedData.docType)),f.subtitle+=" "+c.dataType+(null==c.organization?"":" for "+c.organization.name),f},d=function(a,b){var c=e[a]?e[a].state:"view";return"notification."+c+"-"+b},e={reassign:{title:"Reassign",state:"manage"},"import":{title:"Import",state:"import"},view:{title:"View",state:"view"},reject:{title:"Rejected",state:"view"},review:{title:"Review",state:"view"}};return{listServiceMap:function(){return c},getNotificationState:function(a,b){return d(a,b)},getNotificationTitle:function(a){return e[a]?e[a].title:""}}}]);var sdkHelperMerchantApp=angular.module("ag.sdk.helper.merchant",["ag.sdk.library"]);sdkHelperMerchantApp.factory("merchantHelper",["underscore",function(a){function b(b,c){b=b||[],this.services=a.map(c||[],function(a){return a.name?a.name:a}),this.selection={list:b,mode:0==b.length?"add":"select",text:""}}var c=function(a){return{id:a.id||a.__id,title:a.name,subtitle:(a.subscriptionPlan?g(a.subscriptionPlan)+" ":"")+(a.partnerType?f(a.partnerType)+" partner":""),status:a.registered?{text:"registered",label:"label-success"}:!1}},d={benefit:"Benefit",standard:"Standard"},e={small:"Small",medium:"Medium",large:"Large",association:"Association"},f=function(a){return d[a]||""},g=function(a){return e[a]||""};return b.prototype.toggleMode=function(){this.selection.list.length>0&&(this.selection.mode="select"==this.selection.mode?"add":"select",this.selection.text="")},b.prototype.addService=function(a){a=a||this.selection.text,-1==this.services.indexOf(a)&&(this.services.push(a),this.selection.text="")},b.prototype.removeService=function(a){"string"==typeof a&&(a=this.services.indexOf(a)),-1!==a&&this.services.splice(a,1)},{listServiceMap:function(){return c},partnerTypes:function(){return d},getPartnerType:f,subscriptionPlans:function(){return e},getSubscriptionPlan:g,serviceEditor:function(a,c){return new b(a,c)}}}]);var sdkHelperTaskApp=angular.module("ag.sdk.helper.task",["ag.sdk.authorization","ag.sdk.utilities","ag.sdk.interface.list","ag.sdk.library"]);sdkHelperTaskApp.provider("taskHelper",["underscore",function(a){var b=["assigned","in progress","in review"],c=function(c){var d=c.documentKey,e=a.filter(c.subtasks,function(a){return a.type&&-1!==b.indexOf(a.status)&&"child"==a.type}).map(function(a){return{id:a.id||c.__id,title:c.organization.name,subtitle:g(a.todo),todo:a.todo,groupby:d,status:{text:a.status||" ",label:j(a.status)}}});return e.length?e:void 0},d=function(a){return{id:a.documentId,title:a.organization.name,subtitle:a.documentKey,status:{text:a.status||" ",label:j(a.status)}}},e={},f=function(a){return e[a]?e[a].state:void 0},g=function(a){return e[a]?e[a].title:void 0},h=function(a){return k[a]||a||" "},i=function(a){return l[a]||a||" "},j=function(a){switch(a){case"in progress":case"in review":return"label-warning";case"done":return"label-success";default:return"label-default"}},k={backlog:"Backlog",assigned:"Assigned","in progress":"In Progress","in review":"In Review",done:"Done",archive:"Archived"},l={accept:"Accept",decline:"Decline",assign:"Assign",start:"Start",complete:"Complete",approve:"Approve",reject:"Reject",release:"Release"};this.addTasks=function(b){e=a.extend(e,b)},this.$get=["authorization","listService","dataMapService",function(e,k,l){return{listServiceMap:function(){return c},parentListServiceMap:function(){return d},getTaskState:f,getTaskTitle:g,getTaskStatusTitle:h,getTaskActionTitle:i,getTaskLabel:j,filterTasks:function(b){return a.filter(b,function(a){return void 0!==f(a.todo)})},updateListService:function(d,f,g,h){var i=e.currentUser(),j=a.findWhere(g,{id:d});k.addItems(l({id:j.parentTaskId,documentKey:j.documentKey,type:"parent",todo:f,organization:h,subtasks:a.filter(g,function(a){return a&&a.assignedTo==i.username})},c)),j&&-1===b.indexOf(j.status)&&k.removeItems(j.id)}}}]}]),sdkHelperTaskApp.factory("taskWorkflowHelper",function(){var a={accept:["backlog","assigned","in progress","in review","complete"],decline:["assigned"],start:["assigned","in progress"],assign:["backlog","assigned","in progress","in review"],complete:["assigned","in progress"],approve:["in review"],reject:["assigned","in review"],release:["done"]};return{canChangeToState:function(b,c){return a[c]?-1!==a[c].indexOf(b.status):!0}}});var sdkHelperTeamApp=angular.module("ag.sdk.helper.team",["ag.sdk.library"]);sdkHelperTeamApp.factory("teamHelper",["underscore",function(a){function b(b,c){b=b||[],this.teams=a.map(c||[],function(a){return a.name?a.name:a}),this.teamsDetails=a.map(c||[],function(a){return a}),this.selection={list:b,mode:0==b.length?"add":"select",text:""}}return b.prototype.toggleMode=function(){this.selection.list.length>0&&(this.selection.mode="select"==this.selection.mode?"add":"select",this.selection.text="")},b.prototype.addTeam=function(b){b=b||this.selection.text,-1!=this.teams.indexOf(b)||a.findWhere(this.teamsDetails,b)||(this.teams.push(b),this.teamsDetails.push(b),this.selection.text="")},b.prototype.removeTeam=function(a){"string"==typeof a&&(a=this.teams.indexOf(a)),-1!==a&&(this.teams.splice(a,1),this.teamsDetails.splice(a,1))},{teamEditor:function(a,c){return new b(a,c)}}}]);var sdkHelperUserApp=angular.module("ag.sdk.helper.user",[]);sdkHelperUserApp.factory("userHelper",[function(){var a=function(a){return{id:a.id||a.__id,title:a.firstName+" "+a.lastName,subtitle:a.position,teams:a.teams}},b=["English"];return{listServiceMap:function(){return a},languageList:function(){return b}}}]);var sdkInterfaceListApp=angular.module("ag.sdk.interface.list",["ag.sdk.id"]);sdkInterfaceListApp.factory("listService",["$rootScope","objectId",function(a,b){var c,d,e,f,g,h=[],i=function(){a.$broadcast("list::button__clicked")},j=function(b){c!==b&&("object"==typeof b?(c=b,c.click=c.click||i):c=void 0,a.$broadcast("list::button__changed",c))},k=function(b){d!==b&&(d=void 0!==b?b:void 0,a.$broadcast("list::groupby__changed",d))},l=function(b){e!==b&&(void 0!==b?(h=[],e=b):e=void 0,a.$broadcast("list::scroll__changed",e))},m=function(b){f!==b&&(f=void 0!==b?b:void 0,a.$broadcast("list::search__changed",f))},n=function(a){if(g=a,h instanceof Array)for(var b=0;b<h.length;b++)h[b].active=!1,void 0!==a&&(h[b].id==a?h[b].active=!0:h[b].type==a&&(h[b].active=!0));else for(var c in h)h.hasOwnProperty(c)&&(h[c].active=c==a)},o=function(){if(h instanceof Array){for(var a=0;a<h.length;a++)if(h[a].id==g)return h[a]}else for(var b in h)if(h.hasOwnProperty(b)&&b==g)return h[b];return null};return a.$on("$stateChangeSuccess",function(a,b,c){n(c.id?c.id:c.type)}),a.$on("list::item__selected",function(a,b){n("object"==typeof b?b.id?b.id:b.type:b)}),{config:function(a){a.reset&&(c=void 0,d=void 0,e=void 0,f=void 0,h=[],g=void 0),j(a.button),k(a.groupby),l(a.infiniteScroll),m(a.search)},button:function(a){return 1==arguments.length&&j(a),c},groupby:function(a){return 1==arguments.length&&k(a),d},infiniteScroll:function(a){return 1==arguments.length&&l(a),e},search:function(a){return 1==arguments.length&&m(a),f},items:function(b){return void 0!==b&&(h=angular.copy(b),g=void 0,a.$broadcast("list::items__changed",h)),h},length:function(){return h.length},addItems:function(c){if(void 0!==c){c instanceof Array==!1&&(c=[c]);for(var d=0;d<c.length;d++){var e=c[d];if(e.id=e.id||b().toBase64String(),h instanceof Array){for(var f=!1,i=0;i<h.length;i++)if(e.id==h[i].id){h[i]=e,h[i].active=void 0!==g&&g==e.id,f=!0;break}0==f&&h.push(e)}else h[e.id]=e,h[e.id].active=void 0!==g&&g==e.id}a.$broadcast("list::items__changed",h)}},removeItems:function(b){if(void 0!==b){b instanceof Array==!1&&(b=[b]);for(var c=0;c<b.length;c++){var d=b[c];if(h instanceof Array){for(var e=0;e<h.length;e++)if(d==h[e].id){if(h.splice(e,1),d==g&&h.length){var f=h[e]?h[e]:h[e-1];a.$broadcast("list::item__selected",f)}break}}else delete h[d]}h instanceof Array&&0==h.length&&a.$broadcast("list::items__empty"),a.$broadcast("list::items__changed",h)}},selectFirstItem:function(){a.$broadcast("list::selectFirst__requested")},setActiveItem:function(a){n(a)},getActiveItem:function(){return o()}}}]);var sdkInterfaceMapApp=angular.module("ag.sdk.interface.map",["ag.sdk.utilities","ag.sdk.id","ag.sdk.config","ag.sdk.library"]);sdkInterfaceMapApp.factory("geoJSONHelper",function(){function a(b,c){return this instanceof a?void this.addGeometry(b,c):new a(b,c)}function b(a,c){c&&(angular.isArray(c[0])?angular.forEach(c,function(c){b(a,c)}):angular.isArray(c)&&a.push([c[1],c[0]]))}return a.prototype={getJson:function(){return this._json},getType:function(){return this._json.type},getGeometryType:function(){return this._json.geometry?this._json.geometry.type:this._json.type},getBounds:function(){var a=[];if(this._json){var c=this._json.features||[this._json];angular.forEach(c,function(c){var d=c.geometry||c;b(a,d.coordinates)})}return a},getCenter:function(a){var b=[0,0];return a=a||this.getBounds(),angular.forEach(a,function(a){b[0]+=a[0],b[1]+=a[1]}),a.length?[b[0]/a.length,b[1]/a.length]:null},getCenterAsGeojson:function(a){return{coordinates:this.getCenter(a).reverse(),type:"Point"}},getProperty:function(a){return this._json&&this._json.properties?this._json.properties[a]:void 0},setCoordinates:function(a){this._json&&"FeatureCollection"!=this._json.type&&(this._json.geometry?this._json.geometry.coordinates=a:this._json.coordinates=a)},addProperties:function(a){var b=this;return this._json&&a&&("FeatureCollection"!=b._json.type&&"Feature"!=b._json.type?b._json={type:"Feature",geometry:b._json,properties:a}:(b._json.properties=b._json.properties||{},angular.forEach(a,function(a,c){b._json.properties[c]=a}))),b},addGeometry:function(a,b){return a&&(void 0===this._json?(this._json=a,this.addProperties(b)):("FeatureCollection"!=this._json.type&&"Feature"!=this._json.type&&(this._json={type:"Feature",geometry:this._json}),"Feature"==this._json.type&&(this._json={type:"FeatureCollection",features:[this._json]}),"FeatureCollection"==this._json.type&&this._json.features.push({type:"Feature",geometry:a,properties:b}))),this}},function(b,c){return new a(b,c)}}),sdkInterfaceMapApp.provider("mapMarkerHelper",["underscore",function(a){var b=function(b,c,d){return a.defaults(d||{},{iconUrl:"img/icons/"+b+"."+(c?c:"default")+".png",shadowUrl:"img/icons/"+b+".shadow.png",iconSize:[48,48],iconAnchor:[22,42],shadowSize:[73,48],shadowAnchor:[22,40],labelAnchor:[12,-24]})},c=this.getMarker=function(a,c,d){return"object"==typeof c&&(d=c,c="default"),b(a,c,d)},d=this.getMarkerStates=function(a,c,d){var e={};return"string"==typeof a&&angular.forEach(c,function(c){e[c]=b(a,c,d)}),e};this.$get=function(){return{getMarker:c,getMarkerStates:d}}}]),sdkInterfaceMapApp.provider("mapStyleHelper",["mapMarkerHelperProvider",function(a){var b={asset:a.getMarkerStates("asset",["default","success","error"]),zone:a.getMarkerStates("marker",["default","success","error"])},c={foreground:{district:{style:{weight:2,color:"white",opacity:.8,fillColor:"#0094D6",fillOpacity:.5}},farmland:{style:{weight:2,color:"white",opacity:.8,fillColor:"blue",fillOpacity:.3}},field:{icon:"success",style:{weight:2,color:"white",opacity:.8,fillColor:"#5b4723",fillOpacity:.8}},crop:{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#aa64b0",fillOpacity:.8}},improvement:{icon:"success",style:{weight:4,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.8}},"irrigated cropland":{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#4573d5",fillOpacity:.8}},pasture:{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#ffde40",fillOpacity:.8}},"permanent crop":{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#487811",fillOpacity:.8}},plantation:{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#00e64a",fillOpacity:.8}},zone:{icon:b.zone.success,draggable:!0,style:{weight:4,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.8}},farmgate:{icon:"success"},homestead:{icon:"success"}},background:{district:{style:{weight:1,color:"white",opacity:.8,fillColor:"#0094D6",fillOpacity:.2}},farmland:{style:{weight:1,color:"white",opacity:.8,fillColor:"blue",fillOpacity:.1}},field:{icon:"default",style:{weight:1,color:"white",opacity:.8,fillColor:"#5b4723",fillOpacity:.4}},crop:{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#aa64b0",fillOpacity:.4}},improvement:{icon:"default",style:{weight:4,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.5}},"irrigated cropland":{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#4573d5",fillOpacity:.4}},pasture:{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#ffde40",fillOpacity:.4}},"permanent crop":{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#487811",fillOpacity:.4}},plantation:{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#00e64a",fillOpacity:.4}},zone:{icon:b.asset.default,style:{weight:2,color:"white",opacity:.5,fillColor:"#ff6666",fillOpacity:.5}},farmgate:{icon:"default"},homestead:{icon:"default",label:{message:"Homestead"}}}},d=this.getStyle=function(d,e,f){var g=c[d]&&c[d][e]?angular.copy(c[d][e]):{};return"string"==typeof g.icon&&(void 0===b[e]&&(b[e]=a.getMarkerStates(e,["default","success","error"])),g.icon=b[e][g.icon]),"object"==typeof f&&(g.label=f),g},e=this.setStyle=function(a,b,d){c[a]=c[a]||{},c[a][b]=d};this.$get=function(){return{getStyle:d,setStyle:e}}}]),sdkInterfaceMapApp.provider("mapboxService",["underscore",function(a){var b={options:{attributionControl:!0,layersControl:!0,scrollWheelZoom:!1,zoomControl:!0},layerControl:{baseTile:"agrista.map-65ftbmpi",baseLayers:{Agrista:{base:!0,type:"mapbox"},Google:{type:"google",tiles:"SATELLITE"}},overlays:{}},controls:{},events:{},view:{coordinates:[-28.691,24.714],zoom:6},bounds:{},layers:{},geojson:{}},c={};this.config=function(c){b=a.defaults(c||{},b)},this.$get=["$rootScope","objectId",function(d,e){function f(a,c){var e=this;e._id=a,e._ready=!1,e._options=c,e._show=e._options.show||!1,e._config=angular.copy(b),e._requestQueue=[],d.$on("mapbox-"+e._id+"::init",function(){e.dequeueRequests(),e._ready=!0}),d.$on("mapbox-"+e._id+"::destroy",function(){e._ready=!1,e._options.persist!==!0&&(e._config=angular.copy(b))})}return f.prototype={getId:function(){return this._id},reset:function(){this._config=angular.copy(b),d.$broadcast("mapbox-"+this._id+"::reset")},clearLayers:function(){this.removeOverlays(),this.removeLayers(),this.removeGeoJSON()},enqueueRequest:function(a,b){this._ready?d.$broadcast(a,b):this._requestQueue.push({event:a,args:b})},dequeueRequests:function(){if(this._requestQueue.length)do{var a=this._requestQueue.shift();d.$broadcast(a.event,a.args)}while(this._requestQueue.length)},shouldShow:function(){return this._show},hide:function(){this._show=!1,this.enqueueRequest("mapbox-"+this._id+"::hide",{})},show:function(){this._show=!0,this.enqueueRequest("mapbox-"+this._id+"::show",{})},invalidateSize:function(){this.enqueueRequest("mapbox-"+this._id+"::invalidate-size",{})},getOptions:function(){return this._config.options},setOptions:function(a){var b=this;angular.forEach(a,function(a,c){b._config.options[c]=a})},getMapCenter:function(a){this.enqueueRequest("mapbox-"+this._id+"::get-center",a)},getMapBounds:function(a){this.enqueueRequest("mapbox-"+this._id+"::get-bounds",a)},getMapControl:function(a,b){this.enqueueRequest("mapbox-"+this._id+"::get-control",{control:a,handler:b})},getBaseTile:function(){return this._config.layerControl.baseTile},setBaseTile:function(a){this._config.layerControl.baseTile=a,this.enqueueRequest("mapbox-"+this._id+"::set-basetile",a)},getBaseLayers:function(){return this._config.layerControl.baseLayers},setBaseLayers:function(a){this._config.layerControl.baseLayers=a,this.enqueueRequest("mapbox-"+this._id+"::set-baselayers",a)},getOverlays:function(){return this._config.layerControl.overlays},addOverlay:function(a,b){a&&void 0==this._config.layerControl.overlays[a]&&(this._config.layerControl.overlays[a]=b,this.enqueueRequest("mapbox-"+this._id+"::add-overlay",{layerName:a,name:b||a}))},removeOverlay:function(a){a&&this._config.layerControl.overlays[a]&&(d.$broadcast("mapbox-"+this._id+"::remove-overlay",a),delete this._config.layerControl.overlays[a])},removeOverlays:function(){var a=this;angular.forEach(this._config.layerControl.overlays,function(b,c){d.$broadcast("mapbox-"+a._id+"::remove-overlay",c),delete a._config.layerControl.overlays[c]})},getControls:function(){return this._config.controls},addControl:function(a,b){this._config.controls[a]={name:a,options:b},d.$broadcast("mapbox-"+this._id+"::add-control",this._config.controls[a])},removeControl:function(a){delete this._config.controls[a],d.$broadcast("mapbox-"+this._id+"::remove-control",a)},getEventHandlers:function(){return this._config.events},addEventHandler:function(a,b){a=a instanceof Array?a:[a];var c=this;angular.forEach(a,function(a){c.removeEventHandler(a),c._config.events[a]=b,d.$broadcast("mapbox-"+c._id+"::add-event-handler",{event:a,handler:b})
})},removeEventHandler:function(a){a=a instanceof Array?a:[a];var b=this;angular.forEach(a,function(a){void 0!==b._config.events[a]&&(d.$broadcast("mapbox-"+b._id+"::remove-event-handler",{event:a,handler:b._config.events[handler]}),delete b._config.events[a])})},getView:function(){return{coordinates:this._config.view.coordinates,zoom:this._config.view.zoom}},setView:function(a,b){a instanceof Array&&(this._config.view.coordinates=a,this._config.view.zoom=b||this._config.view.zoom,d.$broadcast("mapbox-"+this._id+"::set-view",this._config.view))},getBounds:function(){return this._config.bounds},setBounds:function(a,b){this._config.bounds={coordinates:a,options:b||{reset:!1}},d.$broadcast("mapbox-"+this._id+"::set-bounds",this._config.bounds)},zoomTo:function(a,b,c){d.$broadcast("mapbox-"+this._id+"::zoom-to",{coordinates:a,zoom:b,options:c})},createLayer:function(a,b,c,d){"function"==typeof c&&(d=c,c={});var e=this;this.enqueueRequest("mapbox-"+this._id+"::create-layer",{name:a,type:b,options:c,handler:function(b){e._config.layers[a]=b,d(b)}})},getLayer:function(a){return this._config.layers[a]},getLayers:function(){return this._config.layers},addLayer:function(a,b){this._config.layers[a]=b,d.$broadcast("mapbox-"+this._id+"::add-layer",a)},removeLayer:function(a){a instanceof Array==!1&&(a=[a]);var b=this;angular.forEach(a,function(a){d.$broadcast("mapbox-"+b._id+"::remove-layer",a),delete b._config.layers[a]})},removeLayers:function(){var a=this;angular.forEach(this._config.layers,function(b,c){d.$broadcast("mapbox-"+-this._id+"::remove-layer",c),delete a._config.layers[c]})},showLayer:function(a){d.$broadcast("mapbox-"+this._id+"::show-layer",a)},hideLayer:function(a){d.$broadcast("mapbox-"+this._id+"::hide-layer",a)},fitLayer:function(a,b){this.enqueueRequest("mapbox-"+this._id+"::fit-layer",{name:a,options:b||{reset:!1}})},getGeoJSON:function(){return this._config.geojson},getGeoJSONFeature:function(a,b){return this._config.geojson[a]&&this._config.geojson[a][b]?this._config.geojson[a][b]:null},getGeoJSONLayer:function(a){return this._config.geojson[a]?this._config.geojson[a]:null},addGeoJSON:function(b,c,f,g,h){"function"==typeof g&&(h=g,g={}),g=a.defaults(g||{},{featureId:e().toString()});var i={layerName:b,geojson:c,options:f,properties:g,onAddCallback:h};return this._config.geojson[b]=this._config.geojson[b]||{},this._config.geojson[b][g.featureId]=i,d.$broadcast("mapbox-"+this._id+"::add-geojson",i),g.featureId},removeGeoJSONFeature:function(a,b){this._config.geojson[a]&&this._config.geojson[a][b]&&(d.$broadcast("mapbox-"+this._id+"::remove-geojson-feature",this._config.geojson[a][b]),delete this._config.geojson[a][b])},removeGeoJSONLayer:function(a){a instanceof Array==!1&&(a=[a]);var b=this;angular.forEach(a,function(a){b._config.geojson[a]&&(d.$broadcast("mapbox-"+b._id+"::remove-geojson-layer",a),delete b._config.geojson[a])})},removeGeoJSON:function(){var a=this;angular.forEach(a._config.geojson,function(b,c){d.$broadcast("mapbox-"+a._id+"::remove-geojson-layer",c),delete a._config.geojson[c]})},editingOn:function(a,b,c,d,e){"string"==typeof c&&(c={exclude:"exclude"==c}),this.enqueueRequest("mapbox-"+this._id+"::edit-on",{layerName:a,controls:b,controlOptions:c,styleOptions:d,addLayer:e})},editingUpdate:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-update")},editingClear:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-clear")},editingOff:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-off")},pickPortionOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-portion-on")},pickDistrictOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-district-on")},pickFieldOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-field-on")},defineFarmOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-on")},defineServiceAreaOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-service-area-on")},defineFieldGroupOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-field-group-on")},featureClickOn:function(){this.enqueueRequest("mapbox-"+this._id+"::feature-click-on")},pickPortionOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-portion-off")},pickDistrictOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-district-off")},pickFieldOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-field-off")},defineFarmOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-off")},defineServiceAreaOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-off")},defineFieldGroupOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-field-group-off")},featureClickOff:function(){this.enqueueRequest("mapbox-"+this._id+"::feature-click-off")}},function(a,b){return b=b||{},void 0===c[a]&&(c[a]=new f(a,b)),b.clean===!0&&c[a].reset(),c[a]}}]}]),sdkInterfaceMapApp.directive("mapbox",["$rootScope","$http","$log","$timeout","configuration","mapboxService","geoJSONHelper","objectId","underscore",function(a,b,c,d,e,f,g,h,i){function j(a,b){var c=this;c._id=a.id,c._optionSchema={},c._editing=!1,c._editableLayer,c._editableFeature=L.featureGroup(),c._featureClickable,c._geoJSON={},c._layers={},c._controls={},c._layerControls={baseTile:"",baseLayers:{},overlays:{}},c._draw={exclude:!1,addLayer:!0,options:{},controls:{}},a.delay=a.delay||0,d(function(){c.mapInit(),c.addListeners(b),c.broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::init",c._map)},a.delay)}var k={};return j.prototype.mapInit=function(){var a=this;a._mapboxServiceInstance=f(a._id);var b=a._mapboxServiceInstance.getView(),c=a._mapboxServiceInstance.getOptions();a._map=L.map(a._id,c).setView(b.coordinates,b.zoom),a._map.whenReady(function(){a.broadcast("mapbox-"+a._mapboxServiceInstance.getId()+"::ready",a._map)}),a._editableFeature=L.featureGroup(),a._editableFeature.addTo(a._map),a.setEventHandlers(a._mapboxServiceInstance.getEventHandlers()),a.resetLayers(a._mapboxServiceInstance.getLayers()),a.resetGeoJSON(a._mapboxServiceInstance.getGeoJSON()),a.resetLayerControls(a._mapboxServiceInstance.getBaseTile(),a._mapboxServiceInstance.getBaseLayers(),a._mapboxServiceInstance.getOverlays()),a.addControls(a._mapboxServiceInstance.getControls()),a.setBounds(a._mapboxServiceInstance.getBounds()),a._map.on("draw:drawstart",a.onDrawStart,a),a._map.on("draw:editstart",a.onDrawStart,a),a._map.on("draw:deletestart",a.onDrawStart,a),a._map.on("draw:drawstop",a.onDrawStop,a),a._map.on("draw:editstop",a.onDrawStop,a),a._map.on("draw:deletestop",a.onDrawStop,a)},j.prototype.addListeners=function(a){a.hidden=!this._mapboxServiceInstance.shouldShow();var b=this,c=this._mapboxServiceInstance.getId();a.$on("mapbox-"+c+"::get-center",function(a,c){"function"==typeof c&&c(b._map.getCenter())}),a.$on("mapbox-"+c+"::get-bounds",function(a,c){"function"==typeof c&&c(b._map.getBounds())}),a.$on("mapbox-"+c+"::get-control",function(a,c){"function"==typeof c.handler&&c.handler(b._controls[c.control])}),a.$on("$destroy",function(){delete k[c],b.mapDestroy(),b.broadcast("mapbox-"+c+"::destroy")}),a.$on("mapbox-"+c+"::set-basetile",function(a,c){b.setBaseTile(c)}),a.$on("mapbox-"+c+"::set-baselayers",function(a,c){b.setBaseLayers(c)}),a.$on("mapbox-"+c+"::add-overlay",function(a,c){b.addOverlay(c.layerName,c.name)}),a.$on("mapbox-"+c+"::remove-overlay",function(a,c){b.removeOverlay(c)}),a.$on("mapbox-"+c+"::add-control",function(a,c){b.addControls({control:c})}),a.$on("mapbox-"+c+"::remove-control",function(a,c){b.removeControl(c)}),a.$on("mapbox-"+c+"::add-event-handler",function(a,c){b.addEventHandler(c.event,c.handler)}),a.$on("mapbox-"+c+"::remove-event-handler",function(a,c){b.removeEventHandler(c.event,c.handler)}),a.$on("mapbox-"+c+"::set-view",function(a,c){b.setView(c)}),a.$on("mapbox-"+c+"::set-bounds",function(a,c){b.setBounds(c)}),a.$on("mapbox-"+c+"::zoom-to",function(a,c){b.zoomTo(c)}),a.$on("mapbox-"+c+"::create-layer",function(a,c){"function"==typeof c.handler&&c.handler(b.createLayer(c.name,c.type,c.options))}),a.$on("mapbox-"+c+"::add-layer",function(a,c){b.addLayer(c)}),a.$on("mapbox-"+c+"::remove-layer",function(a,c){b.removeLayer(c)}),a.$on("mapbox-"+c+"::show-layer",function(a,c){b.showLayer(c)}),a.$on("mapbox-"+c+"::hide-layer",function(a,c){b.hideLayer(c)}),a.$on("mapbox-"+c+"::fit-layer",function(a,c){b.fitLayer(c)}),a.$on("mapbox-"+c+"::add-geojson",function(a,c){b.addGeoJSONFeature(c)}),a.$on("mapbox-"+c+"::remove-geojson-feature",function(a,c){b.removeGeoJSONFeature(c)}),a.$on("mapbox-"+c+"::remove-geojson-layer",function(a,c){b.removeGeoJSONLayer(c)}),a.$on("mapbox-"+c+"::hide",function(){a.hidden=!0}),a.$on("mapbox-"+c+"::show",function(){a.hidden=!1}),a.$on("mapbox-"+c+"::invalidate-size",function(){b._map.invalidateSize()}),a.$on("mapbox-"+c+"::edit-on",function(a,c){b.setOptionSchema(c.styleOptions),b.makeEditable(c.layerName,c.addLayer,!0),b.setDrawControls(c.controls,c.controlOptions),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-update",function(){b.makeEditable(b._editableLayer,b._draw.addLayer,!1),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-clear",function(){b.cleanEditable(),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-off",function(){b.makeEditable(void 0,{},!0),b.updateDrawControls()}),a.$on("mapbox-"+c+"::pick-portion-on",function(){b._map.on("click",b.pickPortion,b)}),a.$on("mapbox-"+c+"::pick-district-on",function(){b._map.on("click",b.pickDistrict,b)}),a.$on("mapbox-"+c+"::pick-field-on",function(){b._map.on("click",b.pickField,b)}),a.$on("mapbox-"+c+"::define-farm-on",function(){b._map.on("click",b.defineNewFarm,b)}),a.$on("mapbox-"+c+"::define-service-area-on",function(){b._map.on("click",b.defineServiceArea,b)}),a.$on("mapbox-"+c+"::define-field-group-on",function(){b._map.on("click",b.defineFieldGroup,b)}),a.$on("mapbox-"+c+"::feature-click-on",function(){b._featureClickable=!0}),a.$on("mapbox-"+c+"::pick-portion-off",function(){b._map.off("click",b.pickPortion,b)}),a.$on("mapbox-"+c+"::pick-field-off",function(){b._map.off("click",b.pickField,b)}),a.$on("mapbox-"+c+"::pick-district-off",function(){b._map.off("click",b.pickDistrict,b)}),a.$on("mapbox-"+c+"::define-farm-off",function(){b._map.off("click",b.defineNewFarm,b)}),a.$on("mapbox-"+c+"::define-service-area-off",function(){b._map.off("click",b.defineServiceArea,b)}),a.$on("mapbox-"+c+"::define-field-group-off",function(){b._map.off("click",b.defineFieldGroup,b)}),a.$on("mapbox-"+c+"::feature-click-off",function(){b._featureClickable=!1})},j.prototype.mapDestroy=function(){for(var a in this._map._layers)this._map._layers.hasOwnProperty(a)&&this._map.removeLayer(this._map._layers[a]);this._optionSchema={},this._editing=!1,this._editableLayer=null,this._editableFeature=null,this._geoJSON={},this._layers={},this._layerControls={baseTile:"",baseLayers:{},overlays:{}},this._draw={exclude:!1,addLayer:!0,options:{},controls:{}},this._map.remove(),this._map=null},j.prototype.broadcast=function(b,d){c.debug(b),a.$broadcast(b,d)},j.prototype.resetLayerControls=function(a,b,c){this._layerControls.baseTile=a;try{this.map.removeControl(this._layerControls.control)}catch(d){}this.setBaseLayers(b),this.setOverlays(c)},j.prototype.resetLayers=function(a){var b=this;angular.forEach(b._layers,function(a,c){b._map.removeLayer(a),delete b._layers[c]}),angular.forEach(a,function(a,c){b._layers[c]=a,b._map.addLayer(a)})},j.prototype.resetGeoJSON=function(a){var b=this;angular.forEach(b._geoJSON,function(a,c){b._layers[c]&&(b._map.removeLayer(b._layers[c]),delete b._layers[c])}),angular.forEach(a,function(a){b.addGeoJSONLayer(a)})},j.prototype.setBaseTile=function(a){var b=this;b._layerControls.baseTile=a,angular.forEach(b._layerControls.baseLayers,function(b){b.base&&b.layer&&b.layer.setUrl(a)})},j.prototype.setBaseLayers=function(a){var b=this,c=b._mapboxServiceInstance.getOptions();void 0===b._layerControls.control&&(b._layerControls.control=L.control.layers({},{}),c.layersControl&&b._map.addControl(b._layerControls.control)),angular.forEach(b._layerControls.baseLayers,function(c,d){void 0===a[d]?b._layerControls.control.removeLayer(c.layer):void 0===c.layer&&b.addBaseLayer(c,d)}),angular.forEach(a,function(a,c){void 0===b._layerControls.baseLayers[c]?b.addBaseLayer(a,c):(a=b._layerControls.baseLayers[c],a.base&&a.layer.addTo(this._map))})},j.prototype.addBaseLayer=function(a,b){a.base&&(a.tiles=this._layerControls.baseTile),"tile"==a.type?a.layer=L.tileLayer(a.tiles):"mapbox"==a.type?a.layer=L.mapbox.tileLayer(a.tiles):"google"==a.type&&"function"==typeof L.Google&&(a.layer=new L.Google(a.tiles)),a.base&&a.layer.addTo(this._map),this._layerControls.baseLayers[b]=a,this._layerControls.control.addBaseLayer(a.layer,b)},j.prototype.setOverlays=function(a){var b=this;angular.forEach(b._layerControls.overlays,function(c,d){void 0===a[d]&&b.removeOverlay(d,c)}),angular.forEach(a,function(a,c){b.addOverlay(c,a)})},j.prototype.addOverlay=function(a,b){var c=this._layers[a];b=b||a,this._layerControls.control&&c&&void 0===this._layerControls.overlays[a]&&(this._layerControls.overlays[a]=c,this._layerControls.control.addOverlay(c,b))},j.prototype.removeOverlay=function(a,b){var c=b||this._layers[a];this._layerControls.control&&c&&(this._layerControls.control.removeLayer(c),delete this._layerControls.overlays[a])},j.prototype.addControls=function(a){var b=this;angular.forEach(a,function(a){"function"==typeof L.control[a.name]&&(b.removeControl(a.name),b._controls[a.name]=L.control[a.name](a.options),b._map.addControl(b._controls[a.name]))})},j.prototype.removeControl=function(a){this._controls[a]&&(this._map.removeControl(this._controls[a]),delete this._controls[a])},j.prototype.setEventHandlers=function(a){var b=this;angular.forEach(a,function(a,c){b.addEventHandler(c,a)})},j.prototype.addEventHandler=function(a,b){this._map.on(a,b)},j.prototype.removeEventHandler=function(a,b){this._map.off(a,b)},j.prototype.setView=function(a){this._map&&void 0!==a&&this._map.setView(a.coordinates,a.zoom)},j.prototype.setBounds=function(a){this._map&&a.coordinates&&(a.coordinates instanceof Array?a.coordinates.length>1&&this._map.fitBounds(a.coordinates,a.options):this._map.fitBounds(a.coordinates,a.options))},j.prototype.zoomTo=function(a){this._map&&a.coordinates&&a.zoom&&this._map.setZoomAround(a.coordinates,a.zoom,a.options)},j.prototype.createLayer=function(a,b,c){return b=b||"featureGroup",c=c||{},void 0===this._layers[a]&&("featureGroup"==b&&L.featureGroup?this._layers[a]=L.featureGroup(c):"markerClusterGroup"==b&&L.markerClusterGroup&&(this._layers[a]=L.markerClusterGroup(c)),this._layers[a]&&this._layers[a].addTo(this._map)),this._layers[a]},j.prototype.addLayer=function(a){var b=this._mapboxServiceInstance.getLayer(a);b&&(this._layers[a]=b,this._map.addLayer(b))},j.prototype.addLayerToLayer=function(a,b,c){var d=this._layers[c];d&&(this._layers[a]=b,d.addLayer(b))},j.prototype.removeLayer=function(a){var b=this._layers[a];b&&(this.removeOverlay(a),this._map.removeLayer(b),delete this._layers[a])},j.prototype.removeLayerFromLayer=function(a,b){var c=this._layers[b],d=this._layers[a];c&&(c.removeLayer(d),delete this._layers[a])},j.prototype.showLayer=function(a){var b=this._layers[a];b&&0==this._map.hasLayer(b)&&(this._map.addLayer(b),b.eachLayer(function(a){a.bindLabel&&a.feature.properties.label&&a.bindLabel(a.feature.properties.label.message,a.feature.properties.label.options)}))},j.prototype.hideLayer=function(a){var b=this._layers[a];b&&this._map.hasLayer(b)&&this._map.removeLayer(b)},j.prototype.fitLayer=function(a){if(a.name){var b=this._layers[a.name];if(b&&this._map.hasLayer(b)){var c=b.getBounds();this._map.fitBounds(c,a.options)}}},j.prototype.addGeoJSONLayer=function(a){var b=this;angular.forEach(a,function(a){b.addGeoJSONFeature(a)})},j.prototype.makeIcon=function(a){return a?a.type&&L[a.type]&&L[a.type].icon?L[a.type].icon(a):L.icon(a):L.Icon.Default()},j.prototype.addLabel=function(a,b,c){var d=this,e=g(b);if("object"==typeof a&&"Point"!==b.geometry.type)if(a.options=a.options||{},(a.options.centered||a.options.noHide)&&"function"==typeof d._map.showLabel){var f=new L.Label(i.extend(a.options),{offset:[6,-15]});f.setContent(a.message),f.setLatLng(e.getCenter()),1==a.options.noHide?(d._map.showLabel(f),c.on("add",function(){d._map.showLabel(f)}),c.on("remove",function(){d._map.removeLayer(f)})):(c.on("mouseover",function(){d._map.showLabel(f)}),c.on("mouseout",function(){d._map.removeLayer(f)}))}else"function"==typeof c.bindLabel&&c.bindLabel(a.message,a.options)},j.prototype.addGeoJSONFeature=function(a){var b=this,c=g(a.geojson,a.properties);b.createLayer(a.layerName),b._geoJSON[a.layerName]=b._geoJSON[a.layerName]||{},b._geoJSON[a.layerName][a.properties.featureId]=a;var d=a.options?angular.copy(a.options):{};d.icon&&(d.icon=b.makeIcon(d.icon)),L.geoJson(c.getJson(),{style:d.style,pointToLayer:function(a,b){var c=L.marker(b,d);return d.label&&c.bindLabel(d.label.message,d.label.options),c},onEachFeature:function(c,e){b.addLayerToLayer(c.properties.featureId,e,a.layerName),b.addLabel(d.label,c,e),"function"==typeof a.onAddCallback&&a.onAddCallback(c,e),!b._featureClickable||"Polygon"!==c.geometry.type&&"MultiPolygon"!==c.geometry.type||e.on("click",function(){c&&c.properties&&(c.properties.highlighted?(c.properties.highlighted=!1,e.setStyle({color:e.options.fillColor||"blue",opacity:e.options.fillOpacity||.4})):(c.properties.highlighted=!0,e.setStyle({color:"white",opacity:1,fillColor:e.options.fillColor||"blue",fillOpacity:e.options.fillOpacity||.4}))),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::polygon-clicked",{properties:c.properties,highlighted:c.properties.highlighted})})}})},j.prototype.removeGeoJSONFeature=function(a){this._geoJSON[a.layerName]&&this._geoJSON[a.layerName][a.properties.featureId]&&(this.removeLayerFromLayer(a.properties.featureId,a.layerName),delete this._geoJSON[a.layerName][a.properties.featureId])},j.prototype.removeGeoJSONLayer=function(a){this._geoJSON[a]&&(this.removeLayer(a),delete this._geoJSON[a])},j.prototype.makeEditable=function(a,b,c){var d=this;1==c&&d.cleanEditable(),a&&d._layers[a]&&d._layers[a].eachLayer(function(b){d._layers[a].removeLayer(b),d._editableFeature.addLayer(b)}),d._editableLayer=a,d._draw.addLayer=void 0==b?!0:b},j.prototype.cleanEditable=function(){var a=this;a._editableFeature.eachLayer(function(b){a._editableFeature.removeLayer(b)})},j.prototype.setDrawControls=function(a,b){this._draw.controlOptions=b||{},this._draw.controls={},a instanceof Array&&"function"==typeof L.Control.Draw&&(this._draw.controls.polyline=new L.Control.Draw({draw:{polyline:-1!=a.indexOf("polyline"),polygon:!1,rectangle:!1,circle:!1,marker:!1}}),this._draw.controls.polygon=new L.Control.Draw({draw:{polyline:!1,polygon:-1==a.indexOf("polygon")?!1:{allowIntersection:!1,showArea:!0,metric:!0},rectangle:!1,circle:!1,marker:!1}}),this._draw.controls.marker=new L.Control.Draw({draw:{polyline:!1,polygon:!1,rectangle:!1,circle:!1,marker:-1==a.indexOf("marker")?!1:{icon:this._optionSchema.icon?L.icon(this._optionSchema.icon):L.Icon.Default()}}}),this._draw.controls.edit=new L.Control.Draw({draw:!1,edit:{featureGroup:this._editableFeature,remove:1!=this._draw.controlOptions.nodelete}}))},j.prototype.setOptionSchema=function(a){this._optionSchema=a||{}},j.prototype.updateDrawControls=function(){try{this._map.removeControl(this._draw.controls.polyline)}catch(a){}try{this._map.removeControl(this._draw.controls.polygon)}catch(a){}try{this._map.removeControl(this._draw.controls.marker)}catch(a){}try{this._map.removeControl(this._draw.controls.edit)}catch(a){}try{this._map.off("draw:created",this.onDrawn,this),this._map.off("draw:edited",this.onEdited,this),this._map.off("draw:deleted",this.onDeleted,this)}catch(a){}if(this._editableFeature.getLayers().length>0&&(this._map.on("draw:edited",this.onEdited,this),this._map.on("draw:deleted",this.onDeleted,this),this._draw.controls.edit&&this._map.addControl(this._draw.controls.edit)),this._editableLayer&&(0==this._editableFeature.getLayers().length||this._draw.controlOptions.multidraw)){var b={polyline:!0,polygon:!0,marker:!0};this._editableFeature.eachLayer(function(a){if(a.feature&&a.feature.geometry&&a.feature.geometry.type)switch(a.feature.geometry.type){case"LineString":b.polyline=!1;break;case"Polygon":b.polygon=!1;break;case"Point":b.marker=!1}}),this._draw.controlOptions.exclude?(b.polyline&&this._map.addControl(this._draw.controls.polyline),b.polygon&&this._map.addControl(this._draw.controls.polygon),b.marker&&this._map.addControl(this._draw.controls.marker),this._map.on("draw:created",this.onDrawn,this)):(this._draw.controls.polyline&&this._map.addControl(this._draw.controls.polyline),this._draw.controls.polygon&&this._map.addControl(this._draw.controls.polygon),this._draw.controls.marker&&this._map.addControl(this._draw.controls.marker),this._map.on("draw:created",this.onDrawn,this))}},j.prototype.pickPortion=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/portion-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::portion-added",a))}).error(function(a){c.debug(a)})}},j.prototype.defineNewFarm=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/portion-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey,portion:a}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::portion-added",a))}).error(function(a){c.debug(a)})}},j.prototype.pickDistrict=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/district-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::district-added",a))}).error(function(a){c.debug(a)})}},j.prototype.defineServiceArea=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/district-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey,districtName:a.name}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::district-added",a))}).error(function(a){c.debug(a)})}},j.prototype.pickField=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/field-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::field-added",a))}).error(function(a){c.debug(a)})}},j.prototype.defineFieldGroup=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/field-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::field-added",a))}).error(function(a){c.debug(a)})}},j.prototype.onDrawStart=function(){this._editing=!0,this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-editing",this._editing)},j.prototype.onDrawStop=function(){this._editing=!1,this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-editing",this._editing)},j.prototype.onDrawn=function(a){var b={type:"Feature",geometry:{},properties:{featureId:h().toString()}};switch(a.layerType){case"polyline":b.geometry={type:"LineString",coordinates:[]},angular.forEach(a.layer._latlngs,function(a){b.geometry.coordinates.push([a.lng,a.lat])}),this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b);break;case"polygon":if(b.geometry={type:"Polygon",coordinates:[[]]},angular.forEach(a.layer._latlngs,function(a){b.geometry.coordinates[0].push([a.lng,a.lat])}),b.geometry.coordinates[0].length>0&&b.geometry.coordinates[0][0]!=b.geometry.coordinates[0][b.geometry.coordinates[0].length-1]&&b.geometry.coordinates[0].push(b.geometry.coordinates[0][0]),this._draw.controls.polygon.options.draw.polygon.showArea){var c=L.GeometryUtil.geodesicArea(a.layer._latlngs),d=1.19599*c;b.properties.area={m_sq:c,ha:1e-4*c,mi_sq:d/3097600,acres:d/4840,yd_sq:d}}this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b);break;case"marker":b.geometry={type:"Point",coordinates:[a.layer._latlng.lng,a.layer._latlng.lat]},this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b)}this._draw.addLayer&&(this._mapboxServiceInstance.addGeoJSON(this._editableLayer,b,this._optionSchema,b.properties),this.makeEditable(this._editableLayer),this.updateDrawControls())},j.prototype.onEdited=function(a){var b=this;a.layers.eachLayer(function(a){var c={type:"Feature",geometry:{type:a.feature.geometry.type},properties:{featureId:a.feature.properties.featureId}};switch(a.feature.geometry.type){case"Point":c.geometry.coordinates=[a._latlng.lng,a._latlng.lat],b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-edited",c);break;case"Polygon":if(c.geometry.coordinates=[[]],angular.forEach(a._latlngs,function(a){c.geometry.coordinates[0].push([a.lng,a.lat])}),c.geometry.coordinates[0].length>0&&c.geometry.coordinates[0][0]!=c.geometry.coordinates[0][c.geometry.coordinates[0].length-1]&&c.geometry.coordinates[0].push(c.geometry.coordinates[0][0]),b._draw.controls.polygon.options.draw.polygon.showArea){var d=L.GeometryUtil.geodesicArea(a._latlngs),e=1.19599*d;c.properties.area={m_sq:d,ha:1e-4*d,mi_sq:e/3097600,acres:e/4840,yd_sq:e}}b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-edited",c);break;case"LineString":c.geometry.coordinates=[],angular.forEach(a._latlngs,function(a){c.geometry.coordinates.push([a.lng,a.lat])}),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-edited",c)}})},j.prototype.onDeleted=function(a){var b=this;a.layers.getLayers().length>0?a.layers.eachLayer(function(a){b._editableFeature.removeLayer(a),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-deleted",a.feature.properties.featureId)}):(b._editableFeature.clearLayers(),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-deleted")),b.updateDrawControls()},{restrict:"E",template:'<div class="map" ng-hide="hidden" ng-transclude></div>',replace:!0,transclude:!0,link:function(a,b,c){void 0===k[c.id]&&(k[c.id]=new j(c,a))},controller:function(a,b){this.getMap=function(){return k[b.id]._map}}}}]),sdkInterfaceMapApp.directive("mapboxControl",["$rootScope",function(a){function b(b){var e=b.parent();a.$on("mapbox-"+e.attr("id")+"::init",function(){e.find(".leaflet-control-container "+d[c]).prepend(b)})}var c,d={topleft:".leaflet-top.leaflet-left",topright:".leaflet-top.leaflet-right",bottomleft:".leaflet-bottom.leaflet-left",bottomright:".leaflet-bottom.leaflet-right"};return{restrict:"E",require:"^mapbox",replace:!0,transclude:!0,template:'<div class="leaflet-control"><div class="leaflet-bar" ng-transclude></div></div>',link:function(a,b,d){c=void 0==d.position?"bottomright":d.position},controller:function(a){b(a)}}}]);var sdkInterfaceNavigiationApp=angular.module("ag.sdk.interface.navigation",["ag.sdk.authorization","ag.sdk.library"]);sdkInterfaceNavigiationApp.provider("navigationService",["underscore",function(a){var b={},c=[],d={Favourites:1,Assets:2,Apps:3,Administration:4},e={left:[],right:[]},f=function(a,b){return a.order-b.order},g=this.registerApps=function(c){c=c instanceof Array?c:[c],angular.forEach(c,function(c){c=a.defaults(c,{id:c.title,order:100,group:"Apps",include:function(a,b){return-1!==b.indexOf(a.id)}}),c.title&&c.state&&(b[c.title]=c)})};this.$get=["$rootScope","$state","authorization",function(h,i,j){var k=!1,l="",m=function(b){var e=a.findWhere(c,{title:b.group});void 0===e&&(e={title:b.group,order:d[b.group]||100,items:[]},c.push(e),c=c.sort(f));var g=a.findWhere(e.items,{id:b.id});void 0===g&&(b.active=i.includes(b.state),e.items.push(b),e.items=e.items.sort(f),h.$broadcast("navigation::items__changed",c),h.$broadcast("navigation::app__allowed",b))},n=function(){c=[],h.$broadcast("navigation::items__changed",c)},o=function(c){var d=c||j.currentUser(),e=d.userRole?a.pluck(d.userRole.apps,"name"):[],f=d.organization?a.pluck(d.organization.services,"serviceType"):[];n(),angular.forEach(b,function(a){("function"==typeof a.include&&a.include(a,e,f)||a.include===!0)&&m(a)})},p=function(a,b){b&&(b instanceof Array==!1?e[a].push(b):e[a]=b,h.$broadcast("navigation::"+a+"-buttons__changed",e[a]),h.$broadcast("navigation::buttons__changed"))};return h.$on("$stateChangeSuccess",function(){angular.forEach(c,function(a){angular.forEach(a.items,function(a){a.active=i.includes(a.state)})})}),h.$on("navigation::item__selected",function(a,b){i.go(b)}),h.$on("authorization::login",function(a,b){o(b)}),h.$on("authorization::unauthorized",function(){n()}),h.$on("authorization::logout",function(){n()}),o(),{getGroupedApps:function(){return c},renameApp:function(d,e){var f=a.findWhere(b,{id:d});f&&(f.title=e,h.$broadcast("navigation::items__changed",c))},registerApps:function(a){g(a)},unregisterApps:function(){b={},c=[]},allowApp:function(a){b[a]&&m(b[a])},toggleSlim:function(){k=!k,h.$broadcast("navigation::slim__changed",k)},isSlim:function(){return k},footerText:function(a){return void 0!==a&&(l=a,h.$broadcast("navigation::footerText",l)),l},leftButtons:function(a){return p("left",a),e.left},rightButtons:function(a){return p("right",a),e.right}}}]}]);var cordovaHelperApp=angular.module("ag.mobile-sdk.helper",["ag.sdk.utilities","ag.mobile-sdk.cordova.geolocation","ag.mobile-sdk.cordova.camera"]);cordovaHelperApp.factory("geolocationHelper",["promiseService","geolocationService",function(a,b){function c(a){return this instanceof c?(this._options=a.options||{},this._onGet=a.onGet||angular.noop,this._onWatch=a.onWatch||angular.noop,this._onError=a.onError||angular.noop,void(this._watcher=null)):new c(a)}function d(a){return{type:"Feature",geometry:{coordinates:[a.coords.longitude,a.coords.latitude],type:"Point"},properties:{accuracy:a.coords.accuracy,altitude:a.coords.altitude}}}return c.prototype={busy:!1,getPosition:function(a){var c=this;c.busy=!0,a=a||c._options,b.getPosition(a).then(function(a){c.busy=!1,c._onGet(d(a),a)},function(a){c.busy=!1,c._onError(a)})},watchPosition:function(a){var c=this;a=a||c._options,c._watcher=b.watchPosition(a,function(a,b){a?c._onWatch(d(a),a):c._onError(b)})},cancelWatch:function(){this._watcher&&(this._watcher.cancel(),this._watcher=null)}},function(a){return new c(a)}}]),cordovaHelperApp.factory("cameraHelper",["promiseService","geolocationService","cameraService",function(a,b,c){var d={geolocation:{timeout:2e4},camera:{quality:50,targetWidth:1280,targetHeight:720,correctOrientation:!0,encodingType:c.getEncodingTypes.JPEG,destinationType:c.getDestinationTypes.FILE_URI}},e={0:"image/jpeg",1:"image/png"};
return{capturePhotoWithLocation:function(f,g){return f=f||d.geolocation,g=g||d.camera,a.wrap(function(d){a.all({geolocation:b.getPosition(f),camera:c.capture(g)}).then(function(a){d.resolve({geolocation:{type:"Feature",geometry:{coordinates:[a.geolocation.coords.longitude,a.geolocation.coords.latitude],type:"Point"},properties:{source:"gps",accuracy:a.geolocation.coords.accuracy,altitude:a.geolocation.coords.altitude}},camera:{src:a.camera,type:e[g.encodingType]}})},d.reject)})}}}]);var sdkTestDataApp=angular.module("ag.sdk.test.data",["ag.sdk.utilities","ag.sdk.id","ag.sdk.library"]);sdkTestDataApp.provider("mockDataService",["underscore",function(a){var b={},c={localStore:!0};this.config=function(b){c=a.defaults(b,c)},this.$get=["localStore","objectId","promiseService",function(d,e,f){return c.localStore&&(b=d.getItem("mockdata")||{}),{setItem:function(a,f){f instanceof Array?(b[a]={},angular.forEach(f,function(c){c.id=c.id||e().toString(),b[a][c.id]=c})):(f.id=f.id||e().toString(),b[a]=b[a]||{},b[a][f.id]=f),c.localStore&&d.setItem("mockdata",b)},getItem:function(c,d){return f.wrap(function(e){b[c]=b[c]||{},void 0===d?e.resolve(a.toArray(b[c]||{})):b[c][d]?e.resolve(b[c][d]):e.reject()})}}}]}]);var cordovaCameraApp=angular.module("ag.mobile-sdk.cordova.camera",["ag.sdk.utilities","ag.sdk.library"]);cordovaCameraApp.factory("cameraService",["promiseService","underscore",function(a,b){function c(b){var c=a.defer();return void 0!==navigator.camera?navigator.camera.getPicture(function(a){c.resolve(a)},function(a){c.reject(a)},b):c.reject({code:"NoCamera",message:"No camera available"}),c.promise}"undefined"==typeof window.Camera&&(window.Camera={});var d=Camera.PictureSourceType,e=Camera.DestinationType,f=Camera.EncodingType;return{getDestinationTypes:e,getEncodingTypes:f,getPictureSourceTypes:d,capture:function(a){return"object"!=typeof a&&(a={}),c(b.defaults(a,{quality:50,destinationType:e.DATA_URL,source:d.CAMERA}))},captureAndEdit:function(a){return"object"!=typeof a&&(a={}),c(b.defaults(a,{quality:50,allowEdit:!0,destinationType:e.DATA_URL,source:d.CAMERA}))},retrieve:function(a){return"object"!=typeof a&&(a={}),c(b.defaults(a,{quality:50,destinationType:e.FILE_URI,source:d.PHOTOLIBRARY}))}}}]);var cordovaConnectionApp=angular.module("ag.mobile-sdk.cordova.connection",[]);cordovaConnectionApp.factory("connectionService",["$timeout",function(a){var b=[],c=void 0,d=function(){if(c!==navigator.connection.type){c=navigator.connection.type;for(var e=b.length-1;e>=0;e--)void 0!==b[e]?b[e](c):b.splice(e,1)}a(d,1e4)};return d(),{onConnectionChange:function(a){"function"==typeof a&&b.push(a)},isOnline:function(){return navigator.connection.type!==Connection.NONE},isMobile:function(){return navigator.connection.type===Connection.CELL||navigator.connection.type===Connection.CELL_2G||navigator.connection.type===Connection.CELL_3G||navigator.connection.type===Connection.CELL_4G}}}]);var cordovaGeolocationApp=angular.module("ag.mobile-sdk.cordova.geolocation",["ag.sdk.utilities","ag.sdk.library"]);cordovaGeolocationApp.factory("geolocationService",["promiseService","underscore",function(a,b){function c(a,b){switch(a){case PositionError.PERMISSION_DENIED:return f.PermissionDenied;case PositionError.POSITION_UNAVAILABLE:return f.PositionUnavailable;case PositionError.TIMEOUT:return f.Timeout;default:return{err:"Unknown",msg:b}}}var d=navigator.geolocation,e={enableHighAccuracy:!0},f={PermissionDenied:{err:"PermissionDenied",msg:"Not authorizated to request position"},PositionUnavailable:{err:"PositionUnavailable",msg:"Unable to receive position"},Timeout:{err:"Timeout",msg:"Unable to receive position within timeout"},Unknown:{err:"Unknown",msg:"An unknown error occured"}};return{getPosition:function(f){"object"!=typeof f&&(f={}),f=b.defaults(f,e);var g=a.defer();return d.getCurrentPosition(function(a){g.resolve(a)},function(a){g.reject(c(a.code,a.msg))},f),g.promise},watchPosition:function(a,f){function g(){var b=void 0;this.start=function(){void 0===b&&(b=d.watchPosition(function(a){f(a)},function(a){f(null,c(a.code,a.msg))},a))},this.cancel=function(){void 0!==b&&(d.clearWatch(b),b=void 0)},this.start()}return"function"==typeof a&&(f=a,a={}),"object"!=typeof a&&(a={}),a=b.defaults(a,e),new g}}}]);var cordovaStorageApp=angular.module("ag.mobile-sdk.cordova.storage",["ag.sdk.utilities"]);cordovaStorageApp.factory("fileStorageService",["$log","promiseService",function(a,b){var c=void 0,d={noFileSystem:{err:"NoFileSystem",msg:"Could not initialize file system"},directoryNotFound:{err:"directoryNotFound",msg:"Could not find requested directory"},fileNotFound:{err:"FileNotFound",msg:"Could not find requested file"},fileNotReadable:{err:"FileNotReadable",msg:"Could not read from file"},fileNotWritable:{err:"FileNotWritable",msg:"Could not write to file"}},e=function(a,b){void 0===c?window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(b){c=b,a()},b):a()},f=function(a,f){var g=b.defer(),h=function(a){g.resolve(a)},i=function(){g.reject(d.fileNotFound)};return e(function(){0===a.indexOf("file://")?window.resolveLocalFileSystemURI(a,h,i):c.root.getFile(a,f,h,i)},function(){g.reject(d.noFileSystem)}),g.promise};return a.debug("Initialized storageService"),{exists:function(a){var c=b.defer();return f(a,{create:!1}).then(function(a){c.resolve({exists:!0,file:a.name})},function(a){c.reject(a)}),c.promise},read:function(a,c){var e=b.defer();return f(a,{create:!1}).then(function(a){a.file(function(b){var f=new FileReader;f.onloadend=function(){e.resolve({read:!0,file:a.name,content:f.result})},f.onerror=function(){e.reject(d.fileNotReadable)},c===!0?f.readAsDataURL(b):f.readAsText(b)},function(){e.reject(d.fileNotFound)})},function(a){e.reject(a)}),e.promise},copy:function(a,e){var g=b.defer();return f(a,{create:!1}).then(function(a){c.root.getDirectory(e,{create:!0,exclusive:!1},function(b){a.copyTo(b,a.name,function(a){g.resolve({copy:!0,file:a.name,path:a.fullPath})},function(){g.reject(d.fileNotFound)})},function(){g.reject(d.directoryNotFound)})},function(a){g.reject(a)}),g.promise},move:function(a,e){var g=b.defer();return f(a,{create:!1}).then(function(a){c.root.getDirectory(e,{create:!0,exclusive:!1},function(b){a.moveTo(b,a.name,function(a){g.resolve({move:!0,file:a.name,path:a.fullPath})},function(){g.reject(d.fileNotFound)})},function(){g.reject(d.directoryNotFound)})},function(a){g.reject(a)}),g.promise},write:function(a,c){var e=b.defer();return f(a,{create:!0}).then(function(a){a.createWriter(function(b){b.onwriteend=function(){e.resolve({write:!0,file:a.name})},b.onerror=function(){e.reject(d.fileNotWritable)},b.write(c)},function(){e.reject(d.fileNotFound)})},function(a){e.reject(a)}),e.promise},remove:function(a){var c=b.defer();return f(a,{create:!1}).then(function(a){a.remove(function(){c.resolve({remove:!0,file:a.name})},function(){c.reject(d.fileNotFound)})},function(a){c.reject(a)}),c.promise}}}]);var mobileSdkApiApp=angular.module("ag.mobile-sdk.api",["ag.sdk.utilities","ag.sdk.monitor","ag.mobile-sdk.data","ag.mobile-sdk.cordova.storage","ag.sdk.library"]),_errors={TypeParamRequired:{code:"TypeParamRequired",message:"Type parameter is required"},UploadPhotoError:{code:"UploadPhotoError",message:"Error occured uploading photo"}};mobileSdkApiApp.factory("dataUploadService",["$http","configuration","promiseMonitor","promiseService","farmerApi","farmApi","fileStorageService","assetApi","documentApi","taskApi","enterpriseBudgetApi","legalEntityApi","underscore",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){return B.add(d.wrap(function(a){e.getFarmers().then(function(b){d.arrayWrap(function(a){angular.forEach(b,function(b){a.push(d.wrap(function(a){r(b).then(function(){d.all([s(b.id),t(b.id)]).then(a.resolve,a.reject)})}))})}).then(a.resolve,a.reject)})}))}function o(){return B.add(d.wrap(function(a){i.getDocuments().then(function(b){d.arrayWrap(function(a){angular.forEach(b,function(b){a.push(w(b))})}).then(a.resolve,a.reject)})}))}function p(){return B.add(d.wrap(function(a){j.getTasks().then(function(b){d.arrayWrap(function(a){angular.forEach(b,function(b){a.push(d.wrap(function(a){j.getTasks({template:"tasks/:id",schema:{id:b.id}}).then(function(c){d.arrayWrap(function(a){angular.forEach(c,function(b){a.push(z(b))})}).then(function(){return z(b)},a.reject).then(a.resolve,a.reject)},a.reject)}))})}).then(a.resolve,a.reject)})}))}function q(){return B.add(d.wrap(function(a){k.getEnterpriseBudgets().then(function(b){d.arrayWrap(function(a){angular.forEach(b,function(b){a.push(A(b))})}).then(a.resolve,a.reject)})}))}function r(a){return B.add(d.wrap(function(b){a.__dirty===!0?e.postFarmer({data:a}).then(b.resolve,b.reject):b.resolve()}))}function s(a){return B.add(d.wrap(function(b){f.getFarms({id:a}).then(function(a){d.arrayWrap(function(b){angular.forEach(a,function(a){a.__dirty===!0&&b.push(f.postFarm({data:a}))})}).then(b.resolve,b.reject)})}))}function t(a){return B.add(d.wrap(function(b){l.getEntities({id:a}).then(function(a){d.arrayWrap(function(b){angular.forEach(a,function(a){a.__dirty===!0&&b.push(l.postEntity({data:a})),b.push(u(a.id))})}).then(b.resolve,b.reject)})}))}function u(a){return B.add(d.wrap(function(b){h.getAssets({id:a}).then(function(a){d.arrayWrap(function(b){angular.forEach(a,function(a){b.push(v(a))})}).then(b.resolve,b.reject)})}))}function v(a){return B.add(d.wrap(function(b){if(a.__dirty===!0){var c=angular.copy(a.data.attachments);a.data.attachments=m.filter(a.data.attachments,function(a){return a.local!==!0}),h.postAsset({data:a}).then(function(d){d&&1==d.length?(a.data.attachments=c,x("asset",d[0].id,a).then(b.resolve,b.reject)):b.resolve()},b.reject)}else b.resolve()}))}function w(a){return B.add(d.wrap(function(b){if(a.__dirty===!0){var c=angular.copy(a.data.attachments);a.data.attachments=m.reject(a.data.attachments,function(a){return a.local===!0}),i.postDocument({data:a}).then(function(d){d&&1==d.length?(a.data.attachments=c,x("document",d[0].id,a).then(b.resolve,b.reject)):b.resolve()},b.reject)}else b.resolve()}))}function x(a,b,c){var e=null;return B.add(d.wrap(function(d){angular.forEach(c.data.attachments,function(c){c.local===!0&&(e?e.then(function(){return y(a,b,c)},d.reject):e=y(a,b,c))}),e?e.then(d.resolve,d.reject):d.resolve()}))}function y(c,e,f){return d.wrap(function(d){var h="api/"+c+"/"+e+"/attach";g.read(f.src,!0).then(function(c){a.post(b.getServer()+h,{archive:m.extend(m.omit(f,["src","local","key"]),{filename:c.file,content:c.content.substring(c.content.indexOf(",")+1)})},{withCredentials:!0}).then(d.resolve,d.reject)},d.reject)})}function z(a){return B.add(d.wrap(function(b){a.__dirty===!0?j.postTask({template:"task/:id",schema:{id:a.id},data:a}).then(b.resolve,b.reject):b.resolve()}))}function A(a){return B.add(d.wrap(function(b){a.__dirty===!0?k.postEnterpriseBudget({data:a}).then(b.resolve,b.reject):b.resolve()}))}var B=null;return function(a){return B=a||c(),d.wrap(function(a){n().then(o,a.reject).then(p,a.reject).then(q,a.reject).then(a.resolve,a.reject)})}}]),mobileSdkApiApp.factory("dataDownloadService",["promiseMonitor","promiseService","farmApi","assetUtility","farmerUtility","documentUtility","taskUtility","enterpriseBudgetApi",function(a,b,c,d,e,f,g,h){function i(){return m.add(b.wrap(function(a){e.api.getFarmers({options:n}).then(function(a){return b.arrayWrap(function(b){angular.forEach(a,function(a){b.push(e.hydration.dehydrate(a))})})},a.reject).then(a.resolve,a.reject)}))}function j(){return m.add(b.wrap(function(a){f.api.getDocuments({options:n}).then(function(a){return b.arrayWrap(function(b){angular.forEach(a,function(a){b.push(f.hydration.dehydrate(a))})})},a.reject).then(a.resolve,a.reject)}))}function k(){return m.add(b.wrap(function(a){g.api.getTasks({options:n}).then(function(a){return b.arrayWrap(function(b){angular.forEach(a,function(a){b.push(g.hydration.dehydrate(a))})})},a.reject).then(a.resolve,a.reject)}))}function l(){return m.add(h.getEnterpriseBudgets({options:n}))}var m=null,n={readLocal:!1,readRemote:!0};return function(c){return m=c||a(),b.wrap(function(a){i().then(j,a.reject).then(k,a.reject).then(l,a.reject).then(a.resolve,a.reject)})}}]),mobileSdkApiApp.factory("dataSyncService",["promiseMonitor","promiseService","dataUploadService","dataDownloadService",function(a,b,c,d){var e=null;return function(f){e=a(f),e.add(b.wrap(function(a){c(e).then(function(){d(e).then(a.resolve,a.reject)},a.reject)}))}}]),mobileSdkApiApp.factory("api",["promiseService","dataStore","underscore",function(a,b,c){return function(d){"String"==typeof d&&(d={singular:d,plural:d+"s"}),void 0===d.plural&&(d.plural=d.singular+"s");var e=b(d.singular,{apiTemplate:d.singular+"/:id"}),f=function(a){return d.strip?c.omit(a,d.strip):a};return{getItems:function(b){return b=b||{},a.wrap(function(a){e.transaction(function(c){b.template?c.getItems({template:b.template,schema:b.schema,options:b.options,callback:a}):b.search?(b.options.readLocal=!1,b.options.readRemote=!0,c.getItems({template:d.plural+"?search=:query",schema:{query:b.search},options:b.options,callback:a})):c.getItems(b.id?{template:d.plural+"/:id",schema:{id:b.id},options:b.options,callback:a}:{template:d.plural,options:b.options,callback:a})})})},createItem:function(b){return b=b||{},a.wrap(function(a){b.data?e.transaction(function(c){c.createItems({template:b.template,schema:b.schema,data:f(b.data),options:b.options,callback:a})}):a.resolve()})},getItem:function(b){return b=b||{},a.wrap(function(a){b.id?e.transaction(function(c){c.getItems({template:b.template,schema:{id:b.id},options:b.options,callback:a})}):a.resolve()})},findItem:function(b){return b=b||{},a.wrap(function(a){b.key?e.transaction(function(c){c.findItems({key:b.key,column:b.column,options:b.options,callback:a})}):a.resolve()})},updateItem:function(b){return b=b||{},a.wrap(function(a){b.data?e.transaction(function(c){c.updateItems({data:f(b.data),options:b.options,callback:a})}):a.resolve()})},postItem:function(b){return b=b||{},a.wrap(function(a){b.data?e.transaction(function(c){c.postItems({template:b.template,schema:b.schema,data:f(b.data),callback:a})}):a.resolve()})},deleteItem:function(b){return b=b||{},a.wrap(function(a){b.data?e.transaction(function(c){c.removeItems({template:d.singular+"/:id/delete",data:b.data,callback:a})}):a.resolve()})},purgeItem:function(b){return b=b||{},a.wrap(function(a){b.template?e.transaction(function(c){c.purgeItems({template:b.template,schema:b.schema,callback:a})}):a.resolve()})}}}}]),mobileSdkApiApp.factory("userApi",["api",function(a){var b=a({plural:"users",singular:"user"});return{getUsers:b.getItems,createUser:b.createItem,getUser:b.getItem,findUser:b.findItem,updateUser:b.updateItem,postUser:b.postItem,deleteUser:b.deleteItem}}]),mobileSdkApiApp.factory("teamApi",["api",function(a){var b=a({plural:"teams",singular:"team"});return{getTeams:b.getItems,createTeam:b.createItem,getTeam:b.getItem,findTeam:b.findItem,updateTeam:b.updateItem,postTeam:b.postItem,deleteTeam:b.deleteItem}}]),mobileSdkApiApp.factory("notificationApi",["api",function(a){var b=a({plural:"notifications",singular:"notification"});return{getNotifications:b.getItems,getNotification:b.getItem,deleteNotification:b.deleteItem}}]),mobileSdkApiApp.factory("taskApi",["api",function(a){var b=a({plural:"tasks",singular:"task",strip:["document","organization","subtasks"]});return{getTasks:b.getItems,createTask:b.createItem,getTask:b.getItem,findTask:b.findItem,updateTask:b.updateItem,postTask:b.postItem,deleteTask:b.deleteItem,purgeTask:b.purgeItem}}]),mobileSdkApiApp.factory("merchantApi",["api",function(a){var b=a({plural:"merchants",singular:"merchant"});return{getMerchants:b.getItems,createMerchant:b.createItem,getMerchant:b.getItem,updateMerchant:b.updateItem,postMerchant:b.postItem,deleteMerchant:b.deleteItem}}]),mobileSdkApiApp.factory("farmerApi",["api",function(a){var b=a({plural:"farmers",singular:"farmer",strip:["assets","farms","legalEntities"]});return{getFarmers:b.getItems,createFarmer:b.createItem,getFarmer:b.getItem,findFarmer:b.findItem,updateFarmer:b.updateItem,postFarmer:b.postItem,deleteFarmer:b.deleteItem,purgeFarmer:b.purgeItem}}]),mobileSdkApiApp.factory("legalEntityApi",["api",function(a){var b=a({plural:"legalentities",singular:"legalentity",strip:["assets"]});return{getEntities:b.getItems,createEntity:b.createItem,getEntity:b.getItem,findEntity:b.findItem,updateEntity:b.updateItem,postEntity:b.postItem,deleteEntity:b.deleteItem,purgeEntity:b.purgeItem}}]),mobileSdkApiApp.factory("farmApi",["api",function(a){var b=a({plural:"farms",singular:"farm"});return{getFarms:b.getItems,createFarm:b.createItem,getFarm:b.getItem,findFarm:b.findItem,updateFarm:b.updateItem,postFarm:b.postItem,deleteFarm:b.deleteItem,purgeFarm:b.purgeItem}}]),mobileSdkApiApp.factory("assetApi",["api",function(a){var b=a({plural:"assets",singular:"asset",strip:["farm","legalEntity"]});return{getAssets:b.getItems,createAsset:b.createItem,getAsset:b.getItem,findAsset:b.findItem,updateAsset:b.updateItem,postAsset:b.postItem,deleteAsset:b.deleteItem,purgeAsset:b.purgeItem}}]),mobileSdkApiApp.factory("documentApi",["api",function(a){var b=a({plural:"documents",singular:"document",strip:["organization","tasks"]});return{getDocuments:b.getItems,createDocument:b.createItem,getDocument:b.getItem,findDocument:b.findItem,updateDocument:b.updateItem,postDocument:b.postItem,deleteDocument:b.deleteItem,purgeDocument:b.purgeItem}}]),mobileSdkApiApp.factory("activityApi",["api",function(a){var b=a({plural:"activities",singular:"activity"});return{getActivities:b.getItems,createActivity:b.createItem,getActivity:b.getItem,deleteActivity:b.deleteItem}}]),mobileSdkApiApp.factory("enterpriseBudgetApi",["api",function(a){var b=a({plural:"budgets",singular:"budget"});return{getEnterpriseBudgets:b.getItems,createEnterpriseBudget:b.createItem,getEnterpriseBudget:b.getItem,findEnterpriseBudget:b.findItem,updateEnterpriseBudget:b.updateItem,postEnterpriseBudget:b.postItem,deleteEnterpriseBudget:b.deleteItem,purgeEnterpriseBudget:b.purgeItem}}]),mobileSdkApiApp.factory("pipGeoApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getFieldPolygon:function(c,e){return b.wrap(function(b){a.get(d+"api/geo/field-polygon?x="+c+"&y="+e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getPortionPolygon:function(c,e){return b.wrap(function(b){a.get(d+"api/geo/portion-polygon?x="+c+"&y="+e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getDistrictPolygon:function(c,e){return b.wrap(function(b){a.get(d+"api/geo/district-polygon?x="+c+"&y="+e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getProvincePolygon:function(c,e){return b.wrap(function(b){a.get(d+"api/geo/province-polygon?x="+c+"&y="+e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),mobileSdkApiApp.factory("hydration",["promiseService","taskApi","farmerApi","farmApi","assetApi","documentApi","legalEntityApi","underscore",function(a,b,c,d,e,f,g,h){var i={organization:{hydrate:function(b,d){return a.wrap(function(e){c.findFarmer({key:b.organizationId,options:{one:!0}}).then(function(b){a.all({farms:i.farms.hydrate(b,d),legalEntities:i.legalEntities.hydrate(b,d)}).then(function(a){e.resolve(h.extend(b,a))},e.reject)},e.reject)})},dehydrate:function(a){return a.organization.id=a.organization.id||a.organizationId,c.createFarmer({template:"farmers",data:a.organization,options:{replace:!1,dirty:!1}})}},farms:{hydrate:function(a){return d.getFarms({id:a.__id})},dehydrate:function(b){var c=void 0!==b.__id?b.__id:b.id;return a.wrap(function(e){d.purgeFarm({template:"farms/:id",schema:{id:c},options:{force:!1}}).then(function(){a.arrayWrap(function(a){angular.forEach(b.farms,function(b){a.push(d.createFarm({template:"farms/:id",schema:{id:c},data:b,options:{replace:!1,dirty:!1}}))})}).then(e.resolve,e.reject)},e.reject)})}},farm:{hydrate:function(a){return d.findFarm({key:a.farmId,options:{one:!0}})}},assets:{hydrate:function(a){return e.getAssets({id:a.__id})},dehydrate:function(b){var c=void 0!==b.__id?b.__id:b.id;return a.wrap(function(d){e.purgeAsset({template:"assets/:id",schema:{id:c},options:{force:!1}}).then(function(){a.arrayWrap(function(a){angular.forEach(b.assets,function(b){a.push(e.createAsset({template:"assets/:id",schema:{id:c},data:b,options:{replace:!1,dirty:!1}}))})}).then(d.resolve,d.reject)},d.reject)})}},legalEntities:{hydrate:function(b,c){return a.wrap(function(d){g.getEntities({id:b.__id}).then(function(b){return a.arrayWrap(function(a){angular.forEach(b,function(b){a.push(i.assets.hydrate(b,c).then(function(a){return b.assets=a,b},d.reject))})})},d.reject).then(d.resolve,d.reject)})},dehydrate:function(b,c){var d=void 0!==b.__id?b.__id:b.id;return a.wrap(function(e){g.purgeEntity({template:"legalentities/:id",schema:{id:d},options:{force:!1}}).then(function(){a.arrayWrap(function(a){angular.forEach(b.legalEntities,function(b){a.push(g.createEntity({template:"legalentities/:id",schema:{id:d},data:b,options:{replace:!1,dirty:!1}})),a.push(i.assets.dehydrate(b,c))})}).then(e.resolve,e.reject)},e.reject)})}},legalEntity:{hydrate:function(b,c){return a.wrap(function(a){g.findEntity({key:b.legalEntityId,options:{one:!0}}).then(function(b){return i.assets.hydrate(b,c).then(function(a){return b.assets=a,b},a.reject)}).then(a.resolve,a.reject)})}},document:{hydrate:function(a){return f.findDocument({key:a.documentId,options:{one:!0}})},dehydrate:function(a){return f.createDocument({template:"documents",data:a.document,options:{replace:!1,dirty:!1}})}},subtasks:{hydrate:function(a){return b.getTasks({template:"tasks/:id",schema:{id:a.__id}})},dehydrate:function(c){var d=void 0!==c.__id?c.__id:c.id;return a.wrap(function(e){b.purgeTask({template:"tasks/:id",schema:{id:d},options:{force:!1}}).then(function(){a.arrayWrap(function(a){angular.forEach(c.subtasks,function(c){a.push(b.createTask({template:"tasks/:id",schema:{id:d},data:c,options:{replace:!1,dirty:!1}}))})}).then(e.resolve,e.reject)},e.reject)})}}},j=function(b,c,d){return d=d||[],a.wrap(function(e){a.objectWrap(function(a){angular.forEach(d,function(d){var e=i[d];e&&e.hydrate&&(a[d]=e.hydrate(b,c))})}).then(function(a){e.resolve(h.extend(b,a))},function(a){e.resolve(h.extend(b,a))})})},k=function(b,c,d){return d=d||[],a.wrap(function(e){a.objectWrap(function(a){angular.forEach(d,function(d){var e=i[d];e&&e.dehydrate&&(a[d]=e.dehydrate(b,c))})}).then(function(){angular.forEach(d,function(a){delete b[a]}),e.resolve(b)},function(){e.reject()})})};return{hydrate:j,dehydrate:k}}]),mobileSdkApiApp.factory("taskUtility",["promiseService","hydration","taskApi",function(a,b,c){var d=["organization","document","subtasks"];return{hydration:{hydrate:function(e,f){return f=f||d,a.wrap(function(a){"object"!=typeof e?c.findTask({key:e,options:{one:!0}}).then(function(c){b.hydrate(c,"task",f).then(a.resolve,a.reject)},a.reject):b.hydrate(e,"task",f).then(a.resolve,a.reject)})},dehydrate:function(a,e){return e=e||d,b.dehydrate(a,"task",e).then(function(a){c.updateTask({data:a,options:{dirty:!1}})})}},api:c}}]),mobileSdkApiApp.factory("farmerUtility",["promiseService","hydration","farmerApi",function(a,b,c){var d=["farms","legalEntities"];return{hydration:{hydrate:function(e,f){return f=f||d,a.wrap(function(a){"object"!=typeof e?c.findFarmer({key:e,options:{one:!0}}).then(function(c){b.hydrate(c,"farmer",f).then(a.resolve,a.reject)},a.reject):b.hydrate(e,"farmer",f).then(a.resolve,a.reject)})},dehydrate:function(a,e){return e=e||d,angular.forEach(a.teams,function(b,c){"object"==typeof b&&(a.teams[c]=b.name)}),b.dehydrate(a,"farmer",e).then(function(a){c.updateFarmer({data:a,options:{dirty:!1}})})}},api:c}}]),mobileSdkApiApp.factory("assetUtility",["promiseService","hydration","assetApi",function(a,b,c){var d=["farm","legalEntity"];return{hydration:{hydrate:function(e,f){return f=f||d,a.wrap(function(a){"object"!=typeof e?c.findAsset({key:e,options:{one:!0}}).then(function(c){b.hydrate(c,"asset",f).then(a.resolve,a.reject)},a.reject):b.hydrate(e,"asset",f).then(a.resolve,a.reject)})},dehydrate:function(a,e){return e=e||d,b.dehydrate(a,"asset",e).then(function(a){c.updateAsset({data:a,options:{dirty:!1}})})}},api:c}}]),mobileSdkApiApp.factory("documentUtility",["promiseService","hydration","documentApi",function(a,b,c){var d=["organization"];return{hydration:{hydrate:function(e,f){return f=f||d,a.wrap(function(a){"object"!=typeof e?c.findDocument({key:e,options:{one:!0}}).then(function(c){b.hydrate(c,"document",f).then(a.resolve,a.reject)},a.reject):b.hydrate(e,"document",f).then(a.resolve,a.reject)})},dehydrate:function(a,e){return e=e||d,b.dehydrate(a,"document",e).then(function(a){c.updateDocument({data:a,options:{dirty:!1}})})}},api:c}}]);var mobileSdkDataApp=angular.module("ag.mobile-sdk.data",["ag.sdk.utilities","ag.sdk.config","ag.sdk.monitor","ag.sdk.library"]);mobileSdkDataApp.provider("dataPurge",function(){this.$get=["promiseService","dataStore",function(a,b){function c(c){return a.wrap(function(a){var d=b(c);d.transaction(function(b){b.purgeItems({callback:a})})})}return function(b){return a.wrapAll(function(a){for(var d=0;d<b.length;d++)a.push(c(b[d]))})}}]}),mobileSdkDataApp.factory("dataStoreUtilities",["$log","underscore",function(a,b){return{parseRequest:function(b,c){return a.debug("Unresolved: "+b),void 0!==b&&angular.forEach(c,function(a,c){b=b.replace("/:"+c,void 0!==a?"/"+a:"")}),a.debug("Resolved: "+b),b},generateItemIndex:function(){return 2e9+Math.round(147483647*Math.random())},injectMetadata:function(a){return b.extend("object"==typeof a.data?a.data:JSON.parse(a.data),{__id:a.id,__uri:a.uri,__dirty:1==a.dirty,__local:1==a.local,__saved:!0})},extractMetadata:function(a){return{id:a.__id,uri:a.__uri,dirty:a.__dirty,local:a.__local,data:b.omit(a,["__id","__uri","__dirty","__local","__saved"])}}}}]),mobileSdkDataApp.provider("dataStore",["underscore",function(a){var b,c={pageLimit:10,dbName:void 0,readLocal:!0,readRemote:!0},d={NoStoreParams:{code:"NoStoreParams",message:"No DataStore parameters defined"},NoConfigDBNameParams:{code:"NoConfigDBNameParams",message:"No Config database name defined"},NoConfigAPIParams:{code:"NoConfigAPIParams",message:"No Config API parameters defined"},NoConfigPagingParams:{code:"NoConfigPagingParams",message:"No Config Paging parameters defined"},NoReadParams:{code:"NoReadParams",message:"No DataRead parameters defined"},NoPagingDefined:{code:"NoPagingDefined",message:"No Paging parameters have been defined in config"},LocalDataStoreError:{code:"LocalDataStoreError",message:"Can not perform action on local data store"},RemoteDataStoreError:{code:"RemoteDataStoreError",message:"Can not perform action on remote data store"},RemoteNoDataError:{code:"RemoteNoDataError",message:"No data response from remote store"}};this.config=function(b){c=a.defaults(b||{},c)},this.$get=["$http","$log","$q","$rootScope","safeApply","configuration","dataStoreUtilities",function(e,f,g,h,i,j,k){function l(a){function b(c){if(f.debug("_processMigration"),d.length>0){var e=d[0];d.splice(0,1),e.current===c.version?(f.debug("Database ("+c.version+") has a newer version "+e.next),c.changeVersion(e.current,e.next,e.process,_errorCallback,function(){f.debug("Database version migrated from "+e.current+" to "+e.next),b(c)})):b(c)}else a(c)}var d=[];b(window.openDatabase(c.dbName,"",c.dbName,4194304))}function m(g,h){function j(a){var c=new q(2,a);b.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS "+g+" (id INT UNIQUE, uri TEXT, dirty INT DEFAULT 0, local INT DEFAULT 0, data TEXT, updated TIMESTAMP DEFAULT current_timestamp)",[],c.done,o),a.executeSql("CREATE TRIGGER IF NOT EXISTS "+g+"_timestamp AFTER UPDATE ON "+g+" BEGIN UPDATE "+g+"  SET updated = datetime('now') WHERE id = old.id AND uri = old.uri; END",[],c.done,o)})}function l(a){b.transaction(function(b){b.executeSql("DELETE FROM "+g,[],function(){a(!0)},function(){a(!1)})})}function o(a,b){"undefined"==typeof b&&(b=a,a=void 0),f.warn("string"==typeof b?"Error: "+b:void 0!==b.message?"Error: "+b.message+"("+b.code+")":b)}function p(a,b){return void 0===a[s.indexerProperty]&&f.warn("Configured indexer property not defined"),a[s.indexerProperty]||a.id||b}function q(a,b){return this instanceof q?{done:function(){a--,0==a&&b&&b.apply(this,arguments)}}:new q(a,b)}function r(){return this instanceof r?{createItems:function(b){var c=a.defaults(b||{},{template:s.apiTemplate,schema:{},data:[],options:{replace:!0,force:!1,dirty:!0},callback:angular.noop});c.data instanceof Array==!1&&(c.data=[c.data]);var d=new q(c.data.length,function(a,b){F(c.callback,a,b)});angular.forEach(c.data,function(b){var e=p(b,k.generateItemIndex());w(k.injectMetadata({id:e,uri:k.parseRequest(c.template,a.defaults(c.schema,{id:e})),data:b,dirty:c.options.dirty,local:c.options.dirty}),c.options,d.done)})},getItems:function(b){var e=a.defaults(b||{},{template:s.apiTemplate,schema:{},options:{page:1,limit:c.pageLimit,readLocal:s.readLocal,readRemote:s.readRemote,fallbackRemote:!1},callback:angular.noop}),f=function(a){z(a,function(b){b?v(b,a,function(a,b){F(e.callback,a,b)}):t(a,e.options,function(a,b){F(e.callback,a,b)})})};if("object"==typeof e.schema){var g=k.parseRequest(e.template,e.schema);e.options.readRemote===!0?f(g):e.options.readLocal===!0&&t(g,e.options,function(a,b){0==a.length&&e.options.fallbackRemote===!0?f(g):F(e.callback,a,b)})}else F(e.callback,null,d.NoReadParams)},findItems:function(b){var c=a.defaults(b||{},{key:"",column:"id",options:{like:!1,one:!1},callback:angular.noop});u(c.key,c.column,c.options,function(a,b){F(c.callback,a,b)})},updateItems:function(b){var c=a.defaults(b||{},{data:[],options:{dirty:!0},callback:angular.noop});c.data instanceof Array==!1&&(c.data=[c.data]),c.options.dirty&&angular.forEach(c.data,function(a){a.__dirty=!0}),w(c.data,c.options,function(a,b){F(c.callback,a,b)})},postItems:function(b){var c=a.defaults(b||{},{template:s.apiTemplate,schema:{},data:[],callback:angular.noop});c.data instanceof Array==!1&&(c.data=[c.data]),A(c.data,c.template,c.schema,function(a,b){F(c.callback,a,b)})},removeItems:function(b){var c=a.defaults(b||{},{template:void 0,schema:{},data:[],callback:angular.noop});c.data instanceof Array==!1&&(c.data=[c.data]);var d=new q(c.data.length,function(a,b){F(c.callback,a,b)});angular.forEach(c.data,function(a){a.__local===!0?x(a,d.done):B(a,c.template,c.schema,d.done)})},purgeItems:function(b){var c=a.defaults(b||{},{template:void 0,schema:{},options:{force:!0},callback:angular.noop});if(void 0!==c.template){var d=k.parseRequest(c.template,c.schema);t(d,c.options,function(a){var b=[];angular.forEach(a,function(a){(0==a.__dirty||1==c.options.force)&&b.push(a)}),x(b,function(a,b){F(c.callback,a,b)})})}else l(function(a,b){F(c.callback,a,b)})}}:new r}if(!(this instanceof m))return new m(g,h);if("string"!=typeof g)throw new Error(d.NoStoreParams.msg);if(void 0===c.dbName)throw new Error(d.NoConfigDBNameParams.msg);var s=a.defaults(h||{},{apiTemplate:void 0,paging:void 0,indexerProperty:"id",readLocal:c.readLocal,readRemote:c.readRemote});void 0!==s.paging&&(s.paging=a.defaults(s.paging,{template:"",schema:{},data:{page:1,limit:c.pageLimit}}));var t=function(a,c,e){f.debug("_getLocal"),"function"!=typeof e&&(e=angular.noop),b.transaction(function(b){b.executeSql("SELECT * FROM "+g+" WHERE uri = ?",[a],function(a,b){if(b.rows.length>0)if(c.one)e(k.injectMetadata(b.rows.item(0)));else{for(var d=[],f=0;f<b.rows.length;f++)d.push(k.injectMetadata(b.rows.item(f)));e(d)}else e(c.one?void 0:[])},function(a,b){o(a,b),e(null,d.LocalDataStoreError)})})},u=function(a,c,d,e){f.debug("_findLocal"),"function"!=typeof e&&(e=angular.noop),b.transaction(function(b){b.executeSql("SELECT * FROM "+g+" WHERE "+c+" "+(d.like?"LIKE":"=")+" ?",[d.like?"%"+a+"%":a],function(a,b){if(b.rows.length>0)if(d.one)e(k.injectMetadata(b.rows.item(0)));else{for(var c=[],f=0;f<b.rows.length;f++)c.push(k.injectMetadata(b.rows.item(f)));
e(c)}else e(d.one?void 0:[])},function(a,b){e(null,b)})})},v=function(a,b,c){f.debug("_syncLocal"),"function"!=typeof c&&(c=angular.noop),y(b,function(){w(a,function(){t(b,{},c)})})},w=function(c,d,e){if(f.debug("_updateLocal"),"function"==typeof d&&(e=d,d={}),"function"!=typeof e&&(e=angular.noop),c instanceof Array==!1&&(c=[c]),c.length>0){d=a.defaults(d||{},{replace:!0,force:!1});var h=new q(c.length,function(){e(c)});b.transaction(function(a){for(var b=0;b<c.length;b++){var e=k.extractMetadata(c[b]),f=JSON.stringify(e.data);a.executeSql("INSERT INTO "+g+" (id, uri, data, dirty, local) VALUES (?, ?, ?, ?, ?)",[e.id,e.uri,f,e.dirty?1:0,e.local?1:0],h.done,function(a){d.replace===!0?e.dirty===!0||e.local===!0||d.force?a.executeSql("UPDATE "+g+" SET uri = ?, data = ?, dirty = ?, local = ? WHERE id = ?",[e.uri,f,e.dirty?1:0,e.local?1:0,e.id],h.done,o):a.executeSql("UPDATE "+g+" SET uri = ?, data = ?, dirty = ?, local = ? WHERE id = ? AND dirty = 0 AND local = 0",[e.uri,f,e.dirty?1:0,e.local?1:0,e.id],h.done,o):h.done()})}})}else e(c)},x=function(a,c){if(f.debug("_deleteLocal"),a instanceof Array==!1&&(a=[a]),a.length>0){var d=new q(a.length,c);b.transaction(function(b){for(var c=0;c<a.length;c++){var e=k.extractMetadata(a[c]);b.executeSql("DELETE FROM "+g+" WHERE id = ? AND uri = ?",[e.id,e.uri],d.done,function(a){o(b,a),d.done()})}})}else c(a)},y=function(c,d,e){f.debug("_deleteAllLocal"),"function"==typeof d&&(e=d,d={}),d=a.defaults(d||{},{force:!1});var h=new q(1,e),i=function(){f.debug("handleSuccess"),h.done()},j=function(a,b){f.debug("handleError"),o(a,b),h.done()};f.debug(c),b.transaction(function(a){f.debug("_deleteAllLocal transaction"),d.force===!0?(f.debug("_deleteAllLocal force"),a.executeSql("DELETE FROM "+g+" WHERE uri = ?",[c],i,j)):(f.debug("_deleteAllLocal not force"),a.executeSql("DELETE FROM "+g+" WHERE uri = ? AND local = ? AND dirty = ?",[c,0,0],i,j))}),f.debug("_deleteAllLocal end")},z=function(a,b){f.debug("_getRemote"),"function"!=typeof b&&(b=angular.noop),void 0!==s.apiTemplate?i(function(){e.get(n+a,{withCredentials:!0}).then(function(c){if(null!=c.data&&"null"!==c.data){var e=c.data;if(e instanceof Array==!1)b([k.injectMetadata({id:p(e),uri:a,data:e,dirty:!1,local:!1})]);else{for(var f=[],g=0;g<e.length;g++){var h=e[g];f.push(k.injectMetadata({id:p(h),uri:a,data:h,dirty:!1,local:!1}))}b(f)}}else b(null,d.RemoteNoDataError)},function(a){o(a),b(null,d.RemoteDataStoreError)})}):b()},A=function(b,c,d,g){if(f.debug("_updateRemote"),"function"==typeof d?(g=d,d={}):"function"==typeof c&&(g=c,d={},c=void 0),"function"!=typeof g&&(g=angular.noop),void 0!==b&&void 0!==s.apiTemplate){b instanceof Array==!1&&(b=[b]);for(var h=void 0,j=new q(b.length,function(){g(h)}),l=function(a){h?h.push(a):h=[a]},m=function(a,b){i(function(){e.post(n+b,a.data,{withCredentials:!0}).then(function(b){if(200===b.status){var c=k.injectMetadata({id:p(b.data,a.id),uri:a.uri,data:a.data,dirty:!1,local:!1});1==a.local&&(c.id=c.__id,x(a)),l(c),w(c,{force:!0},j.done)}else o(err),j.done()},function(a){o(a),j.done()})})},r=0;r<b.length;r++){var t=k.extractMetadata(b[r]);t.dirty===!0?t.local||void 0!==c?(t.local&&void 0!==t.data[s.indexerProperty]&&delete t.data[s.indexerProperty],m(t,k.parseRequest(c||s.apiTemplate,a.extend(d,{id:t.local?void 0:t.id})))):m(t,t.uri):j.done()}}else g()},B=function(b,c,d,g){if(f.debug("_deleteRemote"),"function"==typeof d?(g=d,d={}):"function"==typeof c&&(g=c,d={},c=void 0),"function"!=typeof g&&(g=angular.noop),void 0!==b&&void 0!==c){b instanceof Array==!1&&(b=[b]);for(var h=new q(b.length,g),j=function(a,b){i(function(){e.post(n+b,{withCredentials:!0}).then(function(b){200===b.status?x(a,h.done):(o(err),h.done())},function(a){o(a),h.done()})})},l=0;l<b.length;l++){var m=k.extractMetadata(b[l]);m.local===!1?j(m,k.parseRequest(c,a.defaults(d,{id:m.id}))):h.done()}}else g()},C=!1,D=[],E=function(){if(void 0!==b)for(;D.length>0;){var a=D[0];a(new r),D.splice(0,1)}},F=function(a,b,c){void 0!==a&&("function"==typeof a?a(b,c):b?a.resolve(b):a.reject(c))};return j(function(){f.debug("table initialized"),C=!0,E()}),{defaults:c,config:s,transaction:function(a){"function"==typeof a&&(D.push(a),E())}}}var n=j.getServer()+"api/";return l(function(a){b=a,f.debug("database initialized")}),function(a,b){return new m(a,b)}}]}]),angular.module("ag.sdk.helper",["ag.sdk.helper.asset","ag.sdk.helper.crop-inspection","ag.sdk.helper.document","ag.sdk.helper.enterprise-budget","ag.sdk.helper.farmer","ag.sdk.helper.favourites","ag.sdk.helper.merchant","ag.sdk.helper.task","ag.sdk.helper.team","ag.sdk.helper.user"]),angular.module("ag.sdk.interface",["ag.sdk.interface.list","ag.sdk.interface.map","ag.sdk.interface.navigation"]),angular.module("ag.sdk.test",["ag.sdk.test.data"]),angular.module("ag.mobile-sdk",["ag.sdk.authorization","ag.sdk.id","ag.sdk.utilities","ag.sdk.monitor","ag.sdk.interface.map","ag.sdk.helper","ag.sdk.library","ag.sdk.test","ag.mobile-sdk.helper","ag.mobile-sdk.api","ag.mobile-sdk.data"]);