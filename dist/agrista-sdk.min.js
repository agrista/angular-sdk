var sdkApiGeoApp=angular.module("ag.sdk.api.geo",["ag.sdk.config","ag.sdk.utilities","ag.sdk.library"]);sdkApiGeoApp.factory("pipGeoApi",["$http","configuration","pagingService","promiseService","underscore","uriEncodeQuery",function(a,b,c,d,e,f){function g(a){return e.omit(a,function(a){return null==a||""==a})}function h(a){return f(g(a))}var i=b.getServer();return{getAdminRegion:function(b){return b=h(b),d.wrap(function(c){a.get(i+"api/geo/admin-region"+(b?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},searchAdminRegions:function(a){return c.page(i+"api/geo/admin-regions",g(a))},getColorMap:function(b){var c=h(e.pick(b,["type"]));return d.wrap(function(d){a.post(i+"api/geo/color-map"+(c?"?"+c:""),e.omit(b,["type"]),{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})},getDistrict:function(b){return b=h(b),d.wrap(function(c){a.get(i+"api/geo/district"+(b?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getFarm:function(b){return b=h(b),d.wrap(function(c){a.get(i+"api/geo/farm"+(b?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},searchFarms:function(a){return c.page(i+"api/geo/farms",g(a))},getField:function(b){return b=h(b),d.wrap(function(c){a.get(i+"api/geo/field"+(b?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getPortion:function(b){return b=h(b),d.wrap(function(c){a.get(i+"api/geo/portion"+(b?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},searchPortions:function(a){return c.page(i+"api/geo/portions",g(a))},getProvince:function(b){return b=h(b),d.wrap(function(c){a.get(i+"api/geo/province"+(b?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getSublayer:function(b){return b=h(b),d.wrap(function(c){a.get(i+"api/geo/sublayer"+(b?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]);var sdkApiApp=angular.module("ag.sdk.api",["ag.sdk.config","ag.sdk.utilities","ag.sdk.library","ag.sdk.api.geo"]);sdkApiApp.factory("activeFlagApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer();return{getActiveFlags:function(b){return d.wrap(function(c){a.get(f+"api/active-flags"+(b?"?purpose="+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getActiveFlagsByPage:function(a){return c.page(f+"api/active-flags",a)},updateActiveFlag:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/active-flag/"+e.id,e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("activityApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer();return{createActivity:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/activity",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getActivities:function(a,b,d){return"object"==typeof b&&(d=b,b=void 0),"object"==typeof a&&(d=a,a=void 0),c.page(f+"api/activities"+(a?"/"+a:"")+(b?"/"+b:""),d)},getDocumentActivities:function(a,b){return c.page(f+"api/activities/document/"+a,b)},getOrganizationActivities:function(a,b){return c.page(f+"api/activities/organization/"+a,b)},getActivity:function(b){return d.wrap(function(c){a.get(f+"api/activity/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteActivity:function(b){return d.wrap(function(c){a.post(f+"api/activity/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("aggregationApi",["$http","configuration","promiseService","pagingService","underscore",function(a,b,c,d,e){var f=b.getServer();return{getCustomerLocations:function(){return c.wrap(function(b){a.get(f+"api/aggregation/customer-locations",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getCustomerFarmlands:function(b,d,e,g){return c.wrap(function(c){a.get(f+"api/aggregation/customer-geodata?x1="+g+"&y1="+e+"&x2="+d+"&y2="+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getSublayerBoundaries:function(b,d,e,g){return c.wrap(function(c){a.get(f+"api/aggregation/guideline-sublayers?x1="+g+"&y1="+b+"&x2="+d+"&y2="+e,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getGroupCustomerLocations:function(){return c.wrap(function(b){a.get(f+"api/aggregation/customer-locations-group",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getGroupCustomerFarmlands:function(b,d,e,g){return c.wrap(function(c){a.get(f+"api/aggregation/customer-geodata-group?x1="+g+"&y1="+b+"&x2="+d+"&y2="+e,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getFarmlandOverlaps:function(a){return d.page(f+"api/aggregation/farmland-overlap",a)},getGuidelineExceptions:function(a){return d.page(f+"api/aggregation/guideline-exceptions",a)},listBenefitAuthorisation:function(){return c.wrap(function(b){a.get(f+"api/aggregation/report-benefit-authorisation",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},listCrossSelling:function(a){return d.page(f+"api/aggregation/report-cross-selling",a)},searchProductionSchedules:function(b){return b=e.map(b,function(a,b){return(e.isString(b)?b.toLowerCase():b)+"="+encodeURIComponent(a)}).join("&"),c.wrap(function(c){a.get(f+"api/aggregation/search-production-schedules"+(b?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},averageProductionSchedules:function(b){return c.wrap(function(c){a.post(f+"api/aggregation/average-production-schedules",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getDistinctProductionScheduleYears:function(b){return b=e.map(b,function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),c.wrap(function(c){a.get(f+"api/aggregation/distinct-production-schedule-years"+(b?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getDistinctProductionScheduleEnterprises:function(b){return b=e.map(b,function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),c.wrap(function(c){a.get(f+"api/aggregation/distinct-production-schedule-enterprises"+(b?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getDistinctProductionScheduleCategories:function(){return c.wrap(function(b){a.get(f+"api/aggregation/distinct-production-schedule-categories",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},mapReduce:function(b){return c.wrap(function(c){a.post(f+"api/aggregation/map-reduce",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("agristaApi",["organizationApi","underscore",function(a,b){return{getMerchants:function(){return a.searchOrganizations({type:"merchant"})},searchMerchants:function(c){return a.searchOrganizations(b.extend({type:"merchant"},c))},getMerchant:function(b){return a.searchOrganization({type:"merchant",uuid:b})}}}]),sdkApiApp.factory("assetApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer(),g=["liabilities","productionSchedules"];return{getAssets:function(a,b){return"object"==typeof a&&(b=a,a=void 0),c.page(f+"api/assets"+(a?"/"+a:""),b)},createAsset:function(c,e){var h=b(c,e?[]:g);return d.wrap(function(b){a.post(f+"api/asset",h,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getAsset:function(b){return d.wrap(function(c){a.get(f+"api/asset/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateAsset:function(c,e){var h=b(c,e?[]:g);return d.wrap(function(b){a.post(f+"api/asset/"+h.id,h,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},attachLiability:function(c,e){var g=b(e);return d.wrap(function(b){a.post(f+"api/asset/"+c+"/liability",g,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},detachLiability:function(b,c){return d.wrap(function(d){a.post(f+"api/asset/"+b+"/liability/"+c+"/delete",{},{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})},deleteAsset:function(b){return d.wrap(function(c){a.post(f+"api/asset/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},uploadAttachment:function(c,e){var g=b(e);return d.wrap(function(b){a.post(f+"api/asset/"+c+"/attach",g,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("attachmentApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getAttachmentUri:function(c){return b.wrap(function(b){a.get(d+"api/attachment/url?key="+encodeURIComponent(c),{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("benefitApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer();return{searchCustomerNumber:function(b){return d.wrap(function(c){a.get(f+"api/benefit/search?customerNumber="+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},linkCustomerNumber:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/benefit/link",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},unlinkCustomerNumber:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/benefit/unlink",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},authoriseCustomerNumber:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/benefit/authorise",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},modifyAuthorisedCustomerNumber:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/benefit/modify",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deauthoriseCustomerNumber:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/benefit/deauthorise",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},listMemberships:function(){return d.wrap(function(b){a.get(f+"api/benefit/memberships",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("comparableApi",["$http","asJson","pagingService","promiseService","configuration","underscore","uriEncodeQuery",function(a,b,c,d,e,f,g){var h=e.getServer();return{createComparable:function(c){var e=b(c);return d.wrap(function(b){a.post(h+"api/comparable",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},aggregateComparables:function(b){return b=g(b,{resulttype:"simple"}),d.wrap(function(c){a.get(h+"api/comparables/aggregate"+(b&&b.length>0?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},searchComparables:function(b){return b=g(b,{resulttype:"simple"}),d.wrap(function(c){a.get(h+"api/comparables/search"+(b&&b.length>0?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getComparable:function(b){return d.wrap(function(c){a.get(h+"api/comparable/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateComparable:function(c){var e=b(c);return d.wrap(function(b){a.post(h+"api/comparable/"+e.uuid,e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},uploadAttachment:function(c,e){var f=b(e);return d.wrap(function(b){a.post(h+"api/comparable/"+c+"/attach",f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},useComparable:function(b){return d.wrap(function(c){a.post(h+"api/comparable/"+b+"/use",{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteComparable:function(b){return d.wrap(function(c){a.post(h+"api/comparable/"+b+"/delete",{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("dataApi",["$http","asJson","configuration","promiseService","underscore","uriEncodeQuery",function(a,b,c,d,e,f){var g=c.getServer();return{aggregateAll:function(b){return b=f(b),d.wrap(function(c){a.post(g+"api/data/aggregate-all"+(b.length?"?"+b:""),{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},exportFile:function(c){var e=b(c);return d.wrap(function(b){a.post(g+"api/data/export-file",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},importFile:function(c){var e=b(c);return d.wrap(function(b){a.post(g+"api/data/import-file",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},validateFile:function(c){var e=b(c);return d.wrap(function(b){a.post(g+"api/data/validate-file",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("documentApi",["$http","asJson","configuration","pagingService","promiseService","uriEncodeQuery",function(a,b,c,d,e,f){var g=c.getServer(),h=["organization","origin","tasks"];return{getDocuments:function(a,b){return"object"==typeof a&&(b=a,a=void 0),d.page(g+"api/documents"+(a?"/"+a:""),b)},createDocument:function(c){var d=b(c,h);return e.wrap(function(b){a.post(g+"api/document",d,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getDocument:function(b){return e.wrap(function(c){a.get(g+"api/document/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},sendDocument:function(c,d){var f=b(d);return e.wrap(function(b){a.post(g+"api/document/"+c+"/send",f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},attachDocument:function(b,c,d){return d=f(d),e.wrap(function(e){a.post(g+"api/document/"+b+"/add/"+c+(d.length>0?"?"+d:""),{},{withCredentials:!0}).then(function(a){e.resolve(a.data)},e.reject)})},detachDocument:function(b,c,d){return d=f(d),e.wrap(function(e){a.post(g+"api/document/"+b+"/remove/"+c+(d.length>0?"?"+d:""),{},{withCredentials:!0}).then(function(a){e.resolve(a.data)},e.reject)})},updateDocument:function(c){var d=b(c,h);return e.wrap(function(b){a.post(g+"api/document/"+d.id,d,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteDocument:function(b){return e.wrap(function(c){a.post(g+"api/document/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},uploadAttachment:function(c,d){var f=b(d);return e.wrap(function(b){a.post(g+"api/document/"+c+"/attach",f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getDocumentPdf:function(c){var d=b(c);return e.wrap(function(b){a.post(g+"api/document/pdf/get",d,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},saveDocumentPdf:function(c){var d=b(c);return e.wrap(function(b){a.post(g+"api/document/pdf/save",d,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},mergeDocumentPdfs:function(c,d){var f=b(d);return e.wrap(function(b){a.post(g+"api/document/pdf/merge?key="+c,f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("enterpriseBudgetApi",["$http","asJson","httpRequestor","pagingService","promiseService","configuration","underscore","uriEncodeQuery",function(a,b,c,d,e,f,g,h){var i=f.getServer();return{getEnterpriseBudgets:function(a,b){return"object"==typeof a&&(b=a,a=void 0),d.page(i+"api/budgets"+(a?"?sublayer="+a:""),b)},getAveragedBudgets:function(b){return b=h(b,{resulttype:"simple"}),e.wrap(function(c){a.get(i+"api/budgets/averaged"+(b&&b.length>0?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},searchEnterpriseBudgets:function(a){return c(i+"api/budgets/search",a)},createEnterpriseBudget:function(c){var d=b(c);return e.wrap(function(b){a.post(i+"api/budget",d,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getEnterpriseBudget:function(b,c){return e.wrap(function(d){a.get(i+"api/budget/"+b+(c?"?requesttype="+c:""),{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})},getEnterpriseBudgetPublishers:function(b){return b=h(b),e.wrap(function(c){a.get(i+"api/budget/publishers"+(b.length>0?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getEnterpriseBudgetRegions:function(b){return b=h(b),e.wrap(function(c){a.get(i+"api/budget/regions"+(b.length>0?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateEnterpriseBudget:function(c){var d=b(c);return e.wrap(function(b){a.post(i+"api/budget/"+d.id,d,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},publishEnterpriseBudget:function(b,c){return c=c||{remote:"agrista"},e.wrap(function(d){a.post(i+"api/budget/"+b+"/publish",c,{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})},deleteEnterpriseBudget:function(b){return e.wrap(function(c){a.post(i+"api/budget/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},uploadAttachment:function(c,d){var f=b(d);return e.wrap(function(b){a.post(i+"api/budget/"+c+"/attach",f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},favoriteEnterpriseBudget:function(b){return e.wrap(function(c){a.post(i+"api/budget/"+b+"/favorite",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("expenseApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer();return{getExpenses:function(a){var b="api/expenses";return a&&a.key&&void 0!==a.id&&a.id>-1&&(b+="/"+a.key+"/"+a.id,delete a.key,delete a.id),c.page(f+b,a)},createExpense:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/expense",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateExpense:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/expense/"+e.id,e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteExpense:function(b){return d.wrap(function(c){a.post(f+"api/expense/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("farmApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer();return{getFarms:function(a,b){return"object"==typeof a&&(b=a,a=void 0),c.page(f+"api/farms"+(a?"/"+a:""),b)},createFarm:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/farm",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getFarm:function(b){return d.wrap(function(c){a.get(f+"api/farm/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateFarm:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/farm/"+e.id,e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteFarm:function(b){return d.wrap(function(c){a.post(f+"api/farm/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("farmerApi",["$http","asJson","configuration","organizationApi","pagingService","promiseService","taskApi","underscore",function(a,b,c,d,e,f,g,h){c.getServer();return{getFarmers:function(a){return d.getOrganizations(h.chain(a).defaults({type:"farmer"}).value())},searchFarmers:function(a){return d.searchOrganizations(h.defaults(a,{type:"farmer"}))},createFarmer:function(a,b){return d.createOrganization(h.defaults(a,{type:"farmer"}),b)},inviteFarmer:function(a){return d.inviteOrganization(a)},getFarmer:function(a){return d.getOrganization(a)},updateFarmer:function(a,b){return d.updateOrganization(a,b)},uploadAttachment:function(a,b){return d.uploadAttachment(a,b)},deleteFarmer:function(a){return d.deleteOrganization(a)}}}]),sdkApiApp.factory("farmlandValueApi",["$http","promiseService","configuration","underscore",function(a,b,c,d){var e=c.getServer();return{getFarmlandValue:function(c,f){return f=d.map(f,function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),b.wrap(function(b){a.get(e+"api/farmland-value/"+c+(f?"?"+f:""),{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getFarmlandValues:function(c){return c=d.map(c,function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),b.wrap(function(b){a.get(e+"api/farmland-values"+(c?"?"+c:""),{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("farmSaleApi",["$http","asJson","httpRequestor","pagingService","promiseService","configuration",function(a,b,c,d,e,f){var g=f.getServer(),h=["documents","organization"];return{createFarmSale:function(c,d){var f=b(c,d?[]:h);return e.wrap(function(b){a.post(g+"api/farm-sale",f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getFarmSales:function(a){return d.page(g+"api/farm-sales",a)},aggregateFarmSales:function(a){return c(g+"api/farm-sales/aggregate",a)},searchFarmSales:function(a){return d.page(g+"api/farm-sales/search",a)},getFarmSale:function(b){return e.wrap(function(c){a.get(g+"api/farm-sale/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateFarmSale:function(c,d){var f=b(c,d?[]:h);return e.wrap(function(b){a.post(g+"api/farm-sale/"+f.id,f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteFarmSale:function(b){return e.wrap(function(c){a.post(g+"api/farm-sale/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},attachDocument:function(b,c){return e.wrap(function(d){a.post(g+"api/farm-sale/"+b+"/add/"+c,{},{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})},detachDocument:function(b,c){return e.wrap(function(d){a.post(g+"api/farm-sale/"+b+"/remove/"+c,{},{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})}}}]),sdkApiApp.factory("financialApi",["$http","asJson","promiseService","configuration",function(a,b,c,d){var e=d.getServer(),f=["legalEntity"];return{getFinancials:function(b){return c.wrap(function(c){void 0!==b?a.get(e+"api/financials/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject):c.reject()})},createFinancial:function(d){var g=b(d,f);return c.wrap(function(b){a.post(e+"api/financial",g,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getFinancial:function(b){return c.wrap(function(c){a.get(e+"api/financial/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateFinancial:function(d){var g=b(d,f);return c.wrap(function(b){a.post(e+"api/financial/"+g.id,g,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteFinancial:function(b){return c.wrap(function(c){a.post(e+"api/financial/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("inviteApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getInvite:function(c){return b.wrap(function(b){a.get(d+"api/invite/"+c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("layerApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer();return{getLayerTypes:function(){return d.wrap(function(b){a.get(f+"api/layer/types",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getLayers:function(a){return c.page(f+"api/layers",a)},getLayer:function(b){return d.wrap(function(c){a.get(f+"api/layer/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},createLayer:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/layer",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateLayer:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/layer/"+e.id,e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getSublayers:function(a){return c.page(f+"api/sublayers",a)},getSublayer:function(b){return d.wrap(function(c){a.get(f+"api/sublayer/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getSublayersByLayer:function(b){return d.wrap(function(c){a.get(f+"api/sublayers/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},createSublayer:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/sublayer",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateSublayer:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/sublayer/"+e.id,e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteSublayer:function(b){return d.wrap(function(c){a.post(f+"api/sublayer/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("legalEntityApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer(),g=["assets","financials"];return{getEntities:function(a,b){return"object"==typeof a&&(b=a,a=void 0),c.page(f+"api/legalentities"+(a?"/"+a:""),b)},updateEntity:function(c,e){var h=b(c,e?[]:g);return d.wrap(function(b){a.post(f+"api/legalentity/"+h.id,h,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},uploadAttachment:function(c,e){var g=b(e);return d.wrap(function(b){a.post(f+"api/legalentity/"+c+"/attach",g,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getEntity:function(b){return d.wrap(function(c){a.get(f+"api/legalentity/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},createEntity:function(c,e){var h=b(c,e?[]:g);return d.wrap(function(b){a.post(f+"api/legalentity",h,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteEntity:function(b){return d.wrap(function(c){a.post(f+"api/legalentity/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},attachLiability:function(c,e){var g=b(e);return d.wrap(function(b){a.post(f+"api/legalentity/"+c+"/liability",g,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},detachLiability:function(b,c){return d.wrap(function(d){a.post(f+"api/legalentity/"+b+"/liability/"+c+"/delete",{},{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})}}}]),sdkApiApp.factory("liabilityApi",["$http","asJson","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{createLiability:function(d){var f=b(d);return c.wrap(function(b){a.post(e+"api/liability",f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateLiability:function(d){var f=b(d);return c.wrap(function(b){a.post(e+"api/liability/"+f.id,f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteLiability:function(b){return c.wrap(function(c){a.post(e+"api/liability/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("mapThemeApi",["$http","asJson","promiseService","configuration","underscore",function(a,b,c,d,e){var f=d.getServer();return{getMapThemes:function(b){return b=e.map(e.defaults(b||{},{resulttype:"simple"}),function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),c.wrap(function(c){a.get(f+"api/map-themes"+(b?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},createMapTheme:function(d){var e=b(d);return c.wrap(function(b){a.post(f+"api/map-theme",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateMapTheme:function(d){var e=b(d);return c.wrap(function(b){a.post(f+"api/map-theme/"+e.id,e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("merchantApi",["$http","asJson","organizationApi","pagingService","promiseService","configuration","underscore",function(a,b,c,d,e,f,g){var h=f.getServer();return{getMerchants:function(a){return c.getOrganizations(g.chain(a).defaults({type:"merchant"}).value())},searchMerchants:function(a){return c.searchOrganizations({type:"merchant",search:a})},searchByService:function(a,b,d){return c.getOrganizations(g.chain({type:"merchant",service:a}).extend(b?{x:b[0],y:b[1]}:{}).extend(d?{organizationId:d}:{}).value())},createMerchant:function(a){return c.createOrganization(g.defaults(a,{type:"merchant"}))},inviteMerchant:function(a){return c.inviteOrganization(a)},inviteMerchantUser:function(a){return c.inviteOrganizationUser(a)},registerMerchant:function(){return e.wrap(function(b){a.post(h+"api/register/merchant",dataCopy,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getMerchant:function(a){return c.getOrganization(a)},updateMerchant:function(a){return c.updateOrganization(a)},uploadAttachment:function(a,b){return c.uploadAttachment(a,b)},deleteMerchant:function(a){return c.deleteOrganization(a)}}}]),sdkApiApp.factory("notificationApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer();return{getNotifications:function(a){return c.page(f+"api/notifications",a)},createNotification:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/notification",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getNotification:function(b){return d.wrap(function(c){a.get(f+"api/notification/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},rejectNotification:function(c,e){var g=b(e);return d.wrap(function(b){a.post(f+"api/notification/"+c+"/reject",g,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},acceptNotification:function(b){return d.wrap(function(c){a.post(f+"api/notification/"+b+"/accept",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteNotification:function(b){return d.wrap(function(c){a.post(f+"api/notification/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("organizationApi",["$http","asJson","httpRequestor","pagingService","promiseService","configuration",function(a,b,c,d,e,f){var g=f.getServer(),h=["farms","legalEntities","pointsOfInterest"];return{createOrganization:function(c,d){var f=b(c,d?[]:h);return e.wrap(function(b){a.post(g+"api/organization",f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getOrganizations:function(a){return d.page(g+"api/organizations",a)},getOrganization:function(b){return e.wrap(function(c){a.get(g+"api/organization/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getOrganizationDuplicates:function(a){return c(g+"api/organization/"+a+"/duplicates")},searchOrganizations:function(a){return d.page(g+"api/organizations/search",a)},searchOrganization:function(a){return c(g+"api/organization/search",a)},inviteOrganization:function(b){return e.wrap(function(c){a.post(g+"api/organization/"+b+"/invite",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},inviteOrganizationUser:function(b){return e.wrap(function(c){a.post(g+"api/organization/"+b+"/invite-user",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},registerOrganization:function(c){var d=b(c);return e.wrap(function(b){a.post(g+"api/register/organization",d,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateOrganization:function(c,d){var f=b(c,d?[]:h);return e.wrap(function(b){a.post(g+"api/organization/"+f.id,f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},uploadAttachment:function(c,d){var f=b(d);return e.wrap(function(b){a.post(g+"api/organization/"+c+"/attach",f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteOrganization:function(b){return e.wrap(function(c){a.post(g+"api/organization/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("organizationalUnitApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer();return{createOrganizationalUnit:function(c){return d.wrap(function(d){a.post(f+"api/organizational-unit"+(c.type?"/"+c.type.toLowerCase():""),b(c),{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})},getOrganizationalUnits:function(a){return c.page(f+"api/organizational-units",a)},getOrganizationalUnitBranches:function(a){return c.page(f+"api/organizational-units/branches",a)},getOrganizationalUnitGroups:function(a){return c.page(f+"api/organizational-units/groups",a)
},getOrganizationalUnitRegions:function(a){return c.page(f+"api/organizational-units/regions",a)},getOrganizationalUnit:function(b){return d.wrap(function(c){a.get(f+"api/organizational-unit/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateOrganizationalUnit:function(c){var e=b(c,["organization","users"]);return d.wrap(function(b){a.post(f+"api/organizational-unit/"+e.id,e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteOrganizationalUnit:function(b){return d.wrap(function(c){a.post(f+"api/organizational-unit/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("pointOfInterestApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer(),g=["organization"];return{createPointOfInterest:function(c){var e=b(c,g);return d.wrap(function(b){a.post(f+"api/point-of-interest",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getPointOfInterest:function(b){return d.wrap(function(c){a.get(f+"api/point-of-interest/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},searchPointsOfInterest:function(a){return c.page(f+"api/points-of-interest/search",a)},updatePointOfInterest:function(c){var e=b(c,g);return d.wrap(function(b){a.post(f+"api/point-of-interest/"+e.id,e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deletePointOfInterest:function(b){return d.wrap(function(c){a.post(f+"api/point-of-interest/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("productDemandApi",["$http","asJson","pagingService","promiseService","configuration","underscore",function(a,b,c,d,e,f){var g=e.getServer();return{getProductDemandAssumptions:function(b){return b=f.map(b,function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),d.wrap(function(c){a.get(g+"api/demand-assumptions"+(b?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getMapData:function(b){return d.wrap(function(c){a.post(g+"api/demand-assumptions/map-data",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},addAssumptionGroup:function(c){var e=b(c);return d.wrap(function(b){a.post(g+"api/demand-assumption",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateProductDemandAssumption:function(c,e){var f=b(e);return d.wrap(function(b){a.post(g+"api/demand-assumption/"+c,f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteProductDemandAssumption:function(c){var e=b(c);return d.wrap(function(b){a.post(g+"api/demand-assumption/delete",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("productionScheduleApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer(),g=["assets","budget","organization"];return{getProductionSchedules:function(a){return c.page(f+"api/production-schedules"+(a?"/"+a:""))},createProductionSchedule:function(c,e){var h=b(c,e?[]:g);return d.wrap(function(b){a.post(f+"api/production-schedule",h,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getProductionSchedule:function(b){return d.wrap(function(c){a.get(f+"api/production-schedule/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateProductionSchedule:function(c,e){var h=b(c,e?[]:g);return d.wrap(function(b){a.post(f+"api/production-schedule/"+h.id,h,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteProductionSchedule:function(b){return d.wrap(function(c){a.post(f+"api/production-schedule/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},attachAsset:function(b,c){return d.wrap(function(d){a.post(f+"api/production-schedule/"+b+"/add/"+c,{},{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})},detachAsset:function(b,c){return d.wrap(function(d){a.post(f+"api/production-schedule/"+b+"/remove/"+c,{},{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})}}}]),sdkApiApp.factory("roleApi",["$http","asJson","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getRoles:function(){return c.wrap(function(b){a.get(e+"api/roles",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateRoleApps:function(d){var f=b(d);return c.wrap(function(b){a.post(e+"api/role-apps",f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("serviceApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getServices:function(a){return b.page(e+"api/services",a)},getService:function(b){return c.wrap(function(c){a.get(e+"api/service/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("shareApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getDocument:function(c){return b.wrap(function(b){a.get(d+"api/share/document/"+c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("tagApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getTags:function(){return b.wrap(function(b){a.get(d+"api/tags",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("taskApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer(),g=["document","organization","subtasks"];return{getTasks:function(a){return c.page(f+"api/tasks",a)},getManagerTasks:function(a){return c.page(f+"api/tasks/manager",a)},searchTasks:function(a){return c.page(f+"api/tasks/search",a)},createTask:function(c){var e=b(c,g);return d.wrap(function(b){a.post(f+"api/task",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getTask:function(b){return d.wrap(function(c){a.get(f+"api/task/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateTask:function(c){var e=b(c,g);return d.wrap(function(b){a.post(f+"api/task/"+e.id,e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteTask:function(b){return d.wrap(function(c){a.post(f+"api/task/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("teamApi",["$http","asJson","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getTeams:function(){return c.wrap(function(b){a.get(e+"api/teams",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},createTeam:function(d){var f=b(d);return c.wrap(function(b){a.post(e+"api/team",f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getTeam:function(b){return c.wrap(function(c){a.get(e+"api/team/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getTeamUsers:function(b){return c.wrap(function(c){a.get(e+"api/team/"+b+"/users",{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateTeam:function(d){var f=b(d);return c.wrap(function(b){a.post(e+"api/team/"+f.id,f,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteTeam:function(b){return c.wrap(function(c){a.post(e+"api/team/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("userApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer();return{getUsers:function(a){return c.page(f+"api/users",a)},getUsersByRole:function(b,c){return d.wrap(function(d){a.get(f+"api/users/organization/"+b+"?rolename="+c,{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})},getUsersPositions:function(){return d.wrap(function(b){a.get(f+"api/users/positions",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},createUser:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/user",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},inviteUser:function(b){return d.wrap(function(c){a.post(f+"api/user/"+b+"/invite",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getUser:function(b,c){if(c)var e="?username="+c;return d.wrap(function(c){a.get(f+"api/user/"+b+(e?e:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateUser:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/user/"+e.id,e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateUserGroups:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/user/"+e.id+"/groups",e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteUser:function(b){return d.wrap(function(c){a.post(f+"api/user/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("workloadApi",["$http","asJson","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer();return{updateWorkload:function(c){var e=b(c);return d.wrap(function(b){a.post(f+"api/workload/"+e.id,e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]);var sdkAuthorizationApp=angular.module("ag.sdk.authorization",["ag.sdk.config","ag.sdk.utilities","satellizer"]);sdkAuthorizationApp.factory("authorizationApi",["$http","promiseService","configuration","underscore",function(a,b,c,d){var e=c.getServer();return{requestReset:function(c){return b.wrap(function(b){a.post(e+"auth/request-reset",{email:c}).then(function(a){b.resolve(a.data)},b.reject)})},confirmReset:function(c){return b.wrap(function(b){a.post(e+"auth/confirm-reset",c).then(function(a){b.resolve(a.data)},b.reject)})},authorize:function(c,d){return b.wrap(function(b){a.post(e+"auth/"+c,d,{skipAuthorization:!0}).then(function(a){b.resolve(a.data)},b.reject)})},refresh:function(c){return b.wrap(function(b){a.post(e+"auth/refresh-token",{refresh_token:c},{skipAuthorization:!0}).then(function(a){b.resolve(a.data)},b.reject)})},changePassword:function(c,d){return b.wrap(function(b){a.post(e+"auth/change-password",{password:c,newPassword:d}).then(function(a){b.resolve(a.data)},b.reject)})},getUser:function(){return b.wrap(function(b){a.get(e+"api/me").then(function(a){b.resolve(a.data)},b.reject)})},updateUser:function(c){return b.wrap(function(b){a.post(e+"api/me",d.omit(c,"profilePhotoSrc")).then(function(a){b.resolve(a.data)},b.reject)})},logout:function(){return a.post(e+"logout",{})}}}]),sdkAuthorizationApp.provider("authorization",["$httpProvider",function(a){var b,c,d={open:1,user:2,admin:4},e={open:d.open|d.user|d.admin,user:d.user|d.admin,admin:d.admin},f={email:"",role:d.open},g={expiresIn:60};a.interceptors.push(["$injector","$log","$rootScope","localStore","moment","promiseService",function(a,b,d,e,f,h){function k(a){var b={config:a,defer:h.defer()};return m.push(b),b.defer.promise}function l(a){for(;m.length>0;){var b=m.shift();a&&(b.config.headers.Authorization="Bearer "+a),b.defer.resolve(b.config)}}var m=[];return{request:function(b){if(b.skipAuthorization||b.headers.Authorization)return g.lastRequest=f(),b;if(c&&c.refresh_token&&i(g)){if(0===m.length){var d=a.get("$auth"),h=a.get("authorizationApi");h.refresh(c.refresh_token).then(function(a){a&&(j(a),d.setToken(a.access_token),e.setItem("tokens",a),c=a),l(a&&a.access_token)},function(){l()})}return k(b)}return b},responseError:function(a){return b.debug(a),401===a.status?d.$broadcast("authorization::unauthorized",a):403===a.status&&d.$broadcast("authorization::forbidden",a),h.reject(a)}}}]);var h=["promiseService",function(a){return function(){return a.wrap(function(a){a.resolve()})}}],i=function(){return!0},j=["moment",function(a){return function(b){b&&(b.expires_at?(g.expiresAt=b.expires_at,g.expiresIn=a(g.expiresAt).diff(a(),"s")):b.expires_in&&(g.expiresIn=b.expires_in,g.expiresAt=a().add(g.expiresIn,"s").unix()))}}];return{userRole:d,accessLevel:e,setPreAuthenticate:function(a){h=a},setPreReauthenticate:function(a){i=a},$get:["$auth","$injector","$log","$rootScope","$timeout","authorizationApi","localStore","promiseService","underscore",function(a,g,i,k,l,m,n,o,p){function q(){return n.getItem("user")||f}function r(a){return a=a||f,void 0===a.role&&(a.role="admin"===a.accessLevel?d.admin:d.user),n.setItem("user",a),a}function s(b){return b&&b.data&&(j(b.data),a.setToken(b.data.access_token),n.setItem("tokens",b.data),c=b.data),m.getUser()}function t(a){return function(c){b=void 0,x=r(c),a.resolve(x),k.$broadcast("authorization::login",x)}}function u(a){return function(c){i.error(c),b={code:c.status,type:"error",message:c.data&&c.data.message||"Unable to Authenticate. Please try again."},n.removeItem("user"),a.reject({data:b})}}function v(){return 0!==(e.user&x.role)}var w,x=q();return c=n.getItem("tokens"),j instanceof Array&&(j=g.invoke(j)),h instanceof Array&&(h=g.invoke(h)),j(c),k.$on("authorization::unauthorized",function(){n.removeItem("user"),n.removeItem("tokens"),a.removeToken(),c=void 0}),{userRole:d,accessLevel:e,lastError:function(){return b},currentUser:function(){return x},setAuthentication:function(a){return w=o.wrap(function(b){p.has(a,"code")?h(a).then(function(){return m.authorize(a.provider,a)},o.throwError).then(function(a){return s({data:a})},o.throwError).then(t(b),u(b)):s({data:a}).then(t(b),u(b))})},waitForAuthentication:function(){return o.wrap(function(a){w?w.then(function(){v()?a.resolve(x):a.reject()},a.reject):v()?a.resolve(x):a.reject()})},getAuthenticationResponse:function(){return c},hasApp:function(a){return x&&x.userRole&&p.some(x.userRole.apps,function(b){return b.name===a})},isAdmin:function(){return x&&("admin"===x.accessLevel||x.userRole&&"Admin"===x.userRole.name)},isAllowed:function(a){return 0!==(a&x.role)},isLoggedIn:v,login:function(b,c){var d={email:b,password:c};return w=o.wrap(function(b){return h(d).then(function(){return a.login(d)},o.throwError).then(s,o.throwError).then(t(b),u(b))})},authenticate:function(b,c){return w=o.wrap(function(d){return h(c).then(function(){return a.authenticate(b,c)},o.throwError).then(s,o.throwError).then(t(d),u(d))})},requestReset:m.requestReset,confirmReset:function(a){return o.wrap(function(b){m.confirmReset(a).then(function(a){c&&(c.confirmed=!0,n.setItem("tokens",c)),b.resolve(a)},b.reject)})},changePassword:function(a,b){return m.changePassword(a,b)},changeUserDetails:function(a){return m.updateUser(a).then(function(a){return x=r(a),k.$broadcast("authorization::user-details__changed",x),a})},register:function(b){return w=o.wrap(function(c){return h(b).then(function(){return a.signup(b)},o.throwError).then(s,o.throwError).then(t(c),u(c))})},logout:function(){return m.logout().then(function(){return a.logout(),n.removeItem("user"),n.removeItem("tokens"),c=void 0,x=q(),k.$broadcast("authorization::logout"),x})}}}]}}]);var sdkConfigApp=angular.module("ag.sdk.config",[]);sdkConfigApp.provider("configuration",["$httpProvider",function(a){var b="",c="local",d=[],e={local:"",testing:"https://dev-enterprise.agrista.com/",staging:"https://staging-enterprise.agrista.com/",production:"https://enterprise.agrista.com/"},f=function(a){return-1!==d.indexOf(a)},g=function(a){0==f(a)&&d.push(a)},h=function(a){var b=e[c];return a&&b.lastIndexOf("/")===b.length-1&&(b=b.substr(0,b.length-1)),b};return{addModule:g,hasModule:f,setServers:function(a){angular.forEach(a,function(a,b){a.lastIndexOf("/")!==a.length-1&&(a+="/"),e[b]=a}),this.useHost(c,b)},setVersion:function(a){a&&(b=a)},getServer:h,useHost:function(d,f,g){"function"==typeof f&&(g=f,f=b),b=f||b,void 0!==e[d]&&(c=d,a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]),"function"==typeof g&&g(e[c])},$get:function(){return{addModule:g,hasModule:f,getVersion:function(){return b},getHost:function(){return c},getServer:h}}}}]);var sdkEditorApp=angular.module("ag.sdk.editor",["ag.sdk.library"]);sdkEditorApp.factory("enterpriseEditor",["underscore",function(a){function b(b){this.enterprises=a.map(b||[],function(a){return a.name?a.name:a}),this.selection={category:void 0,item:void 0}}return b.prototype.addEnterprise=function(b){b=b||this.selection.item,a.isUndefined(b)||-1!==this.enterprises.indexOf(b)||(this.enterprises.push(b),this.selection.item=void 0)},b.prototype.removeEnterprise=function(b){a.isString(b)&&(b=this.enterprises.indexOf(b)),-1!==b&&this.enterprises.splice(b,1)},function(a){return new b(a)}}]),sdkEditorApp.factory("serviceEditor",["underscore",function(a){function b(b,c){b=b||[],this.services=a.map(c||[],function(a){return a.serviceType?a.serviceType:a}),this.selection={list:b,mode:0===b.length?"add":"select",text:void 0}}return b.prototype.toggleMode=function(){this.selection.list.length>0&&(this.selection.mode="select"===this.selection.mode?"add":"select",this.selection.text=void 0)},b.prototype.addService=function(b){b=b||this.selection.text,a.isUndefined(b)||-1!==this.services.indexOf(b)||(this.services.push(b),this.selection.text=void 0)},b.prototype.removeService=function(b){a.isString(b)&&(b=this.services.indexOf(b)),-1!==b&&this.services.splice(b,1)},function(a,c){return new b(a,c)}}]),sdkEditorApp.factory("teamEditor",["underscore",function(a){function b(b,c){b=b||[],c=c||[],this.teams=a.map(c,function(a){return a.name?a.name:a}),this.teamsDetails=angular.copy(c),this.filterList=function(){var c=this;c.selection.list=a.reject(b,function(b){return a.contains(c.teams,b.name?b.name:b)})},this.selection={mode:0===b.length?"add":"select",text:void 0},this.filterList()}return b.prototype.toggleMode=function(){this.selection.list.length>0&&(this.selection.mode="select"===this.selection.mode?"add":"select",this.selection.text=void 0)},b.prototype.addTeam=function(b){b=b||this.selection.text,a.isUndefined(b)||-1!==this.teams.indexOf(b)||(this.teams.push(b),this.teamsDetails.push(a.findWhere(this.selection.list,{name:b})),this.selection.text=void 0,this.filterList())},b.prototype.removeTeam=function(b){a.isString(b)&&(b=this.teams.indexOf(b)),-1!==b&&(this.teams.splice(b,1),this.teamsDetails.splice(b,1),this.selection.text=void 0,this.filterList())},function(a,c){return new b(a,c)}}]);var sdkGeospatialApp=angular.module("ag.sdk.geospatial",["ag.sdk.utilities","ag.sdk.id","ag.sdk.library"]);sdkGeospatialApp.factory("sphericalHelper",[function(){var a=6378137,b=function(a,b){var c=Math.sin(Math.PI*(a[0]-b[0])/180)*Math.cos(Math.PI*b[1]/180),d=Math.cos(Math.PI*a[1]/180)*Math.sin(Math.PI*b[1]/180)-Math.sin(Math.PI*a[1]/180)*Math.cos(Math.PI*b[1]/180)*Math.cos(Math.PI*(a[0]-b[0])/180);return 180*Math.atan2(c,d)/Math.PI},c=function(b,c){var d=Math.sin(Math.PI*(c[0]-b[0])/360),e=Math.sin(Math.PI*(c[1]-b[1])/360),f=e*e+d*d*Math.cos(Math.PI*b[1]/180)*Math.cos(Math.PI*c[1]/180);return 2*a*Math.atan2(Math.sqrt(f),Math.sqrt(1-f))},d=function(b,c,d,g){var h,i=e(c),j=d/a,k=e(b[0]),l=e(b[1]),m=Math.asin(Math.sin(l)*Math.cos(j)+Math.cos(l)*Math.sin(j)*Math.cos(i)),n=Math.atan2(Math.sin(i)*Math.sin(j)*Math.cos(l),Math.cos(j)-Math.sin(l)*Math.sin(m));return h=g?(k-n+Math.PI)%(2*Math.PI)-Math.PI:k-n+Math.PI-Math.PI,[f(h),f(m)]},e=function(a){return a*(Math.PI/180)},f=function(a){return a*(180/Math.PI)};return{RADIUS:a,heading:b,distance:c,radial:d,rad:e,deg:f}}]),sdkGeospatialApp.factory("areaHelper",["sphericalHelper",function(a){var b=function(a,b){if(b&&b.length>0){a+=Math.abs(c(b[0]));for(var d=1;d<b.length;d++)a-=Math.abs(c(b[d]))}return a},c=function(b){var c,d,e,f,g,h,i,j=0,k=b.length;if(k>2){for(i=0;k>i;i++)i===k-2?(f=k-2,g=k-1,h=0):i===k-1?(f=k-1,g=0,h=1):(f=i,g=i+1,h=i+2),c=b[f],d=b[g],e=b[h],j+=(a.rad(e[0])-a.rad(c[0]))*Math.sin(a.rad(d[1]));j=j*a.RADIUS*a.RADIUS/2}return j};return{polygon:b,ring:c}}]),sdkGeospatialApp.factory("geoJSONHelper",["areaHelper","objectId","topologyHelper","underscore",function(a,b,c,d){function e(a,b){return this instanceof e?void this.addGeometry(a,b):new e(a,b)}function f(a,b){b&&(angular.isArray(b[0])?angular.forEach(b,function(b){f(a,b)}):angular.isArray(b)&&a.push([b[1],b[0]]))}function g(b,c){if(c.type)switch(c.type){case"Polygon":return a.polygon(0,c.coordinates);case"MultiPolygon":return d.reduce(c.coordinates,a.polygon,b);case"GeometryCollection":return d.reduce(c.geometries,g,b)}return b}function h(a){return a._json&&("Feature"===a._json.type?a._json.geometry:"FeatureCollection"!==a._json.type?a._json:{type:"GeometryCollection",geometries:d.pluck(a._json.features,"geometry")})}function i(a,b,d){var e=c.readGeoJSON(h(a)),f=c.readGeoJSON(d);return e&&f&&e[b]?e[b](f):!1}return e.prototype={getJson:function(){return this._json},getType:function(){return this._json.type},getGeometryType:function(){return this._json.geometry?this._json.geometry.type:this._json.type},getArea:function(){var a=this._json?g(0,this._json):0,b=1.19599*a;return{m_sq:a,ha:1e-4*a,mi_sq:b/3097600,acres:b/4840,yd_sq:b}},getBounds:function(){var a=[];if(this._json){var b=this._json.geometries||this._json.features||[this._json];angular.forEach(b,function(b){var c=b.geometry||b;f(a,c.coordinates)})}return a},getBoundingBox:function(a){a=a||this.getBounds();var b=0,c=0,d=0,e=0;return angular.forEach(a,function(a,f){0===f?(b=c=a[0],d=e=a[1]):(b=b<a[0]?b:a[0],c=c<a[0]?a[0]:c,d=d<a[1]?d:a[1],e=e<a[1]?a[1]:e)}),[[b,d],[c,e]]},geometry:function(){return c.readGeoJSON(h(this))},difference:function(a){var b=c.readGeoJSON(h(this));return this._json=c.writeGeoJSON(b.difference(a)),this},manipulate:function(a,b){return a&&(this._json=this._json?c.writeGeoJSON(i(this,b,a)):a),this},contains:function(a){return i(this,"contains",a)},within:function(a){return i(this,"within",a)},getCenter:function(){var a=c.readGeoJSON(h(this)),b=a?a.getCentroid().getCoordinate():a;return b?[b.x,b.y]:b},getCenterAsGeojson:function(){var a=c.readGeoJSON(h(this));return a?c.writeGeoJSON(a.getCentroid()):a},getProperty:function(a){return this._json&&this._json.properties?this._json.properties[a]:void 0},setCoordinates:function(a){this._json&&"FeatureCollection"!==this._json.type&&(this._json.geometry?this._json.geometry.coordinates=a:this._json.coordinates=a)},addProperties:function(a){var b=this;return this._json&&a&&("FeatureCollection"!==b._json.type&&"Feature"!==b._json.type?b._json={type:"Feature",geometry:b._json,properties:a}:(b._json.properties=b._json.properties||{},angular.forEach(a,function(a,c){b._json.properties[c]=a}))),b},addGeometry:function(a,c){return a&&(void 0===this._json?(this._json=a,this.addProperties(c)):("GeometryCollection"!==this._json.type&&"FeatureCollection"!==this._json.type&&"Feature"!==this._json.type&&(this._json={type:"GeometryCollection",geometries:[this._json]}),"Feature"===this._json.type&&(this._json.properties=d.defaults(this._json.properties||{},{featureId:b().toString()}),this._json={type:"FeatureCollection",features:[this._json]}),"FeatureCollection"===this._json.type&&this._json.features.push("Feature"===a.type?a:{type:"Feature",geometry:a,properties:d.defaults(c||{},{featureId:b().toString()})}),"GeometryCollection"===this._json.type&&("Feature"===a.type?this._json.features.push(a.geometry):this._json.geometries.push(a)))),this},formatGeoJson:function(a,b){if("point"===b.toLowerCase())switch(a&&a.type&&a.type.toLowerCase()){case"feature":if(a.geometry&&a.geometry.type&&"Point"===a.geometry.type)return a.geometry;break;case"featurecollection":break;case"geometrycollection":}return a},validGeoJson:function(a,b){var c=!0;if(!a||void 0===a.type||"string"!=typeof a.type||b&&a.type.toLowerCase()!==b)return!1;switch(a.type.toLowerCase()){case"feature":break;case"featurecollection":break;case"geometrycollection":break;default:if(!a.coordinates||!a.coordinates instanceof Array)return!1;var d=_.flatten(a.coordinates);d.forEach(function(a){"number"!=typeof a&&(c=!1)})}return c}},function(a,b){return new e(a,b)}}]),sdkGeospatialApp.factory("topologyHelper",["topologySuite",function(a){var b=new a.geom.GeometryFactory,c=new a.io.GeoJSONReader(b),d=new a.io.GeoJSONWriter(b);return{getGeometryFactory:function(){return b},getGeoJSONReader:function(){return c},getGeoJSONWriter:function(){return d},readGeoJSON:function(a){return a?c.read(a):void 0},writeGeoJSON:function(a){return a?d.write(a):void 0}}}]);var sdkIdApp=angular.module("ag.sdk.id",["ag.sdk.utilities"]);sdkIdApp.factory("objectId",["localStore",function(a){var b=function(){function c(){return this instanceof b?void("object"==typeof arguments[0]?(this.timestamp=arguments[0].timestamp,this.machine=arguments[0].machine,this.pid=arguments[0].pid,this.increment=arguments[0].increment):"string"==typeof arguments[0]&&24==arguments[0].length?(this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))):4==arguments.length&&null!=arguments[0]?(this.timestamp=arguments[0],this.machine=arguments[1],this.pid=arguments[2],this.increment=arguments[3]):(this.timestamp=Math.floor((new Date).valueOf()/1e3),this.machine=f,this.pid=e,this.increment=d++,d>16777215&&(d=0))):new b(arguments[0],arguments[1],arguments[2],arguments[3]).toString()}var d=0,e=Math.floor(32767*Math.random()),f=Math.floor(16777216*Math.random()),g=parseInt(a.getItem("mongoMachineId"));return g>=0&&16777215>=g&&(f=Math.floor(a.getItem("mongoMachineId"))),a.setItem("mongoMachineId",f),c}();return b.prototype.getDate=function(){return new Date(1e3*this.timestamp)},b.prototype.toArray=function(){var a,b=this.toString(),c=[];for(a=0;12>a;a++)c[a]=parseInt(b.slice(2*a,2*a+2),16);return c},b.prototype.toString=function(){var a=this.timestamp.toString(16),b=this.machine.toString(16),c=this.pid.toString(16),d=this.increment.toString(16);return"00000000".substr(0,8-a.length)+a+"000000".substr(0,6-b.length)+b+"0000".substr(0,4-c.length)+c+"000000".substr(0,6-d.length)+d},b.prototype.toBase64String=function(){return window.btoa(this.toString())},function(){return new b}}]),sdkIdApp.factory("generateUUID",function(){function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}return function(){return a()}});var sdkLibraryApp=angular.module("ag.sdk.library",[]);sdkLibraryApp.constant("bigNumber",window.BigNumber),sdkLibraryApp.constant("underscore",window._),sdkLibraryApp.constant("md5",window.md5),sdkLibraryApp.constant("moment",window.moment),sdkLibraryApp.constant("topologySuite",window.jsts),sdkLibraryApp.constant("naturalSort",window.naturalSort);var sdkMonitorApp=angular.module("ag.sdk.monitor",["ag.sdk.utilities"]);sdkMonitorApp.config(["$provide",function(a){a.decorator("$log",["$delegate","$filter","logStore","moment","underscore",function(a,b,c,d,e){function f(a,f){var g=a[f];a[f]=function(){var a=[].slice.call(arguments),h=arguments.callee&&arguments.callee.caller&&arguments.callee.caller.name.length>0?arguments.callee.caller.name+" :: ":"",i=e.isObject(a[0])?"function"==typeof a[0].toString?a[0].toString():"\n"+b("json")(a[0]):a[0];a[0]=d().format("YYYY-MM-DDTHH:mm:ss.SSS")+e.lpad(" ["+f.toUpperCase()+"] ",7," ")+h+i,c.log(f,a[0]),g.apply(null,a)}}return f(a,"log"),f(a,"info"),f(a,"warn"),f(a,"debug"),f(a,"error"),a}])}]),sdkMonitorApp.provider("logStore",[function(){var a=[],b={maxItems:1e3},c=b;return{config:function(a){c=a},$get:["underscore",function(d){return c=d.defaults(c,b),{log:function(b,d){var e={level:b,entry:d};a.splice(0,0,e),a.length>c.maxItems&&a.pop()},clear:function(){a=[]},list:function(){return a}}}]}}]),sdkMonitorApp.factory("promiseMonitor",["$log","safeApply",function(a,b){function c(d){if(!(this instanceof c))return new c(d);var e={total:0,complete:0,resolved:0,rejected:0,percent:0},f=function(){e.complete++,e.percent=100/e.total*e.complete,a.debug("MONITOR TOTAL: "+e.total+" COMPLETE: "+e.complete+" PERCENT: "+e.percent),b(function(){d(e.complete==e.total?{type:"complete",percent:e.percent,stats:e}:{type:"progress",percent:e.percent,stats:e})})};return{stats:function(){return e},clear:function(){e={total:0,complete:0,resolved:0,rejected:0,percent:0}},add:function(a){return e.total++,a.then(function(){e.resolved++,f()},function(a){e.rejected++,b(function(){d({type:"error"},a)}),f()}),a}}}return function(a){return new c(a)}}]);var sdkUtilitiesApp=angular.module("ag.sdk.utilities",["ngCookies","ag.sdk.id"]);sdkUtilitiesApp.factory("safeApply",["$rootScope",function(a){return function(b){a.$$phase?b():a.$apply(b)}}]),sdkUtilitiesApp.directive("stopEvent",function(){return{restrict:"A",link:function(a,b,c){b.bind(c.stopEvent,function(a){a.stopPropagation()})}}}),sdkUtilitiesApp.factory("dataMapService",[function(){return function(a,b,c){var d=[];a instanceof Array==!1&&(a=void 0!==a?[a]:[]);for(var e=0;e<a.length;e++){var f,g=a[e];if("function"==typeof b)f=b(g);else{f={};for(var h in b)b.hasOwnProperty(h)&&(f[h]=g[b[h]])}f instanceof Array?d=d.concat(f):"object"==typeof f?(c!==!0&&(f.id=f.id||g.id),d.push(f)):void 0!==f&&d.push(f)}return d}}]),sdkUtilitiesApp.factory("pagingService",["$rootScope","$http","promiseService","dataMapService","generateUUID","underscore","uriQueryFormatArrays",function(a,b,c,d,e,f,g){var h=e();return{initialize:function(b,f,g,i){"object"==typeof g&&(i=g,g=f,f=void 0),"object"==typeof f&&(i=f,g=void 0,f=void 0),h=e(),g=g||function(b){a.$broadcast("paging::items",b)};var j=_.defaults(i||{},{limit:50,resulttype:"simple"}),k={page:_.clone(j),busy:!1,complete:!1,disabled:function(){return k.busy||k.complete||void 0!==k.searching&&k.searching.complete},search:function(a){a&&a.length>0?((void 0===k.searching||k.searching.complete===!1||k.searching.search!==a)&&(k.searching=_.defaults({search:a},j)),k.request()):delete k.searching},request:function(a){return c.wrap(function(c){if(k.disabled())c.reject();else{var e=h;a=a||(k.searching?k.searching:k.page),k.busy=!0,delete a.complete,b(a).then(function(b){void 0===a.search?(k.page.offset=void 0===k.page.offset?b.length:k.page.offset+b.length,k.complete=b.length!==k.page.limit):(k.searching=a,k.searching.offset=void 0===k.searching.offset?b.length:k.searching.offset+b.length,k.searching.complete=b.length!==k.searching.limit),k.busy=!1,f&&(b=d(b,f)),e===h&&g(b),c.resolve(b)},function(a){k.complete=!0,k.busy=!1,c.reject(a)})}})}};return k},page:function(a,d){return c.wrap(function(c){var e=function(a){c.resolve(a.data)};if(f.isUndefined(d))b.get(a,{withCredentials:!0}).then(e,c.reject);else if(f.isString(d))b.get(d,{withCredentials:!0}).then(e,c.reject);else{var h=f.isObject(d.resulttype)?{method:"POST",url:a,data:d.resulttype,params:g(f.omit(d,"resulttype")),withCredentials:!0}:{method:"GET",url:a,params:g(d),withCredentials:!0};b(h).then(e,c.reject)}})}}}]),sdkUtilitiesApp.factory("apiPager",["pagingService","promiseService",function(a,b){return function(c,d){return b.wrap(function(b){var e=[],f=a.initialize(c,function(a){e=e.concat(a),f.complete?b.resolve(e):f.request()["catch"](b.reject)},d);f.request()["catch"](b.reject)})}}]),sdkUtilitiesApp.factory("httpRequestor",["$http","underscore","uriQueryFormatArrays",function(a,b,c){return function(d,e){return e=e||{},a(b.extend(b.isObject(e.resulttype)?{method:"POST",data:e.resulttype,params:c(b.omit(e,"resulttype"))}:{method:"GET",params:c(e)},{url:d,withCredentials:!0})).then(function(a){return a.data})}}]),sdkUtilitiesApp.filter("parenthesizeProps",["underscore",function(a){return function(b,c,d){var e=b.lastIndexOf(")"),f=a.chain(c).compact().map(function(a){return a.split(", ")}).flatten().reject(function(a){return s.include(b,a)}).value().join(d||", ");return 0===f.length?b:-1===e?b+" ("+f+")":b.substr(0,e)+", "+f+b.substr(e)}}]),sdkUtilitiesApp.factory("promiseService",["$timeout","$q","safeApply",function(a,b,c){var d=function(){var a=b.defer();return{resolve:function(b){c(function(){a.resolve(b)})},reject:function(b){c(function(){a.reject(b)})},promise:a.promise}},e=function(a,c){var d=b.defer(),e=d.promise,f=[];
a(c);var g=function(a){return e.then(function(b){return b instanceof Array?f=f.concat(b):b&&f.push(b),a?a():f},function(a){throw a})};return angular.forEach(c,function(a){e=g(a)}),d.resolve(),g()},f=function(a,c){return a(c),b.all(c)};return{all:b.all,reject:b.reject,resolve:b.resolve,chain:function(a){return e(a,[])},wrap:function(b){var c=d();return a(function(){b(c)},0),c.promise},wrapAll:function(a){return f(a,[])},arrayWrap:function(a){return f(a,[])},objectWrap:function(a){return f(a,{})},throwError:function(a){throw a},defer:d}}]),sdkUtilitiesApp.factory("localStore",["$cookieStore","$window",function(a,b){return{setItem:function(c,d){b.localStorage?b.localStorage.setItem(c,JSON.stringify(d)):a.put(c,d)},getItem:function(c,d){return b.localStorage?JSON.parse(b.localStorage.getItem(c))||d:a.get(c)||d},removeItem:function(c){b.localStorage?b.localStorage.removeItem(c):a.remove(c)}}}]),sdkUtilitiesApp.factory("colorHash",[function(){function a(a){for(var b=0,c=0;c<a.length;c++)b=a.charCodeAt(c)+((b<<5)-b);return b}return function(b){var c=(16777215&a(b)).toString(16).toUpperCase();return"#"+"00000".substring(0,6-c.length)+c}}]),sdkUtilitiesApp.filter("round",[function(){return function(a,b){return b=b||2,Number(Math.round(a+"e"+b)+"e-"+b)}}]),sdkUtilitiesApp.factory("asJson",["deepCopy","underscore",function(a,b){function c(c){return function(d){var e=b.isFunction(d.asJSON)?d.asJSON(c):a(d);return c?b.omit(e,c):e}}return function(a,d){return b.isArray(a)?b.map(a,c(d)):c(d)(a)}}]),sdkUtilitiesApp.factory("sortJson",["underscore",function(a){function b(b){var d=a.keys(b).sort();return a.object(d,a.map(d,function(a){return c(b[a])}))}function c(c){return a.isUndefined(c)?null:a.isObject(c)&&!a.isArray(c)?b(c):c}return c}]),sdkUtilitiesApp.factory("md5Json",["md5String","sortJson",function(a,b){function c(a){return a?JSON.stringify(a):a}return function(d){return a(c(b(d)))}}]),sdkUtilitiesApp.factory("md5String",["md5",function(a){return function(b){return b?a(b.toLowerCase().replace(" ","")):b}}]),sdkUtilitiesApp.factory("deepCopy",[function(){return function(a){return JSON.parse(JSON.stringify(a))}}]),sdkUtilitiesApp.factory("safeMath",["bigNumber",function(a){return a.config({ERRORS:!1}),{chain:function(b){return new a(b||0)},plus:function(b,c){return new a(b||0).plus(c||0).toNumber()},minus:function(b,c){return new a(b||0).minus(c||0).toNumber()},dividedBy:function(b,c){return c?new a(b||0).dividedBy(c).toNumber():0},times:function(b,c){return new a(b||0).times(c||0).toNumber()},round:function(b,c){return new a(b||0).round(c).toNumber()}}}]),sdkUtilitiesApp.factory("safeArrayMath",["safeMath","underscore",function(a,b){function c(a,b){return a=a||[],b=b||[],{"short":a.length<=b.length?a:b,"long":a.length>b.length?a:b}}function d(a,c,d){var e=c.concat(c.length>=a.length?[]:b.range(a.length-c.length).map(function(){return 0}));return b.reduce(e,function(a,b,c){return a[c]=d(a[c],b),a},angular.copy(a))}function e(a,d,e){var f=c(a,d);return b.reduce(f["short"],function(a,b,c){return a[c]=e(a[c],b),a},angular.copy(f["long"]))}function f(c,d,e){return e=e||"plus",b.reduce(c||[],function(b,c){return a[e](b,c)},d||0)}return{count:function(c){return b.reduce(c,function(c,d){return a.plus(c,b.isNumber(d)&&!b.isNaN(d)&&d>0?1:0)},0)},plus:function(b,c){return e(b,c,a.plus)},minus:function(b,c){return d(b,c,a.minus)},dividedBy:function(b,c){return d(b,c,a.dividedBy)},times:function(b,c){return e(b,c,a.times)},reduce:function(a,b){return f(a,b)},reduceOperator:function(a,b,c){return f(a,c,b)},reduceProperty:function(c,d,e){return b.chain(c||[]).pluck(d).reduce(function(b,c){return a.plus(b,c)},e||0).value()},negate:function(c){return b.map(c,function(b){return a.times(b,-1)})},round:function(c,d){return b.map(c,function(b){return a.round(b,d)})}}}]),sdkUtilitiesApp.factory("uriQueryFormatArrays",["underscore",function(a){return function(b){return a.mapObject(b,function(b){return a.isArray(b)?b.join(","):b})}}]),sdkUtilitiesApp.factory("uriEncodeQuery",["underscore",function(a){return function(b,c){return a.chain(b||{}).defaults(c||{}).map(function(a,b){return b+"="+encodeURIComponent(a)}).value().join("&")}}]);var sdkHelperAssetApp=angular.module("ag.sdk.helper.asset",["ag.sdk.helper.attachment","ag.sdk.library"]);sdkHelperAssetApp.factory("assetValuationHelper",["Asset","underscore",function(a,b){var c=function(a){return{title:a.organization.name,subtitle:"Valued at "+a.currency+" "+a.assetValue,date:a.date}};return{listServiceMap:function(){return c},calculateAssetValue:function(a){"vme"==a.type&&0==isNaN(a.data.quantity)?a.data.assetValue=a.data.quantity*(a.data.unitValue||0):"livestock"==a.type&&0==isNaN(a.data.totalStock)?a.data.assetValue=a.data.totalStock*(a.data.unitValue||0):"crop"==a.type&&0==isNaN(a.data.expectedYield)?a.data.assetValue=a.data.expectedYield*(a.data.unitValue||0):"improvement"==a.type?(a.data.valuation=a.data.valuation||{},a.data.valuation.replacementValue=a.data.size*(a.data.valuation&&a.data.valuation.constructionCost||0),a.data.valuation.totalDepreciation=b.reduce(["physicalDepreciation","functionalDepreciation","economicDepreciation","purchaserResistance"],function(b,c){return isNaN(a.data.valuation[c])?b:b*(1-a.data.valuation[c])},1),a.data.assetValue=Math.round((a.data.valuation.replacementValue||0)*Math.min(a.data.valuation.totalDepreciation,1))):"improvement"!=a.type&&0==isNaN(a.data.size)&&(a.data.assetValue=a.data.size*(a.data.unitValue||0)),a.data.assetValue=Math.round(100*a.data.assetValue)/100},getApplicableGuidelines:function(c,d,e){var f=a.landClassesByType[d.type]||[],g=b.chain(c).filter(function(a){return-1!==f.indexOf(a.assetClass)});if("cropland"===d.type)g=g.filter(function(a){return e.irrigated?d.data.waterSource?a.waterSource&&-1!==a.waterSource.indexOf(d.data.waterSource):"Potential Irrigable Land"===a.category:"Cropland"===a.assetClass&&(void 0===a.soilPotential||a.soilPotential===e.croppingPotential)});else if("pasture"===d.type||"wasteland"===d.type)g=g.where({assetClass:e.landUse}).filter(function(a){return(void 0===d.data.crop&&void 0===a.crop||void 0!==a.crop&&-1!==a.crop.indexOf(d.data.crop))&&(void 0===e.terrain&&void 0===a.terrain||a.terrain===e.terrain)});else if("permanent crop"===d.type){var h=moment(d.data.establishedDate),i=moment().diff(h,"months");g=g.filter(function(a){return a.crop&&-1!==a.crop.indexOf(d.data.crop)&&(!d.data.irrigation||void 0===a.irrigationType||-1!==a.irrigationType.indexOf(d.data.irrigation))&&(void 0===a.minAge||i>=a.minAge)&&(void 0===a.maxAge||i<a.maxAge)})}else"plantation"===d.type?g=g.filter(function(a){return void 0===a.crop||-1!==a.crop.indexOf(d.data.crop)}):"water right"===d.type&&(g=g.filter(function(a){return void 0===a.waterSource||-1!==a.waterSource.indexOf(d.data.waterSource)}));return g.value()}}}]);var sdkHelperAttachmentApp=angular.module("ag.sdk.helper.attachment",["ag.sdk.library"]);sdkHelperAttachmentApp.provider("attachmentHelper",["underscore",function(a){var b={defaultImage:"img/camera.png",fileResolver:function(a){return a}};this.config=function(c){b=a.defaults(c||{},b)},this.$get=["$injector","promiseService",function(c){a.isArray(b.fileResolver)&&(b.fileResolver=c.invoke(b.fileResolver));var d=function(c,d,e,f){c=a.isArray(c)?c:[c],f=a.isUndefined(f)||a.isArray(f)?f:[f],e=e||b.defaultImage;var g=a.chain(c).filter(function(b){return(a.isUndefined(f)||a.contains(f,b.type))&&(a.isString(b.base64)||b.sizes&&b.sizes[d])}).map(function(b){return a.isString(b.base64)?"data:"+(b.mimeType||"image")+";base64,"+b.base64:b.sizes[d].src}).last().value();return g?b.fileResolver(g):e};return{findSize:function(a,b,c,e){return d(a.data&&a.data.attachments?a.data.attachments:[],b,c,e)},getSize:function(a,b,c,e){return d(a?a:[],b,c,e)},getThumbnail:function(a,b,c){return d(a?a:[],"thumb",b,c)},resolveUri:function(a){return b.fileResolver(a)}}}]}]),sdkHelperAttachmentApp.factory("resizeImageService",["promiseService","underscore",function(a,b){return function(c,d){var e=function(a){var c=document.createElement("canvas"),e=c.getContext("2d");if(d=b.defaults(d||{},{width:80,height:80,center:!0,crop:!0,output:"image/png"}),c.width=d.width,c.height=d.height,d.crop){var f=0,g=0,h=d.width*a.height/d.height>a.width,i=Math.floor(h?a.width:d.width*a.height/d.height),j=Math.floor(h?d.height*a.width/d.width:a.height);d.center&&(f=h?0:Math.floor((i-d.width)/2),g=h?Math.floor((j-d.height)/2):0),e.drawImage(a,f,g,i,j,0,0,d.width,d.height)}else e.drawImage(a,0,0,d.width,d.height);return c.toDataURL(d.output,1)};return a.wrap(function(a){if("string"==typeof c){var b=new Image;b.onload=function(){a.resolve(e(b))},b.src=c}else a.resolve(e(c))})}}]);var sdkHelperCropInspectionApp=angular.module("ag.sdk.helper.crop-inspection",["ag.sdk.helper.document","ag.sdk.library"]);sdkHelperCropInspectionApp.factory("cropInspectionHelper",["underscore",function(a){var b=["Approved","Not Approved","Not Planted"],c=["Crop amendment","Crop re-plant","Insurance coverage discontinued","Multi-insured","Other","Without prejudice","Wrongfully reported"],d=[["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12","R13","R14"],["V0","V1","V2","V3","V4","V5","R1","R2","R3","R4","R5","R6"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","R1","R2","R3","R4","R5","R6","R7","R8","R9"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","V17","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","V17","V18","V19","V20","V21","V22","V23","V24","V25","V26","V27","V28","R1","R2","R3","R4","R5","R6","R7","R8"],["V0","V1","V2","V3","V4","V5","V6","V7","R1","R2","R3","R4","R5","R6","R7","R8","R9"],["V0","V1","V2","V3","V4","V5","V6","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12","R13","R14","R15","R16","R17","R18"],["V0","V1","V2","V3","V4","R1","R2","R3","R4","R5","R6"],["V0","V1","V2","V3","V4","V5","V6","V7","R1","R2","R3","R4","R5","R6"]],e={Barley:d[1],Bean:d[5],"Bean (Broad)":d[5],"Bean (Dry)":d[5],"Bean (Sugar)":d[5],"Bean (Green)":d[5],"Bean (Kidney)":d[5],Canola:d[7],Cotton:d[6],"Grain Sorghum":d[3],Maize:d[0],"Maize (White)":d[0],"Maize (Yellow)":d[0],"Soya Bean":d[2],Sunflower:d[4],Wheat:d[1],"Wheat (Durum)":d[1]},f={"emergence inspection":"Emergence Inspection","hail inspection":"Hail Inspection","progress inspection":"Progress Inspection"},g=["Dry","Moist","Wet"],h=[["Maize Commodity","Maize Hybrid","Maize Silo Fodder"]],i={Maize:h[0],"Maize (White)":h[0],"Maize (Yellow)":h[0]},j=["Hail","Multi Peril"],k={Hail:["emergence inspection","hail inspection"],"Multi Peril":a.keys(f)},l={disease:"Disease",fading:"Fading",uneven:"Uneven",other:"Other",root:"Root",shortage:"Shortage",weed:"Weed"},m={"Dry Bean":"pod","Grain Sorghum":"panicle","Maize (White)":"ear","Maize (Yellow)":"ear",Sunflower:"flower",Wheat:"spikelet","Soya Bean":"pod"};return{approvalTypes:function(){return b},commentTypes:function(){return c},inspectionTitles:function(){return f},inspectionTypes:function(){return a.keys(f)},moistureStatusTypes:function(){return g},policyTypes:function(){return j},policyInspectionTypes:function(a){return k[a]||[]},problemTypes:function(){return l},getFlowerType:function(a){return m[a]||""},getGrowthStages:function(a){return e[a]||d[0]},getSeedTypes:function(a){return i[a]},getInspectionTitle:function(a){return f[a]||""},getProblemTitle:function(a){return l[a]||""},getSampleArea:function(a,b){return"spikelet"===m[a.data.crop]?b&&b.plantedInRows===!0?"3m":"m²":"pod"===m[a.data.crop]?"3m":"10m"},hasSeedTypes:function(a){return void 0!==i[a]},calculateProgressYield:function(b,c,d,e){d=d||0,e=void 0===e?100:e;var f=function(b,c){return a.reduce(b,function(a,b){return b[c]?a+b[c]:a},0)/b.length||0},g=a.map(b.data.zones,function(g,h){var i=a.where(c,{zone:h}),j={coverage:g.size/b.data.plantedArea,heads:f(i,"heads"),weight:f(i,"weight")};return"spikelet"===m[b.data.crop]?j["yield"]=j.weight*j.heads/((b.data.irrigated?3e3:3500)*(g.inRows?3*g.rowWidth:1)):"pod"===m[b.data.crop]?(j.pods=f(i,"pods"),j.seeds=f(i,"seeds"),j["yield"]=d*j.seeds*j.pods*j.heads/(300*g.rowWidth)):j["yield"]=j.weight*j.heads/(1e3*g.rowWidth),j["yield"]*=e/100,j});return{zones:g,flower:m[b.data.crop],"yield":a.reduce(g,function(a,b){return a+b.coverage*b["yield"]},0)}}}}]);var sdkHelperDocumentApp=angular.module("ag.sdk.helper.document",["ag.sdk.helper.task","ag.sdk.library"]);sdkHelperDocumentApp.provider("documentRegistry",["underscore",function(a){var b={};this.get=function(a){return b[a]},this.register=function(c){c=a.isArray(c)?c:[c],a.each(c,function(c){b[c.docType]=a.defaults(c,{deletable:!1,state:"document.details"})})},this.$get=[function(){return{filter:function(c){return a.reject(c,function(c){return!a.isUndefined(b[c.docType])})},get:function(a){return b[a]},getProperty:function(c,d,e){return b[c]&&!a.isUndefined(b[c][d])?b[c][d]:e},getProperties:function(c){return a.pluck(b,c)}}}]}]);var sdkHelperFavouritesApp=angular.module("ag.sdk.helper.favourites",["ag.sdk.helper.document","ag.sdk.helper.task"]);sdkHelperFavouritesApp.factory("activityHelper",["documentRegistry","underscore",function(a,b){var c=function(c){var g={id:c.id||c.$id,date:c.date};return"object"==typeof c.actor?(c.actor.displayName?(g.title=c.actor.displayName,g.subtitle=c.actor.displayName):(g.title=c.actor.firstName+" "+c.actor.lastName,g.subtitle=c.actor.firstName+" "+c.actor.lastName),c.actor.position&&(g.title+=" ("+c.actor.position+")"),g.profilePhotoSrc=c.actor.profilePhotoSrc):c.organization?(g.title=c.organization.name,g.subtitle=c.organization.name):(g.title="Someone",g.subtitle="Someone"),g.subtitle+=" "+e(c.action)+" ",g.referenceId=b.contains(["farmer","merchant","user"],c.referenceType)?c.organization.id:c[c.referenceType+"Id"],"document"!==c.referenceType||b.isUndefined(c[c.referenceType])?"farmer"!==c.referenceType||b.isUndefined(c.organization)?"task"!==c.referenceType||b.isUndefined(c[c.referenceType])?"merchant"!==c.referenceType||b.isUndefined(c.organization)?"user"!==c.referenceType||b.isUndefined(c.organization)?g.subtitle+=f(c.referenceType)+" "+c.referenceType:"invite"===c.action?g.subtitle+=c.organization.name+" to create a user":"register"===c.action&&(g.subtitle+="the request to create a user"):"invite"===c.action?(g.subtitle+=c.organization.name+" to create an Agrista account",g.referenceState="merchant"):"register"===c.action?(g.subtitle+="the request to join Agrista",g.referenceState="merchant"):"create"===c.action?(g.subtitle+="a merchant portfolio for "+c.organization.name,g.referenceState="merchant"):g.subtitle+="decline"===c.action?"a task for "+c.organization.name:"the portfolio of "+c.organization.name:(g.subtitle+="the "+taskHelper.getTaskTitle(c[c.referenceType].todo)+" "+c.referenceType,g.referenceState=taskHelper.getTaskState(c[c.referenceType].todo)):("invite"===c.action?g.subtitle+=c.organization.name+" to create an Agrista account":"register"===c.action?g.subtitle+="the request to join Agrista":"create"===c.action&&(g.subtitle+="a customer portfolio for "+c.organization.name),g.referenceState="customer.details"):(g.subtitle+=f(c[c.referenceType].docType)+" "+a.getProperty(c[c.referenceType].docType,"title","")+" "+c.referenceType,g.referenceState=a.getProperty(c[c.referenceType].docType,"state")),c.actor&&b.contains(["document","task"],c.referenceType)&&c.organization&&c.organization.name&&(g.subtitle+=" "+d(c.action)+" "+c.organization.name),g},d=function(a){return g[a]||"for"},e=function(a){var b=["a","e","i","o","u"];return h[a]||(a.lastIndexOf("e")===a.length-1?a+"d":a.lastIndexOf("y")===a.length-1&&-1===b.indexOf(a.substr(a.length-1,a.length))?a.substr(0,a.length-1)+"ied":a+"ed")},f=function(a){var b=["a","e","i","o","u"];return i[a]||(-1!==b.indexOf(a.substr(0,1))?"an":"a")},g={share:"of",sent:"to"},h={register:"accepted",sent:"sent"},i={"asset register":"an"};return{listServiceMap:function(){return c},getActionVerb:e,getReferenceArticle:f}}]),sdkHelperFavouritesApp.factory("notificationHelper",[function(){var a=function(a){return{id:a.id||a.$id,title:a.sender,subtitle:a.message,state:b(a.notificationType,a.dataType)}},b=function(a,b){var d=c[a]?c[a].state:"view";return"notification."+d+"-"+b},c={reassign:{title:"Reassign",state:"manage"},"import":{title:"Import",state:"import"},view:{title:"View",state:"view"},reject:{title:"Rejected",state:"view"},review:{title:"Review",state:"view"}};return{listServiceMap:function(){return a},getNotificationState:function(a,c){return b(a,c)},getNotificationTitle:function(a){return c[a]?c[a].title:""}}}]);var sdkHelperTaskApp=angular.module("ag.sdk.helper.task",["ag.sdk.authorization","ag.sdk.utilities","ag.sdk.interface.list","ag.sdk.library"]);sdkHelperTaskApp.provider("taskHelper",["underscore",function(a){var b=["assigned","in progress","in review"],c=function(c){var d=c.documentKey,e=a.chain(c.subtasks).filter(function(a){return"child"===a.type&&-1!==b.indexOf(a.status)}).map(function(a){return{id:a.id||c.$id,title:c.organization.name,subtitle:g(a.todo,a),todo:a.todo,groupby:d,status:{text:a.status||" ",label:j(a.status)}}}).value();return e.length?e:void 0},d=function(a){return{id:a.documentId,title:a.organization.name,subtitle:a.documentKey,status:{text:a.status||" ",label:j(a.status)}}},e={},f=function(a){return e[a]?e[a].state:void 0},g=function(a,b){var c=e[a];return void 0!==c?"string"==typeof c.title?c.title:c.title(b):void 0},h=function(a){return k[a]||a||" "},i=function(a){return l[a]||a||" "},j=function(a){switch(a){case"in progress":case"in review":return"label-warning";case"done":return"label-success";default:return"label-default"}},k={backlog:"Backlog",assigned:"Assigned","in progress":"In Progress","in review":"In Review",done:"Done",archive:"Archived"},l={accept:"Accept",decline:"Decline",assign:"Assign",start:"Start",complete:"Complete",approve:"Approve",reject:"Reject",release:"Release"};this.addTasks=function(b){e=a.extend(e,b)},this.$get=["authorization","listService","dataMapService",function(e,l,m){return{listServiceMap:function(){return c},parentListServiceMap:function(){return d},getTaskState:f,getTaskTitle:g,getTaskStatusTitle:h,getTaskActionTitle:i,getTaskLabel:j,taskStatusTitles:function(){return k},filterTasks:function(b,c){return c=c||[],a.filter(b,function(b){return void 0!==f(b.todo)&&!a.contains(c,b.status)})},updateListService:function(d,f,g,h){var i=e.currentUser(),j=a.findWhere(g,{id:d});l.addItems(m({id:j.parentTaskId,documentKey:j.documentKey,type:"parent",todo:f,organization:h,subtasks:a.filter(g,function(a){return a&&a.assignedTo===i.username})},c)),j&&-1===b.indexOf(j.status)&&l.removeItems(j.id)}}}]}]),sdkHelperTaskApp.factory("taskWorkflowHelper",["underscore",function(a){var b=["accept","decline","start","assign","complete","approve","reject","release"],c={accept:["backlog","assigned","in progress","in review","complete"],decline:["assigned"],start:["assigned","in progress"],assign:["backlog","assigned","in progress","in review"],complete:["assigned","in progress"],approve:["in review"],reject:["assigned","in review"],release:["done"]},d={parent:{complete:["in progress"],reject:["done"],release:["done"]},child:c,external:c};return{canChangeToState:function(c,e){return a.contains(b,e)?d[c.type]&&d[c.type][e]?-1!==d[c.type][e].indexOf(c.status):!1:!0}}}]);var sdkHelperUserApp=angular.module("ag.sdk.helper.user",[]);sdkHelperUserApp.provider("userHelper",["listServiceMapProvider",function(a){this.$get=["listServiceMap",function(a){var b=["English"];return{listServiceMap:function(){return a("user")},languageList:function(){return b}}}],a.add("user",[function(){return function(a){return{id:a.id||a.$id,title:a.firstName+" "+a.lastName,subtitle:a.position,teams:a.teams}}}])}]);var sdkInterfaceGeocledianApp=angular.module("ag.sdk.interface.geocledian",["ag.sdk.utilities","ag.sdk.id","ag.sdk.library"]);sdkInterfaceGeocledianApp.provider("geocledianService",["underscore",function(a){var b={key:"46552fa9-6a5v-2346-3z67-s4b8556cxvwp",layers:["vitality","visible"],url:"https://geocledian.com/agknow/api/v3/",source:"sentinel2"};this.config=function(c){b=a.defaults(c||{},b)},this.$get=["$http","moment","promiseService","underscore",function(a,c,d,e){function f(){this.ids=[],this.dates=[],this.parcels=[]}function g(a,c){return d.wrapAll(function(d){var f=a.getParcels(c);c&&f&&0==f.length?(a.ids.push(c),e.each(b.layers,function(b){d.push(h(a,c,b))})):e.each(f,function(a){d.push(a)})})}function h(c,d,f){return a.get(b.url+"parcels/"+d+"/"+f+"?key="+b.key+(b.source?"&source="+b.source:"")).then(function(a){a&&a.data&&a.data.content&&(c.parcels=c.parcels.concat(e.map(a.data.content,function(a){return e.extend(a,{type:f})})))})}return f.prototype={config:b,createParcel:function(c){return d.wrap(function(d){a.post(b.url+"parcels",e.extend({key:b.key},c)).then(function(a){a&&a.data&&e.isNumber(a.data.id)?d.resolve(a.data):d.reject()},d.reject)})},addParcel:function(a){return g(this,a)},getDates:function(){return e.chain(this.parcels).pluck("date").uniq().sortBy(function(a){return c(a)}).value()},getParcels:function(a){return"object"!=typeof a&&(a={parcel_id:a}),e.where(this.parcels,a)},getParcelImageUrl:function(a,c){return b.url+a[c||"png"]+"?key="+b.key}},function(){return new f}}]}]);var sdkInterfaceListApp=angular.module("ag.sdk.interface.list",["ag.sdk.id"]);sdkInterfaceListApp.factory("listService",["$rootScope","objectId",function(a,b){var c,d,e,f,g,h,i=[],j=function(){a.$broadcast("list::button__clicked")},k=function(b){c!==b&&("object"==typeof b?(c=b,c.click=c.click||j):c=void 0,a.$broadcast("list::button__changed",c))},l=function(b){d!==b&&(d=void 0!==b?b:void 0,a.$broadcast("list::groupby__changed",d))},m=function(b){e!==b&&(void 0!==b?(i=[],e=b):e=void 0,a.$broadcast("list::scroll__changed",e))},n=function(b){f!==b&&(f=void 0!==b?b:void 0,a.$broadcast("list::search__changed",f))},o=function(b){g!==b&&(g=b?b:void 0,a.$broadcast("list::title__changed",g))},p=function(a){if(h=a,i instanceof Array)for(var b=0;b<i.length;b++)i[b].active=!1,void 0!==a&&(i[b].id==a?i[b].active=!0:i[b].type==a&&(i[b].active=!0));else for(var c in i)i.hasOwnProperty(c)&&(i[c].active=c==a)},q=function(){if(i instanceof Array){for(var a=0;a<i.length;a++)if(i[a].id==h)return i[a]}else for(var b in i)if(i.hasOwnProperty(b)&&b==h)return i[b];return null};return a.$on("$onTransitionSuccess",function(a,b){var c=b.params()||{};p(c.id?c.id:c.type)}),a.$on("list::item__selected",function(a,b){p("object"==typeof b?b.id?b.id:b.type:b)}),{config:function(a){a.reset&&(c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,i=[],h=void 0),k(a.button),l(a.groupby),m(a.infiniteScroll),n(a.search),o(a.title)},button:function(a){return 1==arguments.length&&k(a),c},groupby:function(a){return 1==arguments.length&&l(a),d},infiniteScroll:function(a){return 1==arguments.length&&m(a),e},search:function(a){return 1==arguments.length&&n(a),f},title:function(a){return 1==arguments.length&&o(a),g},items:function(b){return void 0!==b&&(i=angular.copy(b),h=void 0,a.$broadcast("list::items__changed",i)),i},length:function(){return i.length},addItems:function(c,d){if(void 0!==c){c instanceof Array==!1&&(c=[c]);for(var e=0;e<c.length;e++){var f=c[e];if(f.id=f.id||b().toBase64String(),i instanceof Array){for(var g=!1,j=0;j<i.length;j++)if(f.id==i[j].id){i[j]=f,i[j].active=void 0!==h&&h==f.id,g=!0;break}0==g&&(d===!0?i.unshift(f):i.push(f))}else i[f.id]=f,i[f.id].active=void 0!==h&&h==f.id}a.$broadcast("list::items__changed",i)}},removeItems:function(b){if(void 0!==b){b instanceof Array==!1&&(b=[b]);for(var c=0;c<b.length;c++){var d=b[c];if(i instanceof Array){for(var e=0;e<i.length;e++)if(d==i[e].id){if(i.splice(e,1),d==h&&i.length){var f=i[e]?i[e]:i[e-1];a.$broadcast("list::item__selected",f)}break}}else delete i[d]}i instanceof Array&&0==i.length&&a.$broadcast("list::items__empty"),a.$broadcast("list::items__changed",i)}},selectFirstItem:function(){a.$broadcast("list::selectFirst__requested")},setActiveItem:function(a){p(a)},getActiveItem:function(){return q()},updateLabel:function(b){a.$broadcast("list::labels__changed",b)}}}]),sdkInterfaceListApp.provider("listServiceMap",function(){var a={};this.add=function(b,c){a[b]=c},this.$get=["$injector",function(b){function c(a){return a}function d(c){return c&&a[c]&&a[c]instanceof Array&&(a[c]=b.invoke(a[c])),a[c]}return function(a,b){return d(a)||d(b)||c}}]});var sdkInterfaceMapApp=angular.module("ag.sdk.interface.map",["ag.sdk.utilities","ag.sdk.id","ag.sdk.config","ag.sdk.geospatial","ag.sdk.library"]);sdkInterfaceMapApp.provider("mapMarkerHelper",["underscore",function(a){var b=function(b,c,d){return a.defaults(d||{},{iconUrl:"img/icons/"+b+"."+(c?c:"default")+".png",shadowUrl:"img/icons/"+b+".shadow.png",iconSize:[48,48],iconAnchor:[22,42],shadowSize:[73,48],shadowAnchor:[22,40],labelAnchor:[12,-24]})},c=this.getMarker=function(a,c,d){return"object"==typeof c&&(d=c,c="default"),b(a,c,d)},d=this.getMarkerStates=function(a,c,d){var e={};return"string"==typeof a&&angular.forEach(c,function(c){e[c]=b(a,c,d)}),e};this.$get=function(){return{getMarker:c,getMarkerStates:d}}}]),sdkInterfaceMapApp.provider("mapStyleHelper",["mapMarkerHelperProvider","underscore",function(a,b){var c={asset:a.getMarkerStates("asset",["default","success","error"]),marker:a.getMarkerStates("marker",["default","success","error"])},d={foreground:{district:{style:{weight:2,color:"white",opacity:.8,fillColor:"#0094D6",fillOpacity:.6}},farmland:{style:{weight:2,color:"white",opacity:.8,fillColor:"blue",fillOpacity:.3}},field:{icon:"success",style:{weight:2,color:"white",opacity:.8,fillColor:"#5b4723",fillOpacity:.8}},crop:{icon:c.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#aa64b0",fillOpacity:.8}},improvement:{icon:"success",style:{weight:2,color:"white",opacity:.8,fillColor:"#808080",fillOpacity:.8}},cropland:{icon:c.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#4573d5",fillOpacity:.8}},pasture:{icon:c.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#ffde40",fillOpacity:.8}},"permanent-crop":{icon:c.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#487811",fillOpacity:.8}},plantation:{icon:c.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#00e64a",fillOpacity:.8}},marker:{icon:c.marker.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.8}},search:{style:{weight:2,color:"white",opacity:.8,fillColor:"#f7b2bf",fillOpacity:.8,dashArray:"5,5"}}},background:{district:{style:{weight:1,color:"white",opacity:.8,fillColor:"#0094D6",fillOpacity:.2}},farmland:{style:{weight:1,color:"white",opacity:.8,fillColor:"blue",fillOpacity:.1}},field:{icon:"default",style:{weight:1,color:"white",opacity:.8,fillColor:"#5b4723",fillOpacity:.4}},crop:{icon:c.asset["default"],style:{weight:1,color:"white",opacity:.8,fillColor:"#aa64b0",fillOpacity:.4}},improvement:{icon:"default",style:{weight:1,color:"white",opacity:.8,fillColor:"#c0c0c0",fillOpacity:.4}},cropland:{icon:c.asset["default"],style:{weight:1,color:"white",opacity:.8,fillColor:"#4573d5",fillOpacity:.4}},pasture:{icon:c.asset["default"],style:{weight:1,color:"white",opacity:.8,fillColor:"#ffde40",fillOpacity:.4}},"permanent-crop":{icon:c.asset["default"],style:{weight:1,color:"white",opacity:.8,fillColor:"#487811",fillOpacity:.4}},plantation:{icon:c.asset["default"],style:{weight:1,color:"white",opacity:.8,fillColor:"#00e64a",fillOpacity:.4}},marker:{icon:c.marker["default"],style:{weight:1,color:"white",opacity:.5,fillColor:"#ff6666",fillOpacity:.5}}}},e=this.getStyle=function(e,f,g){f=b.slugify(f);var h=angular.copy(d[e]&&d[e][f]||d[e||"background"].marker);return"string"==typeof h.icon&&(void 0===c[f]&&(c[f]=a.getMarkerStates(f,["default","success","error"])),h.icon=c[f][h.icon]),"object"==typeof g&&(h.label=g),h},f=this.setStyle=function(a,b,c){d[a]=d[a]||{},d[a][b]=c},g=this.setStyles=function(a){b.each(a,function(a,c){d[c]=d[c]||{},b.each(a,function(a,e){d[c][e]=b.chain(d[c][e]||{}).extend(a).value()})})};this.$get=function(){return{getStyle:e,setStyle:f,setStyles:g}}}]),sdkInterfaceMapApp.provider("mapboxServiceCache",[function(){function a(){return f.config}function b(a){f.config=a}function c(a){return f.instances[a]}function d(a,b){f.instances[a]=b}function e(){f.instances={}}var f={config:{},instances:{}};this.getConfig=a,this.setConfig=b,this.$get=[function(){return{getConfig:a,setConfig:b,getInstance:c,setInstance:d,resetInstances:e}}]}]),sdkInterfaceMapApp.provider("mapboxService",["mapboxServiceCacheProvider","underscore",function(a,b){a.setConfig({init:{delay:200},options:{attributionControl:!0,layersControl:!0,scrollWheelZoom:!1,zoomControl:!0},layerControl:{baseTile:"Agriculture",baseLayers:{Agriculture:{template:"mapbox://styles/agrista/cjdmrq0wu0iq02so2sevccwlm",type:"mapbox.styleLayer"},"Agriculture Light":{template:"mapbox://styles/agrista/cjdmt9c8q0mr02srgvyfo2qwg",type:"mapbox.styleLayer"},"Capability (Climate)":{template:"https://maps.agrista.com/gwc/service/wmts",type:"wmts",options:{attribution:"&copy; 2019 Agrista, DAFF",format:"image/png8",layer:"za:climate_capability",tilematrixSet:"EPSG:900913"}},"Capability (Land)":{template:"https://maps.agrista.com/gwc/service/wmts",type:"wmts",options:{attribution:"&copy; 2019 Agrista, DAFF",format:"image/png8",layer:"za:land_capability",tilematrixSet:"EPSG:900913"}},"Capability (Soil)":{template:"https://maps.agrista.com/gwc/service/wmts",type:"wmts",options:{attribution:"&copy; 2019 Agrista, DAFF",format:"image/png8",layer:"za:soil_capability",tilematrixSet:"EPSG:900913"}},"Capability (Terrain)":{template:"https://maps.agrista.com/gwc/service/wmts",type:"wmts",options:{attribution:"&copy; 2019 Agrista, DAFF",format:"image/png8",layer:"za:terrain_capability",tilematrixSet:"EPSG:900913"}},"Land Cover":{template:"https://maps.agrista.com/gwc/service/wmts",type:"wmts",options:{attribution:"&copy; 2019 Agrista, DAFF",format:"image/png8",layer:"za:land_cover",tilematrixSet:"EPSG:900913"}},"Production Regions":{template:"agrista.87ceb2ab",type:"mapbox"},Satellite:{template:"https://earthwatch.digitalglobe.com/earthservice/tmsaccess/tms/1.0.0/DigitalGlobe:ImageryTileService@EPSG:3857@png/{z}/{x}/{y}.png?connectId={connectId}",type:"tileLayer",options:{attribution:"&copy; 2019 DigitalGlobe",connectId:"7e873a59-1413-4528-83f3-178c195472f8",maxZoom:20,tms:!0}},"Satellite (Hybrid)":{template:"mapbox://styles/agrista/cjdmt8w570l3r2sql91xzgmbn",type:"mapbox.styleLayer"}},overlays:{}},controls:{},events:{},view:{coordinates:[-29.0003409534,25.0839009251],zoom:5.1},bounds:{},leafletLayers:{},layers:{},geojson:{}}),this.config=function(c){a.setConfig(b.defaults(c||{},a.getConfig()))},this.$get=["$rootScope","$timeout","mapboxServiceCache","objectId","safeApply",function(a,c,d,e,f){function g(b,e){var f=this;f._id=b,f._ready=!1,f._options=e,f._show=f._options.show||!1,f._config=angular.copy(d.getConfig()),f._requestQueue=[],a.$on("mapbox-"+f._id+"::init",function(){c(function(){f.dequeueRequests(),f._ready=!0},f._config.init.delay||0)}),a.$on("mapbox-"+f._id+"::destroy",function(){f._ready=!1,f._options.persist!==!0&&(f._config=angular.copy(d.getConfig()))})}return g.prototype={getId:function(){return this._id},isReady:function(){return this._ready},reset:function(){this._config=angular.copy(d.getConfig()),a.$broadcast("mapbox-"+this._id+"::reset")},clearLayers:function(){this.removeOverlays(),this.removeGeoJSON(),this.removeLayers()},enqueueRequest:function(b,c,d){d=d||angular.noop,this._ready?(a.$broadcast(b,c),d()):this._requestQueue.push({event:b,data:c,handler:d})},dequeueRequests:function(){if(this._requestQueue.length)do{var b=this._requestQueue.shift();a.$broadcast(b.event,b.data),b.handler()}while(this._requestQueue.length)},shouldShow:function(){return this._show
},hide:function(){var a=this;this.enqueueRequest("mapbox-"+this._id+"::hide",{},function(){a._show=!1})},show:function(){var a=this;this.enqueueRequest("mapbox-"+this._id+"::show",{},function(){a._show=!0})},invalidateSize:function(){this.enqueueRequest("mapbox-"+this._id+"::invalidate-size",{})},getOptions:function(){return this._config.options},setOptions:function(a){var b=this;angular.forEach(a,function(a,c){b._config.options[c]=a})},getMap:function(a){this.enqueueRequest("mapbox-"+this._id+"::get-map",a)},getMapCenter:function(a){this.enqueueRequest("mapbox-"+this._id+"::get-center",a)},getMapBounds:function(a){this.enqueueRequest("mapbox-"+this._id+"::get-bounds",a)},getMapControl:function(a,b){this.enqueueRequest("mapbox-"+this._id+"::get-control",{control:a,handler:b})},getBaseTile:function(){return this._config.layerControl.baseTile},setBaseTile:function(a){var b=this;b.enqueueRequest("mapbox-"+b._id+"::set-basetile",a,function(){b._config.layerControl.baseTile=a})},getBaseLayers:function(){return this._config.layerControl.baseLayers},setBaseLayers:function(a){var b=this;b.enqueueRequest("mapbox-"+b._id+"::set-baselayers",a,function(){b._config.layerControl.baseLayers=a})},addBaseLayer:function(a,b,c){var d=this;d.enqueueRequest("mapbox-"+d._id+"::add-baselayer",{name:a,layer:b,show:c},function(){d._config.layerControl.baseLayers[a]=b})},getOverlays:function(){return this._config.layerControl.overlays},addOverlay:function(a,b){if(a&&void 0==this._config.layerControl.overlays[a]){var c=this;c.enqueueRequest("mapbox-"+c._id+"::add-overlay",{layerName:a,name:b||a},function(){c._config.layerControl.overlays[a]=b})}},removeOverlay:function(a){if(a&&this._config.layerControl.overlays[a]){var b=this;b.enqueueRequest("mapbox-"+b._id+"::remove-overlay",a,function(){delete b._config.layerControl.overlays[a]})}},removeOverlays:function(){var a=this;angular.forEach(a._config.layerControl.overlays,function(b,c){a.enqueueRequest("mapbox-"+a._id+"::remove-overlay",c,function(){delete a._config.layerControl.overlays[c]})})},getControls:function(){return this._config.controls},addControl:function(a,b){var c=this,d={name:a,options:b};c.enqueueRequest("mapbox-"+c._id+"::add-control",d,function(){c._config.controls[a]=d})},showControls:function(){this.enqueueRequest("mapbox-"+this._id+"::show-controls")},hideControls:function(){this.enqueueRequest("mapbox-"+this._id+"::hide-controls")},removeControl:function(a){var b=this;b.enqueueRequest("mapbox-"+b._id+"::remove-control",a,function(){delete b._config.controls[a]})},getEventHandlers:function(){return this._config.events},addEventHandler:function(a,b){a=a instanceof Array?a:[a];var c=this;angular.forEach(a,function(a){c.removeEventHandler(a);var d="click"!==a?b:function(a){var d=a.originalEvent.x+","+a.originalEvent.y;c.lastClick&&c.lastClick===d||f(function(){b(a)}),c.lastClick=d};c.enqueueRequest("mapbox-"+c._id+"::add-event-handler",{event:a,handler:d},function(){c._config.events[a]=d})})},removeEventHandler:function(a){a=a instanceof Array?a:[a];var b=this;angular.forEach(a,function(a){void 0!==b._config.events[a]&&b.enqueueRequest("mapbox-"+b._id+"::remove-event-handler",{event:a,handler:b._config.events[a]},function(){delete b._config.events[a]})})},addLayerEventHandler:function(a,b,c){var d=this;b.on(a,"click"!==a?c:function(a){var b=a.originalEvent.x+","+a.originalEvent.y;d.lastClick&&d.lastClick===b||f(function(){c(a)}),d.lastClick=b})},getView:function(){return{coordinates:this._config.view.coordinates,zoom:this._config.view.zoom}},setView:function(a,b){if(a instanceof Array){var c=this,d={coordinates:a,zoom:b||c._config.view.zoom};c.enqueueRequest("mapbox-"+c._id+"::set-view",d,function(){c._config.view=d})}},getBounds:function(){return this._config.bounds},setBounds:function(a,b){var c=this,d={coordinates:a,options:b||{reset:!1}};c.enqueueRequest("mapbox-"+c._id+"::set-bounds",d,function(){c._config.bounds=d})},panBy:function(a,b){this.enqueueRequest("mapbox-"+this._id+"::pan-by",{coordinates:a,options:b})},panTo:function(a,b){this.enqueueRequest("mapbox-"+this._id+"::pan-to",{coordinates:a,options:b})},zoomTo:function(a,b,c){this.enqueueRequest("mapbox-"+this._id+"::zoom-to",{coordinates:a,zoom:b,options:c})},createLayer:function(a,b,c,d){"function"==typeof c&&(d=c,c={});var e=this,f={name:a,type:b,options:c,handler:function(b){e._config.leafletLayers[a]=b,"function"==typeof d&&d(b)}};e.enqueueRequest("mapbox-"+e._id+"::create-layer",f,function(){e._config.layers[a]=f})},getLayer:function(a){return this._config.leafletLayers[a]},getLayers:function(){return this._config.layers},addLayer:function(a,b){var c=this;c.enqueueRequest("mapbox-"+c._id+"::add-layer",a,function(){c._config.leafletLayers[a]=b})},removeLayer:function(a){a instanceof Array==!1&&(a=[a]);var b=this;angular.forEach(a,function(a){b.enqueueRequest("mapbox-"+b._id+"::remove-layer",a,function(){delete b._config.layers[a],delete b._config.leafletLayers[a]})})},removeLayers:function(){var a=this;angular.forEach(this._config.layers,function(b,c){a.enqueueRequest("mapbox-"+a._id+"::remove-layer",c,function(){delete a._config.layers[c],delete a._config.leafletLayers[c]})})},showLayer:function(a){this.enqueueRequest("mapbox-"+this._id+"::show-layer",a)},hideLayer:function(a){this.enqueueRequest("mapbox-"+this._id+"::hide-layer",a)},fitLayer:function(a,b){this.enqueueRequest("mapbox-"+this._id+"::fit-layer",{name:a,options:b||{reset:!1}})},getGeoJSON:function(){return this._config.geojson},getGeoJSONFeature:function(a,b){return this._config.geojson[a]&&this._config.geojson[a][b]?this._config.geojson[a][b]:null},getGeoJSONLayer:function(a){return this._config.geojson[a]?this._config.geojson[a]:null},addGeoJSON:function(a,c,d,f,g){"function"==typeof f&&(g=f,f={});var h=this;d=b.defaults(d||{},{interactive:!0}),f=b.defaults(f||{},{featureId:e().toString()});var i={layerName:a,geojson:c,options:d,properties:f,handler:function(b,c,d){h._config.leafletLayers[a]=b,h._config.leafletLayers[f.featureId]=d,"function"==typeof g&&g(c,d)}};return h.enqueueRequest("mapbox-"+h._id+"::add-geojson",i,function(){h._config.geojson[a]=h._config.geojson[a]||{},h._config.geojson[a][f.featureId]=i}),f.featureId},removeGeoJSONFeature:function(a,b){var c=this;c.enqueueRequest("mapbox-"+this._id+"::remove-geojson-feature",{layerName:a,featureId:b},function(){c._config.geojson[a]&&delete c._config.geojson[a][b]})},removeGeoJSONLayer:function(a){a instanceof Array==!1&&(a=[a]);var b=this;angular.forEach(a,function(a){b._config.geojson[a]&&(angular.forEach(b._config.geojson[a],function(c,d){b.enqueueRequest("mapbox-"+b._id+"::remove-layer",d,function(){delete b._config.leafletLayers[d],delete b._config.geojson[a][d]})}),b.enqueueRequest("mapbox-"+b._id+"::remove-geojson-layer",a,function(){delete b._config.leafletLayers[a],delete b._config.geojson[a]}))})},removeGeoJSON:function(){var a=this;angular.forEach(a._config.geojson,function(b,c){angular.forEach(b,function(b,d){a.enqueueRequest("mapbox-"+a._id+"::remove-layer",d,function(){delete a._config.leafletLayers[d],delete a._config.geojson[c][d]})}),a.enqueueRequest("mapbox-"+a._id+"::remove-geojson-layer",c,function(){delete a._config.leafletLayers[c],delete a._config.geojson[c]})})},editingOn:function(a,b,c,d,e){"string"==typeof c&&(c={exclude:"exclude"==c}),this.enqueueRequest("mapbox-"+this._id+"::edit-on",{layerName:a,controls:b,controlOptions:c,styleOptions:d,addLayer:e})},editingUpdate:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-update")},editingClear:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-clear")},editingOff:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-off")},pickPortionOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-portion-on")},pickDistrictOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-district-on")},pickFieldOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-field-on")},defineFarmOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-on")},defineServiceAreaOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-service-area-on")},defineFieldGroupOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-field-group-on")},featureClickOn:function(){this.enqueueRequest("mapbox-"+this._id+"::feature-click-on")},pickPortionOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-portion-off")},pickDistrictOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-district-off")},pickFieldOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-field-off")},defineFarmOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-off")},defineServiceAreaOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-service-area-off")},defineFieldGroupOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-field-group-off")},featureClickOff:function(){this.enqueueRequest("mapbox-"+this._id+"::feature-click-off")},enableSidebar:function(){this.enqueueRequest("mapbox-"+this._id+"::enable-sidebar")},showSidebar:function(){this.enqueueRequest("mapbox-"+this._id+"::sidebar-show")},hideSidebar:function(){this.enqueueRequest("mapbox-"+this._id+"::sidebar-hide")},toggleSidebar:function(){this.enqueueRequest("mapbox-"+this._id+"::sidebar-toggle")}},function(a,b){b=b||{};var c=d.getInstance(a);return void 0===c&&(c=new g(a,b),d.setInstance(a,c)),b.clean===!0&&c.reset(),c}}]}]),sdkInterfaceMapApp.directive("mapbox",["$rootScope","$http","$log","$timeout","configuration","mapboxService","geoJSONHelper","mapStyleHelper","objectId","sphericalHelper","underscore",function(a,b,c,d,e,f,g,h,i,j,k){function l(a,b){var c=this;c._id=a.id,c._optionSchema={},c._editing=!1,c._editableLayer,c._editableFeature=L.featureGroup(),c._featureClickable,c._geoJSON={},c._layers={},c._controls={},c._layerControls={baseTile:"",baseLayers:{},overlays:{}},c._draw={exclude:!1,addLayer:!0,options:{},controls:{}},a.delay=a.delay||0,d(function(){c.mapInit(),c.addListeners(b),c.broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::init",c._map)},a.delay)}var m={};return l.prototype.mapInit=function(){var a=this;a._mapboxServiceInstance=f(a._id);var b=a._mapboxServiceInstance.getView(),c=a._mapboxServiceInstance.getOptions();L.mapbox.accessToken=c.accessToken,a._map=L.map(a._id,c).setView(b.coordinates,b.zoom),a._map.whenReady(function(){a.broadcast("mapbox-"+a._mapboxServiceInstance.getId()+"::ready",a._map)}),a._map.on("baselayerchange",function(b){a._layerControls.baseTile=b.name}),a._editableFeature=L.featureGroup(),a._editableFeature.addTo(a._map),a.setEventHandlers(a._mapboxServiceInstance.getEventHandlers()),a.addControls(a._mapboxServiceInstance.getControls()),a.setBounds(a._mapboxServiceInstance.getBounds()),a.resetLayers(a._mapboxServiceInstance.getLayers()),a.resetGeoJSON(a._mapboxServiceInstance.getGeoJSON()),a.resetLayerControls(a._mapboxServiceInstance.getBaseTile(),a._mapboxServiceInstance.getBaseLayers(),a._mapboxServiceInstance.getOverlays()),a._map.on("draw:drawstart",a.onDrawStart,a),a._map.on("draw:editstart",a.onEditStart,a),a._map.on("draw:deletestart",a.onDrawStart,a),a._map.on("draw:drawstop",a.onDrawStop,a),a._map.on("draw:editstop",a.onEditStop,a),a._map.on("draw:deletestop",a.onDrawStop,a)},l.prototype.addListeners=function(a){a.hidden=!this._mapboxServiceInstance.shouldShow();var b=this,c=this._mapboxServiceInstance.getId();a.$on("mapbox-"+c+"::get-map",function(a,c){"function"==typeof c&&c(b._map)}),a.$on("mapbox-"+c+"::get-center",function(a,c){"function"==typeof c&&c(b._map.getCenter())}),a.$on("mapbox-"+c+"::get-bounds",function(a,c){"function"==typeof c&&c(b._map.getBounds())}),a.$on("mapbox-"+c+"::get-control",function(a,c){"function"==typeof c.handler&&c.handler(b._controls[c.control])}),a.$on("$destroy",function(){delete m[c],b.mapDestroy(),b.broadcast("mapbox-"+c+"::destroy")}),a.$on("mapbox-"+c+"::set-basetile",function(a,c){b.setBaseTile(c)}),a.$on("mapbox-"+c+"::set-baselayers",function(a,c){b.setBaseLayers(c)}),a.$on("mapbox-"+c+"::add-baselayer",function(a,c){b.addBaseLayer(c.layer,c.name,c.show)}),a.$on("mapbox-"+c+"::add-overlay",function(a,c){b.addOverlay(c.layerName,c.name)}),a.$on("mapbox-"+c+"::remove-overlay",function(a,c){b.removeOverlay(c)}),a.$on("mapbox-"+c+"::add-control",function(a,c){b.addControls({control:c})}),a.$on("mapbox-"+c+"::remove-control",function(a,c){b.removeControl(c)}),a.$on("mapbox-"+c+"::show-controls",function(a,c){b.showControls(c)}),a.$on("mapbox-"+c+"::hide-controls",function(a,c){b.hideControls(c)}),a.$on("mapbox-"+c+"::add-event-handler",function(a,c){b.addEventHandler(c.event,c.handler)}),a.$on("mapbox-"+c+"::remove-event-handler",function(a,c){b.removeEventHandler(c.event,c.handler)}),a.$on("mapbox-"+c+"::set-view",function(a,c){b.setView(c)}),a.$on("mapbox-"+c+"::set-bounds",function(a,c){b.setBounds(c)}),a.$on("mapbox-"+c+"::pan-by",function(a,c){b.panBy(c)}),a.$on("mapbox-"+c+"::pan-to",function(a,c){b.panTo(c)}),a.$on("mapbox-"+c+"::zoom-to",function(a,c){b.zoomTo(c)}),a.$on("mapbox-"+c+"::create-layer",function(a,c){"function"==typeof c.handler&&c.handler(b.createLayer(c.name,c.type,c.options))}),a.$on("mapbox-"+c+"::add-layer",function(a,c){b.addLayer(c)}),a.$on("mapbox-"+c+"::remove-layer",function(a,c){b.removeLayer(c)}),a.$on("mapbox-"+c+"::show-layer",function(a,c){b.showLayer(c)}),a.$on("mapbox-"+c+"::hide-layer",function(a,c){b.hideLayer(c)}),a.$on("mapbox-"+c+"::fit-layer",function(a,c){b.fitLayer(c)}),a.$on("mapbox-"+c+"::add-geojson",function(a,c){b.addGeoJSONFeature(c)}),a.$on("mapbox-"+c+"::remove-geojson-feature",function(a,c){b.removeGeoJSONFeature(c)}),a.$on("mapbox-"+c+"::remove-geojson-layer",function(a,c){b.removeGeoJSONLayer(c)}),a.$on("mapbox-"+c+"::hide",function(){a.hidden=!0}),a.$on("mapbox-"+c+"::show",function(){a.hidden=!1}),a.$on("mapbox-"+c+"::invalidate-size",function(){b._map.invalidateSize()}),a.$on("mapbox-"+c+"::edit-on",function(a,c){b.setOptionSchema(c.styleOptions),b.makeEditable(c.layerName,c.addLayer,!0),b.setDrawControls(c.controls,c.controlOptions),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-update",function(){b.makeEditable(b._editableLayer,b._draw.addLayer,!1),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-clear",function(){b.cleanEditable(),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-off",function(){b.makeEditable(void 0,{},!0),b.updateDrawControls()}),a.$on("mapbox-"+c+"::pick-portion-on",function(){b._map.on("click",b.pickPortion,b)}),a.$on("mapbox-"+c+"::pick-district-on",function(){b._map.on("click",b.pickDistrict,b)}),a.$on("mapbox-"+c+"::pick-field-on",function(){b._map.on("click",b.pickField,b)}),a.$on("mapbox-"+c+"::define-farm-on",function(){b._map.on("click",b.defineNewFarm,b)}),a.$on("mapbox-"+c+"::define-service-area-on",function(){b._map.on("click",b.defineServiceArea,b)}),a.$on("mapbox-"+c+"::define-field-group-on",function(){b._map.on("click",b.defineFieldGroup,b)}),a.$on("mapbox-"+c+"::feature-click-on",function(){b._featureClickable=!0}),a.$on("mapbox-"+c+"::pick-portion-off",function(){b._map.off("click",b.pickPortion,b)}),a.$on("mapbox-"+c+"::pick-field-off",function(){b._map.off("click",b.pickField,b)}),a.$on("mapbox-"+c+"::pick-district-off",function(){b._map.off("click",b.pickDistrict,b)}),a.$on("mapbox-"+c+"::define-farm-off",function(){b._map.off("click",b.defineNewFarm,b)}),a.$on("mapbox-"+c+"::define-service-area-off",function(){b._map.off("click",b.defineServiceArea,b)}),a.$on("mapbox-"+c+"::define-field-group-off",function(){b._map.off("click",b.defineFieldGroup,b)}),a.$on("mapbox-"+c+"::feature-click-off",function(){b._featureClickable=!1}),a.$on("mapbox-"+c+"::enable-sidebar",function(){var a=L.control.sidebar("sidebar",{closeButton:!0,position:"right"});b._sidebar=a,b._map.addControl(a)}),a.$on("mapbox-"+c+"::sidebar-show",function(){null!=b._sidebar&&b._sidebar.show()}),a.$on("mapbox-"+c+"::sidebar-hide",function(){null!=b._sidebar&&b._sidebar.hide()}),a.$on("mapbox-"+c+"::sidebar-toggle",function(){null!=b._sidebar&&b._sidebar.toggle()})},l.prototype.mapDestroy=function(){if(this._map){for(var a in this._map._layers)this._map._layers.hasOwnProperty(a)&&this._map.removeLayer(this._map._layers[a]);this._map.remove(),this._map=null}this._optionSchema={},this._editing=!1,this._editableLayer=null,this._editableFeature=null,this._geoJSON={},this._layers={},this._layerControls={baseTile:"",baseLayers:{},overlays:{}},this._draw={exclude:!1,addLayer:!0,options:{},controls:{}}},l.prototype.broadcast=function(b,d){c.debug(b),a.$broadcast(b,d)},l.prototype.resetLayerControls=function(a,b,c){this._layerControls.baseTile=a;try{this.map.removeControl(this._layerControls.control)}catch(d){}this.setBaseLayers(b),this.setOverlays(c)},l.prototype.resetLayers=function(a){var b=this;angular.forEach(b._layers,function(a,c){b._map.removeLayer(a),delete b._layers[c]}),angular.forEach(a,function(a,c){"function"==typeof a.handler&&a.handler(b.createLayer(c,a.type,a.options))})},l.prototype.resetGeoJSON=function(a){var b=this;angular.forEach(b._geoJSON,function(a,c){b._layers[c]&&(b._map.removeLayer(b._layers[c]),delete b._layers[c])}),angular.forEach(a,function(a){b.addGeoJSONLayer(a)})},l.prototype.setBaseTile=function(a){var b=this,c=!1;b._layerControls.baseTile!==a&&(angular.forEach(b._layerControls.baseLayers,function(d,e){b._map.hasLayer(d.layer)&&b._map.removeLayer(d.layer),e===a&&(c=!0)}),c&&(b._layerControls.baseTile=a),angular.forEach(b._layerControls.baseLayers,function(a,c){c===b._layerControls.baseTile&&b._map.addLayer(a.layer)}))},l.prototype.setBaseLayers=function(a){var b=this,c=b._mapboxServiceInstance.getOptions();void 0===b._layerControls.control&&(b._layerControls.control=L.control.layers({},{}),c.layersControl&&b._map.addControl(b._layerControls.control)),angular.forEach(b._layerControls.baseLayers,function(c,d){void 0===a[d]?b._layerControls.control.removeLayer(c.layer):void 0===c.layer&&b.addBaseLayer(c,d)}),angular.forEach(a,function(a,c){void 0===b._layerControls.baseLayers[c]?b.addBaseLayer(a,c):(a=b._layerControls.baseLayers[c],c===b._layerControls.baseTile&&a.layer.addTo(b._map))})},l.prototype.addBaseLayer=function(a,b,c){void 0===this._layerControls.baseLayers[b]&&("mapbox"===a.type||"mapbox.tileLayer"===a.type?a.layer=L.mapbox.tileLayer(a.template,a.options):"mapbox.styleLayer"===a.type?a.layer=L.mapbox.styleLayer(a.template,a.options):"function"==typeof L[a.type]?a.layer=L[a.type](a.template,a.options):"function"==typeof L.tileLayer[a.type]&&(a.layer=L.tileLayer[a.type](a.template,a.options)),a.layer&&((b===this._layerControls.baseTile||c)&&a.layer.addTo(this._map),this._layerControls.baseLayers[b]=a,this._layerControls.control.addBaseLayer(a.layer,b)))},l.prototype.setOverlays=function(a){var b=this;angular.forEach(b._layerControls.overlays,function(c,d){void 0===a[d]&&b.removeOverlay(d,c)}),angular.forEach(a,function(a,c){b.addOverlay(c,a)})},l.prototype.addOverlay=function(a,b){var c=this._layers[a];b=b||a,this._layerControls.control&&c&&void 0===this._layerControls.overlays[a]&&(this._layerControls.overlays[a]=c,this._layerControls.control.addOverlay(c,b))},l.prototype.removeOverlay=function(a,b){var c=b||this._layers[a];this._layerControls.control&&c&&(this._layerControls.control.removeLayer(c),delete this._layerControls.overlays[a])},l.prototype.addControls=function(a){var b=this;angular.forEach(a,function(a){"function"==typeof L.control[a.name]&&(b.removeControl(a.name),b._controls[a.name]=L.control[a.name](a.options),b._map.addControl(b._controls[a.name]))})},l.prototype.showControls=function(){var a=this;a._layerControls.control&&a._map.addControl(a._layerControls.control),angular.forEach(a._controls,function(b,c){b.addTo(a._map),delete a._controls[c]})},l.prototype.hideControls=function(){var a=this;a._layerControls.control&&a._layerControls.control.remove(),angular.forEach(a._map.options,function(b,c){b===!0&&a._map[c]&&"function"==typeof a._map[c].disable&&(a._controls[c]=a._map[c],a._map[c].remove())})},l.prototype.removeControl=function(a){this._controls[a]&&(this._map.removeControl(this._controls[a]),delete this._controls[a])},l.prototype.setEventHandlers=function(a){var b=this;angular.forEach(a,function(a,c){b.addEventHandler(c,a)})},l.prototype.addEventHandler=function(a,b){this._map.on(a,b)},l.prototype.removeEventHandler=function(a,b){this._map.off(a,b)},l.prototype.setView=function(a){this._map&&void 0!==a&&this._map.setView(a.coordinates,a.zoom)},l.prototype.setBounds=function(a){this._map&&a.coordinates&&(a.coordinates instanceof Array?a.coordinates.length>1?this._map.fitBounds(a.coordinates,a.options):1==a.coordinates.length&&this._map.fitBounds(a.coordinates.concat(a.coordinates),a.options):this._map.fitBounds(a.coordinates,a.options))},l.prototype.panBy=function(a){this._map&&a.coordinates&&this._map.panBy(a.coordinates,a.options)},l.prototype.panTo=function(a){this._map&&a.coordinates&&this._map.panTo(a.coordinates,a.options)},l.prototype.zoomTo=function(a){this._map&&a.coordinates&&a.zoom&&this._map.setZoomAround(a.coordinates,a.zoom,a.options)},l.prototype.createLayer=function(a,b,c){return b=b||"featureGroup",c=k.defaults(c||{},{enabled:!0}),void 0===this._layers[a]&&("featureGroup"==b&&L.featureGroup?this._layers[a]=L.featureGroup(c):"layerGroup"==b&&L.layerGroup?this._layers[a]=L.layerGroup(c):"markerClusterGroup"==b&&L.markerClusterGroup&&(this._layers[a]=L.markerClusterGroup(c)),this._layers[a]&&c.enabled&&this._layers[a].addTo(this._map)),this._layers[a]},l.prototype.addLayer=function(a){var b=this._mapboxServiceInstance.getLayer(a),c=!1;return b&&(c=void 0==this._layers[a],this._layers[a]=b,this._map.addLayer(b)),c},l.prototype.addLayerToLayer=function(a,b,c){var d=this._layers[c];return d?(this._layers[a]&&d.removeLayer(b),this._layers[a]=b,d.addLayer(b),!0):!1},l.prototype.removeLayer=function(a){var b=this._layers[a],c=!1;return b&&(c=void 0!=this._layers[a],this.removeOverlay(a),this._map.removeLayer(b),delete this._layers[a]),c},l.prototype.removeLayerFromLayer=function(a,b){var c=this._layers[b],d=this._layers[a],e=!1;return c&&d&&(e=void 0!=this._layers[a],c.removeLayer(d),delete this._layers[a]),e},l.prototype.showLayer=function(a){var b=this._layers[a];b&&0==this._map.hasLayer(b)&&(this._map.addLayer(b),b.eachLayer&&b.eachLayer(function(a){a.bindTooltip&&a.feature&&a.feature.properties&&a.feature.properties.label&&a.bindTooltip(a.feature.properties.label.message,a.feature.properties.label.options)}))},l.prototype.hideLayer=function(a){var b=this._layers[a];b&&this._map.hasLayer(b)&&this._map.removeLayer(b)},l.prototype.fitLayer=function(a){if(a.name){var b=this._layers[a.name];if(b&&this._map.hasLayer(b)){var c=b.getBounds();this._map.fitBounds(c,a.options)}}},l.prototype.addGeoJSONLayer=function(a){var b=this;angular.forEach(a,function(a){b.addGeoJSONFeature(a)})},l.prototype.makeIcon=function(a){return a instanceof L.Class?a:a.type&&L[a.type]?L[a.type].icon?L[a.type].icon(a):L[a.type](a):L.icon(a)},l.prototype.addLabel=function(a,b,c){var d=this,e=g(b);if("object"==typeof a&&"Point"!==b.geometry.type){a.options=a.options||{};var f=new L.Tooltip(a.options);f.setContent(a.message),f.setLatLng(e.getCenter().reverse()),1==a.options.permanent?(f.addTo(d._map),c.on("add",function(){f.addTo(d._map)}),c.on("remove",function(){d._map.removeLayer(f)})):(c.on("mouseover",function(){f.addTo(d._map)}),c.on("mouseout",function(){d._map.removeLayer(f)}))}},l.prototype.addGeoJSONFeature=function(a){var b=this,c=g(a.geojson,a.properties);b.createLayer(a.layerName,a.type,a.options),b._geoJSON[a.layerName]=b._geoJSON[a.layerName]||{},b._geoJSON[a.layerName][a.properties.featureId]=a;var d=a.options?angular.copy(a.options):{};d.icon&&(d.icon=b.makeIcon(d.icon)),L.geoJson(c.getJson(),{interactive:d.interactive,style:d.style,pointToLayer:function(a,b){var c;return c=d.radius?L.circleMarker(b,d):L.marker(b,d),d.label&&c.bindPopup(d.label.message,d.label.options),c},onEachFeature:function(c,e){var f=b.addLayerToLayer(c.properties.featureId,e,a.layerName);b.addLabel(d.label,c,e),f&&"function"==typeof a.handler&&a.handler(b._layers[a.layerName],c,e),!b._featureClickable||"Polygon"!==c.geometry.type&&"MultiPolygon"!==c.geometry.type||e.on("click",function(){c&&c.properties&&(c.properties.highlighted?(c.properties.highlighted=!1,e.setStyle({color:e.options.fillColor||"blue",opacity:e.options.fillOpacity||.4})):(c.properties.highlighted=!0,e.setStyle({color:"white",opacity:1,fillColor:e.options.fillColor||"blue",fillOpacity:e.options.fillOpacity||.4}))),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::polygon-clicked",{properties:c.properties,highlighted:c.properties.highlighted})})}})},l.prototype.removeGeoJSONFeature=function(a){this._geoJSON[a.layerName]&&this._geoJSON[a.layerName][a.featureId]&&(this.removeLayerFromLayer(a.featureId,a.layerName),delete this._geoJSON[a.layerName][a.featureId])},l.prototype.removeGeoJSONLayer=function(a){this._geoJSON[a]&&(this.removeLayer(a),delete this._geoJSON[a])},l.prototype.makeEditable=function(a,b,c){var d=this;1==c&&d.cleanEditable(),a&&d._layers[a]&&d._layers[a].eachLayer(function(b){d._layers[a].removeLayer(b),d._editableFeature.addLayer(b)}),d._editableLayer=a,d._draw.addLayer=void 0==b?!0:b},l.prototype.cleanEditable=function(){var a=this;a._editableFeature.eachLayer(function(b){a._editableFeature.removeLayer(b)})},l.prototype.resetEditable=function(){var a=this;a._editableFeature&&(a._editableFeature.eachLayer(function(b){a._editableFeature.removeLayer(b),a._layers[a._editableLayer]&&a._layers[a._editableLayer].addLayer(b)}),a._editableFeature=L.featureGroup(),a._editableFeature.addTo(a._map))},l.prototype.setDrawControls=function(a,b){this._draw.controlOptions=b||this._draw.controlOptions||{},this._draw.controls={},a instanceof Array&&"function"==typeof L.Control.Draw&&(this._draw.controls.circle=new L.Control.Draw({draw:{polyline:!1,polygon:!1,rectangle:!1,circle:-1==a.indexOf("circle")?!1:{showRadius:!0,feet:!1,metric:!0},marker:!1}}),this._draw.controls.polyline=new L.Control.Draw({draw:{polyline:-1!=a.indexOf("polyline"),polygon:!1,rectangle:!1,circle:!1,marker:!1}}),this._draw.controls.polygon=new L.Control.Draw({draw:{polyline:!1,polygon:-1==a.indexOf("polygon")?!1:{allowIntersection:!1,showArea:!0,metric:!0},rectangle:!1,circle:!1,marker:!1}}),this._draw.controls.marker=new L.Control.Draw({draw:{polyline:!1,polygon:!1,rectangle:!1,circle:!1,marker:-1==a.indexOf("marker")?!1:{icon:this._optionSchema.icon?L.icon(this._optionSchema.icon):L.Icon.Default()}}}),this._draw.controls.editor=new L.Control.Draw({draw:!1,edit:{featureGroup:this._editableFeature,remove:1!=this._draw.controlOptions.nodelete}}))},l.prototype.setOptionSchema=function(a){this._optionSchema=a||{}},l.prototype.updateDrawControls=function(){try{this._map.removeControl(this._draw.controls.circle)}catch(a){}try{this._map.removeControl(this._draw.controls.polygon)}catch(a){}try{this._map.removeControl(this._draw.controls.polyline)}catch(a){}try{this._map.removeControl(this._draw.controls.marker)}catch(a){}try{this._map.removeControl(this._draw.controls.editor)}catch(a){}try{this._map.off("draw:created",this.onDrawn,this),this._map.off("draw:edited",this.onEdited,this),this._map.off("draw:deleted",this.onDeleted,this)}catch(a){}if(this._editableFeature.getLayers().length>0&&(this._map.on("draw:edited",this.onEdited,this),this._map.on("draw:deleted",this.onDeleted,this),this._draw.controls.editor&&(this._draw.controls.editor=new L.Control.Draw({draw:!1,edit:{featureGroup:this._editableFeature,remove:1!=this._draw.controlOptions.nodelete}}),this._map.addControl(this._draw.controls.editor))),this._editableLayer&&(0==this._editableFeature.getLayers().length||this._draw.controlOptions.multidraw)){var b={circle:!0,polygon:!0,polyline:!0,marker:!0};this._editableFeature.eachLayer(function(a){if(a.feature&&a.feature.geometry&&a.feature.geometry.type)switch(a.feature.geometry.type){case"LineString":b.polyline=!1;break;case"Polygon":b.circle=!1,b.polygon=!1;break;case"Point":b.marker=!1}}),this._draw.controlOptions.exclude?(b.circle&&this._map.addControl(this._draw.controls.polyline),b.polygon&&this._map.addControl(this._draw.controls.polygon),b.polyline&&this._map.addControl(this._draw.controls.polyline),b.marker&&this._map.addControl(this._draw.controls.marker),this._map.on("draw:created",this.onDrawn,this)):(this._draw.controls.circle&&this._map.addControl(this._draw.controls.circle),this._draw.controls.polygon&&this._map.addControl(this._draw.controls.polygon),this._draw.controls.polyline&&this._map.addControl(this._draw.controls.polyline),this._draw.controls.marker&&this._map.addControl(this._draw.controls.marker),this._map.on("draw:created",this.onDrawn,this))}},l.prototype.pickPortion=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/portion"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::portion-added",a))}).error(function(a){c.debug(a)})}},l.prototype.defineNewFarm=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/portion"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey,portion:a}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::portion-added",a))}).error(function(a){c.debug(a)})}},l.prototype.pickDistrict=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/district"+g).success(function(a){if(!d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)){var b=h.getStyle("background","district");d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,b,{featureId:a.sgKey}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::district-added",a)}}).error(function(a){c.debug(a)})}},l.prototype.defineServiceArea=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/district"+g).success(function(a){if(!d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)){var b=h.getStyle("background","district");d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,b,{featureId:a.sgKey,districtName:a.name}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::district-added",a)}}).error(function(a){c.debug(a)})}},l.prototype.pickField=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/field"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::field-added",a))}).error(function(a){c.debug(a)})}},l.prototype.defineFieldGroup=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/field"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::field-added",a))}).error(function(a){c.debug(a)})}},l.prototype.onDrawStart=function(){this._editing=!0,this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-editing",this._editing)
},l.prototype.onDrawStop=function(){this._editing=!1,this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-editing",this._editing)},l.prototype.onDrawn=function(a){var b={type:"Feature",geometry:{},properties:{featureId:i().toString()}},c=function(a,b){var c=[];if(angular.forEach(a,function(a){c.push([a.lng,a.lat])}),c.length>0&&c[0]!=c[c.length-1]&&c.push(c[0]),void 0!==b.properties.area){var d=L.GeometryUtil.geodesicArea(a),e=1.19599*d;b.properties.area.m_sq+=d,b.properties.area.ha+=1e-4*d,b.properties.area.mi_sq+=e/3097600,b.properties.area.acres+=e/4840,b.properties.area.yd_sq+=e}return c},d=function(a,b){for(var d=a._latlng,e=a._mRadius,f=Math.max(16,Math.ceil(e/5)),g=e/j.RADIUS*180/Math.PI,h=[],i=0;f+1>i;i++)h.push(j.radial([d.lng,d.lat],i/f*360,e).reverse());return g>90-d.lat&&h.push([h[0][0],d.lng+180],[90,d.lng+180],[90,d.lng-180],[h[0][0],d.lng-180]),g>90+d.lat&&h.splice((f>>1)+1,0,[h[f>>1][0],d.lng-180],[-90,d.lng-180],[-90,d.lng+180],[h[f>>1][0],d.lng+180]),c(L.polygon(h)._latlngs[0],b)};switch(a.layerType){case"circle":case"polygon":b.geometry={type:"Polygon",coordinates:[]},b.properties.area={m_sq:0,ha:0,mi_sq:0,acres:0,yd_sq:0},"polygon"===a.layerType?angular.forEach(a.layer._latlngs,function(a){b.geometry.coordinates.push(c(a,b))}):b.geometry.coordinates.push(d(a.layer,b)),this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b);break;case"polyline":b.geometry={type:"LineString",coordinates:[]},angular.forEach(a.layer._latlngs,function(a){b.geometry.coordinates.push([a.lng,a.lat])}),this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b);break;case"marker":b.geometry={type:"Point",coordinates:[a.layer._latlng.lng,a.layer._latlng.lat]},this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b)}this._editing=!1,this._draw.addLayer&&(this._mapboxServiceInstance.addGeoJSON(this._editableLayer,b,this._optionSchema,b.properties),this.makeEditable(this._editableLayer),this.updateDrawControls())},l.prototype.onEditStart=function(){this._editing=!0,this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-editing",this._editing)},l.prototype.onEditStop=function(){this._editing=!1,this.resetEditable(),this.makeEditable(this._editableLayer),this.updateDrawControls(),this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-editing",this._editing)},l.prototype.onEdited=function(b){var c=this;b.layers.eachLayer(function(b){var d={type:"Feature",geometry:{type:b.feature.geometry.type},properties:{featureId:b.feature.properties.featureId}};c._draw.controls.polygon.options.draw.polygon.showArea&&(d.properties.area={m_sq:0,ha:0,mi_sq:0,acres:0,yd_sq:0});var e=function(a,b){var c=[];if(angular.forEach(a,function(a){c.push([a.lng,a.lat])}),c.length>0&&c[0]!=c[c.length-1]&&c.push(c[0]),void 0!==b.properties.area){var d=L.GeometryUtil.geodesicArea(a),e=1.19599*d;b.properties.area.m_sq+=d,b.properties.area.ha+=1e-4*d,b.properties.area.mi_sq+=e/3097600,b.properties.area.acres+=e/4840,b.properties.area.yd_sq+=e}return c};switch(b.feature.geometry.type){case"Point":d.geometry.coordinates=[b._latlng.lng,b._latlng.lat],c.broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d);break;case"Polygon":d.geometry.coordinates=[],angular.forEach(b._latlngs,function(a){d.geometry.coordinates.push(e(a,d))}),d.geometry.coordinates.length>1&&(d.geometry.type="MultiPolygon",d.geometry.coordinates=[d.geometry.coordinates]),a.$broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d);break;case"MultiPolygon":d.geometry.coordinates=[],angular.forEach(b._latlngs,function(a,b){d.geometry.coordinates.push([]),angular.forEach(a,function(a){d.geometry.coordinates[b].push(e(a,d))})}),c.broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d);break;case"LineString":d.geometry.coordinates=[],angular.forEach(b._latlngs,function(a){d.geometry.coordinates.push([a.lng,a.lat])}),c.broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d)}})},l.prototype.onDeleted=function(a){var b=this,c=function(a){b._editableFeature.removeLayer(a),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-deleted",a.feature.properties.featureId)};a.layers.getLayers().length>0?a.layers.eachLayer(function(a){void 0!==a.feature?c(a):b._editableFeature.eachLayer(function(b){b.hasLayer(a)&&c(b)})}):(b._editableFeature.clearLayers(),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-deleted")),b.updateDrawControls()},{restrict:"E",template:'<div class="map" ng-hide="hidden" ng-transclude></div>',replace:!0,transclude:!0,link:function(a,b,c){void 0===m[c.id]&&(m[c.id]=new l(c,a))},controller:function(a,b){this.getMap=function(){return m[b.id]._map}}}}]),sdkInterfaceMapApp.directive("mapboxControl",["$rootScope",function(a){function b(b,d){var e=d.parent();a.$on("mapbox-"+e.attr("id")+"::init",function(a,f){d.on("click",function(a){a.originalEvent&&(a.originalEvent._stopped=!0,a.originalEvent.preventDefault(),a.originalEvent.stopPropagation())}),d.on("mouseover",function(){f.dragging.disable()}),d.on("mouseout",function(){f.dragging.enable()}),e.find(".leaflet-control-container "+c[b.position]).prepend(d),b.hidden=!1})}var c={topleft:".leaflet-top.leaflet-left",topright:".leaflet-top.leaflet-right",bottomleft:".leaflet-bottom.leaflet-left",bottomright:".leaflet-bottom.leaflet-right"};return{restrict:"E",require:"^mapbox",replace:!0,transclude:!0,scope:{position:"@"},template:'<div class="leaflet-control"><div class="leaflet-bar" ng-hide="hidden" ng-transclude></div></div>',link:function(a){a.hidden=!0},controller:function(a,c){b(a,c)}}}]);var sdkInterfaceNavigiationApp=angular.module("ag.sdk.interface.navigation",["ag.sdk.authorization","ag.sdk.library"]);sdkInterfaceNavigiationApp.provider("navigationService",["underscore",function(a){var b={},c=[],d={Favourites:1,Assets:2,Apps:3,Administration:4},e={left:[],right:[]},f=function(a,b){return a.order-b.order},g=this.registerApps=function(c){c=c instanceof Array?c:[c],angular.forEach(c,function(c){c=a.defaults(c,{id:c.title,order:100,group:"Apps",include:function(a,b){return-1!==b.indexOf(a.id)}}),c.title&&c.state&&(b[c.title]=c)})};this.$get=["$rootScope","$state","authorization","promiseService",function(h,i,j,k){var l=!1,m="",n=function(b){var e=a.findWhere(c,{title:b.group});void 0===e&&(e={title:b.group,order:d[b.group]||100,items:[]},c.push(e),c=c.sort(f));var g=a.findWhere(e.items,{id:b.id});void 0===g&&(b.active=i.includes(b.state),e.items.push(b),e.items=e.items.sort(f),h.$broadcast("navigation::items__changed",c),h.$broadcast("navigation::app__allowed",b))},o=function(b){var d=a.findWhere(c,{title:b.group});void 0!==d&&(d.items=a.reject(d.items,function(a){return a.id===b.id}),0===d.items.length&&(c=a.reject(c,function(a){return a.title===d.title})),h.$broadcast("navigation::items__changed",c),h.$broadcast("navigation::app__revoked",b))},p=function(){c=[],h.$broadcast("navigation::items__changed",c)},q=function(c){var d=c||j.currentUser(),e=d.userRole?a.pluck(d.userRole.apps,"name"):[],f=d.organization?a.pluck(d.organization.services,"serviceType"):[];p(),angular.forEach(b,function(a){("function"==typeof a.include&&a.include(a,e,f)||a.include===!0)&&n(a)})},r=function(a,b){b&&(b instanceof Array==!1?e[a].push(b):e[a]=b,h.$broadcast("navigation::"+a+"-buttons__changed",e[a]),h.$broadcast("navigation::buttons__changed"))};return h.$on("$onTransitionSuccess",function(){angular.forEach(c,function(a){angular.forEach(a.items,function(a){a.active=i.includes(a.state)})})}),h.$on("authorization::login",function(a,b){q(b)}),h.$on("authorization::unauthorized",function(){p()}),h.$on("authorization::logout",function(){p()}),q(),{getApp:function(c){return a.findWhere(b,{id:c})},getGroupedApps:function(){return c},renameApp:function(d,e){var f=a.findWhere(b,{id:d});f&&(f.title=e,h.$broadcast("navigation::items__changed",c))},selectItem:function(c){return k.wrap(function(d){var e=a.findWhere(b,{id:c.id});e?(h.$broadcast("navigation::item__selected",e),i.go(e.state,e.params).then(d.resolve,d.reject)):d.reject()})},registerApps:function(a){g(a)},unregisterApps:function(){b={},c=[]},allowApp:function(a){b[a]&&n(b[a])},revokeApp:function(a){b[a]&&o(b[a])},toggleSlim:function(){l=!l,h.$broadcast("navigation::slim__changed",l)},isSlim:function(){return l},footerText:function(a){return void 0!==a&&(m=a,h.$broadcast("navigation::footerText",m)),m},leftButtons:function(a){return r("left",a),e.left},rightButtons:function(a){return r("right",a),e.right}}}]}]);var sdkInterfaceUiApp=angular.module("ag.sdk.interface.ui",[]);sdkInterfaceUiApp.directive("busy",[function(){return{restrict:"A",template:'<button ng-click="onClick($event)" ng-disabled="disabled() || isBusy" ng-class="getBusyClass()">\n    <span ng-if="isBusy">\n        <span class="spinner"><i ng-show="icon" ng-class="icon"></i></span> {{ text }}\n    </span>\n    <span ng-if="!isBusy" ng-transclude></span>\n</button>',replace:!0,transclude:!0,scope:{busy:"&",busyIcon:"@",busyText:"@",busyClass:"@",busyDisabled:"&"},link:function(a,b,c){a.isBusy=!1,a.icon=a.busyIcon||"glyphicon glyphicon-refresh",a.text=void 0!==c.busyText?a.busyText:"Saving",a.disabled=a.busyDisabled||function(){return!1},a.getBusyClass=function(){return(a.isBusy&&a.icon?"has-spinner active":"")+(a.isBusy&&a.busyClass?" "+a.busyClass:"")},a.onClick=function(b){var c=0,d=a.busy();if(b.preventDefault(),b.stopPropagation(),a.isBusy=!0,"object"==typeof d&&"function"==typeof d["finally"])d["finally"](function(){a.isBusy=!1});else var e=a.$on("http-intercepted",function(b,d){c="request"==d?c+1:c-1,a.isBusy&&0==c&&(e(),a.isBusy=!1)})}}}}]),sdkInterfaceUiApp.directive("dynamicName",function(){return{restrict:"A",require:"?form",link:function(a,b,c,d){var e=null!=d?d:b.parent().controller("form"),f=e[b.attr("name")];e&&f&&(b.attr("name",c.name),e.$removeControl(f),f.$name=c.name,e.$addControl(f))}}}),sdkInterfaceUiApp.directive("defaultSrc",[function(){return{restrict:"A",link:function(a,b,c){b.bind("error",function(){b.attr("src",c.defaultSrc)})}}}]),sdkInterfaceUiApp.filter("location",["$filter",function(a){return function(b,c){var d=b&&b.geometry||b,e=d&&d.coordinates?{lng:d.coordinates[0],lat:d.coordinates[1]}:d;return(e?a("number")(c?Math.abs(e.lat):e.lng,3)+(c?"° "+(e.lat>=0?"N":"S"):"")+", "+a("number")(c?Math.abs(e.lng):e.lat,3)+(c?"° "+(e.lng<=0?"W":"E"):""):"")+(b&&b.properties&&b.properties.accuracy?" at "+a("number")(b.properties.accuracy,2)+"m":"")}}]),sdkInterfaceUiApp.filter("floor",["$filter",function(a){return function(b){return a("number")(Math.floor(b),0)}}]),sdkInterfaceUiApp.filter("htmlEncode",[function(){return function(a){return(a||"").replace(/[\u00A0-\u9999<>&'"]/gim,function(a){return"&#"+a.charCodeAt(0)+";"})}}]),sdkInterfaceUiApp.filter("newlines",["$filter","$sce",function(a,b){return function(c,d){return b.trustAsHtml(a("htmlEncode")(c).replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(void 0===d||d?"<br />":"<br>")+"$2"))}}]),sdkInterfaceUiApp.filter("unsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),sdkInterfaceUiApp.directive("locationFormatter",["$filter",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$formatters.push(function(c){var e="";return void 0!==c&&(e=a("location")(c,"true"===d.locationFormatter),d.ngChange&&b.$eval(d.ngChange)),e})}}}]),sdkInterfaceUiApp.directive("dateFormatter",["$filter",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$formatters.push(function(b){return void 0!==b?a("date")(new Date(b),d.dateFormat||"yyyy-MM-dd"):""})}}}]),sdkInterfaceUiApp.directive("dateParser",["$filter",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$parsers.push(function(b){return void 0!==b?a("date")(new Date(b),d.dateFormat||"yyyy-MM-dd"):""})}}}]),sdkInterfaceUiApp.directive("inputNumber",["$filter",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f=d.max?parseFloat(d.max):!1,g=d.min?parseFloat(d.min):!1,h=d.round?parseInt(d.round):!1;e.$formatters.push(function(b){return h===!1?b:a("number")(b,h)}),e.$parsers.push(function(a){var b=isNaN(a)||isNaN(parseFloat(a));if(e.$setValidity("number",b===!1),b===!1){var c=parseFloat(a);return e.$setValidity("range",(g===!1||c>=g)&&(f===!1||f>=c)),c}return void 0})}}}]),sdkInterfaceUiApp.directive("inputDate",["moment",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f=d.dateFormat||"YYYY-MM-DD";e.$formatters.length=0,e.$parsers.length=0,e.$formatters.push(function(b){return b?a(b).format(f):b}),e.$parsers.push(function(b){if(b){var c="string"==typeof b?a(b,["DD/MM/YYYY","MM/DD/YYYY","YYYY-MM-DD"],!0):a(b);return c&&"function"==typeof c.isValid&&c.isValid()?(e.$setValidity("date-format",!0),"string"==typeof b?c.format("YYYY-MM-DD"):c):(e.$setValidity("date-format",!1),b)}})}}}]),sdkInterfaceUiApp.directive("sparkline",["$window","underscore",function(a,b){return{restrict:"A",template:'<div class="sparkline"></div>',replace:!0,scope:{sparkline:"=",sparklineText:"="},link:function(c,d,e){function f(a,b){return function(c){return a(c[b])}}function g(){c.data=b.map(c.sparkline,function(a){return b.isArray(a)?{x:b.isNumber(a[0])?a[0]:0,y:b.isNumber(a[1])?a[1]:0}:{x:b.isNumber(a.x)?a.x:0,y:b.isNumber(a.y)?a.y:0}}),c.data.unshift({x:-1,y:b.first(c.data).y}),s.domain(k&&0!=k?[0,k]:h.extent(c.data,function(a){return a.x})),t.domain(m&&0!=m?[0,m]:[0,h.max(c.data,function(a){return a.y})]),q.attr("d",u(c.data)),r.attr("d",v(c.data))}var h=a.d3,i=d[0],j=e.width||i.clientWidth,k=e.xExtent,l=e.height||i.clientHeight,m=e.yExtent||100,n=e.interpolate||"step-before",o=h.select(i).append("svg").attr("width",j).attr("height",l),p=o.append("text").attr("class","sparkline-text").attr("x",j/2).attr("y",l/2+5),q=o.append("path").attr("class","sparkline-area"),r=o.append("path").attr("class","sparkline-line"),s=h.scale.linear().range([0,j]),t=h.scale.linear().range([l,0]),u=h.svg.area().interpolate(n).x(f(s,"x")).y0(l).y1(f(t,"y")),v=h.svg.line().interpolate(n).x(f(s,"x")).y(f(t,"y"));c.$watchCollection("sparkline",function(){g()}),c.$watch("sparklineText",function(){p.text(function(){return c.sparklineText})})}}}]);var sdkModelAsset=angular.module("ag.sdk.model.asset",["ag.sdk.library","ag.sdk.model.base","ag.sdk.model.field","ag.sdk.model.liability","ag.sdk.model.production-schedule"]);sdkModelAsset.factory("AssetBase",["Base","computedProperty","inheritModel","Liability","Model","moment","privateProperty","readOnlyProperty","safeMath","underscore",function(a,b,c,d,e,f,g,h,i,j){function k(c){e.Base.apply(this,arguments),g(this,"generateKey",function(a,b){return this.assetKey=l(this,a,b),this.assetKey}),b(this,"hasGeometry",function(){return!j.isUndefined(this.data.loc)}),g(this,"totalLiabilityInRange",function(a,b){return j.reduce(this.liabilities,function(c,d){return i.plus(c,d.totalLiabilityInRange(a,b))},0)}),this.data=c&&c.data?c.data:{},a.initializeObject(this.data,"attachments",[]),j.isUndefined(c)||0===arguments.length||(this.id=c.id||c.$id,this.assetKey=c.assetKey,this.legalEntityId=c.legalEntityId,this.type=c.type,this.liabilities=j.map(c.liabilities,d.newCopy))}function l(a,b,c){return(b?"entity."+b.uuid:"")+("farmland"!==a.type&&c?"-f."+c.name:"")+(a.data.fieldName?"-fi."+a.data.fieldName:"")+(a.data.crop?"-c."+a.data.crop:"")+("crop"===a.type&&a.data.plantedDate?"-pd."+f(a.data.plantedDate).format("YYYY-MM-DD"):"")+(j.contains(["permanent crop","plantation"],a.type)&&a.data.establishedDate?"-ed."+f(a.data.establishedDate).format("YYYY-MM-DD"):"")+("cropland"===a.type&&a.data.irrigated?"-i."+a.data.irrigation:"")+("farmland"===a.type&&a.data.sgKey?"-"+a.data.sgKey:"")+(j.contains(["improvement","livestock","vme"],a.type)?(a.data.type?"-t."+a.data.type:"")+(a.data.category?"-c."+a.data.category:"")+(a.data.name?"-n."+a.data.name:"")+(a.data.purpose?"-p."+a.data.purpose:"")+(a.data.model?"-m."+a.data.model:"")+(a.data.identificationNo?"-in."+a.data.identificationNo:""):"")+("stock"===a.type?(a.data.type?"-t."+a.data.type:"")+(a.data.category?"-c."+a.data.category:"")+(a.data.product?"-pr."+a.data.product:""):"")+(a.data.waterSource?"-ws."+a.data.waterSource:"")+("other"===a.type&&a.data.name?"-n."+a.data.name:"")}return c(k,e.Base),h(k,"assetTypes",{crop:"Crops",farmland:"Farmlands",improvement:"Fixed Improvements",cropland:"Cropland",livestock:"Livestock",pasture:"Pastures","permanent crop":"Permanent Crops",plantation:"Plantations",stock:"Stock",vme:"Vehicles, Machinery & Equipment",wasteland:"Homestead & Wasteland","water right":"Water Rights"}),h(k,"assetTypesWithOther",j.extend({other:"Other"},k.assetTypes)),g(k,"getAssetKey",function(a,b,c){return l(a,b,c)}),g(k,"getTypeTitle",function(a){return k.assetTypes[a]||""}),g(k,"getTitleType",function(a){var b=j.keys(k.assetTypes);return b[j.values(k.assetTypes).indexOf(a)]}),k.validates({assetKey:{required:!0},data:{required:!0,object:!0},legalEntityId:{required:!0,numeric:!0},type:{required:!0,inclusion:{"in":j.keys(k.assetTypesWithOther)}}}),k}]),sdkModelAsset.factory("AssetGroup",["Asset","AssetFactory","computedProperty","inheritModel","Model","privateProperty","safeMath","underscore",function(a,b,c,d,e,f,g,h){function i(b){e.Base.apply(this,arguments),this.data=b&&b.data?b.data:{},this.assets=[],f(this,"addAsset",function(a){j(this,a)}),f(this,"adjustProperty",function(a,b){l(this,a,b)}),f(this,"availableCrops",function(b){return(b&&b.landUse?a.cropsByLandClass[b.landUse]:a.cropsByType[this.type])||[]}),c(this,"hasGeometry",function(){return h.some(this.assets,function(a){return!h.isUndefined(a.data.loc)})}),f(this,"recalculate",function(){m(this)}),h.each(b.assets,this.addAsset,this)}function j(a,c){c=b.isInstanceOf(c)?c:b["new"](c),(h.isUndefined(a.type)||a.type===c.type)&&(a.type=c.type,a.assets=h.chain(a.assets).reject(function(a){return a.assetKey===c.assetKey}).union([c]).value(),h.each(n,k(a,c)),h.each(o[a.type],k(a,c)),a.recalculate())}function k(a,b){return function(c){h.isUndefined(b.data[c])||(a.data[c]=b.data[c])}}function l(a,b){h.each(a.assets,function(c){c.data[b]!==a.data[b]&&(c.data[b]=a.data[b],c.data.assetValue=g.times(c.data.unitValue,c.data.size),c.$dirty=!0)})}function m(a){a.data=h.extend(a.data,h.reduce(a.assets,function(a,b){return a.size=g.plus(a.size,b.data.size),a.assetValue=g.plus(a.assetValue,b.data.assetValue?b.data.assetValue:g.times(b.data.unitValue,b.data.size)),a.unitValue=a.size>0?g.dividedBy(a.assetValue,a.size):a.unitValue||b.data.unitValue||0,a},{})),a.data.assetValue=a.data.size&&a.data.unitValue?g.times(a.data.unitValue,a.data.size):a.data.assetValue}d(i,e.Base);var n=["areaUnit","unitValue"],o={crop:["crop","irrigated","irrigation"],cropland:["crop","croppingPotential","irrigated","irrigation"],improvement:["category","type"],pasture:["condition","crop","grazingCapacity","irrigated","irrigation","terrain"],"permanent crop":["condition","crop","establishedDate","establishedYear","irrigated","irrigation"],plantation:["condition","crop","establishedDate","establishedYear","irrigated","irrigation"],"water right":["waterSource"]};return i}]),sdkModelAsset.factory("Asset",["AssetBase","attachmentHelper","Base","computedProperty","Field","inheritModel","moment","naturalSort","privateProperty","readOnlyProperty","safeMath","underscore",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(b){a.apply(this,arguments),i(this,"generateUniqueName",function(a,b){this.data.name=x(this,a,b)}),i(this,"getAge",function(a){return this.data.establishedDate?g(a).diff(this.data.establishedDate,"years",!0):0}),i(this,"getCategories",function(){return m.categories[this.type]||[]}),i(this,"getCustomTitle",function(a,b){return s(this,a,b)}),i(this,"getTitle",function(a,b){return v(this,a,b)}),i(this,"isFieldApplicable",function(a){return y(this,a)}),i(this,"clean",function(){"vme"===this.type?(this.data.quantity=this.data.identificationNo&&this.data.identificationNo.length>0?1:this.data.quantity,this.data.identificationNo=1!==this.data.quantity?"":this.data.identificationNo):"cropland"===this.type&&(this.data.equipped=this.data.irrigated?this.data.equipped:!1)}),d(this,"thumbnailUrl",function(){return u(this)}),d(this,"age",function(){return this.data.establishedDate?g().diff(this.data.establishedDate,"years",!0):0}),d(this,"title",function(){return v(this,!0)}),d(this,"description",function(){return this.data.description||""}),d(this,"fieldName",function(){return this.data.fieldName}),d(this,"size",function(){return"farmland"!==this.type?this.data.size:this.data.area}),d(this,"farmRequired",function(){return z(this)}),i(this,"unitSize",function(a){return n(this,a,"farmland"!==this.type?"size":"area")}),i(this,"unitValue",function(a){return this.data.valuePerHa?o(this,a,"ha","valuePerHa"):n(this,a,"unitValue")}),i(this,"availableCrops",function(a){return(a&&a.landUse?m.cropsByLandClass[a.landUse]:m.cropsByType[this.type])||[]}),d(this,"crop",function(){return this.data.crop}),d(this,"establishedDate",function(){return this.data.establishedDate}),d(this,"plantedDate",function(){return this.data.plantedDate}),d(this,"liquidityTypeTitle",function(){return this.data.liquidityType&&this.assetTypes[this.data.liquidityType]||""}),i(this,"incomeInRange",function(a,b){var c={};return this.data.sold===!0&&this.data.salePrice&&g(this.data.soldDate,"YYYY-MM-DD").isBetween(a,b)&&(c.Sales=this.data.salePrice),c}),i(this,"totalIncomeInRange",function(a,b){return l.reduce(this.incomeInRange(a,b),function(a,b){return k.plus(a,b)},0)}),l.isUndefined(b)||0===arguments.length||(this.farmId=b.farmId,!this.data.valuePerHa&&this.data.assetValue&&this.size&&(this.data.valuePerHa=k.dividedBy(this.data.assetValue,this.size),this.$dirty=!0),!this.data.unitValue&&this.data.valuePerHa&&(this.data.unitValue=this.data.valuePerHa,this.data.areaUnit="ha",this.$dirty=!0))}function n(a,b,c){var d=a.data.areaUnit||"ha";return o(a,b,d,c)}function o(a,b,c,d){var e=A[c+"/"+b],f=a.data[d];return c===b?f:e&&e(f)}function p(a){return function(b){return l.object(l.first(a,b.length),b)}}function q(a){switch(a.type){case"crop":case"permanent crop":case"plantation":return["plantedArea","crop","fieldName","farmName"];case"farmland":return[["label","portionLabel","portionNumber"]];case"cropland":return["typeTitle",function(a){return a.data.irrigation?a.data.irrigation+" irrigated":a.data.irrigated?"Irrigated ("+(a.data.equipped?"equipped":"unequipped")+")":"Non irrigable"},"waterSource","fieldName","farmName"];case"livestock":return["type","category"];case"pasture":return[function(a){return a.data.intensified?(a.data.crop?a.data.crop+" intensified ":"Intensified ")+a.type:"Natural Grazing"},"fieldName","farmName"];case"stock":return["category"];case"vme":return["category","model"];case"wasteland":return["typeTitle"];case"water source":case"water right":return["waterSource","fieldName","farmName"];default:return[["name","category","typeTitle"]]}}function r(a,b,c){return l.chain(b).map(function(b){if(l.isArray(b))return l.first(r(a,b,c));if(l.isFunction(b))return b(a,c);switch(b){case"age":var d=g(c.asOfDate).diff(a.data.establishedDate,"years");return a.data.establishedDate&&(0===d?"Established":d+" year"+(1===d?"":"s"));case"defaultTitle":return r(a,q(a),c);case"farmName":return c.withFarm&&c.field&&c.field[b];case"fieldName":return c.withField&&a.data[b];case"croppingPotential":return c.field&&c.field[b]&&c.field[b]+" Potential";case"landUse":return c.field&&c.field[b];case"area":case"plantedArea":case"size":return a.data[b]&&k.round(a.data[b],2)+"ha";case"portionNumber":return a.data.portionNumber?"Ptn. "+a.data.portionNumber:"Rem. extent of farm";case"typeTitle":return m.assetTypes[a.type];default:return a.data[b]}}).compact().uniq().value()}function s(a,b,c){return c=l.defaults(c||{},{separator:", "}),l.flatten(r(a,b||q(a),c)).join(c.separator)}function t(a){return l.chain(m.improvementCategoriesByLandClass).reduce(function(b,c,d){return l.contains(c,a.data.type)&&b.push(d),b},[]).union(["Built-up"]).first().value()}function u(){return b.findSize(this,"thumb","img/camera.png")}function v(a,b,c){return s(a,q(a),{farm:c,withFarm:!l.isUndefined(c),field:c&&l.findWhere(c.data.fields,{fieldName:a.data.fieldName}),withField:b})}function w(a,c){var d={id:a.id||a.$id,type:a.type,updatedAt:a.updatedAt};if(a.data)switch(d.title=v(a,!0),d.groupby=a.farmId,d.thumbnailUrl=b.findSize(a,"thumb","img/camera.png"),a.type){case"crop":d.subtitle=a.data.plantedDate?"Planted: "+g(a.data.plantedDate).format("YYYY-MM-DD"):"",d.size=a.data.size;break;case"cropland":case"pasture":case"wasteland":case"water right":d.subtitle=void 0!==a.data.size?"Area: "+k.round(a.data.size,2)+"ha":"Unknown area",d.size=a.data.size;break;case"farmland":d.subtitle=void 0!==a.data.area?"Area: "+k.round(a.data.area,2)+"ha":"Unknown area",d.size=a.data.area;break;case"permanent crop":case"plantation":d.subtitle=a.data.establishedDate?"Established: "+g(a.data.establishedDate).format("YYYY-MM-DD"):"",d.size=a.data.size;break;case"improvement":d.subtitle=a.data.type+(a.data.category?" - "+a.data.category:"")+(void 0!==a.data.size?" ("+k.round(a.data.size,2)+"m²)":""),d.summary=a.data.description||"";break;case"livestock":d.subtitle=(a.data.breed?a.data.breed+" for ":"For ")+a.data.purpose,d.summary=a.data.description||"",d.groupby=a.data.type;break;case"stock":d.groupby=a.type;break;case"vme":d.subtitle="Quantity: "+a.data.quantity,d.summary=a.data.description||"",d.groupby=a.data.type}return c&&(d=l.extend(d,c)),d}function x(a,b,c){b=b||"";var d=l.chain(c).where({type:a.type}).reduce(function(a,c){if(c.data.name){var d,e=c.data.name.search(/\s+[0-9]+$/),f=c.data.name;-1!==e&&(f=f.substr(0,e),d=parseInt(c.data.name.substring(e).trim())),b&&f===b&&(!d||d>a)&&(a=d||1)}return a},-1).value();return b+(d+1?" "+(d+1):"")}function y(a,b){return l.contains(m.landClassesByType[a.type],e["new"](b).landUse)}function z(a){return l.contains(["crop","farmland","cropland","improvement","pasture","permanent crop","plantation","wasteland","water right"],a)}var A={"sm/ha":function(a){return k.dividedBy(a,1e4)},"ha/sm":function(a){return k.times(a,1e4)}};f(m,a);var B="Airport",C="Aquaculture",D="Borehole",E="Poultry",F="Breeding",G="Building",H="Cattle",I="Chickens",J="Commercial",K="Compost",L="Crop Processing",M="Dairy",N="Dam",O="Domestic",P="Education",Q="Equipment",R="Fencing",S="Fuel",T="Goats",U="Indirect Costs",V="Irrigation",W="Livestock Handling",X="Logistics",Y="Machinery",Z="Meat Processing",$="Mushrooms",_="Nursery",ab="Ostriches",bb="Paddocks",cb="Piggery",db="Pigs",eb="Preharvest",fb="Processing",gb="Recreation",hb="Residential",ib="Roads",jb="Security",kb="Sheep",lb="Slaughter",mb="Sports",nb="Staff",ob="Storage",pb="Tanks",qb="Utilities",rb="Vehicles",sb="Walls",tb="Water",ub="Wine Cellar";j(m,"categories",{improvement:l.map([[B],[B,"Hangar"],[B,"Helipad"],[B,"Runway"],[C],[C,"Pond"],[C,"Net House"],["Aviary"],["Beekeeping"],[D],[D,"Equipped"],[D,"Pump"],[D,"Windmill"],[E],[E,"Broiler House"],[E,"Broiler House - Atmosphere"],[E,"Broiler House - Semi"],[E,"Broiler House - Zinc"],[E,"Hatchery"],[G],[G,"Administrative"],[G,J],[G,"Entrance"],[G,"Lean-to"],[G,"Outbuilding"],[G,"Gate"],["Cold Storage"],[J],[J,"Coffee Shop"],[J,"Sales Facility"],[J,"Shop"],[J,"Bar"],[J,"Café"],[J,"Restaurant"],[J,"Factory"],[J,"Tasting Facility"],[J,"Cloth House"],[K],[K,"Preparing Unit"],["Crocodile Dam"],[L],[L,"Degreening Room"],[L,"Dehusking Facility"],[L,"Drying Facility"],[L,"Drying Tunnels"],[L,"Sorting Facility"],[L,"Drying Oven"],[L,"Drying Racks"],[L,"Crushing Plant"],[L,"Nut Cracking Facility"],[L,"Nut Factory"],[M],[M,"Pasteurising Facility"],[M,"Milking Parlour"],[N],[N,"Filter"],[N,"Trout"],[O],[O,"Chicken Coop"],[O,"Chicken Run"],[O,"Kennels"],[O,"Gardening Facility"],[P],[P,"Conference Room"],[P,"Classroom"],[P,"Crèche"],[P,"School"],[P,"Training Facility"],[Q],[Q,"Air Conditioner"],[Q,"Gantry"],[Q,"Oven"],[Q,"Pump"],[Q,"Pumphouse"],[Q,"Scale"],["Feed Mill"],["Feedlot"],[R],[R,"Electric"],[R,"Game"],[R,"Perimeter"],[R,jb],[R,"Wire"],[S],[S,"Tanks"],[S,"Tank Stand"],[S,"Fuelling Facility"],["Grain Mill"],["Greenhouse"],["Infrastructure"],[V],[V,"Sprinklers"],["Laboratory"],[W],[W,"Auction Facility"],[W,"Cages"],[W,"Growing House"],[W,"Pens"],[W,"Shelter"],[W,"Breeding Facility"],[W,"Culling Shed"],[W,"Dipping Facility"],[W,"Elephant Enclosures"],[W,"Feed Troughs/Dispensers"],[W,"Horse Walker"],[W,"Maternity Shelter/Pen"],[W,"Quarantine Area"],[W,"Rehab Facility"],[W,"Shearing Facility"],[W,"Stable"],[W,"Surgery"],[W,"Treatment Area"],[W,"Weaner House"],[W,"Grading Facility"],[W,"Inspection Facility"],[X],[X,"Handling Equipment"],[X,"Handling Facility"],[X,"Depot"],[X,"Loading Area"],[X,"Loading Shed"],[X,"Hopper"],[X,"Weigh Bridge"],[Z],[Z,"Abattoir"],[Z,"Deboning Room"],[Z,"Skinning Facility"],["Mill"],[$],[$,"Cultivation"],[$,"Sweat Room"],[_,"Plant"],[_,"Plant Growing Facility"],["Office"],["Packaging Facility"],[bb],[bb,"Camp"],[bb,"Kraal"],[cb],[cb,"Farrowing House"],[cb,"Pig Sty"],[fb],[fb,"Bottling Facility"],[fb,"Flavour Shed"],[fb,"Processing Facility"],[gb],[gb,"Viewing Area"],[gb,"BBQ"],[gb,"Clubhouse"],[gb,"Event Venue"],[gb,"Gallery"],[gb,"Game Room"],[gb,"Gazebo"],[gb,"Gymnasium"],[gb,"Jacuzzi"],[gb,"Judging Booth"],[gb,"Museum"],[gb,"Play Area"],[gb,"Pool House"],[gb,"Pottery Room"],[gb,"Racing Track"],[gb,"Salon"],[gb,"Sauna"],[gb,"Shooting Range"],[gb,"Spa Facility"],[gb,"Squash Court"],[gb,"Swimming Pool"],["Religious","Church"],[hb],[hb,"Carport"],[hb,"Driveway"],[hb,"Flooring"],[hb,"Paving"],[hb,"Roofing"],[hb,"Water Feature"],[hb,"Hall"],[hb,"Balcony"],[hb,"Canopy"],[hb,"Concrete Surface"],[hb,"Courtyard"],[hb,"Covered"],[hb,"Deck"],[hb,"Mezzanine"],[hb,"Parking Area"],[hb,"Patio"],[hb,"Porch"],[hb,"Porte Cochere"],[hb,"Terrace"],[hb,"Veranda"],[hb,"Walkways"],[hb,"Rondavel"],[hb,"Accommodation Units"],[hb,"Boma"],[hb,"Bungalow"],[hb,"Bunker"],[hb,"Cabin"],[hb,"Chalet"],[hb,"Community Centre"],[hb,"Dormitory"],[hb,"Dwelling"],[hb,"Flat"],[hb,"Kitchen"],[hb,"Lapa"],[hb,"Laundry Facility"],[hb,"Locker Room"],[hb,"Lodge"],[hb,"Shower"],[hb,"Toilets"],[hb,"Room"],[hb,"Cottage"],[hb,"Garage"],[ib],[ib,"Access Roads"],[ib,"Gravel"],[ib,"Tarred"],[jb],[jb,"Control Room"],[jb,"Guardhouse"],[jb,"Office"],["Shade Nets"],["Silo"],[mb],[mb,"Arena"],[mb,"Tennis Court"],[nb],[nb,"Hostel"],[nb,"Hut"],[nb,"Retirement Centre"],[nb,"Staff Building"],[nb,"Canteen"],[nb,"Dining Facility"],[ob],[ob,"Truck Shelter"],[ob,"Barn"],[ob,"Dark Room"],[ob,"Bin Compartments"],[ob,Y],[ob,"Saddle Room"],[ob,"Shed"],[ob,"Chemicals"],[ob,"Tools"],[ob,"Dry"],[ob,Q],[ob,"Feed"],[ob,"Fertilizer"],[ob,S],[ob,"Grain"],[ob,"Hides"],[ob,"Oil"],[ob,"Pesticide"],[ob,"Poison"],[ob,"Seed"],[ob,"Zinc"],[ob,"Sulphur"],[ob],[ob,"Vitamin Room"],["Sugar Mill"],[pb],[pb,tb],["Timber Mill"],["Trench"],[qb],[qb,"Battery Room"],[qb,"Boiler Room"],[qb,"Compressor Room"],[qb,"Engine Room"],[qb,"Generator"],[qb,"Power Room"],[qb,"Pumphouse"],[qb,"Transformer Room"],["Vacant Area"],[rb],[rb,"Transport Depot"],[rb,"Truck Wash"],[rb,"Workshop"],[sb],[sb,"Boundary"],[sb,"Retaining"],[sb,jb],["Warehouse"],[tb],[tb,"Reservoir"],[tb,"Tower"],[tb,"Purification Plant"],[tb,"Reticulation Works"],[tb,"Filter Station"],[ub],[ub,"Tanks"],[ub,"Winery"],[ub,"Barrel Maturation Room"]],p(["category","subCategory"])),livestock:l.map([[H,"Phase A Bulls",F],[H,"Phase B Bulls",F],[H,"Phase C Bulls",F],[H,"Phase D Bulls",F],[H,"Heifers",F],[H,"Bull Calves",F],[H,"Heifer Calves",F],[H,"Tollies 1-2",F],[H,"Heifers 1-2",F],[H,"Culls",F],[H,"Bulls",M],[H,"Dry Cows",M],[H,"Lactating Cows",M],[H,"Heifers",M],[H,"Calves",M],[H,"Culls",M],[H,"Bulls",lb],[H,"Cows",lb],[H,"Heifers",lb],[H,"Weaners",lb],[H,"Calves",lb],[H,"Culls",lb],[I,"Day Old Chicks","Broilers"],[I,"Broilers","Broilers"],[I,"Hens","Layers"],[I,"Point of Laying Hens","Layers"],[I,"Culls","Layers"],["Game","Game",lb],[T,"Rams",lb],[T,"Breeding Ewes",lb],[T,"Young Ewes",lb],[T,"Kids",lb],["Horses","Horses",F],[db,"Boars",lb],[db,"Breeding Sows",lb],[db,"Weaned pigs",lb],[db,"Piglets",lb],[db,"Porkers",lb],[db,"Baconers",lb],[db,"Culls",lb],[ab,"Breeding Stock",lb],[ab,"Slaughter Birds > 3 months",lb],[ab,"Slaughter Birds < 3 months",lb],[ab,"Chicks",lb],["Rabbits","Rabbits",lb],[kb,"Rams",F],[kb,"Young Rams",F],[kb,"Ewes",F],[kb,"Young Ewes",F],[kb,"Lambs",F],[kb,"Wethers",F],[kb,"Culls",F],[kb,"Rams",lb],[kb,"Ewes",lb],[kb,"Lambs",lb],[kb,"Wethers",lb],[kb,"Culls",lb]],p(["category","subCategory","purpose"])),stock:l.map([["Animal Feed","Lick","kg"],[U,S,"l"],[U,tb,"l"],[eb,"Seed","kg"],[eb,"Plant Material","each"],[eb,"Fertiliser","t"],[eb,"Fungicides","l"],[eb,"Lime","t"],[eb,"Herbicides","l"],[eb,"Pesticides","l"]],p(["category","subCategory","unit"])),vme:l.map([[rb,"LDV"],[rb,"LDV (Double Cab)"],[rb,"LDV (4-Wheel)"],[rb,"LDV (Double Cab 4-Wheel)"],[rb,"Truck"],[rb,"Truck (Double Differential)"],[rb,"Truck (Horse)"],[rb,"Truck (Semi-trailer)"],[rb,"Truck (Timber Trailer)"],[rb,"Truck (Cane Trailer)"],[Y,"Tractor"],[Y,"Tractor (4-Wheel)"],[Y,"Tractor (Orchard)"],[Y,"Tractor (Orchard, 4-Wheel)"],[Y,"Road Grader"],[Y,"Front-end Loader"],[Y,"Bulldozer"],[Y,"Forklift"],[Y,"Borehole Machine"],[Y,"Loader (Cane)"],[Y,"Loader (Timber)"],[Y,"Harvester (Maize Combine)"],[Y,"Harvester (Wheat Combine)"],[Y,"Electric Motor"],[Y,"Internal Combustion Engine"],[Y,"Irrigation Pump"],[Y,"Irrigation Pump (Electrical)"],[Y,"Irrigation Pump (Internal Combustion Engine) "],[Q,"Ripper"],[Q,"Ripper (Sugar Cane)"],[Q,"Ripper (Heavy Duty)"],[Q,"Ripper (Auto Reset)"],[Q,"Plough"],[Q,"Plough (Moldboard)"],[Q,"Plough (Disc)"],[Q,"Plough (Chisel)"],[Q,"Plough (Bulldog)"],[Q,"Harrow"],[Q,"Harrow (Offset Disc)"],[Q,"Harrow (Hydraulic Offset)"],[Q,"Harrow (Offset Trailer)"],[Q,"Harrow (Tandem Disc)"],[Q,"Harrow (Rotary)"],[Q,"Harrow (Power)"],[Q,"Ridger"],[Q,"Ridger (Disc)"],[Q,"Ridger (Shear)"],[Q,"Tiller"],[Q,"Tiller (S-Shank)"],[Q,"Tiller (C-Shank)"],[Q,"Tiller (Vibro-flex)"],[Q,"Tiller (Otma)"],[Q,"Cultivator"],[Q,"Cultivator (Shank Tiller)"],[Q,"Cultivator (Vibro Tiller)"],[Q,"Planter"],[Q,"Planter (Single Kernel)"],[Q,"Planter (Seed Drill)"],[Q,"Planter (Wheat)"],[Q,"Planter (Potato)"],[Q,"Vegetable Transplanter"],[Q,"Fine Seed Seeder"],[Q,"Land Roller"],[Q,"Spreader (Fertiliser)"],[Q,"Spreader (Manure)"],[Q,"Spreader (Lime)"],[Q,"Mist Blower"],[Q,"Boom Sprayer"],[Q,"Boom Sprayer (Mounted)"],[Q,"Boom Sprayer (Trailer)"],[Q,"Mower"],[Q,"Mower (Conditioner)"],[Q,"Slasher"],[Q,"Haymaker"],[Q,"Hay Rake"],[Q,"Hay Baler"],[Q,"Hay Baler (Square)"],[Q,"Hay Baler (Round)"],[Q,"Bale Handler"],[Q,"Bale Handler (Round)"],[Q,"Bale Handler (Wrapper)"],[Q,"Bale Handler (Shredder)"],[Q,"Harvester (Combine Trailer)"],[Q,"Harvester (Forage)"],[Q,"Harvester (Forage Chop)"],[Q,"Harvester (Forage Flail)"],[Q,"Harvester (Thresher)"],[Q,"Harvester (Potato Lifter)"],[Q,"Harvester (Potato Sorter)"],[Q,"Harvester (Groundnut Picker)"],[Q,"Harvester (Groundnut Sheller)"],[Q,"Harvester (Groundnut Lifter)"],[Q,"Hammer Mill"],[Q,"Feed Mixer"],[Q,"Roller Mill"],[Q,"Grain Pump"],[Q,"Grain Grader"],[Q,"Grain Drier"],[Q,"Grader (Rear Mounted)"],[Q,"Dam Scoop"],[Q,"Post Digger"],[Q,"Trailer"],[Q,"Trailer (Tip)"],[Q,"Trailer (4-Wheel)"],[Q,"Trailer (Water Cart)"],[Q,"Trailer (Cane)"],[Q,"Trailer (Cane Truck)"],[Q,"Trailer (Timber)"],[Q,"Trailer (Timber Truck)"]],p(["category","subCategory"]))}),j(m,"landClassesByType",{crop:["Cropland","Cropland (Emerging)","Cropland (Irrigated)","Cropland (Smallholding)","Vegetables"],cropland:["Cropland","Cropland (Emerging)","Cropland (Irrigated)","Cropland (Smallholding)","Vegetables"],farmland:[],improvement:["Built-up","Residential","Structures (Handling)","Structures (Processing)","Structures (Retail)","Structures (Storage)","Utilities"],livestock:["Grazing","Grazing (Bush)","Grazing (Fynbos)","Grazing (Shrubland)","Planted Pastures"],pasture:["Grazing","Grazing (Bush)","Grazing (Fynbos)","Grazing (Shrubland)","Planted Pastures"],"permanent crop":["Greenhouses","Orchard","Orchard (Shadenet)","Vineyard"],plantation:["Forest","Pineapple","Plantation","Plantation (Smallholding)","Sugarcane","Sugarcane (Emerging)","Sugarcane (Irrigated)","Tea"],vme:[],wasteland:["Non-vegetated","Wasteland"],"water right":["Water","Water (Seasonal)","Wetland"]});
var vb=["Barley","Bean","Bean (Broad)","Bean (Dry)","Bean (Sugar)","Bean (Green)","Bean (Kidney)","Beet","Broccoli","Butternut","Cabbage","Canola","Carrot","Cassava","Cauliflower","Cotton","Cowpea","Grain Sorghum","Groundnut","Leek","Lucerne","Maize","Maize (White)","Maize (Yellow)","Oats","Onion","Peanut","Pearl Millet","Potato","Pumpkin","Rapeseed","Rice","Rye","Soya Bean","Sunflower","Sweet Corn","Sweet Potato","Teff","Tobacco","Triticale","Turnip","Wheat","Wheat (Durum)"],wb=["Maize (Irrigated)","Soya Bean (Irrigated)","Teff (Irrigated)","Wheat (Irrigated)"],xb=l.union(vb,wb).sort(h),yb=["Bahia-Notatum","Birdsfoot Trefoil","Bottle Brush","Buffalo","Buffalo (Blue)","Buffalo (White)","Bush","Carribean Stylo","Clover","Clover (Arrow Leaf)","Clover (Crimson)","Clover (Persian)","Clover (Red)","Clover (Rose)","Clover (Strawberry)","Clover (Subterranean)","Clover (White)","Cocksfoot","Common Setaria","Dallis","Eragrostis","Kikuyu","Lucerne","Lupin","Lupin (Narrow Leaf)","Lupin (White)","Lupin (Yellow)","Medic","Medic (Barrel)","Medic (Burr)","Medic (Gama)","Medic (Snail)","Medic (Strand)","Multispecies Pasture","Phalaris","Rescue","Rhodes","Russian Grass","Ryegrass","Ryegrass (Hybrid)","Ryegrass (Italian)","Ryegrass (Westerwolds)","Serradella","Serradella (Yellow)","Silver Leaf Desmodium","Smuts Finger","Soutbos","Tall Fescue","Teff","Veld","Weeping Lovegrass"],zb=["Almond","Apple","Apricot","Avocado","Banana","Barberry","Berry","Bilberry","Blackberry","Blueberry","Cherry","Citrus","Cloudberry","Coconut","Coffee","Date","Fig","Gooseberry","Grapefruit","Guava","Hazelnut","Kiwi Fruit","Kumquat","Lemon","Lime","Litchi","Macadamia Nut","Mandarin","Mango","Mulberry","Nectarine","Olive","Orange","Papaya","Peach","Pear","Prickly Pear","Pecan Nut","Persimmon","Pistachio Nut","Plum","Pomegranate","Protea","Prune","Raspberry","Rooibos","Roses","Strawberry","Walnut","Wineberry"],Ab=["Aloe","Bluegum","Eucalyptus","Hops","Pine","Pineapple","Tea","Timber","Sisal","Sugarcane","Sugarcane (Irrigated)","Wattle"],Bb=["Chicory","Chili","Garlic","Lentil","Melon","Olive","Onion","Pea","Pumpkin","Quince","Strawberry","Tomato","Watermelon","Carrot","Beet","Cauliflower","Broccoli","Leek","Butternut","Cabbage","Rapeseed"],Cb=["Currant","Grape","Grape (Bush Vine)","Grape (Red)","Grape (Table)","Grape (White)","Raisin"];return j(m,"cropsByLandClass",{Cropland:vb,"Cropland (Emerging)":vb,"Cropland (Irrigated)":wb,"Cropland (Smallholding)":vb,Forest:["Pine","Timber"],Grazing:yb,"Grazing (Bush)":["Bush"],"Grazing (Fynbos)":yb,"Grazing (Shrubland)":yb,Greenhouses:[],Orchard:zb,"Orchard (Shadenet)":zb,Pineapple:["Pineapple"],Plantation:Ab,"Plantation (Smallholding)":Ab,"Planted Pastures":yb,Sugarcane:["Sugarcane"],"Sugarcane (Emerging)":["Sugarcane"],"Sugarcane (Irrigated)":["Sugarcane (Irrigated)"],Tea:["Tea"],Vegetables:Bb,Vineyard:Cb}),j(m,"cropsByType",{crop:xb,cropland:xb,livestock:yb,pasture:yb,"permanent crop":l.union(zb,Cb),plantation:Ab}),j(m,"improvementCategoriesByLandClass",{"Built-up":[B,G,"Crocodile Dam",N,O,P,R,"Infrastructure","Laboratory","Office",ib,jb,"Trench","Vacant Area",sb],Residential:[gb,"Religious",hb,nb,mb],"Structures (Handling)":[C,"Aviary","Beekeeping",M,"Feedlot","Greenhouse",W,$,_,bb,cb,E],"Structures (Processing)":[L,"Feed Mill","Grain Mill",Z,"Packaging Facility",fb,"Sugar Mill","Timber Mill"],"Structures (Retail)":[J],"Structures (Storage)":["Cold Storage","Silo",ob,"Warehouse",ub],Utilities:[D,"Compost",Q,S,V,X,"Shade Nets","Tanks",qb,rb,tb]}),j(m,"liquidityTypes",{"long-term":"Long-term","medium-term":"Movable","short-term":"Current"}),j(m,"liquidityCategories",{"long-term":["Fixed Improvements","Investments","Land","Other"],"medium-term":["Breeding Stock","Vehicles, Machinery & Equipment","Other"],"short-term":["Crops & Crop Products","Cash on Hand","Debtors","Short-term Investments","Prepaid Expenses","Production Inputs","Life Insurance","Livestock Products","Marketable Livestock","Negotiable Securities","Other"]}),j(m,"conditions",["Good","Good to fair","Fair","Fair to poor","Poor"]),j(m,"seasons",["Cape","Summer","Fruit","Winter"]),i(m,"farmRequired",function(a){return z(a)}),i(m,"getCropsByLandClass",function(a){return m.cropsByLandClass[a]||[]}),i(m,"getCustomTitle",function(a,b,c){return s(a,b,c)}),i(m,"getDefaultCrop",function(a){return 1===l.size(m.cropsByLandClass[a])?l.first(m.cropsByLandClass[a]):void 0}),i(m,"getImprovementLandClass",function(a){return t(a)}),i(m,"getThumbnailUrl",function(a){return u(a)}),i(m,"getTitle",function(a,b,c){return v(a,b,c)}),i(m,"listServiceMap",function(a,b){return w(a,b)}),m.validates({assetKey:{required:!0},crop:{requiredIf:function(a,b){return l.contains(["crop","permanent crop","plantation"],b.type)},inclusion:{"in":function(a,b){return m.cropsByType[b.type]}}},establishedDate:{requiredIf:function(a,b){return l.contains(["permanent crop","plantation"],b.type)},format:{date:!0}},farmId:{requiredIf:function(a,b){return z(b.type)},numeric:!0},fieldName:{requiredIf:function(a,b){return l.contains(["crop","cropland","pasture","permanent crop","plantation"],b.type)},length:{min:1,max:255}},legalEntityId:{required:!0,numeric:!0},plantedDate:{requiredIf:function(a,b){return l.contains(["crop"],b.type)},format:{date:!0}},size:{requiredIf:function(a,b){return l.contains(["crop","cropland","pasture","permanent crop","plantation","wasteland","water right"],b.type)},numeric:!0},type:{required:!0,inclusion:{"in":l.keys(m.assetTypesWithOther)}}}),m}]),sdkModelAsset.provider("AssetFactory",function(){var a={};this.add=function(b,c){a[b]=c},this.$get=["$injector","Asset",function(b,c){function d(d,e){return a[d.type]?("string"==typeof a[d.type]&&(a[d.type]=b.get(a[d.type])),a[d.type][e](d)):c[e](d)}return{isInstanceOf:function(b){return b?a[b.type]?b instanceof a[b.type]:b instanceof c:!1},"new":function(a){return d(a,"new")},newCopy:function(a){return d(a,"newCopy")}}}]});var sdkModelCrop=angular.module("ag.sdk.model.crop",["ag.sdk.model.asset"]);sdkModelCrop.provider("Crop",["AssetFactoryProvider",function(a){this.$get=["Base","asJson","Asset","computedProperty","inheritModel","privateProperty","naturalSort","readOnlyProperty","safeMath","underscore",function(a,b,c,d,e,f,g,h,i,j){function k(){c.apply(this,arguments),a.initializeObject(this.data,"inspections",[]),a.initializeObject(this.data,"problems",[]),a.initializeObject(this.data,"season","Unknown"),a.initializeObject(this.data,"zones",[]),d(this,"flower",function(){return t[this.data.crop]||q}),d(this,"problems",function(){return this.data.problems}),d(this,"zones",function(){return this.data.zones}),f(this,"addProblem",function(a){l(this,"problems",a)}),f(this,"addZone",function(a){l(this,"zones",a)}),f(this,"removeProblem",function(a){m(this,"problems",a)}),f(this,"removeZone",function(a){m(this,"zones",a)}),this.type="crop"}function l(a,c,d){d&&(a.data[c]=j.chain(a.data[c]).reject(j.identity({uuid:d.uuid})).union([b(d)]).value().sort(function(a,b){return g(a.createdAt,b.createdAt)}),n(a),a.$dirty=!0)}function m(a,b,c){c&&(a.data[b]=j.reject(a.data[b],j.identity({uuid:c.uuid})),n(a),a.$dirty=!0)}function n(a){a.data.plantedArea=j.reduce(a.zones,function(a,b){return i.plus(a,b.size)},0)}e(k,c);var o="ear",p="flower",q="pod",r="panicle",s="spikelet",t={"Dry Bean":q,"Grain Sorghum":r,Maize:o,"Maize (White)":o,"Maize (Yellow)":o,Sunflower:p,Wheat:s,"Soya Bean":q};return k.validates(j.defaults({type:{required:!0,equal:{to:"crop"}}},c.validations)),k}],a.add("crop","Crop")}]),sdkModelCrop.factory("CropProblem",["generateUUID","inheritModel","Model","moment","readOnlyProperty","underscore",function(a,b,c,d,e,f){function g(b){c.Base.apply(this,arguments),f.isUndefined(b)||0===arguments.length||(this.createdAt=b.createdAt||d().format("YYYY-MM-DD"),this.description=b.description,this.loc=b.loc,this.size=b.size,this.type=b.type,this.uuid=b.uuid||a())}return b(g,c.Base),e(g,"problemTypes",["Disease","Fading","Uneven","Other","Root","Shortage","Weed"]),g.validates({description:{requiredIf:function(a,b){return"Other"===b.type},length:{min:0,max:255}},type:{required:!0,inclusion:{"in":g.problemTypes}},uuid:{format:{uuid:!0}}}),g}]),sdkModelCrop.factory("CropZone",["computedProperty","generateUUID","inheritModel","Model","moment","naturalSort","readOnlyProperty","underscore",function(a,b,c,d,e,f,g,h){function i(c){d.Base.apply(this,arguments),a(this,"cultivars",function(){return i.cultivarsByCrop[this.crop]||[]}),a(this,"growthStages",function(){return D[this.crop]||C[0]}),a(this,"leavesPerPlant",function(){return B[this.cultivar]||22},{enumerable:!0}),a(this,"typeRequired",function(){return s.include(this.crop,"Maize")}),h.isUndefined(c)||0===arguments.length||(this.createdAt=c.createdAt||e().format("YYYY-MM-DD"),this.crop=c.crop,this.cultivar=c.cultivar,this.emergenceDate=c.emergenceDate,this.growthStage=c.growthStage,this.inRows=c.inRows,this.loc=c.loc,this.plantsHa=c.plantsHa,this.rowWidth=c.rowWidth,this.seedProvider=c.seedProvider,this.size=c.size,this.type=c.type,this.uuid=c.uuid||b())}c(i,d.Base);var j="Afgri",k="Agricol",l="Agriocare",m="All-Grow Seed",n="Capstone",o="Dekalb (Monsanto)",p="Delta Seeds",q="Dry Bean Seed Pty (Ltd)",r="Klein Karoo",t="Linksaad",u="Pannar",v="Pioneer",w="Sensako",x="Sensako (Monsanto)",y="Other",z=[[j,"AFG 4222 B"],[j,"AFG 4244"],[j,"AFG 4270 B"],[j,"AFG 4410"],[j,"AFG 4412 B"],[j,"AFG 4414"],[j,"AFG 4416 B"],[j,"AFG 4434 R"],[j,"AFG 4440"],[j,"AFG 4448"],[j,"AFG 4452 B"],[j,"AFG 4474 R"],[j,"AFG 4476"],[j,"AFG 4478 BR"],[j,"AFG 4512"],[j,"AFG 4520"],[j,"AFG 4522 B"],[j,"AFG 4530"],[j,"AFG 4540"],[j,"AFG 4546"],[j,"AFG 4548"],[j,"AFG 4566 B"],[j,"AFG 4572 R"],[j,"AFG 4660"],[j,"AFG 4664"],[j,"DK 618"],[k,"IMP 50-90 BR"],[k,"IMP 51-22 B"],[k,"IMP 51-92"],[k,"IMP 51-92 R"],[k,"QS 7646"],[k,"SC 602"],[k,"SC 608"],[n,"CAP 121-30"],[n,"CAP 122-60"],[n,"CAP 130-120"],[n,"CAP 130-140"],[n,"CAP 444 NG"],[n,"CAP 766 NG"],[n,"CAP 9004"],[n,"CAP 9444 NG"],[o,"DKC 61-90"],[o,"DKC 62-80 BR"],[o,"DKC 62-80 BR GEN"],[o,"DKC 62-84 R"],[o,"DKC 64-78 BR"],[o,"DKC 64-78 BR GEN"],[o,"DKC 66-32 B"],[o,"DKC 66-36 R"],[o,"DKC 66-60 BR"],[o,"DKC 73-70 B GEN"],[o,"DKC 73-72"],[o,"DKC 73-74 BR GEN"],[o,"DKC 73-76 R"],[o,"DKC 80-10"],[o,"DKC 80-12 B GEN"],[o,"DKC 80-30 R"],[o,"DKC 80-40 BR GEN"],[p,"Amber"],[p,"DE 2004"],[p,"DE 2006"],[p,"DE 2016"],[p,"DE 222"],[r,"Helen"],[r,"KKS 8202"],[r,"KKS 8204 B"],[r,"KKS 8400"],[r,"KKS 8402"],[t,"LS 8518"],[t,"LS 8524 R"],[t,"LS 8526"],[t,"LS 8528 R"],[t,"LS 8532 B"],[t,"LS 8536 B"],[u,"BG 3268"],[u,"BG 3292"],[u,"BG 3492BR"],[u,"BG 3568R"],[u,"BG 3592R"],[u,"BG 3768BR"],[u,"BG 4296"],[u,"BG 6308B"],[u,"PAN 14"],[u,"PAN 3D-736 BR"],[u,"PAN 3P-502 R"],[u,"PAN 3P-730 BR"],[u,"PAN 3Q-222"],[u,"PAN 3Q-240"],[u,"PAN 3Q-740 BR"],[u,"PAN 3R-644 R"],[u,"PAN 4P-228"],[u,"PAN 4P-716 BR"],[u,"PAN 6126 "],[u,"PAN 66"],[u,"PAN 6616"],[u,"PAN 6P-110"],[u,"PAN 6P110"],[u,"PAN 6Q-408B"],[u,"PAN 6Q-508 R"],[u,"PAN 6Q-708 BR"],[v,"P 1615 R"],[v,"P 2048"],[v,"Phb 31D21 B"],[v,"Phb 31D24"],[v,"Phb 31D46 BR"],[v,"Phb 31D48 B"],[v,"Phb 31G54 BR"],[v,"Phb 31G56 R"],[v,"Phb 31K58 B"],[v,"Phb 32D95 BR"],[v,"Phb 32D96 B"],[v,"Phb 32D99"],[v,"Phb 32P68 R"],[v,"Phb 32T50"],[v,"Phb 32W71"],[v,"Phb 32W72 B"],[v,"Phb 33A14 B"],[v,"Phb 33H52 B"],[v,"Phb 33H56"],[v,"Phb 33Y72 B"],[v,"Phb 33Y74"],[v,"Phb 3442"],[v,"Phb 34N44 B"],[v,"Phb 34N45 BR"],[v,"Phb 35T05 R"],[x,"SNK 2472"],[x,"SNK 2682"],[x,"SNK 2778"],[x,"SNK 2900"],[x,"SNK 2942"],[x,"SNK 2972"],[x,"SNK 6326 B"],[x,"SNK 7510 Y"],[x,"SNK 8520"],[y,"Brasco"],[y,"Cobber Flint"],[y,"Cumbre"],[y,"Energy"],[y,"Gold Finger"],[y,"High Flyer"],[y,"IMP 50-10 R"],[y,"IMP 51-22"],[y,"IMP 52-12"],[y,"MEH 114"],[y,"MMH 1765"],[y,"MMH 8825"],[y,"Maverik"],[y,"NK Arma"],[y,"NK MAYOR B"],[y,"NS 5000"],[y,"NS 5004"],[y,"NS 5066"],[y,"NS 5914"],[y,"NS 5916"],[y,"NS 5918"],[y,"NS 5920"],[y,"Premium Flex"],[y,"QS 7608"],[y,"RO 430"],[y,"SA 24"],[y,"SABI 7004"],[y,"SABI 7200"],[y,"Silmaster"],[y,"Syncerus"],[y,"US 9570"],[y,"US 9580"],[y,"US 9600"],[y,"US 9610"],[y,"US 9620"],[y,"US 9770"],[y,"US 9772"],[y,"Woodriver"]],A=[[j,"AFG 4211"],[j,"AFG 4321"],[j,"AFG 4331"],[j,"AFG 4333"],[j,"AFG 4361"],[j,"AFG 4383"],[j,"AFG 4411"],[j,"AFG 4445"],[j,"AFG 4447"],[j,"AFG 4471"],[j,"AFG 4475 B"],[j,"AFG 4477"],[j,"AFG 4479 R"],[j,"AFG 4501"],[j,"AFG 4517"],[j,"AFG 4555"],[j,"AFG 4571 B"],[j,"AFG 4573 B"],[j,"AFG 4575"],[j,"AFG 4577 B"],[j,"AFG 4579 B"],[j,"AFG 4581 BR"],[j,"AFG 4611"],[j,"AFG 4663"],[j,"AFRIC 1"],[k,"IMP 52-11"],[k,"SC 701"],[k,"SC 709"],[n,"CAP 341 NG"],[n,"CAP 341 T NG"],[n,"CAP 441 NG"],[n,"CAP 775 NG"],[n,"CAP 9001"],[n,"CAP 9013"],[n,"CAP 9421"],[o,"CRN 3505"],[o,"CRN 4141"],[o,"DKC 77-61 B"],[o,"DKC 77-85 B GEN"],[o,"DKC 78-15 B"],[o,"DKC 78-17 B"],[o,"DKC 78-35 R"],[o,"DKC 78-45 BR"],[o,"DKC 78-45 BR GEN"],[o,"DKC 79-05"],[p,"DE 111"],[p,"DE 303"],[r,"KKS 4383"],[r,"KKS 4445"],[r,"KKS 4447"],[r,"KKS 4471"],[r,"KKS 4473"],[r,"KKS 4477"],[r,"KKS 4479 R"],[r,"KKS 4485"],[r,"KKS 4501"],[r,"KKS 4517"],[r,"KKS 4519"],[r,"KKS 4555"],[r,"KKS 4575"],[r,"KKS 4581 BR"],[r,"KKS 8401"],[t,"LS 8519"],[t,"LS 8529"],[t,"LS 8533 R"],[t,"LS 8535 B"],[t,"LS 8537"],[t,"LS 8539 B"],[u,"BG 5485B"],[u,"BG 5685R"],[u,"BG4201"],[u,"BG4401B"],[u,"BG5285"],[u,"BG5785BR"],[u,"BG6683R"],[u,"PAN 413"],[u,"PAN 4P-767BR"],[u,"PAN 53"],[u,"PAN 5Q-649 R"],[u,"PAN 5Q-749 BR"],[u,"PAN 5Q-751BR"],[u,"PAN 6227"],[u,"PAN 6479"],[u,"PAN 6611"],[u,"PAN 6671"],[u,"PAN 67"],[u,"PAN 6777"],[u,"PAN 69"],[u,"PAN 6Q-745BR"],[u,"PAN 93"],[u,"PAN413"],[u,"PAN53"],[u,"PAN6Q245"],[u,"PAN6Q345CB"],[u,"SC 701 (Green mealie)"],[v,"P 2369 W"],[v,"P 2653 WB"],[v,"P 2823 WB"],[v,"P 2961 W"],[v,"Phb 30B95 B"],[v,"Phb 30B97 BR"],[v,"Phb 30D04 R"],[v,"Phb 30D07 B"],[v,"Phb 30D09 BR"],[v,"Phb 30Y79 B"],[v,"Phb 30Y81 R"],[v,"Phb 30Y83"],[v,"Phb 31M09"],[v,"Phb 31M84 BR"],[v,"Phb 31T91"],[v,"Phb 31V31"],[v,"Phb 3210B"],[v,"Phb 32A05 B"],[v,"Phb 32B07 BR"],[v,"Phb 32Y85"],[v,"Phb 32Y87 B"],[x,"SNK 2021"],[x,"SNK 2147"],[x,"SNK 2401"],[x,"SNK 2551"],[x,"SNK 2721"],[x,"SNK 2911"],[x,"SNK 2969"],[x,"SNK 6025"],[x,"SNK 7811 B"],[y,"CG 4141"],[y,"GM 2000"],[y,"KGALAGADI"],[y,"MRI 514"],[y,"MRI 624"],[y,"NG 761"],[y,"NS 5913"],[y,"NS 5917"],[y,"NS 5919"],[y,"PGS 7053"],[y,"PGS 7061"],[y,"PGS 7071"],[y,"PLATINUM"],[y,"Panthera"],[y,"QS 7707"],[y,"RO 413"],[y,"RO 413"],[y,"RO 419"],[y,"SAFFIER"],[y,"SC 401"],[y,"SC 403"],[y,"SC 405"],[y,"SC 407"],[y,"SC 513"],[y,"SC 627"],[y,"SC 631"],[y,"SC 633"],[y,"SC 713"],[y,"SC 715"],[y,"Scout"]];g(i,"cultivarsByCrop",{Barley:[[k,"SKG 9"],[k,"SVG 13"],[y,"Clipper"],[y,"Cocktail"],[y,"Puma"],[y,"SabbiErica"],[y,"SabbiNemesia"],[y,"SSG 564"],[y,"SSG 585"]],"Bean (Dry)":[[n,"CAP 2000"],[n,"CAP 2001"],[n,"CAP 2008"],[q,"DBS 310"],[q,"DBS 360"],[q,"DBS 830"],[q,"DBS 840"],[q,"Kranskop HR1"],[q,"OPS RS1"],[q,"OPS RS2"],[q,"OPS RS4"],[q,"OPS-KW1"],[q,"RS 5"],[q,"RS 6"],[q,"RS 7"],[u,"PAN 116"],[u,"PAN 123"],[u,"PAN 128"],[u,"PAN 135"],[u,"PAN 139"],[u,"PAN 146"],[u,"PAN 148"],[u,"PAN 148 Plus"],[u,"PAN 9213"],[u,"PAN 9216"],[u,"PAN 9225"],[u,"PAN 9249"],[u,"PAN 9280"],[u,"PAN 9281"],[u,"PAN 9292"],[u,"PAN 9298"],[y,"AFG 470"],[y,"AFG 471"],[y,"BONUS"],[y,"CALEDON"],[y,"CARDINAL"],[y,"CERRILLOS"],[y,"DONGARA"],[y,"DPO 820"],[y,"JENNY"],[y,"KAMIESBERG"],[y,"KOMATI"],[y,"KRANSKOP"],[y,"MAJUBA"],[y,"MASKAM"],[y,"MINERVA"],[y,"MKONDENI"],[y,"MKUZI"],[y,"RUBY"],[y,"SC Silk"],[y,"SC Superior"],[y,"SEDERBERG"],[y,"SSB 20"],[y,"STORMBERG"],[y,"TEEBUS"],[y,"TEEBUS-RCR2"],[y,"TEEBUS-RR1"],[y,"TYGERBERG"],[y,"UKULINGA"],[y,"UMTATA"],[y,"WERNA"]],Canola:[[k,"Aga Max"],[k,"AV Garnet"],[k,"CB Jardee HT"],[k,"Cobbler"],[k,"Tawriffic"],[r,"Hyola 61"],[r,"Rocket CL"],[r,"Thunder TT"],[r,"Varola 54"]],"Grain Sorghum":[[k,"AVENGER GH"],[k,"DOMINATOR GM"],[k,"ENFORCER GM"],[k,"MAXIMIZER"],[k,"PREMIUM 4065 T GH"],[k,"PREMIUM 100"],[k,"NS 5511 GH"],[k,"NS 5540"],[k,"NS 5555"],[k,"NS 5655 GM"],[k,"NS 5751"],[k,"NS 5832"],[k,"TIGER GM"],[n,"CAP 1002"],[n,"CAP 1003"],[n,"CAP 1004"],[r,"MR 32 GL"],[r,"MR 43 GL"],[r,"MR BUSTER GL"],[r,"MR PACER"],[u,"PAN 8625 GH"],[u,"PAN 8816 GM"],[u,"PAN 8906 GM"],[u,"PAN 8909 GM"],[u,"PAN 8006 T"],[u,"PAN 8507"],[u,"PAN 8609"],[u,"PAN 8648"],[u,"PAN 8706"],[u,"PAN 8806"],[u,"PAN 8901"],[u,"PAN 8902"],[u,"PAN 8903"],[u,"PAN 8904"],[u,"PAN 8905"],[u,"PAN 8906"],[u,"PAN 8907"],[u,"PAN 8908"],[u,"PAN 8909"],[u,"PAN 8911"],[u,"PAN 8912"],[u,"PAN 8913"],[u,"PAN 8914"],[u,"PAN 8915"],[u,"PAN 8916"],[u,"PAN 8918"],[u,"PAN 8919"],[u,"PAN 8920"],[u,"PAN 8921"],[u,"PAN 8922"],[u,"PAN 8923"],[u,"PAN 8924"],[u,"PAN 8925"],[u,"PAN 8926"],[u,"PAN 8927"],[u,"PAN 8928"],[u,"PAN 8929"],[u,"PAN 8930"],[u,"PAN 8931"],[u,"PAN 8932"],[u,"PAN 8933"],[u,"PAN 8936"],[u,"PAN 8937"],[u,"PAN 8938"],[u,"PAN 8939"],[u,"PAN 8940"],[u,"PAN 8966"],[y,"APN 881"],[y,"MACIA-SA"],[y,"NK 8830"],[y,"OVERFLOW"],[y,"SA 1302-M27"],[y,"TITAN"],[y,"X868"]],Maize:h.union(z,A).sort(function(a,b){return f(a.join(),b.join())}),"Maize (Yellow)":z,"Maize (White)":A,Oat:[[k,"Magnifico"],[k,"Maida"],[k,"Nugene"],[k,"Overberg"],[k,"Pallinup"],[k,"Saia"],[k,"SWK001"],[x],[x,"SSH 39W"],[x,"SSH 405"],[x,"SSH 421"],[x,"SSH 423"],[x,"SSH 491"],[y,"Drakensberg"],[y,"H06/19"],[y,"H06/20"],[y,"H07/04"],[y,"H07/05"],[y,"Heros"],[y,"Kompasberg"],[y,"Le Tucana"],[y,"Maluti"],[y,"Potoroo"],[y,"Witteberg"]],"Soya Bean":[[l,"AGC 58007 R"],[l,"AGC 60104 R"],[l,"AGC 64107 R"],[l,"AS 4801 R"],[t,"LS 6146 R"],[t,"LS 6150 R"],[t,"LS 6161 R"],[t,"LS 6164 R"],[t,"LS 6248 R"],[t,"LS 6261 R"],[t,"LS 6444 R"],[t,"LS 6466 R"],[u,"A 5409 RG"],[u,"PAN 1454 R"],[u,"PAN 1583 R"],[u,"PAN 1664 R"],[u,"PAN 1666 R"],[v,"Phb 94Y80 R"],[v,"Phb 95B53 R"],[v,"Phb 95Y20 R"],[v,"Phb 95Y40 R"],[y,"AG 5601"],[y,"AMSTEL NO 1"],[y,"DUMELA"],[y,"DUNDEE"],[y,"EGRET"],[y,"HERON"],[y,"HIGHVELD TOP"],[y,"IBIS 2000"],[y,"JF 91"],[y,"JIMMY"],[y,"KIAAT"],[y,"KNAP"],[y,"LEX 1233 R"],[y,"LEX 1235 R"],[y,"LEX 2257 R"],[y,"LEX 2685 R"],[y,"LIGHTNING"],[y,"MARULA"],[y,"MARUTI"],[y,"MOPANIE"],[y,"MPIMBO"],[y,"MUKWA"],[y,"NQUTU"],[y,"OCTA"],[y,"SONOP"],[y,"SPITFIRE"],[y,"STORK"],[y,"TAMBOTIE"],[y,"WENNER"]],Sugarcane:[[y,"ACRUNCH"],[y,"BONITA"],[y,"CHIEFTAIN"],[y,"EARLISWEET"],[y,"GLADIATOR"],[y,"GSS 9299"],[y,"HOLLYWOOD"],[y,"HONEYMOON"],[y,"INFERNO"],[y,"JUBILEE"],[y,"MADHUR"],[y,"MAJESTY"],[y,"MANTRA"],[y,"MATADOR"],[y,"MAX"],[y,"MEGATON"],[y,"MMZ 9903"],[y,"ORLA"],[y,"OSCAR"],[y,"OVERLAND"],[y,"PRIMEPLUS"],[y,"RUSALTER"],[y,"RUSTICO"],[y,"RUSTLER"],[y,"SENTINEL"],[y,"SHIMMER"],[y,"STAR 7708"],[y,"STAR 7713"],[y,"STAR 7714"],[y,"STAR 7715"],[y,"STAR 7717"],[y,"STAR 7718"],[y,"STAR 7719"],[y,"STETSON"],[y,"SWEET SUCCESS"],[y,"SWEET SURPRISE"],[y,"SWEET TALK"],[y,"TENDER TREAT"],[y,"WINSTAR"]],Sunflower:[[k,"AGSUN 5161 CL"],[k,"AGSUN 5182 CL"],[k,"Agsun 5264"],[k,"Agsun 5671"],[k,"Agsun 8251"],[k,"Nonjana"],[k,"SUNSTRIPE"],[r,"AFG 271"],[r,"HYSUN 333"],[r,"KKS 318"],[r,"NK ADAGIO"],[r,"NK Armoni"],[r,"NK FERTI"],[r,"Sirena"],[r,"Sunbird"],[u,"PAN 7033"],[u,"PAN 7049"],[u,"PAN 7050"],[u,"PAN 7057"],[u,"PAN 7063 CL"],[u,"PAN 7080"],[u,"PAN 7086 HO"],[u,"PAN 7095 CL"],[u,"PAN 7351"],[y,"Ella"],[y,"Grainco Sunstripe"],[y,"HV 3037"],[y,"HYSUN 334"],[y,"HYSUN 338"],[y,"HYSUN 346"],[y,"HYSUN 350"],[y,"Jade Emperor"],[y,"Marica-2"],[y,"NK Adagio CL"],[y,"Nallimi CL"],[y,"SEA 2088 CL AO"],[y,"SY 4045"],[y,"SY 4200"],[y,"Sikllos CL"],[y,"WBS 3100"]],Triticale:[[k,"AG Beacon"],[k,"Rex"],[u,"PAN 248"],[u,"PAN 299"],[y,"Bacchus"],[y,"Cloc 1"],[y,"Cultivars"],[y,"Falcon"],[y,"Ibis"],[y,"Kiewiet"],[y,"Korhaan"],[y,"Tobie"],[y,"US 2009"],[y,"US 2010"],[y,"US2007"]],Wheat:[[j,"AFG 554-8"],[j,"AFG 75-3"],[m,"BUFFELS"],[m,"DUZI"],[m,"KARIEGA"],[m,"KROKODIL"],[m,"SABIE"],[m,"STEENBRAS"],[r,"HARTBEES"],[r,"KOMATI"],[r,"KOONAP"],[r,"MATLABAS"],[r,"SELATI"],[r,"SENQU"],[w,"CRN 826"],[w,"ELANDS"],[w,"SST 015"],[w,"SST 026"],[w,"SST 027"],[w,"SST 035"],[w,"SST 036"],[w,"SST 037"],[w,"SST 039"],[w,"SST 047"],[w,"SST 056"],[w,"SST 057"],[w,"SST 065"],[w,"SST 077"],[w,"SST 087"],[w,"SST 088"],[w,"SST 094"],[w,"SST 096"],[w,"SST 107"],[w,"SST 124"],[w,"SST 308"],[w,"SST 316"],[w,"SST 317"],[w,"SST 319"],[w,"SST 322"],[w,"SST 333"],[w,"SST 334"],[w,"SST 347"],[w,"SST 356"],[w,"SST 363"],[w,"SST 366"],[w,"SST 367"],[w,"SST 374"],[w,"SST 387"],[w,"SST 398"],[w,"SST 399"],[w,"SST 802"],[w,"SST 805"],[w,"SST 806"],[w,"SST 807"],[w,"SST 815"],[w,"SST 816"],[w,"SST 822"],[w,"SST 825"],[w,"SST 835"],[w,"SST 843"],[w,"SST 866"],[w,"SST 867"],[w,"SST 875"],[w,"SST 876"],[w,"SST 877"],[w,"SST 878"],[w,"SST 884"],[w,"SST 885"],[w,"SST 886"],[w,"SST 895"],[w,"SST 896"],[w,"SST 935"],[w,"SST 936"],[w,"SST 946"],[w,"SST 954"],[w,"SST 963"],[w,"SST 964"],[w,"SST 966"],[w,"SST 972"],[w,"SST 983"],[w,"SST 0127"],[w,"SST 1327"],[w,"SST 3137"],[w,"SST 8125"],[w,"SST 8126"],[w,"SST 8134"],[w,"SST 8135"],[w,"SST 8136"],[u,"PAN 3118"],[u,"PAN 3120"],[u,"PAN 3122"],[u,"PAN 3144"],[u,"PAN 3161"],[u,"PAN 3172"],[u,"PAN 3195"],[u,"PAN 3198"],[u,"PAN 3355"],[u,"PAN 3364"],[u,"PAN 3368"],[u,"PAN 3369"],[u,"PAN 3377"],[u,"PAN 3378"],[u,"PAN 3379"],[u,"PAN 3394"],[u,"PAN 3400"],[u,"PAN 3404"],[u,"PAN 3405"],[u,"PAN 3408"],[u,"PAN 3434"],[u,"PAN 3471"],[u,"PAN 3478"],[u,"PAN 3489"],[u,"PAN 3490"],[u,"PAN 3492"],[u,"PAN 3497"],[u,"PAN 3111"],[u,"PAN 3349"],[u,"PAN 3515"],[u,"PAN 3623"],[y,"BAVIAANS"],[y,"BELINDA"],[y,"BETTA-DN"],[y,"BIEDOU"],[y,"CALEDON"],[y,"CARINA"],[y,"CAROL"],[y,"GARIEP"],[y,"HUGENOOT"],[y,"INIA"],[y,"KOUGA"],[y,"KWARTEL"],[y,"LIMPOPO"],[y,"MacB"],[y,"MARICO"],[y,"NOSSOB"],[y,"OLIFANTS"],[y,"SNACK"],[y,"TAMBOTI"],[y,"TANKWA"],[y,"TARKA"],[y,"TIMBAVATI"],[y,"TUGELA-DN"],[y,"UMLAZI"],[y,"RATEL"]]});var B={"Phb 30F40":23,"Phb 31G54 BR":19,"Phb 31G58":21,"Phb 32D95BR":18,"Phb 32D96 B":18,"Phb 32P68 R":20,"Phb 32T50":18,"Phb 32W71":21,"Phb 32W72 B":20,"Phb 33A14 B":19,"Phb 33H56":20,"Phb 33R78 B":21,"Phb 33Y72B":17,"Phb 3442":21,"Phb 30B95 B":23,"Phb 30B97 BR":23,"Phb 30D09 BR":20,"Phb 31M09":18,"Phb 32A05 B":19,"Phb 32B10":18,"Phb 32Y85":21,"Phb 31D48 BR":21,"Phb 32D91 R":20,"Phb 32D99":20,"Phb 32Y68":20,"Phb 3394":19,"Phb 33A13":19,"Phb 33H52 B":19,"Phb 33H54 BR":19,"Phb 33P34":20,"Phb 33P66":20,"Phb 33P67":20,"X 70200 T":23,"X 7268 TR":21,"Phb 30N35":23,"Phb 32A03":19,"Phb 32Y52":19,"Phb 32Y53":20,"Phb 33A03":19,"Phb 30H22":21,"Phb 32P75":20,"Phb 3335":20,"DKC62-74R":20,"DKC62-80BR":18,"DKC64-78BR":17,"DKC66-32B":21,"DKC66-36R":19,"DKC73-70BGEN":20,"DKC73-74BR":20,"DKC73-74BRGEN":20,"DKC73-76R":20,"DKC80-10":20,"DKC80-12B":20,"DKC80-30R":20,"DKC80-40BR":19,"DKC80-40BRGEN":21,CRN3505:21,"DKC77-61B":20,"DKC77-71R":20,"DKC77-85B":21,"DKC78-15B":20,"DKC78-35BR":21,"DKC78-45BRGEN":21,"DKC 78-79 BR":21,"CRN 3604":21,"CRN 37-60":20,"CRN 4760 B":23,"DKC 63-20":20,"DKC 66-21":21,"DKC 66-38 B":21,"DKC 63-28 R":21,"CRN 3549":21,"DKC 71-21":20,"SNK 2472":23,"SNK 2682":23,"SNK 2778":23,"SNK 2900":20,"SNK 2942":24,"SNK 2972":21,"SNK 6326 B":21,"SNK 8520":24,"SNK 2911":21,"SNK 6025":18,"LS 8504":20,"LS 8512":20,"LS 8518":19,"LS 8522 R":19,"LS 8511":19,"LS 8513":19,"LS 8519":19,"LS 8521 B":19,"LS 8523 B":19,"LS 8527 BR":19,"LS 8506":21,"LS 8508":20,"LS 8524 R":20,"LEX 800":23,"LS 8509":21,"LS 8517":23,"LS 8525":21,"LS 8529":21,"LS 8533 R":21,"LS 8536 B":19,"PAN 3D-432Bt ":18,"PAN 3D-736BR":18,"PAN 3P-502RR":19,"PAN 3P-730BR":18,"PAN 3Q-422B":18,"PAN 3Q-740BR":19,"PAN 3R-644R":18,"PAN 4P-116":19,"PAN 4P-316Bt":19,"PAN 4P-516RR":20,"PAN 4P-716BR":19,"PAN 6114":19,"PAN 6126":18,"PAN 6146":24,"PAN 6236Bt":18,"PAN 6238RR":18,"PAN 6480":23,"PAN 6616":23,"PAN 6724Bt":25,"PAN 6734":23,"PAN 6P-110":21,"PAN 6Q-308 B":21,"PAN 6Q-308 Bt":21,"PAN 6Q-408 CB":21,"PAN 6Q-508R":21,"PAN 6Q-508RR":20,"PAN 4P-767BR":19,"PAN 5Q-433Bt *":20,"PAN 5R-541RR":19,"PAN 6013Bt":23,"PAN 6017":21,"PAN 6043":23,"PAN 6053":23,"PAN 6223Bt":21,"PAN 6479":23,"PAN 6611":23,"PAN 6723":23,"PAN 6777":25,"PAN 6Q-419B":20,"PAN 6Q-445Bt":21,"PAN 6000 Bt":19,"PAN 6012 Bt":21,"PAN 6118":19,"PAN 6124 Bt":19,"PAN 6128 RR":19,"PAN 6256":24,"PAN 6310":24,"PAN 6316":25,"PAN 6320":25,"PAN 6432 B":23,"PAN 6568":23,"PAN 6622":25,"PAN 6710":21,"PAN 6804":20,"PAN 6844":25,"PAN 6994 Bt":24,"PAN 5Q-749 BR":23,"PAN 6243":24,"PAN 6335":23,"PAN 6573":23,"PAN 6633":23,"PAN 6757":25,"PAN 6839":23,"PAN 6Q-321 B":23,"PAN 6Q-345 CB":21,"AFG 4270B":18,"AFG 4412B":19,"AFG 4434R":20,"AFG 4522B":20,"AFG 4530":19,"AFG 4222 B":19,"AFG 4244":19,"AFG 4410":19,"AFG 4414":20,"AFG 4416 B":20,"AFG 4448":20,"AFG 4474 R":19,"AFG 4476":20,"AFG 4512":23,"AFG 4520":20,"AFG 4540":20,"DK 618":21,"EXPG 5002":20,"EXP Stack":20,"AFG 4321":19,"AFG 4331":20,"AFG 4333":20,"AFG 4411":21,"AFG 4445":21,"AFG 4447":21,"AFG 4471":23,"AFG 4475 B":21,"AFG 4477":20,"AFG 4479 R":21,"AFG 4573 B":21,"AFG 4577 B":21,"AFG 4611":23,"KKS 8204B":15,"KKS 4581 BR":21,"KKS 8301":19,"IMP 50 - 90BR":18,"IMP 51 - 22":19,"IMP 51-92":19,"IMP 52-12":20,"NS 5920":20,"QS 7646":20,"BG 5485 B":23,"BG 8285":23,Brasco:19,Energy:18,"Gold Finger":19,Helen:17,"High Flyer":17,Maverik:19,"NK Arma":18,"QS 7608":23,"SC 506":19,"SC 602":21,Woodriver:18,"P 1615 R":19,"P 1973 Y":19,"P 2653 WB":20,"P 2048":20,"IMP 52-11 B":18,Panthera:21,"QS 7707":23,"SC 401":18,"SC 403":20,"SC 405":20,"SC 407":20,"SC 533":21,"SC 719":24,Scout:20},C=[["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12","R13","R14"],["V0","V1","V2","V3","V4","V5","R1","R2","R3","R4","R5","R6"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","R1","R2","R3","R4","R5","R6","R7","R8","R9"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","V17","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","V17","V18","V19","V20","V21","V22","V23","V24","V25","V26","V27","V28","R1","R2","R3","R4","R5","R6","R7","R8"],["V0","V1","V2","V3","V4","V5","V6","V7","R1","R2","R3","R4","R5","R6","R7","R8","R9"],["V0","V1","V2","V3","V4","V5","V6","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12","R13","R14","R15","R16","R17","R18"],["V0","V1","V2","V3","V4","R1","R2","R3","R4","R5","R6"],["V0","V1","V2","V3","V4","V5","V6","V7","R1","R2","R3","R4","R5","R6"]],D={Barley:C[1],Bean:C[5],"Bean (Broad)":C[5],"Bean (Dry)":C[5],"Bean (Sugar)":C[5],"Bean (Green)":C[5],"Bean (Kidney)":C[5],Canola:C[7],Cotton:C[6],"Grain Sorghum":C[3],Maize:C[0],"Maize (White)":C[0],"Maize (Yellow)":C[0],"Soya Bean":C[2],Sunflower:C[4],Wheat:C[1],"Wheat (Durum)":C[1]};return g(i,"maizeTypes",["Commodity","Hybrid","Silo Fodder"]),i.validates({emergenceDate:{format:{date:!0}},growthStage:{required:!0,inclusion:{"in":function(a,b){return b.growthStages}}},plantsHa:{required:!0,range:{from:0},numeric:!0},rowWidth:{requiredIf:function(a,b){return b.inRows},range:{from:0},numeric:!0},type:{requiredIf:function(a,b){return s.include(b.crop,"Maize")},inclusion:{"in":i.maizeTypes}},uuid:{format:{uuid:!0}}}),i}]);var sdkModelLivestock=angular.module("ag.sdk.model.livestock",["ag.sdk.model.asset","ag.sdk.model.stock"]);sdkModelLivestock.provider("Livestock",["AssetFactoryProvider",function(a){this.$get=["computedProperty","inheritModel","privateProperty","readOnlyProperty","Stock","underscore",function(a,b,c,d,e,f){function g(){e.apply(this,arguments),d(this,"actions",{incoming:["Birth","Retained","Purchase"],movement:["Deliver"],outgoing:["Death","Household","Labour","Retain","Sale"]}),a(this,"actionTitles",function(){return h(this)}),c(this,"getActionTitle",function(a){var b=a.split(":",2);if(2===b.length)switch(b[0]){case"Retain":return this.birthAnimal===this.data.category?"Wean Livestock":"Retain "+b[1];case"Retained":return this.weanedAnimal===this.data.category?"Weaned Livestock":"Retained "+b[1];default:return b[0]}return this.actionTitles[a]}),a(this,"baseAnimal",function(){return l[this.data.type]||this.data.type}),a(this,"birthAnimal",function(){return i(this.data.type)}),a(this,"weanedAnimal",function(){return j(this.data.type)}),c(this,"conversionRate",function(){return p[this.baseAnimal]&&(p[this.baseAnimal][this.data.category]||p[this.baseAnimal][n[this.baseAnimal]])}),a(this,"representativeAnimal",function(){return n[this.baseAnimal]}),this.type="livestock"}function h(a){return f.chain(k).pairs().union(f.map(o[a.baseAnimal][a.data.category],function(b){return["Retain:"+b,a.birthAnimal===a.data.category?"Wean Livestock":"Retain "+b]})).sortBy(function(a){return a[0]}).object().omit(a.birthAnimal===a.data.category?[]:["Birth","Death"]).value()}function i(a){var b=l[a]||a;return b&&m[b]}function j(a){var b=l[a]||a,c=m[b];return c&&o[b]&&f.first(o[b][c])}b(g,e);var k={Birth:"Register Births",Death:"Register Deaths",Deliver:"Deliver Livestock",Purchase:"Purchase Livestock",Household:"Household Consumption",Labour:"Labour Consumption",Sale:"Sell Livestock"},l={"Cattle (Extensive)":"Cattle","Cattle (Feedlot)":"Cattle","Cattle (Stud)":"Cattle","Sheep (Extensive)":"Sheep","Sheep (Feedlot)":"Sheep","Sheep (Stud)":"Sheep"},m={Cattle:"Calf",Game:"Calf",Goats:"Kid",Rabbits:"Kit",Sheep:"Lamb"},n={Cattle:"Cow",Game:"Cow",Goats:"Ewe",Rabbits:"Doe",Sheep:"Ewe"},o={Cattle:{Calf:["Weaner Calf"],"Weaner Calf":["Bull","Heifer","Steer"],Heifer:["Cow"],Cow:[],Steer:["Ox"],Ox:[],Bull:[]},Game:{Calf:["Weaner Calf"],"Weaner Calf":["Heifer","Steer","Bull"],Heifer:["Cow"],Cow:[],Steer:["Ox"],Ox:[],Bull:[]},Goats:{Kid:["Weaner Kid"],"Weaner Kid":["Ewe","Castrate","Ram"],Ewe:[],Castrate:[],Ram:[]},Rabbits:{Kit:["Weaner Kit"],"Weaner Kit":["Doe","Lapin","Buck"],Doe:[],Lapin:[],Buck:[]},Sheep:{Lamb:["Weaner Lamb"],"Weaner Lamb":["Ewe","Wether","Ram"],Ewe:[],Wether:[],Ram:[]}},p={Cattle:{Calf:.32,"Weaner Calf":.44,Cow:1.1,Heifer:1.1,Steer:.75,Ox:1.1,Bull:1.36},Game:{Calf:.32,"Weaner Calf":.44,Cow:1.1,Heifer:1.1,Steer:.75,Ox:1.1,Bull:1.36},Goats:{Kid:.08,"Weaner Kid":.12,Ewe:.17,Castrate:.17,Ram:.22},Rabbits:{Kit:.08,"Weaner Kit":.12,Doe:.17,Lapin:.17,Buck:.22},Sheep:{Lamb:.08,"Weaner Lamb":.11,Ewe:.16,Wether:.16,Ram:.23}};return c(g,"getBaseAnimal",function(a){return l[a]||a}),c(g,"getBirthingAnimal",function(a){return i(a)}),c(g,"getWeanedAnimal",function(a){return j(a)}),c(g,"getAnimalGrowthStages",function(a){var b=l[a]||a;return b&&o[b]||[]}),c(g,"getConversionRate",function(a,b){var c=l[a]||a;return c&&p[c]&&(p[c][b]||p[c][n[c]])}),c(g,"getConversionRates",function(a){var b=l[a]||a;return b&&p[b]||{}}),c(g,"getRepresentativeAnimal",function(a){var b=l[a]||a;return b&&n[b]}),g.validates({assetKey:{required:!0},data:{required:!0,object:!0},legalEntityId:{required:!0,numeric:!0},type:{required:!0,equal:{to:"livestock"}}}),g}],a.add("livestock","Livestock")}]);var sdkModelStock=angular.module("ag.sdk.model.stock",["ag.sdk.model.asset"]);sdkModelStock.provider("Stock",["AssetFactoryProvider",function(a){this.$get=["AssetBase","Base","computedProperty","inheritModel","moment","naturalSort","privateProperty","readOnlyProperty","safeMath","underscore",function(a,b,c,d,e,f,g,h,i,j){function k(){function d(a,b,c){a.isLedgerEntryValid(b)&&(c=j.defaults(c||{},{checkEntries:!0,recalculate:!0}),a.data.ledger=j.chain(a.data.ledger).union([j.extend(b,{date:e(b.date).format("YYYY-MM-DD")})]).sortBy(function(b){return e(b.date).valueOf()+k(a,b.action)}).value(),a.$dirty=!0,c.recalculate&&w(a,c))}function f(a,b,c,d){j.isEqual(c,j.pick(b,j.keys(c)))||(j.extend(b,c),a.$dirty=!0,d=j.defaults(d||{},{checkEntries:!1,recalculate:!0}),d.recalculate&&w(a,d))}function k(a,b){var c=l(b);return j.chain(a.actions).keys().filter(function(b){return j.contains(a.actions[b],c)}).first().value()}function r(a,b){a.opening=b.closing,a.balance=j.mapObject(a.opening,function(b,c){return i.chain(b).plus(j.reduce(a.incoming,function(a,b){return i.plus(a,b[c])},0)).minus(j.reduce(a.outgoing,function(a,b){return i.plus(a,b[c])},0)).toNumber()}),a.closing=a.balance}function t(a,b,c){var d=e(b,"YYYY-MM-DD").date(1),f=e(c,"YYYY-MM-DD").date(1),g=f.diff(d,"months"),h=a.startMonth?a.startMonth.diff(d,"months"):g,i=a.endMonth?f.diff(a.endMonth,"months"):0,k=Math.abs(Math.min(0,h)),l=p(a);
return j.isEmpty(x)&&!j.isEmpty(a.data.ledger)&&w(a),j.reduce(o(Math.max(0,h)).concat(x).concat(o(Math.max(0,i))),function(a,b){var c=a.length>0?a[a.length-1]:l;return r(b,c),a.push(b),a},[]).slice(k,k+g)}function u(a,b){var c=a.startMonth,d=a.endMonth,f=d?d.diff(c,"months"):-1,g=p(a),h=["incoming","movement","outgoing"];return b=j.defaults(b||{},{checkEntries:!1}),j.range(f+1).reduce(function(d,f){var k=e(c).add(f,"M"),o=k.year(),p=k.month(),q=d.length>0?d[d.length-1]:g,s=j.reduce(a.data.ledger,function(c,d){var f=e(d.date),g=l(d.action);return d.deleted||p!==f.month()||o!==f.year()||j.each(h,function(e){j.contains(a.actions[e],g)&&(b.checkEntries&&v(a,d),c.entries.push(d),c[e][g]=j.isUndefined(c[e][g])?m(d.quantity,d.value):j.mapObject(c[e][g],function(a,b){return i.plus(a,d[b])}))}),c},n());return r(s,q),d.push(s),d},[])}function v(a,b){!j.isUndefined(b.price)||j.isUndefined(b.quantity)||j.isUndefined(a.data.pricePerUnit)||(b.price=a.data.pricePerUnit,b.value=i.times(b.rate||1,i.times(b.price,b.quantity)))}function w(a,b){x=u(a,b)}a.apply(this,arguments),c(this,"startMonth",function(){return j.isEmpty(this.data.ledger)?void 0:e(j.chain(this.data.ledger).pluck("date").first().value(),"YYYY-MM-DD").date(1)}),c(this,"endMonth",function(){return j.isEmpty(this.data.ledger)?void 0:e(j.chain(this.data.ledger).pluck("date").last().value(),"YYYY-MM-DD").date(1)}),h(this,"actions",{incoming:["Production","Purchase"],movement:["Deliver"],outgoing:["Consumption","Internal","Household","Labour","Repay","Sale"]},{configurable:!0}),h(this,"actionTitles",{Consumption:"Consume",Household:"Household Consumption",Internal:"Internal Consumption",Labour:"Labour Consumption",Deliver:"Deliver",Production:"Produce",Purchase:"Buy Stock",Repay:"Repay Credit",Sale:"Sell Stock"},{configurable:!0}),g(this,"getActionTitle",function(a){return this.actionTitles[a]},{configurable:!0}),g(this,"addLedgerEntry",function(a,b){return d(this,a,b)}),g(this,"setLedgerEntry",function(a,b,c){return f(this,a,b,c)}),g(this,"getActionGroup",function(a){return k(this,a)}),g(this,"findLedgerEntry",function(a){if(j.isObject(a)){var b=j.findWhere(this.data.ledger,a);return b||j.findWhere(this.data.ledger,{reference:j.compact([a.reference,a.action,a.date]).join("/")})}return j.findWhere(this.data.ledger,{reference:a})}),g(this,"hasLedgerEntries",function(){return this.data.ledger.length>0}),g(this,"hasQuantityBefore",function(a){var b=e(a,"YYYY-MM-DD");return!j.isUndefined(j.chain(this.data.ledger).filter(function(a){return e(a.date).isSameOrBefore(b)}).pluck("quantity").last().value())}),g(this,"removeLedgerEntry",function(a,b){b=j.defaults(b||{},{checkEntries:!1,markDeleted:!1,recalculate:!0}),a&&(b.markDeleted?a.deleted=!0:(this.data.ledger=j.reject(this.data.ledger,function(b){return b.date===a.date&&b.action===a.action&&b.quantity===a.quantity}),this.$dirty=!0),b.recalculate&&w(this,b))}),g(this,"generateLedgerEntryReference",function(a){return"/"+j.compact([a.action,a.date]).join("/")}),g(this,"removeLedgerEntriesByReference",function(a,b){this.data.ledger=j.reject(this.data.ledger,function(b){return s.include(b.reference,a)}),this.$dirty=!0,w(this,b)}),g(this,"inventoryInRange",function(a,b){return t(this,a,b)}),g(this,"inventoryBefore",function(a){var b=e(a,"YYYY-MM-DD");if(this.startMonth&&b.isSameOrAfter(this.startMonth)){var c=b.diff(this.startMonth,"months");return j.isEmpty(x)&&w(this),x[c]||j.last(x)}return p(this)}),g(this,"subtotalInRange",function(a,b,c){var d=e(b,"YYYY-MM-DD"),f=e(c,"YYYY-MM-DD");return a=j.isArray(a)?a:[a],j.chain(this.data.ledger).reject(function(b){var c=e(b.date);return b.deleted||!j.contains(a,b.action)||c.isBefore(d)||c.isSameOrAfter(f)}).reduce(function(a,b){return a.quantity=i.plus(a.quantity,b.quantity),a.value=i.plus(a.value,b.value),a.price=i.dividedBy(a.value,a.quantity),a},{}).value()}),g(this,"marketPriceAtDate",function(a){var b=e(a,"YYYY-MM-DD"),c=["Purchase","Sale"];return j.chain(this.data.ledger).filter(function(a){return!a.deleted&&j.contains(c,a.action)&&e(a.date).isSameOrBefore(b)}).map(function(a){return i.dividedBy(a.value,a.quantity)}).last().value()||this.data.pricePerUnit}),g(this,"isLedgerEntryValid",function(a){return q(this,a)}),g(this,"clearLedger",function(){this.data.ledger=[],w(this)}),g(this,"recalculateLedger",function(a){w(this,a)});var x=[];b.initializeObject(this.data,"ledger",[]),b.initializeObject(this.data,"openingBalance",0),this.type="stock"}function l(a){return s.strLeft(a,":")}function m(a,b){return{quantity:a||0,value:b||0}}function n(a,b){return{opening:m(a,b),incoming:{},movement:{},outgoing:{},entries:[],balance:m(a,b),interest:0,closing:m(a,b)}}function o(a){return j.range(a).map(n)}function p(a){var b=a.data.openingBalance,c=i.times(a.data.openingBalance,a.data.pricePerUnit);return n(b,c)}function q(a,b){var c=l(b.action);return b&&b.date&&e(b.date).isValid()&&j.isNumber(b.value)&&j.contains(j.keys(a.actionTitles),c)}return d(k,a),k.validates({assetKey:{required:!0},data:{required:!0,object:!0},legalEntityId:{required:!0,numeric:!0},type:{required:!0,inclusion:{"in":j.keys(a.assetTypesWithOther)}}}),k}],a.add("stock","Stock")}]),angular.module("ag.sdk.model.base",["ag.sdk.library","ag.sdk.model.validation","ag.sdk.model.errors","ag.sdk.model.store"]).factory("Model",["Base",function(a){var b={};return b.Base=a,b}]).factory("Base",["deepCopy","Errorable","privateProperty","Storable","underscore","Validatable",function(a,b,c,d,e,f){function g(){var c=this;c["new"]=function(a,b){var d=new c(a,b);return"function"==typeof d.storable&&d.storable(a),d},c.newCopy=function(b,d){return c["new"](a(b||{}),d)},c.getModel=function(){return c.constructor},c.asJSON=function(b){var c=a(this);return b?e.omit(c,b):c},c.copy=function(){var a=this,b={},c=Object.getOwnPropertyNames(a);return e.each(c,function(c){Object.defineProperty(b,c,Object.getOwnPropertyDescriptor(a,c))}),b},c.extend=function(a){var b=new a,c=Object.getOwnPropertyNames(b),d=e.filter(c,function(a){return"__"!==a.slice(0,2)});e.each(d,function(a){Object.defineProperty(this,a,Object.getOwnPropertyDescriptor(b,a))},this)},c.include=function(a){var b=new a,c=Object.getOwnPropertyNames(b),d=e.filter(c,function(a){return"__"===a.slice(0,2)}),f=this["new"];this["new"]=function(){var a=f.apply(this,arguments);return e.each(d,function(c){Object.defineProperty(a,c.slice(2),Object.getOwnPropertyDescriptor(b,c))}),a}},c.extend(f),c.extend(d),c.include(f),c.include(b),c.include(d)}return c(g,"initializeArray",function(a,b){return e.range(a).map(function(){return b||0})}),c(g,"initializeObject",function(a,b,c){a[b]=a[b]&&Object.prototype.toString.call(a[b])===Object.prototype.toString.call(c)?a[b]:c}),g}]).factory("computedProperty",["underscore",function(a){return function(b,c,d,e){Object.defineProperty(b,c,a.defaults(e||{},{get:d}))}}]).factory("readOnlyProperty",["underscore",function(a){return function(b,c,d,e){Object.defineProperty(b,c,a.defaults(e||{},{writable:!1,value:d}))}}]).factory("inheritModel",["underscore",function(a){return function(b,c){c.apply(b),a.each(Object.getOwnPropertyNames(c),function(d){var e=Object.getOwnPropertyDescriptor(c,d);a.isUndefined(b[d])&&e&&Object.defineProperty(b,d,e)})}}]).factory("privateProperty",["underscore",function(a){return function(b,c,d,e){var f;Object.defineProperty(b,c,a.defaults(e||{},{enumerable:!1,configurable:!1,get:function(){return f},set:function(a){f=a}})),void 0!==d&&(b[c]=d)}}]).factory("interfaceProperty",["underscore",function(a){return function(b,c,d,e){var f;Object.defineProperty(b,c,a.defaults(e||{},{enumerable:!1,configurable:!0,get:function(){return f},set:function(a){f=a}})),void 0!==d&&(b[c]=d)}}]);var sdkModelBusinessPlanDocument=angular.module("ag.sdk.model.business-plan",["ag.sdk.id","ag.sdk.model.asset","ag.sdk.model.document","ag.sdk.model.liability","ag.sdk.model.production-schedule","ag.sdk.model.stock"]);sdkModelBusinessPlanDocument.provider("BusinessPlan",["DocumentFactoryProvider",function(a){this.$get=["asJson","AssetFactory","Base","computedProperty","Document","EnterpriseBudget","Financial","FinancialGroup","generateUUID","inheritModel","Liability","Livestock","privateProperty","ProductionSchedule","readOnlyProperty","safeArrayMath","safeMath","Stock","underscore",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(){function i(a){X(a),cb(a)}function j(c,d,e){var f=moment(c.startDate,"YYYY-MM-DD"),g=moment(c.endDate,"YYYY-MM-DD"),h=s.map(c.models.productionSchedules,n.newCopy);if(e=s.defaults(e||{},{extractStockAssets:!0}),c.models.productionSchedules=[],s.chain(d).map(function(a){return a instanceof n?a:n.newCopy(a)}).sortBy(function(a){return moment(a.startDate).valueOf()}).each(function(b){b.validate()&&(f.isBetween(b.startDate,b.endDate)||f.isBefore(b.endDate)&&g.isAfter(b.startDate))&&(e.extractStockAssets&&B(c,b),c.models.productionSchedules.push(a(b)),h=s.reject(h,function(a){return a.scheduleKey===b.scheduleKey}))}),h.length>0){var j=["livestock","stock"],k=s.chain(c.models.assets).filter(function(a){return s.contains(j,a.type)}).map(b.newCopy).value();s.each(h,function(a){s.each(k,function(b){b.removeLedgerEntriesByReference(a.scheduleKey),A(c,b)})})}u(c),i(c)}function l(a,b,d,e){a.data[b]=a.data[b]||{},a.data[b][d]=a.data[b][d]||c.initializeArray(e)}function o(a,b){return a?Math.min(a.length,Math.abs(Math.min(0,b))):0}function r(a,b,c){return a?Math.min(c,b+a.length)-b:0}function t(a,b,d,e,g,h){var i=s.findWhere(b.data.sections,{code:d}),j=moment(b.startDate,"YYYY-MM-DD"),k=b.data.details.commodity;if(i){var l=j.diff(e,"months");angular.forEach(i.productCategoryGroups,function(e){var i="enterpriseProduction"+("INC"===d?"Income":"Expenditure");angular.forEach(e.productCategories,function(e){if(!s.contains(f.stockableCategoryCodes,e.code)){var j=h||"livestock"===b.type||"INC"!==d?e.name:b.data.details.commodity,m=o(e.valuePerMonth,l),n=r(e.valuePerMonth,l,g);for(c.initializeObject(a[i],k,{}),a[i][k][j]=a[i][k][j]||c.initializeArray(g);n>m;m++)a[i][k][j][m+l]=q.plus(a[i][k][j][m+l],e.valuePerMonth[m])}})})}}function y(a,b,c,d){return s.find(a.models.assets,function(a){return(s.isUndefined(b)||a.type===b)&&(s.isUndefined(d)||a.data.category===d)&&(s.isUndefined(c)||a.data.type===c)})}function z(a){return function(c,d,e,f,g){var h=b["new"](y(a,c,d,e)||{type:c,legalEntityId:s.chain(a.data.legalEntities).where({isPrimary:!0}).pluck("id").first().value(),data:s.extend({category:e,priceUnit:f,quantityUnit:g},s.isUndefined(d)?{}:{type:d})});return h.generateKey(s.findWhere(a.data.legalEntities,{id:h.legalEntityId})),A(a,h,!0),h}}function A(b,c,d){b.models.assets=s.reject(b.models.assets,function(a){return a.assetKey===c.assetKey}),(d||c.hasLedgerEntries())&&b.models.assets.push(a(c))}function B(a,b){var c=b.extractStock(z(a));s.each(c,function(b){A(a,b,!0)})}function C(a,b){var c=s.mapObject(a,function(a){return s.reduce(a.slice(12*(b-1),12*b),function(a,b){return a.unit=b.unit,a.value=q.plus(a.value,b.value),a.quantity=q.plus(a.quantity,b.quantity),a.pricePerUnit=q.dividedBy(a.value,a.quantity),a},{quantity:0,value:0})});return c.total={value:p.reduce(s.chain(c).values().pluck("value").value())||0},s.each(c,function(a,b){a.percent="total"!==b?q.times(q.dividedBy(100,c.total.value),a.value):100}),c}function D(a){var b=moment(a.startDate,"YYYY-MM-DD"),d=a.numberOfMonths;s.chain(a.models.income).where({type:"production"}).each(function(b){c.initializeObject(a.data.enterpriseProductionIncome,"Indirect",{}),c.initializeObject(a.data.enterpriseProductionIncome.Indirect,b.name,c.initializeArray(d,0)),a.data.enterpriseProductionIncome.Indirect[b.name]=p.plus(a.data.enterpriseProductionIncome.Indirect[b.name],b.months)}),s.chain(a.models.expenses).where({type:"production"}).each(function(b){c.initializeObject(a.data.enterpriseProductionExpenditure,"Indirect",{}),c.initializeObject(a.data.enterpriseProductionExpenditure.Indirect,b.name,c.initializeArray(d,0)),a.data.enterpriseProductionExpenditure.Indirect[b.name]=p.plus(a.data.enterpriseProductionExpenditure.Indirect[b.name],b.months)}),angular.forEach(a.models.productionSchedules,function(c){var e=n["new"](c);t(a.data,e,"INC",b,d,!0),t(a.data,e,"EXP",b,d,!0)})}function E(a,b){a.data.productionIncome=s.extend(a.data.productionIncome,s.reduce(a.data.enterpriseProductionIncome,function(a,d){return s.reduce(d,function(a,d,e){return c.initializeObject(a,e,c.initializeArray(b,0)),a[e]=p.plus(a[e],d),a},a)},{})),a.data.productionExpenditure=s.extend(a.data.productionExpenditure,s.reduce(a.data.enterpriseProductionExpenditure,function(a,d){return s.reduce(d,function(a,d,e){return c.initializeObject(a,e,c.initializeArray(b,0)),a[e]=p.plus(a[e],d),a},a)},{})),a.data.unallocatedProductionIncome=a.data.productionIncome,a.data.unallocatedProductionExpenditure=a.data.productionExpenditure}function F(a,b,c){a.models[b]=s.reject(a.models[b],function(a){return a.uuid===c.uuid}),a.models[b].push(c),i(a)}function G(a,b,c){a.models[b]=s.reject(a.models[b],function(a){return a.uuid===c.uuid}),i(a)}function H(a){var b=moment(a.startDate,"YYYY-MM-DD"),c=moment(a.endDate,"YYYY-MM-DD"),d=c.diff(b,"months"),e=[];s.each(a.models.income,function(b){var c=s.findWhere(a.data.legalEntities,{id:b.legalEntityId}),f=s.findWhere(e,{uuid:b.uuid}),g=(b.type?b.type:"other")+"Income";"production"!==b.type&&c&&s.isUndefined(f)&&a.data[g]&&(l(a,g,b.name,d),a.data[g][b.name]=s.map(b.months,function(c,d){return q.plus(c,a.data[g][b.name][d])}),e.push(b))}),s.each(a.models.expenses,function(b){var c=s.findWhere(a.data.legalEntities,{id:b.legalEntityId}),f=s.findWhere(e,{uuid:b.uuid}),g=(b.type?b.type:"other")+"Expenditure";"production"!==b.type&&c&&s.isUndefined(f)&&a.data[g]&&(l(a,g,b.name,d),a.data[g][b.name]=s.map(b.months,function(c,d){return q.plus(c,a.data[g][b.name][d])}),e.push(b))})}function I(a){a.data.unallocatedEnterpriseProductionExpenditure=angular.copy(a.data.enterpriseProductionExpenditure),a.data.unallocatedProductionExpenditure=angular.copy(a.data.productionExpenditure),s.chain(a.data.models.liabilities).where({type:"production-credit"}).map(k.newCopy).each(function(b){s.each(b.liabilityInRange(a.startDate,a.endDate),function(d,e){s.each(b.data.enterprises,function(f){s.each(b.data.inputs,function(b){c.initializeObject(a.data.unallocatedEnterpriseProductionExpenditure[f],b,c.initializeArray(a.numberOfMonths,0)),c.initializeObject(a.data.unallocatedProductionExpenditure,b,c.initializeArray(a.numberOfMonths,0)),a.data.unallocatedEnterpriseProductionExpenditure[f][b][e]=Math.max(0,q.minus(a.data.unallocatedEnterpriseProductionExpenditure[f][b][e],d.withdrawal)),a.data.unallocatedProductionExpenditure[b][e]=Math.max(0,q.minus(a.data.unallocatedProductionExpenditure[b][e],d.withdrawal))})})})})}function J(b,d,e,f){f.data.assetValue=f.data.assetValue||0;var g=moment(b.startDate,"YYYY-MM-DD"),h=b.numberOfMonths,i=b.numberOfYears,j=s.findWhere(b.data.assetStatement[d],{name:e})||{name:e,estimatedValue:0,marketValue:0,monthly:{depreciation:c.initializeArray(h),marketValue:c.initializeArray(h)},yearly:{depreciation:c.initializeArray(i),marketValue:c.initializeArray(i)},assets:[]};s.findWhere(j.assets,{assetKey:f.assetKey})||j.assets.push(a(f,["liabilities","productionSchedules"])),(!f.data.acquisitionDate||g.isAfter(f.data.acquisitionDate))&&(j.estimatedValue=q.plus(j.estimatedValue,f.data.assetValue)),b.data.assetStatement[d]=s.chain(b.data.assetStatement[d]).reject(function(a){return a.name===j.name}).union([j]).value().sort(function(a,b){return naturalSort(a.name,b.name)})}function K(b,d){var e="production-credit"===d.type?"medium-term":"rent"===d.type?"short-term":d.type,f="production-credit"===d.type?"Production Credit":"rent"===d.type?"Rent overdue":d.category||d.name,g=b.numberOfYears,h=s.findWhere(b.data.liabilityStatement[e],{name:f})||{name:f,currentValue:0,yearlyValues:c.initializeArray(g),liabilities:[]};h.currentValue=q.plus(h.currentValue,d.liabilityInMonth(b.startDate).opening),s.findWhere(h.liabilities,{uuid:d.uuid})||h.liabilities.push(a(d));for(var i=0;g>i;i++){var j=moment.min(moment(b.endDate,"YYYY-MM-DD"),moment(b.startDate,"YYYY-MM-DD").add(i,"years").add(11,"months"));h.yearlyValues[i]=q.plus(h.yearlyValues[i],d.liabilityInMonth(j).closing)}b.data.liabilityStatement[e]=s.chain(b.data.liabilityStatement[e]).reject(function(a){return a.name===h.name}).union([h]).value().sort(function(a,b){return naturalSort(a.name,b.name)})}function L(a){var b=["Bank Capital","Bank Overdraft"],d=q.chain(a.data.account.depreciationRate||0).dividedBy(100).dividedBy(12).toNumber();angular.forEach(a.data.assetStatement,function(e,f){"total"!==f&&angular.forEach(e,function(e){if(!s.contains(b,e.name)){var f=a.data.adjustmentFactors[e.name]||1,g=a.data.assetMarketValue[e.name]||c.initializeArray(a.numberOfMonths),h=a.data.assetStockValue[e.name],i=a.data.capitalExpenditure[e.name]||c.initializeArray(a.numberOfMonths);e.marketValue=q.times(e.estimatedValue,f),e.monthly.marketValue=s.isArray(h)?h:s.map(e.monthly.marketValue,function(a,b){return q.chain(e.marketValue).minus(p.reduce(g.slice(0,b))).plus(p.reduce(i.slice(0,b))).toNumber()}),e.monthly.depreciation=s.map(e.monthly.marketValue,function(a){return"Vehicles, Machinery & Equipment"!==e.name?0:q.times(a,d)}),e.monthly.marketValue=p.minus(e.monthly.marketValue,g),e.yearly.depreciation=[O(e.monthly.depreciation,1),O(e.monthly.depreciation,2)],e.yearly.marketValue=[P(e.monthly.marketValue,1),P(e.monthly.marketValue,2)]}})})}function M(a){var b=a.numberOfMonths,d=a.numberOfYears;a.data.assetStatement.total=s.chain(a.data.assetStatement).omit("total").values().flatten(!0).reduce(function(a,b){return a.estimatedValue=q.plus(a.estimatedValue,b.estimatedValue),a.marketValue=q.plus(a.marketValue,b.marketValue),a.monthly.depreciation=p.plus(a.monthly.depreciation,b.monthly.depreciation),a.monthly.marketValue=p.plus(a.monthly.marketValue,b.monthly.marketValue),a.yearly.depreciation=p.plus(a.yearly.depreciation,b.yearly.depreciation),a.yearly.marketValue=p.plus(a.yearly.marketValue,b.yearly.marketValue),a},{estimatedValue:0,marketValue:0,monthly:{depreciation:c.initializeArray(b),marketValue:c.initializeArray(b)},yearly:{depreciation:c.initializeArray(d),marketValue:c.initializeArray(d)}}).value(),a.data.liabilityStatement.total=s.chain(a.data.liabilityStatement).omit("total").values().flatten(!0).reduce(function(a,b){return a.currentValue=q.plus(a.currentValue,b.currentValue),a.yearlyValues=p.plus(a.yearlyValues,b.yearlyValues),a},{currentValue:0,yearlyValues:c.initializeArray(d)}).value()}function N(a){var d=moment(a.startDate,"YYYY-MM-DD"),e=moment(a.endDate,"YYYY-MM-DD"),g=e.diff(d,"months"),h=[],i=0,j={cropland:1,pasture:1,"permanent crop":1,plantation:1,wasteland:1,farmland:2};s.chain(a.models.assets).sortBy(function(a){return j[a.type]||0}).each(function(j){var m=s.findWhere(a.data.legalEntities,{id:j.legalEntityId}),n=s.findWhere(h,{assetKey:j.assetKey});if(m&&s.isUndefined(n)){h.push(j),j=b["new"](j);var o=j.data.acquisitionDate?moment(j.data.acquisitionDate):void 0,r=j.data.soldDate?moment(j.data.soldDate):void 0,t=j.data.constructionDate?moment(j.data.constructionDate):void 0,u=j.data.demolitionDate?moment(j.data.demolitionDate):void 0;if("vme"===j.type){if(j.data.assetValue&&o&&o.isBetween(d,e)&&(i=o.diff(d,"months"),l(a,"capitalExpenditure","Vehicles, Machinery & Equipment",g),a.data.capitalExpenditure["Vehicles, Machinery & Equipment"][i]=q.plus(a.data.capitalExpenditure["Vehicles, Machinery & Equipment"][i],j.data.assetValue)),j.data.sold&&j.data.salePrice&&r&&r.isBetween(d,e)){i=r.diff(d,"months");var v=q.minus(j.data.assetValue,q.chain(a.data.account.depreciationRate||0).dividedBy(100).dividedBy(12).times(j.data.assetValue).times(o&&o.isBetween(d,e)?r.diff(o,"months"):i+1).toNumber());l(a,"assetMarketValue","Vehicles, Machinery & Equipment",g),l(a,"capitalIncome","Vehicles, Machinery & Equipment",g),l(a,"capitalProfit","Vehicles, Machinery & Equipment",g),l(a,"capitalLoss","Vehicles, Machinery & Equipment",g),a.data.assetMarketValue["Vehicles, Machinery & Equipment"][i]=q.plus(a.data.assetMarketValue["Vehicles, Machinery & Equipment"][i],q.plus(j.data.assetValue,v)),a.data.capitalIncome["Vehicles, Machinery & Equipment"][i]=q.plus(a.data.capitalIncome["Vehicles, Machinery & Equipment"][i],j.data.salePrice),a.data.capitalProfit["Vehicles, Machinery & Equipment"][i]=q.plus(a.data.capitalProfit["Vehicles, Machinery & Equipment"][i],Math.max(0,q.minus(j.data.salePrice,v))),a.data.capitalLoss["Vehicles, Machinery & Equipment"][i]=q.plus(a.data.capitalLoss["Vehicles, Machinery & Equipment"][i],Math.max(0,q.minus(v,j.data.salePrice)))}}else if("improvement"===j.type)j.data.assetValue&&t&&t.isBetween(d,e)&&(i=t.diff(d,"months"),l(a,"capitalExpenditure","Fixed Improvements",g),a.data.capitalExpenditure["Fixed Improvements"][i]=q.plus(a.data.capitalExpenditure["Fixed Improvements"][i],j.data.assetValue));else if("stock"===j.type)s.each(j.inventoryInRange(d,e),function(b,d){l(a,"assetStockValue","Stock On Hand",g),a.data.assetStockValue["Stock On Hand"][d]=q.plus(a.data.assetStockValue["Stock On Hand"][d],b.closing.value),s.each(b.entries,function(b){var e=b.commodity||"Indirect";switch(b.action){case"Household":l(a,"otherExpenditure","Farm Products Consumed",g),a.data.otherExpenditure["Farm Products Consumed"][d]=q.plus(a.data.otherExpenditure["Farm Products Consumed"][d],b.value);break;case"Labour":c.initializeObject(a.data.enterpriseProductionExpenditure,e,{}),a.data.enterpriseProductionExpenditure[e]["Farm Products Consumed"]=a.data.enterpriseProductionExpenditure[e]["Farm Products Consumed"]||c.initializeArray(g),a.data.enterpriseProductionExpenditure[e]["Farm Products Consumed"][d]=q.plus(a.data.enterpriseProductionExpenditure[e]["Farm Products Consumed"][d],b.value);break;case"Purchase":c.initializeObject(a.data.enterpriseProductionExpenditure,e,{}),a.data.enterpriseProductionExpenditure[e][j.data.category]=a.data.enterpriseProductionExpenditure[e][j.data.category]||c.initializeArray(g),a.data.enterpriseProductionExpenditure[e][j.data.category][d]=q.plus(a.data.enterpriseProductionExpenditure[e][j.data.category][d],b.value);break;case"Sale":c.initializeObject(a.data.enterpriseProductionIncome,e,{}),a.data.enterpriseProductionIncome[e]["Crop Sales"]=a.data.enterpriseProductionIncome[e]["Crop Sales"]||c.initializeArray(g),a.data.enterpriseProductionIncome[e]["Crop Sales"][d]=q.plus(a.data.enterpriseProductionIncome[e]["Crop Sales"][d],b.value),a.data.productionIncomeComposition[j.data.category]=a.data.productionIncomeComposition[j.data.category]||s.range(g).map(function(){return{unit:j.data.quantityUnit||j.data.priceUnit,quantity:0,value:0}});var f=a.data.productionIncomeComposition[j.data.category][d];f.value=q.plus(f.value,b.value),f.quantity=q.plus(f.quantity,b.quantity),f.pricePerUnit=q.dividedBy(f.value,f.quantity)}}),0===d&&J(a,"short-term","Stock On Hand",{data:{name:j.data.category,liquidityType:"short-term",assetValue:b.opening.value,reference:"production/crop"}})});else if("livestock"===j.type){var w=j.inventoryInRange(d,e),x=f.getBirthingAnimal(j.data.type);s.each(w,function(b,d){var e=moment(a.startDate,"YYYY-MM-DD").add(d,"M"),f=q.times(b.closing.quantity,j.marketPriceAtDate(e));x===j.data.category?(l(a,"assetStockValue","Marketable Livestock",g),a.data.assetStockValue["Marketable Livestock"][d]=q.plus(a.data.assetStockValue["Marketable Livestock"][d],f)):(l(a,"assetStockValue","Breeding Stock",g),a.data.assetStockValue["Breeding Stock"][d]=q.plus(a.data.assetStockValue["Breeding Stock"][d],f)),s.chain(b).pick(["incoming","outgoing"]).each(function(b){s.each(b,function(b,e){switch(e){case"Household":l(a,"otherExpenditure","Farm Products Consumed",g),a.data.otherExpenditure["Farm Products Consumed"][d]=q.plus(a.data.otherExpenditure["Farm Products Consumed"][d],b.value);break;case"Labour":c.initializeObject(a.data.enterpriseProductionExpenditure,j.data.type,{}),a.data.enterpriseProductionExpenditure[j.data.type]["Farm Products Consumed"]=a.data.enterpriseProductionExpenditure[j.data.type]["Farm Products Consumed"]||c.initializeArray(g),a.data.enterpriseProductionExpenditure[j.data.type]["Farm Products Consumed"][d]=q.plus(a.data.enterpriseProductionExpenditure[j.data.type]["Farm Products Consumed"][d],b.value);break;case"Purchase":l(a,"capitalExpenditure","Livestock",g),a.data.capitalExpenditure.Livestock[d]=q.plus(a.data.capitalExpenditure.Livestock[d],b.value);break;case"Sale":c.initializeObject(a.data.enterpriseProductionIncome,j.data.type,{}),a.data.enterpriseProductionIncome[j.data.type]["Livestock Sales"]=a.data.enterpriseProductionIncome[j.data.type]["Livestock Sales"]||c.initializeArray(g),a.data.enterpriseProductionIncome[j.data.type]["Livestock Sales"][d]=q.plus(a.data.enterpriseProductionIncome[j.data.type]["Livestock Sales"][d],b.value),a.data.productionIncomeComposition[j.data.category]=a.data.productionIncomeComposition[j.data.category]||s.range(g).map(function(){return{unit:j.data.quantityUnit,quantity:0,value:0}});var f=a.data.productionIncomeComposition[j.data.category][d];f.value=q.plus(f.value,b.value),f.quantity=q.plus(f.quantity,b.quantity),f.pricePerUnit=q.dividedBy(f.value,f.quantity)}})}),0===d&&(x===j.data.category?J(a,"short-term","Marketable Livestock",{data:{name:j.data.category,liquidityType:"short-term",assetValue:b.opening.value,reference:"production/livestock"}}):J(a,"medium-term","Breeding Stock",{data:{name:j.data.category,liquidityType:"medium-term",assetValue:b.opening.value,reference:"production/livestock"}}))})}else if("farmland"===j.type)j.data.assetValue&&o&&o.isBetween(d,e)&&(i=o.diff(d,"months"),l(a,"capitalExpenditure","Land",g),a.data.capitalExpenditure.Land[i]=q.plus(a.data.capitalExpenditure.Land[i],j.data.assetValue)),j.data.sold&&j.data.salePrice&&r&&r.isBetween(d,e)&&(i=r.diff(d,"months"),l(a,"assetMarketValue","Land",g),l(a,"capitalIncome","Land",g),l(a,"capitalProfit","Land",g),l(a,"capitalLoss","Land",g),a.data.assetMarketValue.Land[i]=q.plus(a.data.assetMarketValue.Land[i],j.data.assetValue),a.data.capitalIncome.Land[i]=q.plus(a.data.capitalIncome.Land[i],j.data.salePrice),a.data.capitalProfit.Land[i]=q.plus(a.data.capitalProfit.Land[i],Math.max(0,q.minus(j.data.salePrice,j.data.assetValue))),a.data.capitalLoss.Land[i]=q.plus(a.data.capitalLoss.Land[i],Math.max(0,q.minus(j.data.assetValue,j.data.salePrice))));else if("other"===j.type&&(j.data.liquidityCategory=j.data.liquidityCategory||j.data.category,j.data.assetValue&&o&&o.isBetween(d,e)&&(i=o.diff(d,"months"),l(a,"capitalExpenditure",j.data.liquidityCategory,g),a.data.capitalExpenditure[j.data.liquidityCategory][i]=q.plus(a.data.capitalExpenditure[j.data.liquidityCategory][i],j.data.assetValue)),j.data.sold&&j.data.salePrice&&r&&r.isBetween(d,e))){i=r.diff(d,"months");var v="Vehicles, Machinery & Equipment"!==j.data.liquidityCategory?j.data.assetValue:q.minus(j.data.assetValue,q.chain(a.data.account.depreciationRate||0).dividedBy(100).dividedBy(12).times(j.data.assetValue).times(o&&o.isBetween(d,e)?r.diff(o,"months"):i+1).toNumber());l(a,"assetMarketValue",j.data.liquidityCategory,g),l(a,"capitalIncome",j.data.liquidityCategory,g),l(a,"capitalProfit",j.data.liquidityCategory,g),l(a,"capitalLoss",j.data.liquidityCategory,g),a.data.assetMarketValue[j.data.liquidityCategory][i]=q.plus(a.data.assetMarketValue[j.data.liquidityCategory][i],j.data.assetValue),a.data.capitalIncome[j.data.liquidityCategory][i]=q.plus(a.data.capitalIncome[j.data.liquidityCategory][i],j.data.salePrice),a.data.capitalProfit[j.data.liquidityCategory][i]=q.plus(a.data.capitalProfit[j.data.liquidityCategory][i],Math.max(0,q.minus(j.data.salePrice,v))),a.data.capitalLoss[j.data.liquidityCategory][i]=q.plus(a.data.capitalLoss[j.data.liquidityCategory][i],Math.max(0,q.minus(v,j.data.salePrice)))}if(!(j.data.sold&&r&&r.isBefore(d)||j.data.demolished&&u&&u.isBefore(d)))switch(j.type){case"cropland":case"pasture":case"permanent crop":case"plantation":case"wasteland":J(a,"long-term","Land",j);break;case"farmland":a.data.assetStatement["long-term"]=a.data.assetStatement["long-term"]||[];var y=s.findWhere(a.data.assetStatement["long-term"],{name:"Land"})||{},z=s.chain(y.assets||[]).reject(function(a){return a.farmId!==j.farmId||"farmland"===a.type}).reduce(function(a,b){return q.plus(a,b.data.assetValue)},0).value();0===z&&J(a,"long-term","Land",j);break;case"improvement":J(a,"long-term","Fixed Improvements",j);break;case"vme":J(a,"medium-term","Vehicles, Machinery & Equipment",j);break;case"other":J(a,j.data.liquidityType,j.data.liquidityCategory,j)}angular.forEach(j.liabilities,function(b){if(void 0===s.findWhere(h,{uuid:b.uuid})){h.push(b);var c="rent"===b.type?"capitalExpenditure":"debtRedemption",f="other"!==b.type?k.getTypeTitle(b.type):b.name,m=b.liabilityInRange(a.startDate,a.endDate);"farmland"===j.type&&"rent"!==b.type&&moment(b.startDate,"YYYY-MM-DD").isBetween(d,e)&&(i=moment(b.startDate,"YYYY-MM-DD").diff(d,"months"),l(a,"capitalExpenditure","Land",g),a.data.capitalExpenditure.Land[i]=q.plus(a.data.capitalExpenditure.Land[i],b.openingBalance)),l(a,c,f,g),a.data[c][f]=s.map(m,function(b,d){return p.reduce(b.repayment,a.data[c][f][d])}),K(a,b)}})}}),s.each(a.models.liabilities,function(b){if(void 0===s.findWhere(h,{uuid:b.uuid})){h.push(b),b=k["new"](b);var c="rent"===b.type?"capitalExpenditure":"debtRedemption",d="other"!==b.type?k.getTypeTitle(b.type):b.name,e=b.liabilityInRange(a.startDate,a.endDate);l(a,c,d,g),a.data[c][d]=s.map(e,function(b,e){return p.reduce(b.repayment,a.data[c][d][e])}),K(a,b)}})}function O(a,b){return p.reduce(a.slice(12*(b-1),12*b))}function P(a,b){var c=a.slice(12*(b-1),12*b);return c[c.length-1]}function Q(a,b){var d=["Bank Capital","Bank Overdraft"];return s.chain(a.data.assetStatement).pick(b).values().flatten().compact().reduce(function(a,b){return s.contains(d,b.name)||s.isUndefined(b.monthly)?a:p.plus(a,b.monthly.marketValue)},c.initializeArray(a.numberOfMonths)).value()}function R(a,b,d){d=s.isArray(d)?d:[d];var e=a.numberOfMonths,f=a.numberOfYears,g="asset"===b?{estimatedValue:0,marketValue:0,monthly:{marketValue:c.initializeArray(e),depreciation:c.initializeArray(e)},yearly:{marketValue:c.initializeArray(f),depreciation:c.initializeArray(f)}}:{currentValue:0,yearlyValues:c.initializeArray(f)};return s.each(d,function(c){g=s.reduce(a.data[b+"Statement"][c],function(a,c){return"asset"===b?(a.estimatedValue=q.plus(a.estimatedValue,c.estimatedValue),a.marketValue=q.plus(a.marketValue,c.marketValue),a.monthly.depreciation=p.plus(a.monthly.depreciation,c.monthly.depreciation),a.monthly.marketValue=p.plus(a.monthly.marketValue,c.monthly.marketValue),a.yearly.depreciation=p.plus(a.yearly.depreciation,c.yearly.depreciation),a.yearly.marketValue=p.plus(a.yearly.marketValue,c.yearly.marketValue)):(a.currentValue=q.plus(a.currentValue,c.currentValue),a.yearlyValues=p.plus(a.yearlyValues,c.yearlyValues)),a},g)}),g}function S(a,b,d,e,f){var g=s.filter(a.models.liabilities,function(a){return b&&0!==b.length?-1!==b.indexOf(a.type):!0});return 0===g.length?c.initializeArray(a.numberOfMonths):s.chain(g).map(function(a){var b=new k(a).liabilityInRange(e,f);return s.chain(b).pluck(d).map(function(a){return s.isNumber(a)?a:p.reduce(a)}).value()}).unzip().map(p.reduce).value()}function T(a,b){return s.reduce(a,function(a,b){return s.each(b,function(b,c){a[c]+=b}),a},b),b}function U(a,b){return s.reduce(a,function(a,b){return b?T(b,a):a},b)}function V(a,c){var d=moment(a.startDate).add(c-1,"y"),e=moment(a.startDate).add(c,"y");return s.chain(a.models.assets).where({type:"livestock"}).map(b["new"]).reduce(function(a,b){var c=b.inventoryInRange(d,e),f=s.first(c),g=s.last(c),h=q.times(f.opening.quantity,b.marketPriceAtDate(d)),i=q.times(g.opening.quantity,b.marketPriceAtDate(e)),j=b.subtotalInRange("Purchase",d,e);return q.plus(a,q.minus(q.minus(i,h),j.value))},0).value()}function W(a,c){var d=moment(a.startDate).add(c-1,"y"),e=moment(a.startDate).add(c,"y");
return s.chain(a.models.assets).where({type:"livestock"}).map(b["new"]).reduce(function(a,b){return q.plus(a,b.subtotalInRange(["Household","Labour"],d,e).value)},0).value()}function X(a){var b=moment(a.startDate,"YYYY-MM-DD"),c=moment(a.endDate,"YYYY-MM-DD"),d=a.numberOfMonths,e=q.dividedBy(a.data.account.incomeTaxRate,100);a.data.summary={monthly:{},yearly:{}},a.data.capitalIncome={},a.data.capitalExpenditure={},a.data.capitalLoss={},a.data.capitalProfit={},a.data.cashInflow={},a.data.cashOutflow={},a.data.debtRedemption={},a.data.assetMarketValue={},a.data.assetStockValue={},a.data.assetStatement={},a.data.liabilityStatement={},a.data.enterpriseProductionIncome={},a.data.enterpriseProductionExpenditure={},a.data.productionIncome={},a.data.productionExpenditure={},a.data.productionIncomeComposition={},a.data.otherIncome={},a.data.otherExpenditure={},D(a),N(a),H(a),E(a,d),I(a),Y(a),Z(a,b,c,d),ab(a,b,c,d),bb(a),L(a),M(a),$(a,b,c),a.data.summary.yearly.grossProductionValue=p.plus(a.data.summary.yearly.productionIncome,p.plus(a.data.summary.yearly.livestockAdjustment,a.data.summary.yearly.livestockConsumption)),a.data.summary.yearly.grossProfit=p.minus(a.data.summary.yearly.grossProductionValue,a.data.summary.yearly.productionExpenditure),a.data.summary.yearly.ebitda=p.minus(p.plus(a.data.summary.yearly.grossProfit,a.data.summary.yearly.nonFarmIncome),a.data.summary.yearly.nonFarmExpenditure),a.data.summary.yearly.ebit=p.minus(a.data.summary.yearly.ebitda,a.data.summary.yearly.depreciation),a.data.summary.yearly.interestPaid=p.plus(a.data.summary.yearly.totalRent,a.data.summary.yearly.totalInterest),a.data.summary.yearly.ebt=p.minus(a.data.summary.yearly.ebit,a.data.summary.yearly.interestPaid),a.data.summary.yearly.taxPaid=s.map(a.data.summary.yearly.ebt,function(a){return Math.max(0,q.times(a,e))}),a.data.summary.yearly.netProfit=p.minus(a.data.summary.yearly.ebt,a.data.summary.yearly.taxPaid)}function Y(a){a.data.cashInflow={capitalIncome:a.data.capitalIncome,productionIncome:a.data.productionIncome,otherIncome:a.data.otherIncome},a.data.cashOutflow={capitalExpenditure:a.data.capitalExpenditure,productionExpenditure:s.omit(a.data.unallocatedProductionExpenditure,["Farm Products Consumed"]),otherExpenditure:s.omit(a.data.otherExpenditure,["Farm Products Consumed"])}}function Z(a,b,d,e){var f=U([a.data.cashInflow.capitalIncome,a.data.cashInflow.productionIncome,a.data.cashInflow.otherIncome],c.initializeArray(e)),g=U([a.data.cashOutflow.capitalExpenditure,a.data.cashOutflow.productionExpenditure,a.data.cashOutflow.otherExpenditure],c.initializeArray(e)),h=s.reduce(f,function(a,b,c){return a[c]=b-a[c]<0?b:a[c],a},S(a,["production-credit"],"repayment",b,d)),i=p.minus(f,h),j=p.minus(U([a.data.debtRedemption],c.initializeArray(e)),h);s.extend(a.data.summary.monthly,{productionIncome:U([a.data.productionIncome],c.initializeArray(e)),capitalIncome:U([a.data.capitalIncome],c.initializeArray(e)),capitalProfit:U([a.data.capitalProfit],c.initializeArray(e)),otherIncome:U([a.data.otherIncome],c.initializeArray(e)),nonFarmIncome:U([a.data.capitalProfit,a.data.otherIncome],c.initializeArray(e)),totalIncome:U([a.data.capitalIncome,a.data.productionIncome,a.data.otherIncome],c.initializeArray(e)),cashInflowAfterRepayments:i,unallocatedProductionExpenditure:U([a.data.unallocatedProductionExpenditure],c.initializeArray(e)),productionExpenditure:U([a.data.productionExpenditure],c.initializeArray(e)),capitalExpenditure:U([a.data.capitalExpenditure],c.initializeArray(e)),capitalLoss:U([a.data.capitalLoss],c.initializeArray(e)),otherExpenditure:U([a.data.otherExpenditure],c.initializeArray(e)),nonFarmExpenditure:U([a.data.capitalLoss,a.data.otherExpenditure],c.initializeArray(e)),debtRedemption:j,totalExpenditure:p.plus(j,U([a.data.capitalExpenditure,a.data.unallocatedProductionExpenditure,a.data.otherExpenditure],c.initializeArray(e))),cashOutflowAfterRepayments:p.plus(j,g)});var k=[V(a,1),V(a,2)],l=[W(a,1),W(a,2)];s.extend(a.data.summary.yearly,{livestockAdjustment:k,livestockConsumption:l,productionIncome:[O(a.data.summary.monthly.productionIncome,1),O(a.data.summary.monthly.productionIncome,2)],productionIncomeComposition:[C(a.data.productionIncomeComposition,1),C(a.data.productionIncomeComposition,2)],capitalIncome:[O(a.data.summary.monthly.capitalIncome,1),O(a.data.summary.monthly.capitalIncome,2)],capitalProfit:[O(a.data.summary.monthly.capitalProfit,1),O(a.data.summary.monthly.capitalProfit,2)],otherIncome:[O(a.data.summary.monthly.otherIncome,1),O(a.data.summary.monthly.otherIncome,2)],nonFarmIncome:[O(a.data.summary.monthly.nonFarmIncome,1),O(a.data.summary.monthly.nonFarmIncome,2)],totalIncome:[O(a.data.summary.monthly.totalIncome,1),O(a.data.summary.monthly.totalIncome,2)],cashInflowAfterRepayments:[O(a.data.summary.monthly.cashInflowAfterRepayments,1),O(a.data.summary.monthly.cashInflowAfterRepayments,2)],unallocatedProductionExpenditure:[O(a.data.summary.monthly.unallocatedProductionExpenditure,1),O(a.data.summary.monthly.unallocatedProductionExpenditure,2)],productionExpenditure:[O(a.data.summary.monthly.productionExpenditure,1),O(a.data.summary.monthly.productionExpenditure,2)],capitalExpenditure:[O(a.data.summary.monthly.capitalExpenditure,1),O(a.data.summary.monthly.capitalExpenditure,2)],capitalLoss:[O(a.data.summary.monthly.capitalLoss,1),O(a.data.summary.monthly.capitalLoss,2)],otherExpenditure:[O(a.data.summary.monthly.otherExpenditure,1),O(a.data.summary.monthly.otherExpenditure,2)],nonFarmExpenditure:[O(a.data.summary.monthly.nonFarmExpenditure,1),O(a.data.summary.monthly.nonFarmExpenditure,2)],debtRedemption:[O(a.data.summary.monthly.debtRedemption,1),O(a.data.summary.monthly.debtRedemption,2)],totalExpenditure:[O(a.data.summary.monthly.totalExpenditure,1),O(a.data.summary.monthly.totalExpenditure,2)],cashOutflowAfterRepayments:[O(a.data.summary.monthly.cashOutflowAfterRepayments,1),O(a.data.summary.monthly.cashOutflowAfterRepayments,2)]})}function $(a,b,d){var e=a.numberOfMonths,f=a.numberOfYears;s.extend(a.data.summary.monthly,{productionCreditInterest:S(a,["short-term","production-credit"],"interest",b,d),mediumTermInterest:S(a,["medium-term"],"interest",b,d),longTermInterest:S(a,["long-term"],"interest",b,d),totalInterest:p.plus(S(a,["short-term","long-term","medium-term"],"interest",b,d),a.data.summary.monthly.primaryAccountInterest),currentLiabilities:p.plus(S(a,["short-term","production-credit"],"closing",b,d),a.data.summary.monthly.primaryAccountLiability),mediumLiabilities:S(a,["medium-term"],"closing",b,d),longLiabilities:S(a,["long-term"],"closing",b,d),totalLiabilities:p.plus(S(a,[],"closing",b,d),a.data.summary.monthly.primaryAccountLiability),totalRent:S(a,["rent"],"repayment",b,d),currentAssets:p.plus(Q(a,["short-term"]),a.data.summary.monthly.primaryAccountCapital),movableAssets:Q(a,["medium-term"]),fixedAssets:Q(a,["long-term"]),totalAssets:p.plus(Q(a,["short-term","medium-term","long-term"]),a.data.summary.monthly.primaryAccountCapital),depreciation:a.data.assetStatement.total.monthly.depreciation||c.initializeArray(e)}),s.extend(a.data.summary.yearly,{productionCreditInterest:[O(a.data.summary.monthly.productionCreditInterest,1),O(a.data.summary.monthly.productionCreditInterest,2)],mediumTermInterest:[O(a.data.summary.monthly.mediumTermInterest,1),O(a.data.summary.monthly.mediumTermInterest,2)],longTermInterest:[O(a.data.summary.monthly.longTermInterest,1),O(a.data.summary.monthly.longTermInterest,2)],totalInterest:[O(a.data.summary.monthly.totalInterest,1),O(a.data.summary.monthly.totalInterest,2)],currentLiabilities:R(a,"liability","short-term"),mediumLiabilities:R(a,"liability","medium-term"),longLiabilities:R(a,"liability","long-term"),totalLiabilities:[P(a.data.summary.monthly.totalLiabilities,1),P(a.data.summary.monthly.totalLiabilities,2)],totalRent:[O(a.data.summary.monthly.totalRent,1),O(a.data.summary.monthly.totalRent,2)],currentAssets:R(a,"asset","short-term"),movableAssets:R(a,"asset","medium-term"),fixedAssets:R(a,"asset","long-term"),totalAssets:a.data.assetStatement.total.yearly.marketValue||c.initializeArray(f),depreciation:a.data.assetStatement.total.yearly.depreciation||c.initializeArray(f)}),_(a)}function _(a){var b=q.minus(a.data.assetStatement.total.estimatedValue,a.data.liabilityStatement.total.currentValue),c=p.minus(a.data.assetStatement.total.yearly.marketValue,a.data.liabilityStatement.total.yearlyValues);s.extend(a.data.summary.yearly,{netWorth:{current:b,yearly:c},netWorthGrowth:s.map(c,function(a,d){return 0===d?q.minus(a,b):q.minus(a,c[d-1])})})}function ab(a,b,d,e){var f=a.numberOfYears,g={opening:0,inflow:0,outflow:0,balance:0,interestPayable:0,interestReceivable:0,closing:0};a.data.summary.monthly.primaryAccountInterest=c.initializeArray(e),a.data.summary.monthly.primaryAccountCapital=c.initializeArray(e),a.data.summary.monthly.primaryAccountLiability=c.initializeArray(e),a.account.monthly=s.chain(s.range(e)).map(function(){return s.extend({},g)}).reduce(function(b,c,d){return c.opening=0===d?a.account.openingBalance:b[b.length-1].closing,c.inflow=a.data.summary.monthly.cashInflowAfterRepayments[d],c.outflow=a.data.summary.monthly.cashOutflowAfterRepayments[d],c.balance=q.plus(c.opening,q.minus(c.inflow,c.outflow)),c.interestPayable=c.balance<0&&a.account.interestRateDebit?q.times(Math.abs(c.balance),q.chain(a.account.interestRateDebit).dividedBy(100).dividedBy(12).toNumber()):0,c.interestReceivable=c.balance>0&&a.account.interestRateCredit?q.times(c.balance,q.chain(a.account.interestRateCredit).dividedBy(100).dividedBy(12).toNumber()):0,c.closing=q.chain(c.balance).minus(c.interestPayable).plus(c.interestReceivable).toNumber(),a.data.summary.monthly.primaryAccountInterest[d]=q.plus(a.data.summary.monthly.primaryAccountInterest[d],c.interestPayable),a.data.summary.monthly.primaryAccountCapital[d]=q.plus(a.data.summary.monthly.primaryAccountCapital[d],Math.abs(Math.max(0,c.closing))),a.data.summary.monthly.primaryAccountLiability[d]=q.plus(a.data.summary.monthly.primaryAccountLiability[d],Math.abs(Math.min(0,c.closing))),b.push(c),b},[]).value(),a.account.yearly=s.chain(s.range(f)).map(function(){return s.extend({worstBalance:0,bestBalance:0,openingMonth:null,closingMonth:null},g)}).reduce(function(c,d,e){var f=a.account.monthly.slice(12*e,12*(e+1));d.opening=f[0].opening,d.inflow=p.reduceProperty(f,"inflow"),d.outflow=p.reduceProperty(f,"outflow"),d.balance=q.plus(d.opening,q.minus(d.inflow,d.outflow)),d.interestPayable=p.reduceProperty(f,"interestPayable"),d.interestReceivable=p.reduceProperty(f,"interestReceivable"),d.closing=q.chain(d.balance).minus(d.interestPayable).plus(d.interestReceivable).toNumber(),d.openingMonth=moment(b,"YYYY-MM-DD").add(e,"years").format("YYYY-MM-DD"),d.closingMonth=moment(b,"YYYY-MM-DD").add(e,"years").add(f.length-1,"months").format("YYYY-MM-DD");var g=s.max(f,function(a){return a.closing}),h=s.min(f,function(a){return a.closing});return d.bestBalance={balance:g.closing,month:moment(d.openingMonth,"YYYY-MM-DD").add(f.indexOf(g),"months").format("YYYY-MM-DD")},d.worstBalance={balance:h.closing,month:moment(d.openingMonth,"YYYY-MM-DD").add(f.indexOf(h),"months").format("YYYY-MM-DD")},c.push(d),c},[]).value(),a.data.summary.yearly.primaryAccountInterest=[O(a.data.summary.monthly.primaryAccountInterest,1),O(a.data.summary.monthly.primaryAccountInterest,2)],a.data.summary.yearly.primaryAccountCapital=[P(a.data.summary.monthly.primaryAccountCapital,1),P(a.data.summary.monthly.primaryAccountCapital,2)],a.data.summary.yearly.primaryAccountLiability=[P(a.data.summary.monthly.primaryAccountLiability,1),P(a.data.summary.monthly.primaryAccountLiability,2)]}function bb(a){a.data.assetStatement["short-term"]=a.data.assetStatement["short-term"]||[],a.data.assetStatement["short-term"].push({name:"Bank Capital",estimatedValue:Math.max(0,a.account.openingBalance),marketValue:Math.max(0,a.account.openingBalance),monthly:{marketValue:s.map(a.account.monthly,function(a){return Math.max(0,a.closing)}),depreciation:c.initializeArray(a.numberOfMonths)},yearly:{marketValue:s.map(a.account.yearly,function(a){return Math.max(0,a.closing)}),depreciation:c.initializeArray(a.numberOfYears)}}),a.data.liabilityStatement["short-term"]=a.data.liabilityStatement["short-term"]||[],a.data.liabilityStatement["short-term"].push({name:"Bank Overdraft",currentValue:Math.abs(Math.min(0,a.account.openingBalance)),yearlyValues:[a.data.summary.yearly.primaryAccountLiability[0],a.data.summary.yearly.primaryAccountLiability[1]]})}function cb(a){a.data.ratios={interestCover:gb(a,"operatingProfit","totalInterest"),inputOutput:gb(a,"productionIncome",["productionExpenditure","productionCreditInterest","primaryAccountInterest"]),productionCost:gb(a,"productionExpenditure","productionIncome"),cashFlowBank:gb(a,"cashInflowAfterRepayments",["capitalExpenditure","unallocatedProductionExpenditure","debtRedemption","otherExpenditure","primaryAccountInterest"]),cashFlowFarming:gb(a,"totalIncome",["capitalExpenditure","productionExpenditure","debtRedemption","otherExpenditure","primaryAccountInterest"]),debtToTurnover:gb(a,"totalLiabilities",["productionIncome","otherIncome"]),interestToTurnover:gb(a,"totalInterest",["productionIncome","otherIncome"]),returnOnInvestment:gb(a,"operatingProfit","totalAssets")},fb(a),db(a)}function db(a){var b=eb(a,0),c=eb(a,1);a.data.ratios=s.extend(a.data.ratios,{debtMinStage:[b.min,c.min],debtMaxStage:[b.max,c.max]})}function eb(a,b){function c(a){return a.slice(d,e)}var d=12*b,e=12*(b+1),f=p.minus(c(a.data.summary.monthly.totalAssets),c(a.data.summary.monthly.primaryAccountCapital)),g=p.minus(f,c(a.data.summary.monthly.capitalIncome)),h=p.plus(g,c(a.data.summary.monthly.primaryAccountCapital)),i=p.plus(h,c(a.data.summary.monthly.capitalExpenditure)),j=p.plus(i,c(a.data.summary.monthly.totalIncome)),k=p.minus(j,c(a.data.summary.monthly.cashInflowAfterRepayments)),l=c(a.data.summary.monthly.totalLiabilities),m=s.map(k,function(a,b){return q.dividedBy(l[b],a)});return{min:s.min(m),max:s.max(m)}}function fb(a){var b={yearly:[],marketValue:0,estimatedValue:0};a.data.ratios=s.extend(a.data.ratios,{netCapital:b,gearing:b,debt:b}),a.data.ratios.netCapital=s.mapObject(a.data.ratios.netCapital,function(b,c){return s.contains(["marketValue","estimatedValue"],c)?q.dividedBy(a.data.assetStatement.total[c],a.data.liabilityStatement.total.currentValue):"yearly"===c?p.dividedBy(a.data.assetStatement.total.yearly.marketValue,a.data.liabilityStatement.total.yearlyValues):void 0}),a.data.ratios.debt=s.mapObject(a.data.ratios.debt,function(b,c){return s.contains(["marketValue","estimatedValue"],c)?q.dividedBy(a.data.liabilityStatement.total.currentValue,a.data.assetStatement.total[c]):"yearly"===c?p.dividedBy(a.data.liabilityStatement.total.yearlyValues,a.data.assetStatement.total.yearly.marketValue):void 0}),a.data.ratios.gearing=s.mapObject(a.data.ratios.gearing,function(b,c){return s.contains(["marketValue","estimatedValue"],c)?q.dividedBy(a.data.liabilityStatement.total.currentValue,q.minus(a.data.assetStatement.total[c],a.data.liabilityStatement.total.currentValue)):"yearly"===c?p.dividedBy(a.data.liabilityStatement.total.yearlyValues,p.minus(a.data.assetStatement.total.yearly.marketValue,a.data.liabilityStatement.total.yearlyValues)):void 0})}function gb(a,b,c){function d(b,c){if(!a.data.summary[c])return[];var d=s.chain(b).map(function(b){return"-"===b.charAt(0)?(b=b.substr(1),p.negate(a.data.summary[c][b])):a.data.summary[c][b]}).compact().value();return s.reduce(d.slice(1),function(a,b){return p.plus(a,b)},angular.copy(d[0])||[])}return b=s.isArray(b)?b:[b],c=s.isArray(c)?c:[c],{monthly:p.dividedBy(d(b,"monthly"),d(c,"monthly")),yearly:p.dividedBy(d(b,"yearly"),d(c,"yearly"))}}e.apply(this,arguments),this.docType="financial resource plan",this.data.startDate=moment(this.data.startDate).format("YYYY-MM-DD"),this.data.endDate=moment(this.data.startDate).add(2,"y").format("YYYY-MM-DD"),c.initializeObject(this.data,"account",{}),c.initializeObject(this.data,"models",{}),c.initializeObject(this.data,"adjustmentFactors",{}),c.initializeObject(this.data,"assetStatement",{}),c.initializeObject(this.data,"liabilityStatement",{}),c.initializeObject(this.data.assetStatement,"total",{}),c.initializeObject(this.data.liabilityStatement,"total",{}),c.initializeObject(this.data.account,"monthly",[]),c.initializeObject(this.data.account,"yearly",[]),c.initializeObject(this.data.account,"openingBalance",0),c.initializeObject(this.data.account,"interestRateCredit",0),c.initializeObject(this.data.account,"interestRateDebit",0),c.initializeObject(this.data.account,"depreciationRate",0),c.initializeObject(this.data.models,"assets",[]),c.initializeObject(this.data.models,"budgets",[]),c.initializeObject(this.data.models,"expenses",[]),c.initializeObject(this.data.models,"financials",[]),c.initializeObject(this.data.models,"income",[]),c.initializeObject(this.data.models,"liabilities",[]),c.initializeObject(this.data.models,"productionSchedules",[]),m(this,"updateProductionSchedules",function(a,b){j(this,a,b)}),m(this,"addIncome",function(a){F(this,"income",a)}),m(this,"removeIncome",function(a){G(this,"income",a)}),m(this,"addExpense",function(a){F(this,"expenses",a)}),m(this,"removeExpense",function(a){G(this,"expenses",a)}),m(this,"updateFinancials",function(b){this.models.financials=s.filter(b,function(a){return g["new"](a).validate()}),this.data.consolidatedFinancials=s.chain(this.models.financials).groupBy("year").map(function(b){return a(h["new"]({financials:b}),["financials"])}).sortBy("year").last(3).value()}),m(this,"addAsset",function(c){var d=this,e=s.findWhere(d.models.assets,{assetKey:c.assetKey});c=b["new"](c),c.validate()&&(s.isUndefined(e)||(d.models.liabilities=s.reject(d.models.liabilities,function(a){return s.findWhere(e.liabilities,{uuid:a.uuid})})),d.models.assets=s.reject(d.models.assets,function(a){return a.assetKey===c.assetKey}),c.liabilities=s.chain(c.liabilities).map(function(b){return b.validate()&&(d.models.liabilities=s.reject(d.models.liabilities,function(a){return a.uuid===b.uuid}),b.$delete===!1&&d.models.liabilities.push(a(b))),a(b)}).value(),d.models.assets.push(a(c)),i(d))}),m(this,"removeAsset",function(a){var b=this;b.models.assets=s.reject(b.models.assets,function(b){return b.assetKey===a.assetKey}),s.each(a.liabilities,function(a){b.models.liabilities=s.reject(b.models.liabilities,function(b){return b.uuid===a.uuid})}),i(b)}),m(this,"addLiability",function(b){b=k["new"](b),b.validate()&&(this.models.liabilities=s.reject(this.models.liabilities,function(a){return a.uuid===b.uuid}),this.models.liabilities.push(a(b)),i(this))}),m(this,"removeLiability",function(a){this.models.liabilities=s.reject(this.models.liabilities,function(b){return b.uuid===a.uuid}),i(this)}),m(this,"reEvaluateProductionCredit",function(a){return I(this,a)}),d(this,"startDate",function(){return this.data.startDate}),d(this,"endDate",function(){return this.data.endDate=this.data.startDate?moment(this.data.startDate).add(2,"y").format("YYYY-MM-DD"):this.data.endDate,this.data.endDate}),d(this,"account",function(){return this.data.account}),d(this,"adjustmentFactors",function(){return this.data.adjustmentFactors}),d(this,"numberOfMonths",function(){return moment(this.endDate,"YYYY-MM-DD").diff(moment(this.startDate,"YYYY-MM-DD"),"months")}),d(this,"numberOfYears",function(){return Math.ceil(moment(this.endDate,"YYYY-MM-DD").diff(moment(this.startDate,"YYYY-MM-DD"),"years",!0))}),d(this,"models",function(){return this.data.models}),m(this,"reEvaluate",function(){i(this)}),m(this,"recalculateAccount",function(){ab(this)}),s.isEmpty(this.data.models.budgets)&&!s.isEmpty(this.data.models.productionSchedules)&&u(this),this.data.version<=16&&(v(this),w(this)),this.data.version<=16&&this.updateProductionSchedules(this.data.models.productionSchedules),this.data.version<=15&&this.updateFinancials(this.data.models.financials),this.data.version=x}function u(a){a.data.models.budgets=s.chain(a.data.models.productionSchedules).pluck("budget").compact().uniq(!1,function(a){return a.uuid}).value()}function v(c){var d=s.chain(c.data.models.productionSchedules).map(n.newCopy).uniq(function(a){return a.scheduleKey}).value();c.data.models.assets=s.map(c.data.models.assets,function(e){var f=s.findWhere(c.data.legalEntities,{id:e.legalEntityId}),g=e.productionSchedules;return e=b["new"](e),e.generateKey(f),s.each(g,function(a){var b=n.newCopy(a),c=s.findWhere(d,{scheduleKey:b.scheduleKey})||b;s.isUndefined(c)&&(d.push(b),c=b),c.addAsset(e)}),a(e)}),c.data.models.productionSchedules=a(d)}function w(c){var d=["livestock","stock"];c.data.models.assets=s.map(c.data.models.assets,function(e){return s.contains(d,e.type)&&e.data&&e.data.ledger?(e=b.newCopy(e),s.each(c.data.models.budgets,function(a){e.removeLedgerEntriesByReference(a.uuid)}),a(e)):e})}var x=17;return j(t,e),o(t,"incomeExpenseTypes",{capital:"Capital",production:"Production",other:"Other"}),o(t,"incomeSubtypes",{other:["Interest, Dividends & Subsidies","Pension Fund","Short-term Insurance Claims","VAT Refund","Inheritance","Shares","Other"]}),o(t,"expenseSubtypes",{production:["Accident Insurance","Administration","Accounting Fees","Bank Charges","Crop Insurance","Fuel","Electricity","Government Levy","Licenses & Membership Fees","Long term insurance & Policies","Office Costs","Property Rates","Protective Clothing","Rations","Repairs & Maintenance","Staff Salaries & Wages","Security","Short-term Insurance","Unemployment Insurance","Other"],other:["Drawings","Medical","Life insurance","University / School fees","Other"]}),t.validates(s.defaults({docType:{required:!0,equal:{to:"financial resource plan"}},startDate:{required:!0,format:{date:!0}}},e.validations)),t}],a.add("financial resource plan","BusinessPlan")}]);var sdkModelComparableFarmValuationDocument=angular.module("ag.sdk.model.comparable-farm-valuation",["ag.sdk.model.farm-valuation"]);sdkModelComparableFarmValuationDocument.provider("ComparableFarmValuation",["DocumentFactoryProvider",function(a){this.$get=["FarmValuation","inheritModel","underscore",function(a,b,c){function d(){a.apply(this,arguments),this.docType="comparable farm valuation"}return b(d,a),d.validates(c.defaults({docType:{required:!0,equal:{to:"comparable farm valuation"}}},a.validations)),d}],a.add("comparable farm valuation","ComparableFarmValuation")}]);var sdkModelCropInspectionDocument=angular.module("ag.sdk.model.crop-inspection",["ag.sdk.model.document"]);sdkModelCropInspectionDocument.provider("CropInspection",["DocumentFactoryProvider",function(a){this.$get=["Base","computedProperty","Document","inheritModel","readOnlyProperty","underscore",function(a,b,c,d,e,f){function g(b){c.apply(this,arguments),a.initializeObject(this.data,"request",{}),a.initializeObject(this.data,"report",{}),a.initializeObject(this.data.request,"assets",[]),f.isUndefined(b)||0===arguments.length||(this.docType=f.contains(g.docTypes,b.docType)?b.docType:f.first(g.docTypes))}return d(g,c),e(g,"approvalTypes",["Approved","Not Approved","Not Planted"]),e(g,"commentTypes",["Crop amendment","Crop re-plant","Insurance coverage discontinued","Multi-insured","Without prejudice","Wrongfully reported"]),e(g,"docTypes",["emergence inspection","hail inspection","harvest inspection","preharvest inspection","progress inspection"]),e(g,"moistureStatuses",["Dry","Moist","Wet"]),g.validates(f.defaults({docType:{required:!0,inclusion:{"in":g.docTypes}}},c.validations)),g}],a.add("emergence inspection","CropInspection"),a.add("hail inspection","CropInspection"),a.add("harvest inspection","CropInspection"),a.add("preharvest inspection","CropInspection"),a.add("progress inspection","CropInspection")}]);var sdkModelDesktopValuationDocument=angular.module("ag.sdk.model.desktop-valuation",["ag.sdk.model.comparable-sale","ag.sdk.model.document"]);sdkModelDesktopValuationDocument.provider("DesktopValuation",["DocumentFactoryProvider",function(a){this.$get=["Base","ComparableSale","computedProperty","Document","inheritModel","privateProperty","underscore",function(a,b,c,d,e,f,g){function h(){d.apply(this,arguments),this.docType="desktop valuation";var c='<div class="tinymce-container pdf-container"><h2 id="property-description">Property Description</h2><br/><table id="property-description-table" width="100%"></table><br/><h2 id="farmland-value">Estimated Farmland Value</h2><br/><div id="farmland-value-table"></div><br/><h2 id="regional-value">Regional Value Development</h2><br/><div id="regional-value-graph"></div><br/><h2 id="comparable-sales">Comparable Sales</h2><table id="comparable-sales-table" width="100%"></table><br/><h2 id="disclaimer">Disclaimer</h2><p>Estimates of farmland and property value is based on the aggregation of regional sales data and assumptions regarding the property being valued.</p><br/><br/></div>';a.initializeObject(this.data,"hashes",{}),a.initializeObject(this.data,"report",{}),a.initializeObject(this.data,"request",{}),a.initializeObject(this.data.request,"farmland",[]),a.initializeObject(this.data.report,"body",c),a.initializeObject(this.data.report,"comparables",[]),a.initializeObject(this.data.report,"improvements",[]),a.initializeObject(this.data.report,"improvementsValue",{}),a.initializeObject(this.data.report,"landUseComponents",{}),a.initializeObject(this.data.report,"landUseValue",{}),a.initializeObject(this.data.report,"summary",{}),g.isUndefined(this.data.report.comparableSales)||(this.data.report.comparables=this.data.report.comparableSales,delete this.data.report.comparableSales),f(this,"setLegalEntity",function(a){this.data.request.legalEntity=g.omit(a,["assets","farms","liabilities"])}),f(this,"getFarmland",function(){return this.data.request.farmland}),f(this,"hasFarmland",function(a){return g.some(this.data.request.farmland,function(b){return b.assetKey===a.assetKey})}),f(this,"addFarmland",function(a){this.removeFarmland(a),this.data.request.farmland.push(a)}),f(this,"removeFarmland",function(a){this.data.request.farmland=g.reject(this.data.request.farmland,function(b){return b.assetKey===a.assetKey})}),f(this,"getFarmlandSummary",function(){return g.chain(this.data.request.farmland).groupBy(function(a){return a.data.farmLabel?a.data.farmLabel:a.data.officialFarmName?g.titleize(a.data.officialFarmName):"Unknown"}).mapObject(function(a){return{portionList:g.size(a)>1?g.chain(a).map(function(a){return a.data.portionNumber?a.data.portionNumber:a.data.portionLabel}).sort().toSentence().value():g.first(a).data.portionLabel,town:g.chain(a).map(function(a){return a.data.town?g.titleize(a.data.town):""}).first().value(),province:g.chain(a).map(function(a){return a.data.province?g.titleize(a.data.province):""}).first().value(),area:g.reduce(a,function(a,b){return a+(b.data.area||0)},0)}}).value()}),f(this,"addComparableSale",function(a){var c=this;a=b["new"](a),c.removeComparableSale(a),c.data.report.comparables.push(a.asJSON()),g.each(a.attachments,function(a){c.addAttachment(a)})}),f(this,"removeComparableSale",function(a){var b=this;b.data.report.comparables=g.reject(b.data.report.comparables,g.identity({uuid:a.uuid})),g.each(a.attachments,function(a){b.removeAttachment(a)})})}return e(h,d),h.validates(g.defaults({docType:{required:!0,equal:{to:"desktop valuation"}}},d.validations)),h}],a.add("desktop valuation","DesktopValuation")}]);var sdkModelDocument=angular.module("ag.sdk.model.document",["ag.sdk.library","ag.sdk.model.base"]);sdkModelDocument.provider("Document",["listServiceMapProvider",function(a){this.$get=["asJson","Base","computedProperty","inheritModel","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e,f,g){function h(d){b.apply(this,arguments),this.data=d&&d.data||{},b.initializeObject(this.data,"attachments",[]),e(this,"updateRegister",function(b){var c=a(b);this.organization=b,this.organizationId=b.id,this.data=g.extend(this.data,{organization:g.omit(c,["activeFlags","farms","legalEntities","primaryContact","teams"]),farmer:g.omit(c,["activeFlags","farms","legalEntities","primaryContact","teams"]),farms:c.farms,legalEntities:g.map(c.legalEntities,function(a){return g.omit(a,["assets","farms"])}),assets:g.chain(c.legalEntities).pluck("assets").flatten().compact().groupBy("type").value(),liabilities:g.chain(c.legalEntities).pluck("liabilities").flatten().compact().value(),pointsOfInterest:g.map(c.pointsOfInterest,function(a){return g.omit(a,["organization"])}),productionSchedules:g.map(c.productionSchedules,function(a){return g.omit(a,["organization"])})})}),c(this,"attachments",function(){return this.data.attachments}),e(this,"addAttachment",function(a){this.removeAttachment(a),this.data.attachments.push(a)}),e(this,"removeAttachment",function(a){this.data.attachments=g.reject(this.data.attachments,function(b){return b.key===a.key})}),e(this,"removeNewAttachments",function(){var a=this.data.attachments;return this.data.attachments=g.reject(a,function(a){return g.isObject(a.archive)}),g.difference(a,this.data.attachments)}),g.isUndefined(d)||0===arguments.length||(this.author=d.author,this.docType=d.docType,this.documentId=d.documentId,this.id=d.id||d.$id,this.organizationId=d.organizationId,this.originUuid=d.originUuid,this.origin=d.origin,this.title=g.prune(d.title,255,""),this.organization=d.organization,this.tasks=d.tasks)}return d(h,b),h.validates({author:{required:!0,length:{min:1,max:255}},docType:{required:!0,length:{min:1,max:255}},organizationId:{required:!0,numeric:!0}}),h}],a.add("document",["documentRegistry","moment",function(a,b){return function(c){var d=a.getProperty(c.docType,"title"),e=c.title?c.title:c.organization&&c.organization.name?c.organization.name:"Created "+b(c.createdAt).format("YYYY-MM-DD");return{id:c.id||c.$id,title:c.documentId?c.documentId:"",subtitle:e,docType:c.docType,group:d?d:c.docType}}}])}]),sdkModelDocument.provider("DocumentFactory",function(){var a={};this.add=function(b,c){a[b]=c},this.$get=["$injector","Document",function(b,c){function d(d,e){return a[d.docType]?("string"==typeof a[d.docType]&&(a[d.docType]=b.get(a[d.docType])),a[d.docType][e](d)):c[e](d)}return{isInstanceOf:function(b){return b?a[b.docType]?b instanceof a[b.docType]:b instanceof c:!1},"new":function(a){return d(a,"new")},newCopy:function(a){return d(a,"newCopy")}}}]});var sdkModelFarmValuationDocument=angular.module("ag.sdk.model.farm-valuation",["ag.sdk.model.asset","ag.sdk.model.document"]);sdkModelFarmValuationDocument.provider("FarmValuation",["DocumentFactoryProvider",function(a){this.$get=["$filter","Asset","Base","Document","Field","inheritModel","privateProperty","safeMath","underscore",function(a,b,c,d,e,f,g,h,i){function j(){d.apply(this,arguments),g(this,"asComparable",function(){var a=this;return{attachmentIds:i.chain(a.data.attachments).filter(function(a){return"cover photo"===a.type||s.include(a.mimeType,"image")}).sortBy(function(a,b){return"cover photo"===a.type?-1:b}).first(1).map(function(a){return a.key}).value(),authorData:i.chain(a.data.report.completedBy||{}).pick(["email","mobile","name","position","telephone"]).extend({company:a.data.request.merchant.name}).value(),documentId:a.id,depreciatedImprovements:a.data.report.improvementsValue.depreciatedValue,improvedRatePerHa:h.dividedBy(a.data.report.totalRoundedValue,a.data.report.summary.totalArea),improvements:i.chain(a.data.report.improvements).map(function(a){return a.data.landUse=a.data.landUse||b.getImprovementLandClass(a),{area:a.data.size,constructionDate:a.data.constructionDate,totalValue:a.data.assetValue,type:a.data.landUse,subType:k(a,{field:a.data}),unit:"sm",unitValue:h.dividedBy(a.data.assetValue,a.data.size)}}).value(),knowledgeOfProperty:a.data.report.knowledgeOfProperty,landUse:i.chain(a.data.report.landUseComponents).values().flatten().map(function(b){return i.map(b.assets,function(c){var d=l(a,c);return{area:c.data.size,totalValue:h.times(b.valuePerHa,c.data.size),type:d?d.landUse:e.isLandUse(c.data.landUse)?c.data.landUse:b.name,subType:k(c,{asOfDate:a.data.report.completionDate,field:d||c.data}),unit:"ha",unitValue:b.valuePerHa}
})}).flatten().sortBy("subType").value(),purchasePrice:a.data.report.totalRoundedValue,vacantLandValue:h.dividedBy(a.data.report.landUseValue.land,a.data.report.summary.totalArea),valuationDate:a.data.report.completionDate,valueMinusImprovements:h.minus(a.data.report.totalRoundedValue,a.data.report.improvementsValue.depreciatedValue)}}),c.initializeObject(this.data,"request",{}),c.initializeObject(this.data.request,"farmland",[]),c.initializeObject(this.data,"report",{}),c.initializeObject(this.data.report,"description",{}),c.initializeObject(this.data.report,"improvements",[]),c.initializeObject(this.data.report,"improvementsValue",{}),c.initializeObject(this.data.report,"landUseComponents",{}),c.initializeObject(this.data.report,"landUseValue",{}),c.initializeObject(this.data.report,"location",{}),c.initializeObject(this.data.report,"research",[]),c.initializeObject(this.data.report,"services",{}),c.initializeObject(this.data.report,"summary",{}),c.initializeObject(this.data.report,"template","default"),this.docType="farm valuation"}function k(a,c){var d=[b.getCustomTitle(a,"improvement"===a.type?["type","category"]:["crop","age","croppingPotential","irrigation","terrain","waterSource"],c)];return m(b.getCustomTitle(a,[["landUse","improvement"===a.type?"name":"typeTitle"]],c),d)}function l(a,b){return i.chain(a.data.farms).where({id:b.farmId}).pluck("data").pluck("fields").flatten().where({fieldName:b.data.fieldName}).map(e.newCopy).first().value()}f(j,d);var m=a("parenthesizeProps");return j.validates(i.defaults({docType:{required:!0,equal:{to:"farm valuation"}}},d.validations)),j}],a.add("farm valuation","FarmValuation")}]);var sdkModelEnterpriseBudget=angular.module("ag.sdk.model.enterprise-budget",["ag.sdk.library","ag.sdk.utilities","ag.sdk.model.base"]);sdkModelEnterpriseBudget.factory("EnterpriseBudgetBase",["Base","computedProperty","inheritModel","interfaceProperty","Locale","naturalSort","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e,f,g,h,i){function j(c){e.apply(this,arguments),this.data=c&&c.data||{},a.initializeObject(this.data,"sections",[]),b(this,"defaultCostStage",function(){return i.last(j.costStages)}),g(this,"cache",{}),g(this,"getCache",function(a){return this.cache["string"==typeof a?a:a.join("/")]}),g(this,"setCache",function(a,b){var c="string"==typeof a?a:a.join("/");return this.cache[c]=b,this.cache[c]}),g(this,"resetCache",function(a){delete this.cache["string"==typeof a?a:a.join("/")]}),g(this,"clearCache",function(){i.each(i.keys(this.cache),function(a){delete this.cache[a]},this)}),g(this,"stock",[]),d(this,"addStock",function(a){m(this,a)}),g(this,"findStock",function(a,b,c){return n(this,a,b,c)}),d(this,"replaceAllStock",function(a){o(this,a)}),d(this,"removeStock",function(a){p(this,a)}),g(this,"getSections",function(a,b){var c=i.where(this.data.sections,{code:a,costStage:b||this.defaultCostStage});return c.length>0?c:i.filter(this.data.sections,function(b){return(i.isUndefined(a)||b.code===a)&&i.isUndefined(b.costStage)})}),g(this,"sortSections",function(){this.data.sections=i.chain(this.data.sections).each(function(a){i.each(a.productCategoryGroups,function(a){a.productCategories.sort(function(a,b){return f(a.name,b.name)})}),a.productCategoryGroups.sort(function(a,b){return f(a.name,b.name)})}).sortBy(function(a){return a.name+(a.costStage?"-"+a.costStage:"")}).reverse().value()}),g(this,"hasSection",function(a,b){return!i.isEmpty(this.getSections(a,b))}),g(this,"getSection",function(a,b){return i.first(this.getSections(a,b))}),g(this,"getSectionTitle",function(a){return j.sections[a]?j.sections[a].name:""}),g(this,"addSection",function(a,b){var c=this.getSection(a,b);return i.isUndefined(c)&&(c=i.extend({productCategoryGroups:[],total:{value:0}},j.sections[a]),"livestock"===this.assetType&&(c.total.valuePerLSU=0),b&&(c.costStage=b),this.data.sections.push(c),this.data.sections.sort(function(a,b){return f(a.name+(a.costStage?"-"+a.costStage:""),b.name+(b.costStage?"-"+b.costStage:""))}),this.data.sections.reverse(),this.setCache([a,b],c)),c}),g(this,"getGroup",function(a,b,c){var d=[b,c].join("/");return this.getCache(d)||this.setCache(d,i.chain(this.getSections(a,c)).pluck("productCategoryGroups").flatten().findWhere({name:b}).value())}),g(this,"findGroupNameByCategory",function(a,b,c){var d=c.split("-");return b?b:i.chain(j.groups).map(function(a){return s.include(a.code,d[0]+"-"+d[1])||s.include(a.code,d[1])?a.name:void 0}).compact().first().value()}),g(this,"addGroup",function(a,b,c){var d=this.getGroup(a,b,c);if(i.isUndefined(d)){var e=this.addSection(a,c);d=i.extend({productCategories:[],total:{value:0}},j.groups[b]),"livestock"===this.assetType&&(d.total.valuePerLSU=0),e.productCategoryGroups.push(d),e.productCategoryGroups.sort(function(a,b){return f(a.name,b.name)}),this.setCache([b,c],d)}return d}),g(this,"removeGroup",function(a,b,c){var d=this.getSection(a,c);d&&(d.productCategoryGroups=i.reject(d.productCategoryGroups,function(a){return a.name===b}),this.resetCache([b,c])),this.recalculate()}),g(this,"categoryAllowed",function(a,b){return i.chain(q(a,this.assetType,this.baseAnimal)).values().flatten().findWhere(b).isObject().value()}),g(this,"groupAndCategoryAllowed",function(a,b,c){var d=q(a,this.assetType,this.baseAnimal);return d[b]&&i.findWhere(d[b],{code:c})}),d(this,"getCategory",function(a,b,c){var d=[b,c].join("/");return this.getCache(d)||this.setCache(d,i.chain(this.getSections(a,c)).pluck("productCategoryGroups").flatten().pluck("productCategories").flatten().findWhere({code:b}).value())}),d(this,"getCategoryOptions",function(a){return q(a,this.assetType,this.baseAnimal)}),d(this,"getGroupCategoryOptions",function(a,b){return r(a,this.assetType,this.baseAnimal,b)}),g(this,"getAvailableGroupCategories",function(a,b,c){var d=this.getGroup(a,b,c);return u(this,a,d?d.productCategories:[],b)}),g(this,"getAvailableCategories",function(a,b){var c=i.chain(this.getSections(a,b)).pluck("productCategoryGroups").flatten().pluck("productCategories").flatten().value();return u(this,a,c)}),d(this,"addCategory",function(a,b,c,d){var e=this.getCategory(a,c,d);if(i.isUndefined(e)&&!i.isUndefined(c)){var g=this.addGroup(a,this.findGroupNameByCategory(a,b,c),d);if(e=i.extend({quantity:0,value:0},j.categories[c]),"EXP"===a&&(e.unit="Total"),e.per="livestock"===this.assetType?"LSU":"ha","livestock"===this.assetType){var h=this.getConversionRate(e.name);h&&(e.conversionRate=h),e.valuePerLSU=0}g.productCategories.push(e),g.productCategories.sort(function(a,b){return f(a.name,b.name)}),this.setCache([c,d],e)}return e}),d(this,"adjustCategory",function(){}),g(this,"setCategory",function(a,b,c,d){var e=this.addGroup(a,this.findGroupNameByCategory(a,b,c.code),d);return e&&(e.productCategories=i.chain(e.productCategories).reject(function(a){return a.code===c.code}).union([c]).value(),this.setCache([categoryCode,d],c)),c}),d(this,"removeCategory",function(a,b,c,d){b=this.findGroupNameByCategory(a,b,c);var e=this.getGroup(a,b,d);e&&(e.productCategories=i.reject(e.productCategories,function(a){return a.code===c}),0===e.productCategories.length&&this.removeGroup(a,b,d),this.resetCache([c,d])),this.recalculate()}),g(this,"getStockAssets",function(){return"livestock"!==this.assetType||i.isUndefined(y[this.baseAnimal])?[this.commodityType]:i.keys(y[this.baseAnimal])}),d(this,"recalculate",function(){}),b(this,"baseAnimal",function(){return x[this.commodityType]||this.commodityType}),b(this,"birthAnimal",function(){return j.birthAnimals[this.baseAnimal]}),g(this,"getBaseAnimal",function(){return this.baseAnimal}),g(this,"getRepresentativeAnimal",function(){return j.representativeAnimals[this.baseAnimal]}),g(this,"getConversionRate",function(a){return y[this.baseAnimal]&&(y[this.baseAnimal][a]||y[this.baseAnimal][j.representativeAnimals[this.baseAnimal]])}),g(this,"getConversionRates",function(){return y[this.baseAnimal]}),g(this,"getUnitAbbreviation",function(a){return w[a]||a}),i.isUndefined(c)||0===arguments.length||(this.assetType=c.assetType,this.commodityType=c.commodityType,this.sortSections(),k(this))}function k(a){i.each(a.data.sections,function(a){l(a),i.each(a.productCategoryGroups,function(a){l(a),i.each(a.productCategories,function(a){l(a)})})})}function l(a){a&&v[a.code]&&i.extend(a,v[a.code])}function m(a,b){b&&i.isArray(b.data.ledger)&&(a.stock=i.chain(a.stock).reject(function(a){return a.assetKey===b.assetKey}).union([b]).value())}function n(a,b,c,d){return i.find(a.stock,function(a){return a.type===b&&a.data.category===c&&(i.isUndefined(a.data.type)||a.data.type===d)})}function o(a,b){a.stock=i.filter(b,function(a){return a&&i.isArray(a.data.ledger)})}function p(a,b){a.stock=i.chain(a.stock).reject(function(a){return a.assetKey===b.assetKey}).value()}function q(a,b,c){return b&&j.categoryOptions[b]?"livestock"===b?c?j.categoryOptions[b][c][a]:{}:j.categoryOptions[b][a]:{}}function r(a,b,c,d){var e=q(a,b,c);return e&&e[d]?e[d]:[]}function t(a){return i.chain(a).map(function(a){return j.categories[a]}).compact().sortBy("name").value()}function u(a,b,c,d){return i.chain(a.getCategoryOptions(b)).map(function(a,b){return i.chain(a).reject(function(a){return d&&b!==d||i.findWhere(c,{code:a.code})}).map(function(a){return i.extend(a,{groupBy:b})}).value()}).values().flatten().value()}c(j,e);var v={"INC-HVT-CROP":{code:"INC-CPS-CROP"},"INC-HVT-FRUT":{code:"INC-FRS-FRUT"}};h(j,"sections",i.indexBy([{code:"EXP",name:"Expenses"},{code:"INC",name:"Income"}],"code")),h(j,"groups",i.indexBy([{code:"INC-CPS",name:"Crop Sales"},{code:"INC-FRS",name:"Fruit Sales"},{code:"EST",name:"Establishment"},{code:"HVT",name:"Harvest"},{code:"HVP",name:"Preharvest"},{code:"INC-LSS",name:"Livestock Sales"},{code:"INC-LSP",name:"Product Sales"},{code:"EXP-AMF",name:"Animal Feed"},{code:"HBD",name:"Husbandry"},{code:"IDR",name:"Indirect Costs"},{code:"MRK",name:"Marketing"},{code:"RPM",name:"Replacements"}],"name")),h(j,"categories",i.indexBy([{code:"INC-LSS-SLAMB",name:"Lamb",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-SWEAN",name:"Weaner Lamb",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-SEWE",name:"Ewe",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-SWTH",name:"Wether",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-SRAM",name:"Ram",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-CCALV",name:"Calf",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-CWEN",name:"Weaner Calf",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-CCOW",name:"Cow",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-CHEI",name:"Heifer",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-CST18",name:"Steer",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-CST36",name:"Ox",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-CBULL",name:"Bull",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-GKID",name:"Kid",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-GWEAN",name:"Weaner Kid",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-GEWE",name:"Ewe",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-GCAST",name:"Castrate",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-GRAM",name:"Ram",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-RKIT",name:"Kit",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-RWEN",name:"Weaner Kit",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-RDOE",name:"Doe",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-RLAP",name:"Lapin",supplyUnit:"hd",unit:"kg"},{code:"INC-LSS-RBUC",name:"Buck",supplyUnit:"hd",unit:"kg"},{code:"INC-LSP-MILK",name:"Milk",unit:"l"},{code:"INC-LSP-WOOL",name:"Wool",unit:"kg"},{code:"INC-LSP-LFUR",name:"Fur",unit:"kg"},{code:"INC-CPS-CROP",name:"Crop",unit:"t"},{code:"INC-FRS-FRUT",name:"Fruit",unit:"t"},{code:"EXP-EST-DRAN",name:"Drainage",unit:"Total"},{code:"EXP-EST-IRRG",name:"Irrigation",unit:"Total"},{code:"EXP-EST-LPRP",name:"Land preparation",unit:"Total"},{code:"EXP-EST-TRLL",name:"Trellising",unit:"Total"},{code:"EXP-HVP-CONS",name:"Consultants",unit:"Total"},{code:"EXP-HVP-SEED",name:"Seed",unit:"kg"},{code:"EXP-HVP-PLTM",name:"Plant Material",unit:"each"},{code:"EXP-HVP-ELEC",name:"Electricity",unit:"Total"},{code:"EXP-HVP-FERT",name:"Fertiliser",unit:"t"},{code:"EXP-HVP-FUEL",name:"Fuel",unit:"l"},{code:"EXP-HVP-FUNG",name:"Fungicides",unit:"Total"},{code:"EXP-HVP-GENL",name:"General",unit:"Total"},{code:"EXP-HVP-LIME",name:"Lime",unit:"t"},{code:"EXP-HVP-HERB",name:"Herbicides",unit:"l"},{code:"EXP-HVP-PEST",name:"Pesticides",unit:"l"},{code:"EXP-HVP-PGRG",name:"Plant growth regulators",unit:"Total"},{code:"EXP-HVP-POLL",name:"Pollination",unit:"ha"},{code:"EXP-HVP-SPYA",name:"Aerial spraying",unit:"ha"},{code:"EXP-HVP-PRCI",name:"Production Credit Interest",unit:"Total"},{code:"EXP-HVP-INSH",name:"Hail insurance",unit:"t"},{code:"EXP-HVP-INSM",name:"Yield insurance",unit:"t"},{code:"EXP-HVP-HEDG",name:"Hedging cost",unit:"t"},{code:"EXP-HVP-REPP",name:"Repairs & maintenance",unit:"Total"},{code:"EXP-HVP-SLAB",name:"Seasonal labour",unit:"ha"},{code:"EXP-HVT-FUEL",name:"Fuel",unit:"l"},{code:"EXP-HVT-LABC",name:"Harvest labour",unit:"ha"},{code:"EXP-HVT-HVTT",name:"Harvest transport",unit:"Total"},{code:"EXP-HVT-HVTC",name:"Harvesting cost",unit:"Total"},{code:"EXP-HVT-REPP",name:"Repairs & maintenance",unit:"Total"},{code:"EXP-HVT-STOR",name:"Storage",unit:"days"},{code:"EXP-HVT-PAKM",name:"Packaging material",unit:"each"},{code:"EXP-HVT-DYCL",name:"Drying & cleaning",unit:"t"},{code:"EXP-HVT-PAKC",name:"Packing cost",unit:"each"},{code:"EXP-IDR-DEPR",name:"Depreciation",unit:"Total"},{code:"EXP-IDR-FUEL",name:"Fuel",unit:"l"},{code:"EXP-IDR-LUBR",name:"Lubrication",unit:"l"},{code:"EXP-IDR-REPP",name:"Repairs & maintenance",unit:"Total"},{code:"EXP-IDR-ELEC",name:"Electricity",unit:"Total"},{code:"EXP-IDR-INTR",name:"Interest on loans",unit:"Total"},{code:"EXP-IDR-WATR",name:"Water",unit:"Total"},{code:"EXP-IDR-LABP",name:"Permanent labour",unit:"Total"},{code:"EXP-IDR-SCHED",name:"Scheduling",unit:"Total"},{code:"EXP-IDR-LICS",name:"License",unit:"Total"},{code:"EXP-IDR-INSA",name:"Insurance assets",unit:"Total"},{code:"EXP-IDR-OTHER",name:"Other overheads",unit:"Total"},{code:"EXP-RPM-SLAMB",name:"Lamb",unit:"head"},{code:"EXP-RPM-SWEAN",name:"Weaner Lamb",unit:"head"},{code:"EXP-RPM-SEWE",name:"Ewe",unit:"head"},{code:"EXP-RPM-SWTH",name:"Wether",unit:"head"},{code:"EXP-RPM-SRAM",name:"Ram",unit:"head"},{code:"EXP-RPM-CCALV",name:"Calf",unit:"head"},{code:"EXP-RPM-CWEN",name:"Weaner Calf",unit:"head"},{code:"EXP-RPM-CCOW",name:"Cow",unit:"head"},{code:"EXP-RPM-CHEI",name:"Heifer",unit:"head"},{code:"EXP-RPM-CST18",name:"Steer",unit:"head"},{code:"EXP-RPM-CST36",name:"Ox",unit:"head"},{code:"EXP-RPM-CBULL",name:"Bull",unit:"head"},{code:"EXP-RPM-GKID",name:"Kid",unit:"head"},{code:"EXP-RPM-GWEAN",name:"Weaner Kid",unit:"head"},{code:"EXP-RPM-GEWE",name:"Ewe",unit:"head"},{code:"EXP-RPM-GCAST",name:"Castrate",unit:"head"},{code:"EXP-RPM-GRAM",name:"Ram",unit:"head"},{code:"EXP-RPM-RKIT",name:"Kit",unit:"head"},{code:"EXP-RPM-RWEN",name:"Weaner Kit",unit:"head"},{code:"EXP-RPM-RDOE",name:"Doe",unit:"head"},{code:"EXP-RPM-RLAP",name:"Lapin",unit:"head"},{code:"EXP-RPM-RBUC",name:"Buck",unit:"head"},{code:"EXP-AMF-CROP",name:"Crop",unit:"kg"},{code:"EXP-AMF-LICK",name:"Lick",unit:"t"},{code:"EXP-HBD-VACC",name:"Drenching & vaccination",unit:"head"},{code:"EXP-HBD-DIPP",name:"Dipping & jetting",unit:"head"},{code:"EXP-HBD-VETY",name:"Veterinary",unit:"head"},{code:"EXP-HBD-SHER",name:"Shearing",unit:"head"},{code:"EXP-HBD-CRCH",name:"Crutching",unit:"head"},{code:"EXP-MRK-LSSF",name:"Livestock sales marketing fees",unit:"t"},{code:"EXP-MRK-LSPF",name:"Livestock products marketing fees",unit:"t"},{code:"EXP-MRK-HOTF",name:"Horticulture marketing fees",unit:"t"},{code:"EXP-MRK-CRPF",name:"Crop marketing fees",unit:"t"},{code:"EXP-MRK-LSTP",name:"Livestock transport",unit:"head"},{code:"EXP-MRK-HOTT",name:"Fruit transport",unit:"t"},{code:"EXP-MRK-CRPT",name:"Crop transport",unit:"t"}],"code")),h(j,"stockableCategoryCodes",["INC-LSS-SLAMB","INC-LSS-SWEAN","INC-LSS-SEWE","INC-LSS-SWTH","INC-LSS-SRAM","INC-LSS-CCALV","INC-LSS-CWEN","INC-LSS-CCOW","INC-LSS-CHEI","INC-LSS-CST18","INC-LSS-CST36","INC-LSS-CBULL","INC-LSS-GKID","INC-LSS-GWEAN","INC-LSS-GEWE","INC-LSS-GCAST","INC-LSS-GRAM","INC-LSS-RKIT","INC-LSS-RWEN","INC-LSS-RDOE","INC-LSS-RLAP","INC-LSS-RBUC","INC-LSP-MILK","INC-LSP-WOOL","INC-LSP-LFUR","INC-CPS-CROP","INC-FRS-FRUT","EXP-HVP-SEED","EXP-HVP-PLTM","EXP-HVP-FERT","EXP-HVP-FUEL","EXP-HVP-FUNG","EXP-HVP-LIME","EXP-HVP-HERB","EXP-HVP-PEST","EXP-HVP-PGRG","EXP-HVT-FUEL","EXP-IDR-FUEL","EXP-IDR-LUBR","EXP-IDR-WATR","EXP-AMF-CROP","EXP-AMF-LICK"]),h(j,"categoryOptions",{crop:{INC:{"Crop Sales":t(["INC-CPS-CROP"])},EXP:{Preharvest:t(["EXP-HVP-FERT","EXP-HVP-FUNG","EXP-HVP-HEDG","EXP-HVP-HERB","EXP-HVP-INSH","EXP-HVP-INSM","EXP-HVP-LIME","EXP-HVP-PEST","EXP-HVP-PRCI","EXP-HVP-SEED","EXP-HVP-SPYA"]),Harvest:t(["EXP-HVT-LABC","EXP-HVT-HVTC"]),Marketing:t(["EXP-MRK-CRPF","EXP-MRK-CRPT"]),"Indirect Costs":t(["EXP-IDR-DEPR","EXP-IDR-FUEL","EXP-IDR-LUBR","EXP-IDR-REPP","EXP-IDR-ELEC","EXP-IDR-WATR","EXP-IDR-LABP","EXP-IDR-SCHED","EXP-IDR-OTHER"])}},horticulture:{INC:{"Fruit Sales":t(["INC-FRS-FRUT"])},EXP:{Establishment:t(["EXP-EST-DRAN","EXP-EST-IRRG","EXP-EST-LPRP","EXP-EST-TRLL"]),Preharvest:t(["EXP-HVP-CONS","EXP-HVP-ELEC","EXP-HVP-FERT","EXP-HVP-FUEL","EXP-HVP-FUNG","EXP-HVP-GENL","EXP-HVP-LIME","EXP-HVP-HERB","EXP-HVP-INSH","EXP-HVP-INSM","EXP-HVP-PEST","EXP-HVP-PGRG","EXP-HVP-PLTM","EXP-HVP-POLL","EXP-HVP-PRCI","EXP-HVP-REPP","EXP-HVP-SLAB","EXP-HVP-SPYA"]),Harvest:t(["EXP-HVT-FUEL","EXP-HVT-DYCL","EXP-HVT-LABC","EXP-HVT-HVTT","EXP-HVT-PAKC","EXP-HVT-PAKM","EXP-HVT-REPP","EXP-HVT-STOR"]),Marketing:t(["EXP-MRK-HOTF","EXP-MRK-HOTT"]),"Indirect Costs":t(["EXP-IDR-DEPR","EXP-IDR-FUEL","EXP-IDR-LUBR","EXP-IDR-REPP","EXP-IDR-ELEC","EXP-IDR-WATR","EXP-IDR-LABP","EXP-IDR-SCHED","EXP-IDR-LICS","EXP-IDR-INSA","EXP-IDR-OTHER"])}},livestock:{Cattle:{INC:{"Livestock Sales":t(["INC-LSS-CCALV","INC-LSS-CWEN","INC-LSS-CCOW","INC-LSS-CHEI","INC-LSS-CST18","INC-LSS-CST36","INC-LSS-CBULL"]),"Product Sales":t(["INC-LSP-MILK"])},EXP:{Replacements:t(["EXP-RPM-CCALV","EXP-RPM-CWEN","EXP-RPM-CCOW","EXP-RPM-CHEI","EXP-RPM-CST18","EXP-RPM-CST36","EXP-RPM-CBULL"]),"Animal Feed":t(["EXP-AMF-CROP","EXP-AMF-LICK"]),Husbandry:t(["EXP-HBD-VACC","EXP-HBD-DIPP","EXP-HBD-VETY"]),Marketing:t(["EXP-MRK-LSSF","EXP-MRK-LSPF","EXP-MRK-LSTP"]),"Indirect Costs":t(["EXP-IDR-FUEL","EXP-IDR-REPP","EXP-IDR-ELEC","EXP-IDR-WATR","EXP-IDR-LABP","EXP-IDR-LICS","EXP-IDR-INSA","EXP-IDR-OTHER"])}},Game:{INC:{"Livestock Sales":t(["INC-LSS-CCALV","INC-LSS-CWEN","INC-LSS-CCOW","INC-LSS-CHEI","INC-LSS-CST18","INC-LSS-CST36","INC-LSS-CBULL"]),"Product Sales":t(["INC-LSP-WOOL","INC-LSP-LFUR"])},EXP:{Replacements:t(["EXP-RPM-CCALV","EXP-RPM-CWEN","EXP-RPM-CCOW","EXP-RPM-CHEI","EXP-RPM-CST18","EXP-RPM-CST36","EXP-RPM-CBULL"]),"Animal Feed":t(["EXP-AMF-CROP","EXP-AMF-LICK"]),Husbandry:t(["EXP-HBD-VACC","EXP-HBD-DIPP","EXP-HBD-VETY"]),Marketing:t(["EXP-MRK-LSSF","EXP-MRK-LSPF","EXP-MRK-LSTP"]),"Indirect Costs":t(["EXP-IDR-FUEL","EXP-IDR-REPP","EXP-IDR-ELEC","EXP-IDR-WATR","EXP-IDR-LABP","EXP-IDR-LICS","EXP-IDR-INSA","EXP-IDR-OTHER"])}},Goats:{INC:{"Livestock Sales":t(["INC-LSS-GKID","INC-LSS-GWEAN","INC-LSS-GEWE","INC-LSS-GCAST","INC-LSS-GRAM"]),"Product Sales":t(["INC-LSP-WOOL","INC-LSP-MILK"])},EXP:{Replacements:t(["EXP-RPM-GKID","EXP-RPM-GWEAN","EXP-RPM-GEWE","EXP-RPM-GCAST","EXP-RPM-GRAM"]),"Animal Feed":t(["EXP-AMF-CROP","EXP-AMF-LICK"]),Husbandry:t(["EXP-HBD-VACC","EXP-HBD-DIPP","EXP-HBD-VETY","EXP-HBD-SHER","EXP-HBD-CRCH"]),Marketing:t(["EXP-MRK-LSSF","EXP-MRK-LSPF","EXP-MRK-LSTP"]),"Indirect Costs":t(["EXP-IDR-FUEL","EXP-IDR-REPP","EXP-IDR-ELEC","EXP-IDR-WATR","EXP-IDR-LABP","EXP-IDR-LICS","EXP-IDR-INSA","EXP-IDR-OTHER"])}},Rabbits:{INC:{"Livestock Sales":t(["INC-LSS-RKIT","INC-LSS-RWEN","INC-LSS-RDOE","INC-LSS-RLUP","INC-LSS-RBUC"]),"Product Sales":t(["INC-LSP-WOOL","INC-LSP-LFUR"])},EXP:{Replacements:t(["EXP-RPM-RKIT","EXP-RPM-RWEN","EXP-RPM-RDOE","EXP-RPM-RLUP","EXP-RPM-RBUC"]),Husbandry:t(["EXP-HBD-VACC","EXP-HBD-DIPP","EXP-HBD-VETY","EXP-HBD-SHER","EXP-HBD-CRCH"]),Marketing:t(["EXP-MRK-LSSF","EXP-MRK-LSPF","EXP-MRK-LSTP"]),"Indirect Costs":t(["EXP-IDR-FUEL","EXP-IDR-REPP","EXP-IDR-ELEC","EXP-IDR-WATR","EXP-IDR-LABP","EXP-IDR-LICS","EXP-IDR-INSA","EXP-IDR-OTHER"])}},Sheep:{INC:{"Livestock Sales":t(["INC-LSS-SLAMB","INC-LSS-SWEAN","INC-LSS-SEWE","INC-LSS-SWTH","INC-LSS-SRAM"]),"Product Sales":t(["INC-LSP-WOOL","INC-LSP-MILK"])},EXP:{Replacements:t(["EXP-RPM-SLAMB","EXP-RPM-SWEAN","EXP-RPM-SEWE","EXP-RPM-SWTH","EXP-RPM-SRAM"]),"Animal Feed":t(["EXP-AMF-CROP","EXP-AMF-LICK"]),Husbandry:t(["EXP-HBD-VACC","EXP-HBD-DIPP","EXP-HBD-VETY","EXP-HBD-SHER","EXP-HBD-CRCH"]),Marketing:t(["EXP-MRK-LSSF","EXP-MRK-LSPF","EXP-MRK-LSTP"]),"Indirect Costs":t(["EXP-IDR-FUEL","EXP-IDR-REPP","EXP-IDR-ELEC","EXP-IDR-WATR","EXP-IDR-LABP","EXP-IDR-LICS","EXP-IDR-INSA","EXP-IDR-OTHER"])}}}}),g(j,"getBaseCategory",function(a){return i.findWhere(j.categories,a)}),g(j,"getGroupCategories",function(a,b,c,d){return r(c,a,x[b],d)}),h(j,"costStages",["Establishment","Yearly"]);var w={head:"hd",each:"ea."};h(j,"representativeAnimals",{Cattle:"Cow",Game:"Cow",Goats:"Ewe",Rabbits:"Doe",Sheep:"Ewe"});var x={"Cattle (Extensive)":"Cattle","Cattle (Feedlot)":"Cattle","Cattle (Stud)":"Cattle","Sheep (Extensive)":"Sheep","Sheep (Feedlot)":"Sheep","Sheep (Stud)":"Sheep"};h(j,"birthAnimals",{Cattle:"Calf",Game:"Calf",Goats:"Kid",Rabbits:"Kit",Sheep:"Lamb"}),h(j,"weanedAnimals",{Cattle:"Weaner Calf",Game:"Weaner Calf",Goats:"Weaner Kid",Rabbits:"Weaner Kit",Sheep:"Weaner Lamb"});var y={Cattle:{Calf:.32,"Weaner Calf":.44,Cow:1.1,Heifer:1.1,Steer:.75,Ox:1.1,Bull:1.36},Game:{Calf:.32,"Weaner Calf":.44,Cow:1.1,Heifer:1.1,Steer:.75,Ox:1.1,Bull:1.36},Goats:{Kid:.08,"Weaner Kid":.12,Ewe:.17,Castrate:.17,Ram:.22},Rabbits:{Kit:.08,"Weaner Kit":.12,Doe:.17,Lapin:.17,Buck:.22},Sheep:{Lamb:.08,"Weaner Lamb":.11,Ewe:.16,Wether:.16,Ram:.23}};return g(j,"getBirthingAnimal",function(a){var b=x[a]||a;return b&&j.birthAnimals[b]}),d(j,"getAssetTypeForLandUse",function(a){return s.include(a,"Cropland")?"crop":s.include(a,"Cropland")?"horticulture":"livestock"}),g(j,"getCategorySortKey",function(a){return i.contains(i.values(j.representativeAnimals),a)?0+a:i.contains(i.values(j.birthAnimals),a)?1+a:i.contains(i.values(j.weanedAnimals),a)?2+a:3+a}),j.validates({data:{required:!0,object:!0}}),j}]),sdkModelEnterpriseBudget.provider("EnterpriseBudget",["listServiceMapProvider",function(a){this.$get=["$filter","Base","computedProperty","EnterpriseBudgetBase","inheritModel","moment","naturalSort","privateProperty","readOnlyProperty","safeArrayMath","safeMath","underscore",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){d.apply(this,arguments),b.initializeObject(this.data,"details",{}),b.initializeObject(this.data,"events",{}),b.initializeObject(this.data,"schedules",{}),b.initializeObject(this.data.details,"cycleStart",0),b.initializeObject(this.data.details,"numberOfMonths",12),b.initializeObject(this.data.details,"productionArea","1 Hectare"),c(this,"commodityTitle",function(){return n(this.assetType)}),c(this,"numberOfMonths",function(){return this.data.details.numberOfMonths}),c(this,"defaultMonthlyPercent",function(){return D[this.data.details.numberOfMonths]||l.reduce(l.range(this.numberOfMonths),function(a,b,c){return a[c]=c===a.length-1?k.minus(100,j.reduce(a)):k.chain(100).dividedBy(a.length).round(4).toNumber(),a},b.initializeArray(this.numberOfMonths))}),h(this,"getCommodities",function(){return o(this.assetType)}),h(this,"getShiftedCycle",function(){return p(this)}),h(this,"getEventTypes",function(){return B[this.assetType]?B[this.assetType]:B["default"]}),h(this,"getScheduleTypes",function(){return l.chain(C[this.assetType]?C[this.assetType]:C["default"]).union(r(this)).compact().value().sort(g)}),h(this,"getSchedule",function(a,b){return a&&this.data.schedules[a]?this.data.schedules[a]:l.isUndefined(b)?angular.copy(this.defaultMonthlyPercent):l.range(this.numberOfMonths).map(function(){return 0})}),h(this,"shiftMonthlyArray",function(a){return a?l.rest(a,this.data.details.cycleStart).concat(l.first(a,this.data.details.cycleStart)):a}),h(this,"unshiftMonthlyArray",function(a){return a?l.rest(a,a.length-this.data.details.cycleStart).concat(l.first(a,a.length-this.data.details.cycleStart)):a}),h(this,"getShiftedSchedule",function(a){return this.shiftMonthlyArray(l.isArray(a)?a:this.getSchedule(a))}),h(this,"getAvailableSchedules",function(a){return s(this,a)}),c(this,"cycleStart",function(){return this.data.details.cycleStart}),c(this,"cycleStartMonth",function(){return m.cycleMonths[this.data.details.cycleStart].name}),h(this,"getAllocationIndex",function(a,b){var c=this.getSection(a,b),d=c&&c.total?l.findIndex(this.shiftMonthlyArray(c.total.valuePerMonth),function(a){return 0!==a}):-1;return-1!==d?d:0}),h(this,"getLastAllocationIndex",function(a,b){var c=this.getSection(a,b),d=c&&c.total?l.findLastIndex(this.shiftMonthlyArray(c.total.valuePerMonth),function(a){return 0!==a}):-1;return-1!==d?d+1:this.numberOfMonths}),c(this,"numberOfAllocatedMonths",function(){return this.getLastAllocationIndex("INC")-this.getAllocationIndex("EXP")}),h(this,"adjustCategory",function(a,b,c,d){return t(this,a,b,c,d)}),h(this,"recalculate",function(){return v(this)}),h(this,"recalculateCategory",function(a){return w(this,a)}),l.isUndefined(a)||0===arguments.length||(this.averaged=a.averaged||!1,this.cloneCount=a.cloneCount||0,this.createdAt=a.createdAt,this.createdBy=a.createdBy,this.favoriteCount=a.favoriteCount||0,this.favorited=a.favorited||!1,this.followers=a.followers||[],this.id=a.id||a.$id,this.internallyPublished=a.internallyPublished||!1,this.name=a.name,this.organization=a.organization,this.organizationUuid=a.organizationUuid,this.published=a.published||!1,this.region=a.region,this.sourceUuid=a.sourceUuid,this.useCount=a.useCount||0,this.updatedAt=a.updatedAt,this.updatedBy=a.updatedBy,this.user=a.user,this.userData=a.userData,this.userId=a.userId,this.uuid=a.uuid,"livestock"===this.assetType?(this.data.details.representativeAnimal=this.getRepresentativeAnimal(),this.data.details.conversions=this.getConversionRates(),this.data.details.budgetUnit="LSU",l.each(this.getEventTypes(),function(a){b.initializeObject(this.data.events,a,b.initializeArray(this.numberOfMonths))},this)):"horticulture"===this.assetType&&(this.data.details.maturityFactor instanceof Array&&(this.data.details.maturityFactor={INC:this.data.details.maturityFactor}),b.initializeObject(this.data.details,"yearsToMaturity",q(this)),b.initializeObject(this.data.details,"maturityFactor",{}),b.initializeObject(this.data.details.maturityFactor,"INC",[]),b.initializeObject(this.data.details.maturityFactor,"EXP",[])),this.recalculate())}function n(a){return m.commodityTypes[a]||""}function o(a){return m.assetCommodities[a]||[]}function p(a){return l.sortBy(m.cycleMonths,function(b){return b.id<a.data.details.cycleStart?b.id+12:b.id})}function q(a){return E[a.commodityType]}function r(a){return l.chain(F).keys().filter(function(b){return l.contains(F[b],a.commodityType)}).value()}function s(a,b){return l.reject(a.getScheduleTypes(),function(c){return(void 0===b||c!==b)&&void 0!==a.data.schedules[c]})}function t(a,c,d,e,f){var g=l.isObject(d)?d.code:d,h=a.getCategory(c,g,e);if(h){if(h.quantity="Total"===h.unit?1:h.quantity,l.has(h,"schedule")&&(h.scheduled=!0,delete h.schedule),"valuePerMonth"===f&&(h.scheduled=!0,h.value=j.reduce(h.valuePerMonth)),l.contains(["value","valuePerLSU","valuePerMonth"],f)&&("valuePerLSU"===f&&(h.value=k.round(k.dividedBy(h.value,a.getConversionRate(h.name)),2)),h.pricePerUnit=k.round(k.dividedBy(k.dividedBy(h.value,h.supply||1),h.quantity),4)),l.contains(["pricePerUnit","quantity","quantityPerLSU","supply"],f)&&("quantityPerLSU"===f&&(h.quantity=k.round(k.dividedBy(h.quantity,a.getConversionRate(h.name)),2)),h.value=k.times(k.times(h.supply||1,h.quantity),h.pricePerUnit)),"valuePerMonth"!==f){var i=j.reduce(h.valuePerMonth),m=h.value%a.numberOfMonths;if(0!==i&&h.scheduled){var n=j.count(h.valuePerMonth),o=0;h.valuePerMonth=l.reduce(h.valuePerMonth,function(a,b,c){return b>0&&(a[c]=c===a.length-1||o===n-1?k.minus(h.value,j.reduce(a)):k.round(k.dividedBy(k.times(b,h.value),i),2),o++),a},b.initializeArray(a.numberOfMonths))}else h.valuePerMonth=l.reduce(a.defaultMonthlyPercent,function(b,c,d){return b[d]=d===b.length-1?k.minus(h.value,j.reduce(b)):0===m?k.dividedBy(h.value,a.numberOfMonths):k.round(k.dividedBy(k.times(c,h.value),100),2),b},b.initializeArray(a.numberOfMonths))}w(a,g)}}function u(a){if(l.each(m.sections,function(b){for(var c=m.costStages.length-1;c>=0;c--){var d=a.getSection(b.code,m.costStages[c]);l.isUndefined(d)&&(d=angular.copy(b),d.productCategoryGroups=[],a.data.sections.push(d),a.sortSections()),d.costStage=m.costStages[c]}}),"horticulture"===a.assetType&&a.data.details.yearsToMaturity){var b=a.data.details.yearsToMaturity;a.data.details.maturityFactor=l.mapObject(a.data.details.maturityFactor,function(a){return l.first(a.concat(l.range(a.length<b?b-a.length:0).map(function(){return 100})),b)})}}function v(a){u(a),"livestock"===a.assetType&&a.getConversionRate()&&(a.data.details.calculatedLSU=k.times(a.data.details.herdSize,a.getConversionRate())),l.each(a.data.sections,function(b){l.each(b.productCategoryGroups,function(b){l.each(b.productCategories,function(b){A(a,b)}),z(a,b)}),y(a,b)}),x(a)}function w(a,b){l.each(a.data.sections,function(c){l.each(c.productCategoryGroups,function(d){l.each(d.productCategories,function(e){e.code===b&&(A(a,e),z(a,d),y(a,c))})})}),x(a)}function x(a){a.data.details.grossProfitByStage=l.object(m.costStages,l.map(m.costStages,function(b){return l.chain(a.data.sections).where({costStage:b}).reduce(function(a,b){return"INC"===b.code?k.plus(a,b.total.value):"EXP"===b.code?k.minus(a,b.total.value):a},0).value()})),a.data.details.grossProfit=a.data.details.grossProfitByStage[a.defaultCostStage],"livestock"===a.assetType&&(a.data.details.grossProfitPerLSU=k.dividedBy(a.data.details.grossProfit,a.data.details.calculatedLSU))}function y(a,c){c.total=l.extend({value:l.reduce(c.productCategoryGroups,function(a,b){return k.plus(a,b.total.value)},0),valuePerMonth:l.reduce(c.productCategoryGroups,function(a,b){return j.plus(a,b.total.valuePerMonth)},b.initializeArray(a.numberOfMonths))},"livestock"!==a.assetType?{}:{quantityPerLSU:l.reduce(c.productCategoryGroups,function(a,b){return k.plus(a,b.total.quantityPerLSU)},0),valuePerLSU:l.reduce(c.productCategoryGroups,function(a,b){return k.plus(a,b.total.valuePerLSU)},0)})}function z(a,c){c.total=l.extend({value:l.reduce(c.productCategories,function(a,b){return k.plus(a,b.value)},0),valuePerMonth:l.reduce(c.productCategories,function(a,b){return j.plus(a,b.valuePerMonth)},b.initializeArray(a.numberOfMonths))},"livestock"!==a.assetType?{}:{quantityPerLSU:l.reduce(c.productCategories,function(a,b){return k.plus(a,b.quantityPerLSU)},0),valuePerLSU:l.reduce(c.productCategories,function(a,b){return k.plus(a,b.valuePerLSU)},0)})}function A(a,c){c.name=l.contains(["INC-CPS-CROP","INC-FRS-FRUT"],c.code)?a.commodityType:d.categories[c.code]?d.categories[c.code].name:c.name,"livestock"===a.assetType&&a.getConversionRate(c.name)&&(c.quantityPerLSU=k.times(c.quantity,a.getConversionRate(c.name)),c.valuePerLSU=k.times(c.value,a.getConversionRate(c.name))),c.valuePerMonth=c.valuePerMonth||b.initializeArray(a.numberOfMonths),c.quantityPerMonth=l.reduce(c.valuePerMonth,function(a,b,d){return a[d]=d===a.length-1?k.minus(c.quantity,j.reduce(a)):k.dividedBy(k.times(c.quantity,b),c.value),a},b.initializeArray(a.numberOfMonths)),l.isUndefined(c.supplyUnit)||(c.supplyPerMonth=l.reduce(c.valuePerMonth,function(a,b,d){return a[d]=d===a.length-1?k.minus(c.supply,j.reduce(a)):k.dividedBy(k.times(c.supply,b),c.value),a[d]="hd"===c.supplyUnit?Math.round(a[d]):a[d],a},b.initializeArray(a.numberOfMonths)))}e(m,d),i(m,"commodityTypes",{crop:"Field Crops",horticulture:"Horticulture",livestock:"Livestock"}),i(m,"assetCommodities",{crop:["Barley","Bean (Dry)","Bean (Green)","Beet","Broccoli","Butternut","Cabbage","Canola","Carrot","Cauliflower","Cotton","Cowpea","Grain Sorghum","Groundnut","Leek","Lucerne","Lupin","Maize","Maize (Fodder)","Maize (Green)","Maize (Irrigated)","Maize (Seed)","Maize (White)","Maize (Yellow)","Multispecies Pasture","Oats","Onion","Potato","Pumpkin","Rapeseed","Rye","Soya Bean","Soya Bean (Irrigated)","Sunflower","Sweet Corn","Teff","Teff (Irrigated)","Tobacco","Triticale","Turnip","Wheat","Wheat (Irrigated)"],horticulture:["Almond","Apple","Apricot","Avocado","Banana","Barberry","Berry","Bilberry","Blackberry","Blueberry","Cherry","Chicory","Chili","Cloudberry","Citrus (Hardpeel)","Citrus (Softpeel)","Coffee","Date","Fig","Garlic","Gooseberry","Grape (Bush Vine)","Grape (Table)","Grape (Wine)","Guava","Hazelnut","Hops","Kiwi","Kumquat","Lemon","Lentil","Lime","Macadamia Nut","Mandarin","Mango","Melon","Mulberry","Nectarine","Olive","Orange","Papaya","Pea","Peach","Peanut","Pear","Prickly Pear","Pecan Nut","Persimmon","Pineapple","Pistachio Nut","Plum","Pomegranate","Protea","Prune","Quince","Raspberry","Rooibos","Strawberry","Sugarcane","Tea","Tomato","Watermelon","Wineberry"],livestock:["Cattle (Extensive)","Cattle (Feedlot)","Cattle (Stud)","Chicken (Broilers)","Chicken (Layers)","Dairy","Game","Goats","Horses","Ostrich","Pigs","Rabbits","Sheep (Extensive)","Sheep (Feedlot)","Sheep (Stud)"]});
var B={"default":[],livestock:["Birth","Death"]},C={"default":["Fertilise","Harvest","Plant/Seed","Plough","Spray"],livestock:["Lick","Sales","Shearing","Vaccination"]};i(m,"cycleMonths",l.map(["January","February","March","April","May","June","July","August","September","October","November","December"],function(a,b){return{id:b,name:a,shortname:a.substring(0,3)}})),h(m,"getCycleMonth",function(a){return m.cycleMonths[a%12]});var D={3:[33.33,33.34,33.33],6:[16.67,16.67,16.66,16.66,16.67,16.67],7:[14.29,14.28,14.29,14.28,14.29,14.28,14.29],9:[11.11,11.11,11.11,11.11,11.12,11.11,11.11,11.11,11.11],11:[9.09,9.09,9.09,9.09,9.09,9.1,9.09,9.09,9.09,9.09,9.09],12:[8.33,8.33,8.34,8.33,8.33,8.34,8.33,8.33,8.34,8.33,8.33,8.34]},E={Apple:25,Apricot:18,Avocado:8,Blueberry:8,"Citrus (Hardpeel)":25,"Citrus (Softpeel)":25,Date:12,Fig:30,"Grape (Table)":25,"Grape (Wine)":25,"Macadamia Nut":10,Mango:30,Nectarine:18,Olive:10,Orange:25,"Pecan Nut":10,Peach:18,Pear:25,Persimmon:20,Plum:18,Pomegranate:30,Rooibos:5},F={Calving:["Cattle (Extensive)","Cattle (Feedlot)","Cattle (Stud)","Dairy"],Hatching:["Chicken (Broilers)","Chicken (Layers)","Ostrich"],Kidding:["Game","Goats"],Foaling:["Horses"],Farrowing:["Pigs"],Lambing:["Sheep (Extensive)","Sheep (Feedlot)","Sheep (Stud)"]};return m.validates({assetType:{required:!0,inclusion:{"in":l.keys(m.assetCommodities)}},commodityType:{required:!0,inclusion:{"in":function(a,b){return o(b.assetType)}}},data:{required:!0,object:!0},name:{required:!0,length:{min:1,max:255}},region:{required:!0,object:!0}}),m}],a.add("enterprise budget",[function(){function a(a){var b=[a.name,a.assetType,a.commodityType];return a.data&&a.data.details&&a.data.details.regionName&&b.push(a.data.details.regionName),b}return function(b){return{id:b.id||b.$id,title:b.name,subtitle:b.commodityType+(b.regionName?" in "+b.regionName:""),status:b.published?{text:"public",label:"label-success"}:b.internallyPublished?{text:"internal",label:"label-info"}:!1,searchingIndex:a(b)}}}])}]);var sdkModelExpense=angular.module("ag.sdk.model.expense",["ag.sdk.library","ag.sdk.model.base"]);sdkModelExpense.factory("Expense",["inheritModel","Model","readOnlyProperty","underscore",function(a,b,c,d){function e(a){b.Base.apply(this,arguments),d.isUndefined(a)||0===arguments.length||(this.id=a.id||a.$id,this.createdAt=a.createdAt,this.createdBy=a.createdBy,this.description=a.description,this.documentId=a.documentId,this.organizationId=a.organizationId,this.quantity=a.quantity,this.unit=a.unit,this.userId=a.userId,this.reconciled=a.reconciled,this.reconciledAt=a.reconciledAt,this.reconciledBy=a.reconciledBy,this.document=a.document,this.organization=a.organization,this.user=a.user)}return a(e,b.Base),c(e,"units",["ha","km","h"]),e.validates({description:{required:!1,length:{min:0,max:255}},quantity:{required:!0,numeric:!0},unit:{required:!0,inclusion:{"in":e.units}}}),e}]);var sdkModelFarm=angular.module("ag.sdk.model.farm",["ag.sdk.library","ag.sdk.model.base"]);sdkModelFarm.factory("Farm",["asJson","Base","computedProperty","geoJSONHelper","inheritModel","Model","naturalSort","privateProperty","readOnlyProperty","topologyHelper","underscore",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){f.Base.apply(this,arguments),h(this,"farmNameUnique",function(a,b){return m(this,a,b)}),c(this,"fields",function(){return this.data.fields}),c(this,"gates",function(){return this.data.gates}),h(this,"addFields",function(a){n(this,"fields",a,"fieldName")}),h(this,"addField",function(a){o(this,"fields",a,"fieldName")}),h(this,"getField",function(a){return p(this,"fields",a,"fieldName")}),h(this,"removeField",function(a){q(this,"fields",a,"fieldName")}),h(this,"addGates",function(a){n(this,"gates",a,"name")}),h(this,"addGate",function(a){o(this,"gates",a,"name")}),h(this,"getGate",function(a){return p(this,"gates",a,"name")}),h(this,"removeGate",function(a){q(this,"gates",a,"name")}),h(this,"contains",function(a,b){return t(this,a,b)}),h(this,"centroid",function(a){return u(this,a)}),this.data=a&&a.data||{},b.initializeObject(this.data,"fields",[]),b.initializeObject(this.data,"gates",[]),b.initializeObject(this.data,"ignoredLandClasses",[]),k.isUndefined(a)||0===arguments.length||(this.id=a.id||a.$id,this.name=a.name,this.organizationId=a.organizationId,this.organization=a.organization)}function m(a,b,c){var d=s.trim(b||"").toLowerCase();return!k.isEmpty(d)&&!k.chain(c).reject(function(b){return a.id===b.id}).some(function(a){return s.trim(a.name).toLowerCase()===d}).value()}function n(a,b,c,d){k.each(c,function(c){o(a,b,c,d)})}function o(b,c,d,e){d&&(b.data[c]=k.chain(b.data[c]).reject(function(a){return a[e]===d[e]}).union([a(d)]).value().sort(function(a,b){return g(a[e],b[e])}),b.$dirty=!0)}function p(a,b,c,d){return k.find(a.data[b],function(a){return a[d]===c})}function q(a,b,c,d){c&&(a.data[b]=k.reject(a.data[b],function(a){return a[d]===c[d]}),a.$dirty=!0)}function r(a,b){return k.chain(b).filter(function(b){return b.farmId===a.id&&b.data&&b.data.loc}).reduce(function(a,b){var c=j.readGeoJSON(b.data.loc);return a&&c.isValid()?a.union(c):a||c},null).value()}function t(a,b,c){var d=r(a,c),e=j.readGeoJSON(b);return d&&e?d.contains(e):!1}function u(a,b){var c=r(a,b);return c?j.writeGeoJSON(c.getCentroid()):c}return e(l,f.Base),l.validates({name:{required:!0,length:{min:1,max:255}},organizationId:{required:!0,numeric:!0}}),l}]);var sdkModelField=angular.module("ag.sdk.model.field",["ag.sdk.library","ag.sdk.model.base"]);sdkModelField.factory("Field",["computedProperty","inheritModel","Model","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e,f){function g(b){c.Base.apply(this,arguments),a(this,"croppingPotentialRequired",function(){return s.include(this.landUse,"Cropland")}),a(this,"hasGeometry",function(){return!f.isUndefined(this.loc)}),a(this,"establishedDateRequired",function(){return s.include(this.landUse,"Orchard")}),a(this,"terrainRequired",function(){return s.include(this.landUse,"Grazing")}),d(this,"setIrrigatedFromLandUse",function(){this.irrigated=j(this.landUse)}),d(this,"fieldNameUnique",function(a,b){return i(this,a,b)}),f.isUndefined(b)||0===arguments.length||(this.crop=b.crop,this.croppingPotential=b.croppingPotential,this.effectiveDepth=b.effectiveDepth,this.farmName=b.farmName,this.fieldName=b.fieldName,this.irrigated=b.irrigated,this.irrigationType=b.irrigationType,this.landUse=b.landUse,this.loc=b.loc,this.sgKey=b.sgKey,this.size=b.size,this.soilTexture=b.soilTexture,this.source=b.source,this.terrain=b.terrain,this.waterSource=b.waterSource,h(this))}function h(a){switch(a.landUse){case"Cropland":a.irrigated&&(a.landUse="Cropland (Irrigated)");break;case"Building":a.landUse="Built-up";break;case"Conservation":a.landUse="Protected Area";break;case"Homestead":case"Housing":a.landUse="Residential";break;case"Horticulture (Intensive)":a.landUse="Greenhouses";break;case"Horticulture (Perennial)":a.landUse="Orchard";break;case"Horticulture (Seasonal)":a.landUse="Vegetables"}}function i(a,b,c){var d=s.trim(b||"").toLowerCase();return c&&c.data&&!f.isEmpty(d)&&!f.some(c.data.fields||[],function(b){return s.trim(b.fieldName).toLowerCase()===d||!f.isUndefined(a.loc)&&f.isEqual(b.loc,a.loc)})}function j(a){return s.include(a,"Irrigated")}return b(g,c.Base),e(g,"croppingPotentials",["Very High","High","Medium","Low","Very Low"]),e(g,"effectiveDepths",["0 - 30cm","30 - 60cm","60 - 90cm","90 - 120cm","120cm +"]),e(g,"irrigationTypes",["Centre-Pivot","Drip","Flood","Micro","Sprinkler","Sub-drainage"]),e(g,"landClasses",["Built-up","Cropland","Cropland (Emerging)","Cropland (Irrigated)","Cropland (Smallholding)","Erosion","Forest","Grazing","Grazing (Bush)","Grazing (Fynbos)","Grazing (Shrubland)","Greenhouses","Mining","Non-vegetated","Orchard","Orchard (Shadenet)","Pineapple","Plantation","Plantation (Smallholding)","Planted Pastures","Protected Area","Residential","Structures (Handling)","Structures (Processing)","Structures (Retail)","Structures (Storage)","Sugarcane","Sugarcane (Emerging)","Sugarcane (Irrigated)","Tea","Utilities","Vegetables","Vineyard","Wasteland","Water","Water (Seasonal)","Wetland"]),e(g,"soilTextures",["Clay","Clay Loam","Clay Sand","Coarse Sand","Coarse Sandy Clay","Coarse Sandy Clay Loam","Coarse Sandy Loam","Fine Sand","Fine Sandy Clay","Fine Sandy Clay Loam","Fine Sandy Loam","Gravel","Loam","Loamy Coarse Sand","Loamy Fine Sand","Loamy Medium Sand","Loamy Sand","Medium Sand","Medium Sandy Clay","Medium Sandy Clay Loam","Medium Sandy Loam","Other","Sand","Sandy Clay","Sandy Clay Loam","Sandy Loam","Silty Clay","Silty Loam"]),e(g,"waterSources",["Borehole","Dam","Irrigation Scheme","River"]),e(g,"terrains",["Mountains","Plains"]),d(g,"getIrrigatedFromLandUse",function(a){return j(a)}),d(g,"isLandUse",function(a){return a&&f.contains(g.landClasses,a)}),g.validates({croppingPotential:{required:!1,inclusion:{"in":g.croppingPotentials}},effectiveDepth:{required:!1,inclusion:{"in":g.effectiveDepths}},farmName:{required:!0,length:{min:0,max:255}},fieldName:{required:!0,length:{min:0,max:255}},landUse:{required:!0,inclusion:{"in":g.landClasses}},loc:{required:!1,object:!0},size:{required:!0,numeric:!0},sgKey:{required:!1,numeric:!0},soilTexture:{required:!1,inclusion:{"in":g.soilTextures}},source:{required:!1,length:{min:0,max:255}},terrain:{requiredIf:function(a,b){return b.terrainRequired},inclusion:{"in":g.terrains}},waterSource:{required:!1,inclusion:{"in":g.waterSources}}}),g}]);var sdkModelFinancial=angular.module("ag.sdk.model.financial",["ag.sdk.library","ag.sdk.model.base","ag.sdk.utilities"]);sdkModelFinancial.factory("FinancialBase",["Base","inheritModel","Model","privateProperty","safeMath","underscore",function(a,b,c,d,e,f){function g(b){c.Base.apply(this,arguments),this.data=b&&b.data||{},a.initializeObject(this.data,"assets",{}),a.initializeObject(this.data,"liabilities",{}),a.initializeObject(this.data,"ratios",{}),d(this,"recalculate",function(){return j(this)}),f.isUndefined(b)||0===arguments.length||(this.id=b.id||b.$id,this.grossProfit=b.grossProfit,this.netProfit=b.netProfit,this.netWorth=b.netWorth,this.year=b.year,h(this))}function h(a){f.each(["assets","liabilities"],function(b){a.data[b]=f.chain(a.data[b]).omit("undefined").mapObject(function(a){return f.isArray(a)?f.chain(a).map(function(a){return[a.name,a.estimatedValue]}).object().value():a}).value()})}function i(a,b){a=f.isArray(a)?a:[a],b=f.isArray(b)?b:[b];var c=f.reduce(a,function(a,b){return e.plus(a,b)},0),d=f.reduce(b,function(a,b){return e.plus(a,b)},0);return e.round(e.dividedBy(c,d),2)}function j(a){a.data.totalAssets=e.round(f.chain(a.data.assets).values().reduce(function(a,b){return f.reduce(b,function(a,b){return e.plus(a,b)},a)},0).value()),a.data.totalLiabilities=e.round(f.chain(a.data.liabilities).values().reduce(function(a,b){return f.reduce(b,function(a,b){return e.plus(a,b)},a)},0).value()),a.netWorth=e.round(e.minus(a.data.totalAssets,a.data.totalLiabilities),2),a.grossProfit=e.round(e.minus(a.data.productionIncome,a.data.productionExpenditure),2),a.data.ebitda=e.round(e.minus(e.plus(a.grossProfit,a.data.otherIncome),a.data.otherExpenditure),2),a.data.ebit=e.round(e.minus(a.data.ebitda,a.data.depreciationAmortization),2),a.data.ebt=e.round(e.minus(a.data.ebit,a.data.interestPaid),2),a.netProfit=e.round(e.minus(a.data.ebt,a.data.taxPaid),2),a.data.ratios={debt:i(a.data.totalLiabilities,a.data.totalAssets),debtToTurnover:i(a.data.totalLiabilities,[a.data.productionIncome,a.data.otherIncome]),gearing:i(a.data.totalLiabilities,a.netWorth),inputOutput:i(a.data.productionIncome,a.data.productionExpenditure),interestCover:i(a.grossProfit,a.data.interestPaid),interestToTurnover:i(a.data.interestPaid,[a.data.productionIncome,a.data.otherIncome]),productionCost:i(a.data.productionExpenditure,a.data.productionIncome),returnOnInvestment:i(a.grossProfit,a.data.totalAssets)},a.$dirty=!0}return b(g,c.Base),g.validates({year:{numeric:!0,range:{from:1e3,to:9999}}}),g}]),sdkModelFinancial.factory("Financial",["inheritModel","FinancialBase","underscore",function(a,b,c){function d(a){b.apply(this,arguments),c.isUndefined(a)||0===arguments.length||(this.legalEntityId=a.legalEntityId,this.legalEntity=a.legalEntity)}return a(d,b),d.validates({legalEntityId:{required:!0,numeric:!0},year:{numeric:!0,range:{from:1e3,to:9999}}}),d}]),sdkModelFinancial.factory("FinancialGroup",["inheritModel","Financial","FinancialBase","privateProperty","safeMath","underscore",function(a,b,c,d,e,f){function g(a){c.apply(this,arguments),d(this,"addFinancial",function(a){h(this,a)}),this.financials=[],f.isUndefined(a)||0===arguments.length||f.each(a.financials,this.addFinancial,this)}function h(a,c){c=c instanceof b?c:b["new"](c),a.year=c.year,a.financials=f.chain(a.financials).reject(function(a){return a.legalEntityId===c.legalEntityId&&a.year===c.year}).union([c]).value(),a.data=f.chain(a.financials).reduce(function(a,b){return f.each(["assets","liabilities"],function(c){f.each(b.data[c],function(b,d){a[c][d]=f.reduce(b,function(a,b,c){return a[c]=e.plus(a[c],b),a},a[c][d]||{})})}),a},{assets:{},liabilities:{},ratios:{}}).extend(f.chain(["productionIncome","productionExpenditure","otherIncome","otherExpenditure","depreciationAmortization","interestPaid","taxPaid"]).map(function(b){return[b,f.chain(a.financials).pluck("data").pluck(b).reduce(function(a,b){return e.plus(a,b)},0).value()]}).object().value()).value(),a.recalculate()}return a(g,c),g.validates({year:{numeric:!0,range:{from:1e3,to:9999}}}),g}]);var sdkModelLayer=angular.module("ag.sdk.model.layer",["ag.sdk.library","ag.sdk.model.base","ag.sdk.geospatial"]);sdkModelLayer.factory("Layer",["inheritModel","Locale","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e){function f(a){b.apply(this,arguments),e.isUndefined(a)||0===arguments.length||(this.id=a.id||a.$id,this.comments=a.comments,this.createdAt=a.createdAt,this.createdBy=a.createdBy,this.geometry=a.geometry,this.name=a.name,this.organizationId=a.organizationId,this.province=a.province,this.type=a.type,this.updatedAt=a.updatedAt,this.updatedBy=a.updatedBy,this.organization=a.organization,this.sublayers=a.sublayers)}return a(f,b),c(f,"listMap",function(a){return{title:a.name,subtitle:a.province}}),f.validates({comments:{required:!1,length:{min:0,max:255}},country:{required:!0,length:{min:1,max:64}},geometry:{required:!1,object:!0},name:{required:!0,length:{min:1,max:255}},organizationId:{required:!1,numeric:!0},province:{required:!1,length:{min:0,max:255}},type:{required:!0,length:{min:1,max:255}}}),f}]),sdkModelLayer.factory("Sublayer",["computedProperty","inheritModel","Locale","privateProperty","readOnlyProperty","topologyHelper","underscore",function(a,b,c,d,e,f,g){function h(b){c.apply(this,arguments),a(this,"geom",function(){return f.readGeoJSON(this.geometry)}),d(this,"contains",function(a){return j(this,"contains",a)}),d(this,"covers",function(a){return j(this,"covers",a)}),d(this,"crosses",function(a){return j(this,"crosses",a)}),d(this,"intersects",function(a){return j(this,"intersects",a)}),d(this,"overlaps",function(a){return j(this,"overlaps",a)}),d(this,"touches",function(a){return j(this,"touches",a)}),d(this,"within",function(a){return j(this,"within",a)}),d(this,"withinOrCovers",function(a){return j(this,"within",a)||j(this,"intersects",a)&&i(k(this,"difference",a))<.001}),d(this,"subtract",function(a){var b=l(this,"difference",a);0==i(b)&&(this.geometry=void 0)}),d(this,"add",function(a){l(this,"union",a)}),g.isUndefined(b)||0===arguments.length||(this.id=b.id||b.$id,this.data=b.data,this.code=b.code,this.comments=b.comments,this.createdAt=b.createdAt,this.createdBy=b.createdBy,this.geometry=b.geometry,this.name=b.name,this.organizationId=b.organizationId,this.layerId=b.layerId,this.type=b.type,this.updatedAt=b.updatedAt,this.updatedBy=b.updatedBy,this.organization=b.organization,this.layer=b.layer)}function i(a){return a&&a.getArea()}function j(a,b,c){var d=a.geom;return d&&c&&d[b]?d[b](c):!1}function k(a,b,c){var d=a.geom;return d&&c&&d[b]?d[b](c):d}function l(a,b,c){var d=k(a,b,c);return d&&(a.$dirty=!0,a.geometry=f.writeGeoJSON(d)),d}return b(h,c),d(h,"listMap",function(a){return{title:a.name,subtitle:a.layer.province+(a.code?" - "+a.code:""),layer:a.layer.name}}),h.validates({code:{required:!1,length:{min:0,max:255}},comments:{required:!1,length:{min:0,max:255}},country:{required:!0,length:{min:1,max:64}},data:{required:!1,object:!0},geometry:{required:!0,object:!0},layerId:{required:!0,numeric:!0},name:{required:!0,length:{min:1,max:255}},organizationId:{required:!1,numeric:!0},type:{required:!0,length:{min:1,max:255}}}),h}]);var sdkModelLegalEntity=angular.module("ag.sdk.model.legal-entity",["ag.sdk.library","ag.sdk.model.base","ag.sdk.model.asset","ag.sdk.model.liability"]);sdkModelLegalEntity.provider("LegalEntity",["listServiceMapProvider",function(a){this.$get=["Base","Asset","computedProperty","Financial","inheritModel","Liability","Model","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e,f,g,h,i,j){function k(e){g.Base.apply(this,arguments),c(this,"contactNameRequired",function(){return l(this)}),this.data=e&&e.data?e.data:{},a.initializeObject(this.data,"attachments",[]),j.isUndefined(e)||0===arguments.length||(this.id=e.id||e.$id,this.addressCity=e.addressCity,this.addressCode=e.addressCode,this.addressDistrict=e.addressDistrict,this.addressStreet=e.addressStreet,this.cifKey=e.cifKey,this.contactName=e.contactName,this.email=e.email,this.fax=e.fax,this.isActive=e.isActive,this.isPrimary=e.isPrimary,this.mobile=e.mobile,this.name=e.name,this.organizationId=e.organizationId,this.registrationNumber=e.registrationNumber,this.telephone=e.telephone,this.type=e.type,this.uuid=e.uuid,this.assets=j.map(e.assets,b.newCopy),this.financials=j.map(e.financials,d.newCopy),this.liabilities=j.map(e.liabilities,f.newCopy))}function l(a){return a&&a.type&&!j.contains(["Individual","Sole Proprietary"],a.type)}return e(k,g.Base),i(k,"legalEntityTypes",["Individual","Sole Proprietary","Joint account","Partnership","Close Corporation","Private Company","Public Company","Trust","Non-Profitable companies","Cooperatives","In- Cooperatives","Other Financial Intermediaries"]),h(k,"getContactNameRequired",function(a){return l(a)}),k.validates({addressCity:{length:{min:1,max:255}},addressCode:{length:{min:1,max:255}},addressDistrict:{length:{min:1,max:255}},addressStreet:{length:{min:1,max:255}},email:{required:!0,format:{email:!0}},fax:{format:{telephone:!0}},mobile:{format:{telephone:!0}},name:{required:!0,length:{min:1,max:255}},organizationId:{required:!0,numeric:!0},registrationNumber:{length:{min:1,max:255}},telephone:{format:{telephone:!0}},type:{required:!0,inclusion:{"in":k.legalEntityTypes}},uuid:{format:{uuid:!0}}}),k}],a.add("legal entity",["attachmentHelper","underscore",function(a,b){return function(c){var d=a.findSize(c,"thumb","img/profile-user.png");return b.extend({id:c.id||c.$id,title:c.name,subtitle:c.type},d?{thumbnailUrl:d}:{})}}])}]);var sdkModelLiability=angular.module("ag.sdk.model.liability",["ag.sdk.library","ag.sdk.utilities","ag.sdk.model.base"]);sdkModelLiability.factory("Liability",["computedProperty","inheritModel","Model","moment","privateProperty","readOnlyProperty","safeArrayMath","safeMath","underscore",function(a,b,c,d,e,f,g,h,i){function j(){return{opening:0,repayment:{},withdrawal:0,balance:0,interest:0,closing:0}}function k(a,b,c){for(;b.length<=c;)b.push(j());l(a,b)}function l(a,b){var c=d(a.startDate,"YYYY-MM-DD").month(),e=a.paymentMonths,f=r[a.frequency]>12?r[a.frequency]/12:1;i.each(b,function(d,j){var k=(j+c)%12;if(d.opening=0===j?a.getLiabilityOpening():b[j-1].closing,"once"===this.frequency&&0===j||a.installmentPayment>0&&i.contains(e,k)){var l="once"===this.frequency?d.opening:h.times(a.installmentPayment,f);"rent"===a.type?d.repayment.bank=l:d.opening>0&&(d.repayment.bank=d.opening<=l?d.opening:l)}d.balance=h.round(Math.max(0,h.minus(h.plus(d.opening,d.withdrawal),g.reduce(d.repayment))),2),d.interest=h.round(h.dividedBy(h.times(h.dividedBy(a.interestRate,12),d.balance),100),2),d.closing=h.round(0===d.balance?0:h.plus(d.balance,d.interest),2)})}function m(a,b){var c=d(a.offsetDate,"YYYY-MM-DD"),e=d(b,"YYYY-MM-DD"),f=e.diff(c,"months"),g=angular.copy(a.data.monthly||[]);return k(a,g,f),g[f]||j()}function n(b){c.Base.apply(this,arguments),this.data=b&&b.data||{},a(this,"title",function(){return this.name||this.category}),a(this,"paymentMonths",function(){var a=r[this.frequency],b=i.isUndefined(this.data.month)?d(this.offsetDate,"YYYY-MM-DD").month():this.data.month;return i.range(b,b+12,12>a?12/a:1).map(function(a){return a%12}).sort(function(a,b){return a-b})}),a(this,"offsetDate",function(){return this.startDate&&this.openingDate?d(this.startDate).isBefore(this.openingDate)?this.openingDate:this.startDate:this.startDate?this.startDate:this.openingDate}),e(this,"liabilityInMonth",function(a){return m(this,a)}),e(this,"balanceInMonth",function(a){return this.liabilityInMonth(a).closing||0}),a(this,"currentBalance",function(){return"rent"!==this.type?this.balanceInMonth(d().startOf("month")):0}),e(this,"recalculate",function(){this.data.monthly=this.data.monthly||[],l(this,this.data.monthly)}),e(this,"resetWithdrawalAndRepayments",function(){this.data.monthly=[]}),e(this,"resetRepayments",function(){i.each(this.data.monthly,function(a){a.repayment={}}),l(this,this.data.monthly)}),e(this,"resetWithdrawals",function(){i.each(this.data.monthly,function(a){a.withdrawal=0}),l(this,this.data.monthly)}),e(this,"resetWithdrawalsInRange",function(a,b){var c=d(this.offsetDate,"YYYY-MM-DD"),e=d(a,"YYYY-MM-DD").diff(c,"months"),f=d(b,"YYYY-MM-DD").diff(c,"months");this.data.monthly=this.data.monthly||[],e=0>e?0:e,f=f>this.data.monthly.length?this.data.monthly.length:f;for(var g=e;f>g;g++)this.data.monthly[g].withdrawal=0;l(this,this.data.monthly)}),e(this,"addRepaymentInMonth",function(a,b,c){var e=d(this.offsetDate,"YYYY-MM-DD"),f=d(b,"YYYY-MM-DD"),i=f.diff(e,"months");c=c||"bank";var j=a;if(i>-1){this.data.monthly=this.data.monthly||[],k(this,this.data.monthly,i);var m=this.data.monthly[i],n=g.reduce(m.repayment),o=h.minus(h.plus(m.opening,m.withdrawal),n),p=a>=o?o:a;j=h.round(h.minus(a,p),2),m.repayment[c]=h.plus(m.repayment[c],p),l(this,this.data.monthly)}return j}),e(this,"setRepaymentInMonth",function(a,b,c){var e=d(this.offsetDate,"YYYY-MM-DD"),f=d(b,"YYYY-MM-DD"),g=f.diff(e,"months");c=c||"bank";var j=a;if(g>-1){this.data.monthly=this.data.monthly||[],k(this,this.data.monthly,g);var m=this.data.monthly[g],n=i.reduce(m.repayment,function(a,b,d){return a+(d===c?0:b||0)},0),o=h.minus(h.plus(m.opening,m.withdrawal),n),p=a>=o?o:a;j=h.round(h.minus(a,p),2),m.repayment[c]=p,l(this,this.data.monthly)}return j}),e(this,"removeRepaymentInMonth",function(a,b){b=b||"bank",i.each(this.data.monthly,function(c,d){a===d&&delete c.repayment[b]}),l(this,this.data.monthly)}),e(this,"addWithdrawalInMonth",function(a,b){var c=d(this.offsetDate,"YYYY-MM-DD"),e=d(b,"YYYY-MM-DD"),f=e.diff(c,"months");if(f>-1){this.data.monthly=this.data.monthly||[],k(this,this.data.monthly,f);var i=this.data.monthly[f],j=h.plus(a,i.withdrawal),m=h.minus(i.opening,g.reduce(i.repayment)),n=this.creditLimit>0?Math.min(Math.max(0,h.minus(this.creditLimit,m)),j):j,o=h.round(h.minus(j,n),2);i.withdrawal=n,l(this,this.data.monthly)}return o}),e(this,"setWithdrawalInMonth",function(a,b){var c=d(this.offsetDate,"YYYY-MM-DD"),e=d(b,"YYYY-MM-DD"),f=e.diff(c,"months");if(f>-1){this.data.monthly=this.data.monthly||[],k(this,this.data.monthly,f);var i=this.data.monthly[f],j=h.minus(i.opening,g.reduce(i.repayment)),m=this.creditLimit>0?Math.min(Math.max(0,h.minus(this.creditLimit,j)),a):a,n=h.round(h.minus(a,m),2);i.withdrawal=m,l(this,this.data.monthly)}return n}),e(this,"liabilityInRange",function(a,b){var c=d(this.offsetDate,"YYYY-MM-DD"),e=d(a,"YYYY-MM-DD"),f=d(b,"YYYY-MM-DD"),g=e.diff(c,"months"),h=f.diff(c,"months"),l=0>g?Math.min(f.diff(e,"months"),Math.abs(g)):0,m=angular.copy(this.data.monthly||[]);return k(this,m,h),i.range(l).map(j).concat(m.slice(g+l,h))}),e(this,"totalLiabilityInRange",function(a,b){return i.reduce(this.liabilityInRange(a,b),function(a,b){return h.plus(a,"number"==typeof b.repayment?b.repayment:g.reduce(b.repayment))},0)}),e(this,"getLiabilityOpening",function(){return(d(this.startDate).isBefore(this.openingDate)&&!i.isUndefined(this.openingBalance)?this.openingBalance:this.amount)||0}),i.isUndefined(b)||0===arguments.length||(this.id=b.id||b.$id,this.uuid=b.uuid,this.merchantUuid=b.merchantUuid,this.name=b.name,this.type=b.type,this.category=b.category,this.openingBalance=b.openingBalance,this.installmentPayment=b.installmentPayment,this.interestRate=b.interestRate||0,this.creditLimit=b.creditLimit,this.frequency=b.frequency,this.startDate=b.startDate&&d(b.startDate).format("YYYY-MM-DD"),this.endDate=b.endDate&&d(b.endDate).format("YYYY-MM-DD"),this.openingDate=b.openingDate&&d(b.openingDate).format("YYYY-MM-DD")||this.startDate,this.amount=b.amount||this.openingBalance,this.merchant=b.merchant)}function o(a,b){return"rent"===b.type}function p(a,b){return"other"===b.type}function q(a,b){return!i.isEmpty(n.liabilityCategories[b.type])}var r={monthly:12,"bi-monthly":24,quarterly:4,"bi-yearly":2,yearly:1},s={"short-term":"Short-term","medium-term":"Medium-term","long-term":"Long-term","production-credit":"Production Credit",rent:"Rent"},t=["short-term","medium-term","long-term","rent"],u=["production-credit","other"];return b(n,c.Base),f(n,"frequencyTypes",{once:"One Time","bi-monthly":"Bi-Monthly",monthly:"Monthly",quarterly:"Quarterly","bi-yearly":"Bi-Annually",yearly:"Annually"}),f(n,"frequencyTypesWithCustom",i.extend({custom:"Custom"},n.frequencyTypes)),e(n,"getFrequencyTitle",function(a){return n.frequencyTypesWithCustom[a]||""}),f(n,"liabilityTypes",s),f(n,"liabilityTypesWithOther",i.extend({other:"Other"},n.liabilityTypes)),e(n,"getTypeTitle",function(a){return n.liabilityTypesWithOther[a]||""}),e(n,"getLiabilityInMonth",function(a,b){return m(n.newCopy(a),b)}),f(n,"liabilityCategories",{"long-term":["Bonds","Loans","Other"],"medium-term":["Terms Loans","Instalment Sale Credit","Leases","Other"],"short-term":["Bank","Co-operative","Creditors","Income Tax","Bills Payable","Portion of Term Commitments","Other"],"production-credit":["Off Taker","Input Supplier","Input Financing"]}),n.validates({amount:{requiredIf:function(a,b,c){return!o(a,b,c)},numeric:!0},openingBalance:{required:!0,numeric:!0},installmentPayment:{requiredIf:function(a,b){return i.contains(t,b.type)&&"production-credit"!==b.type&&!angular.isNumber(b.interestRate)},range:{from:0},numeric:!0},interestRate:{required:!0,range:{from:0,to:100},numeric:!0},creditLimit:{requiredIf:function(a,b){return"production-credit"===b.type&&"Input Financing"===b.data.category||"production-credit"!==b.type&&!angular.isNumber(b.installmentPayment)},range:{from:0},numeric:!0},merchantUuid:{requiredIf:function(a,b,c){return!p(a,b,c)},format:{uuid:!0}},frequency:{required:!0,inclusion:{"in":i.keys(n.frequencyTypesWithCustom)}},type:{required:!0,inclusion:{"in":i.keys(n.liabilityTypesWithOther)}},category:{requiredIf:q,inclusion:{"in":function(a,b){return n.liabilityCategories[b.type]}}},data:{required:!0,object:!0},name:{requiredIf:function(a,b){return i.contains(u,b.type)},length:{min:1,max:255}},startDate:{required:!0,format:{date:!0}},openingDate:{required:!1,format:{date:!0}},endDate:{requiredIf:function(a,b,c){return o(a,b,c)||"custom"===b.type},format:{date:!0}}}),n}]);var sdkModelLocale=angular.module("ag.sdk.model.locale",["ag.sdk.library","ag.sdk.model.base"]);sdkModelLocale.factory("Locale",["computedProperty","Base","inheritModel","Model","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e,f,g){function h(b){d.Base.apply(this,arguments),a(this,"countryLocale",function(){return i(this)}),g.isUndefined(b)||0===arguments.length||(this.country=b.country)}function i(a){return g.findWhere(h.countryLocales,{country:a&&a.country||"South Africa"})}return c(h,d.Base),e(h,"countryLocale",function(a){return i(a)}),f(h,"countryLocales",g.map([[[41.1424498947,20.0498339611],"Albania",6,"Lek","ALL","Lek"],[[33.8352307278,66.0047336558],"Afghanistan",6,"Afghani","AFN","؋"],[[-35.3813487953,-65.179806925],"Argentina",6,"Peso","ARS","$"],[[-25.7328870417,134.491000082],"Australia",6,"Dollar","AUD","$"],[[40.2882723471,47.5459987892],"Azerbaijan",6,"Manat","AZN","₼"],[[24.2903670223,-76.6284303802],"Bahamas",6,"Dollar","BSD","$"],[[13.1814542822,-59.5597970021],"Barbados",6,"Dollar","BBD","$"],[[53.5313137685,28.0320930703],"Belarus",6,"Ruble","BYN","Br"],[[17.2002750902,-88.7101048564],"Belize",6,"Dollar","BZD","BZ$"],[[32.3136780208,-64.7545588982],"Bermuda",6,"Dollar","BMD","$"],[[-16.7081478725,-64.6853864515],"Bolivia",6,"Bolíviano","BOB","$b"],[[44.1745012472,17.7687673323],"Bosnia and Herzegovina",6,"Convertible Marka","BAM","KM"],[[-22.1840321328,23.7985336773],"Botswana",6,"Pula","BWP","P"],[[42.7689031797,25.2155290863],"Bulgaria",6,"Lev","BGN","лв"],[[-10.7877770246,-53.0978311267],"Brazil",6,"Real","BRL","R$"],[[4.51968957503,114.722030354],"Brunei Darussalam",6,"Dollar","BND","$"],[[12.7200478567,104.906943249],"Cambodia",6,"Riel","KHR","៛"],[[61.3620632437,-98.3077702819],"Canada",6,"Dollar","CAD","$"],[[19.4289649722,-80.9121332147],"Cayman Islands",6,"Dollar","KYD","$"],[[-37.730709893,-71.3825621318],"Chile",6,"Peso","CLP","$"],[[36.5617654559,103.81907349],"China",6,"Yuan Renminbi","CNY","¥"],[[3.91383430725,-73.0811458241],"Colombia",6,"Peso","COP","$"],[[9.9763446384,-84.1920876775],"Costa Rica",6,"Colon","CRC","₡"],[[45.0804763057,16.404128994],"Croatia",6,"Kuna","HRK","kn"],[[21.6228952793,-79.0160538445],"Cuba",6,"Peso","CUP","₱"],[[49.7334123295,15.3124016281],"Czech Republic",6,"Koruna","CZK","Kč"],[[55.9812529593,10.0280099191],"Denmark",6,"Krone","DKK","kr"],[[18.8943308233,-70.5056889612],"Dominican Republic",6,"Peso","DOP","RD$"],[[26.4959331064,29.8619009908],"Egypt",6,"Pound","EGP","£"],[[13.7394374383,-88.8716446906],"El Salvador",6,"Colon","SVC","$"],[[-51.7448395441,-59.35238956],"Falkland Islands (Malvinas)",6,"Pound","FKP","£"],[[-17.4285803175,165.451954318],"Fiji",6,"Dollar","FJD","$"],[[7.95345643541,-1.21676565807],"Ghana",6,"Cedi","GHS","¢"],[[15.694036635,-90.3648200858],"Guatemala",6,"Quetzal","GTQ","Q"],[[49.4680976128,-2.57239063555],"Guernsey",6,"Pound","GGP","£"],[[4.79378034012,-58.9820245893],"Guyana",6,"Dollar","GYD","$"],[[14.8268816519,-86.6151660963],"Honduras",6,"Lempira","HNL","L"],[[22.3982773723,114.113804542],"Hong Kong",6,"Dollar","HKD","$"],[[47.1627750614,19.3955911607],"Hungary",6,"Forint","HUF","Ft"],[[64.9957538607,-18.5739616708],"Iceland",6,"Krona","ISK","kr"],[[22.8857821183,79.6119761026],"India",6,"Rupee","INR","₹"],[[-2.21505456346,117.240113662],"Indonesia",6,"Rupiah","IDR","Rp"],[[32.575032915,54.2740700448],"Iran",6,"Rial","IRR","﷼"],[[54.2241891077,-4.53873952326],"Isle of Man",6,"Pound","IMP","£"],[[31.4611010118,35.0044469277],"Israel",6,"Shekel","ILS","₪"],[[18.1569487765,-77.3148259327],"Jamaica",6,"Dollar","JMD","J$"],[[37.592301353,138.030895577],"Japan",6,"Yen","JPY","¥"],[[49.2183737668,-2.12689937944],"Jersey",6,"Pound","JEP","£"],[[48.1568806661,67.2914935687],"Kazakhstan",6,"Tenge","KZT","лв"],[[40.1535031093,127.192479732],"Korea (North)",6,"Won","KPW","₩"],[[36.3852398347,127.839160864],"Korea (South)",6,"Won","KRW","₩"],[[41.4622194346,74.5416551329],"Kyrgyzstan",6,"Som","KGS","лв"],[[18.5021743316,103.73772412],"Laos",6,"Kip","LAK","₭"],[[33.9230663057,35.880160715],"Lebanon",6,"Pound","LBP","£"],[[6.45278491657,-9.3220757269],"Liberia",6,"Dollar","LRD","$"],[[41.5953089336,21.6821134607],"Macedonia",6,"Denar","MKD","ден"],[[3.78986845571,109.697622843],"Malaysia",6,"Ringgit","MYR","RM"],[[-20.2776870433,57.5712055061],"Mauritius",6,"Rupee","MUR","₨"],[[23.9475372406,-102.523451692],"Mexico",6,"Peso","MXN","$"],[[46.8268154394,103.052997649],"Mongolia",6,"Tughrik","MNT","₮"],[[-17.2738164259,35.5336754259],"Mozambique",6,"Metical","MZN","MT"],[[-22.1303256842,17.209635667],"Namibia",6,"Dollar","NAD","$"],[[28.2489136496,83.9158264002],"Nepal",6,"Rupee","NPR","₨"],[[-41.811135569,171.484923466],"New Zealand",6,"Dollar","NZD","$"],[[12.8470942896,-85.0305296951],"Nicaragua",6,"Cordoba","NIO","C$"],[[9.59411452233,8.08943894771],"Nigeria",6,"Naira","NGN","₦"],[[68.7501557205,15.3483465622],"Norway",6,"Krone","NOK","kr"],[[20.6051533257,56.0916615483],"Oman",6,"Rial","OMR","﷼"],[[29.9497515031,69.3395793748],"Pakistan",6,"Rupee","PKR","₨"],[[8.51750797491,-80.1191515612],"Panama",6,"Balboa","PAB","B/."],[[-23.228239132,-58.400137032],"Paraguay",6,"Guarani","PYG","Gs"],[[-9.15280381329,-74.382426851],"Peru",6,"Sol","PEN","S/."],[[11.7753677809,122.883932529],"Philippines",6,"Piso","PHP","₱"],[[52.1275956442,19.3901283493],"Poland",6,"Zloty","PLN","zł"],[[25.3060118763,51.1847963212],"Qatar",6,"Riyal","QAR","﷼"],[[45.8524312742,24.9729303933],"Romania",6,"Leu","RON","lei"],[[61.9805220919,96.6865611231],"Russia",6,"Ruble","RUB","₽"],[[-12.4035595078,-9.5477941587],"Saint Helena",6,"Pound","SHP","£"],[[24.1224584073,44.5368627114],"Saudi Arabia",6,"Riyal","SAR","﷼"],[[44.2215031993,20.7895833363],"Serbia",6,"Dinar","RSD","Дин."],[[-4.66099093522,55.4760327912],"Seychelles",6,"Rupee","SCR","₨"],[[1.35876087075,103.81725592],"Singapore",6,"Dollar","SGD","$"],[[-8.92178021692,159.632876678],"Solomon Islands",6,"Dollar","SBD","$"],[[4.75062876055,45.7071448699],"Somalia",6,"Shilling","SOS","S"],[[-29.0003409534,25.0839009251],"South Africa",5.1,"Rand","ZAR","R"],[[7.61266509224,80.7010823782],"Sri Lanka",6,"Rupee","LKR","₨"],[[62.7796651931,16.7455804869],"Sweden",6,"Krona","SEK","kr"],[[46.7978587836,8.20867470615],"Switzerland",6,"Franc","CHF","CHF"],[[4.1305541299,-55.9123456951],"Suriname",6,"Dollar","SRD","$"],[[35.025473894,38.5078820425],"Syria",6,"Pound","SYP","£"],[[23.753992795,120.954272814],"Taiwan",6,"New Dollar","TWD","NT$"],[[15.1181579418,101.002881304],"Thailand",6,"Baht","THB","฿"],[[10.457334081,-61.2656792335],"Trinidad and Tobago",6,"Dollar","TTD","TT$"],[[39.0616029013,35.1689534649],"Turkey",6,"Lira","TRY","₺"],[[48.9965667265,31.3832646865],"Ukraine",6,"Hryvnia","UAH","₴"],[[54.1238715577,-2.86563164084],"United Kingdom",6,"Pound","GBP","£"],[[45.6795472026,-112.4616737],"United States",6,"Dollar","USD","$"],[[-32.7995153444,-56.0180705315],"Uruguay",6,"Peso","UYU","$U"],[[41.7555422527,63.1400152805],"Uzbekistan",6,"Som","UZS","лв"],[[7.12422421273,-66.1818412311],"Venezuela",6,"Bolívar","VEF","Bs"],[[16.6460167019,106.299146978],"Viet Nam",6,"Dong","VND","₫"],[[15.9092800505,47.5867618877],"Yemen",6,"Rial","YER","﷼"],[[-19.0042041882,29.8514412019],"Zimbabwe",6,"Dollar","ZWD","Z$"]],function(a){return g.object(["coordinates","country","zoom","currency","code","symbol"],a)
})),h.validates({country:{required:!0,length:{min:1,max:64}}}),h}]);var sdkModelMapTheme=angular.module("ag.sdk.model.map-theme",["ag.sdk.library","ag.sdk.model.base"]);sdkModelMapTheme.factory("MapTheme",["Base","inheritModel","Model","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e,f){function g(b){c.Base.apply(this,arguments),this.data=b&&b.data||{},a.initializeObject(this.data,"categories",[]),f.isUndefined(b)||0===arguments.length||(this.id=b.id||b.$id,this.createdAt=b.createdAt,this.createdBy=b.createdBy,this.name=b.name,this.organizationId=b.organizationId,this.updatedAt=b.updatedAt,this.updatedBy=b.updatedBy,this.organization=b.organization,h(this))}function h(a){switch(a.data.version){case void 0:a.data=f.extend({baseStyle:a.data.baseTile&&g.baseStyles[a.data.baseTile]?a.data.baseTile:"Agriculture",categories:a.data.categories,center:a.data.center,zoom:{value:a.data.zoom}},g.baseStyles[a.data.baseTile]||g.baseStyles.Agriculture)}a.data.version=g.version}return b(g,c.Base),e(g,"version",1),e(g,"baseStyles",{Agriculture:{style:"mapbox://styles/agrista/cjdmrq0wu0iq02so2sevccwlm",sources:[],layers:[]},Satellite:{style:"mapbox://styles/agrista/cjdmt8w570l3r2sql91xzgmbn",sources:[],layers:[]},Light:{style:"mapbox://styles/agrista/cjdmt9c8q0mr02srgvyfo2qwg",sources:[],layers:[]},Dark:{style:"mapbox://styles/agrista/cjdmt9w8d0o8x2so2xpcu4mm0",sources:[],layers:[]}}),g.validates({data:{required:!0,object:!0},name:{required:!0,length:{min:1,max:255}},organizationId:{required:!0,numeric:!0}}),g}]);var sdkModelFarmer=angular.module("ag.sdk.model.farmer",["ag.sdk.model.organization"]);sdkModelFarmer.provider("Farmer",["OrganizationFactoryProvider",function(a){this.$get=["Organization","Base","computedProperty","inheritModel","privateProperty","ProductionSchedule","readOnlyProperty","underscore",function(a,b,c,d,e,f,g,h){function i(d){a.apply(this,arguments),c(this,"operationTypeDescription",function(){return i.operationTypeDescriptions[this.type]||""}),b.initializeObject(this.data,"enterprises",[]),h.isUndefined(d)||0===arguments.length||(this.farms=d.farms||[],this.operationType=d.operationType,this.productionSchedules=h.map(d.productionSchedules,f.newCopy))}return d(i,a),g(i,"operationTypes",["Unknown","Commercial","Recreational","Smallholder"]),g(i,"operationTypeDescriptions",{Unknown:"No farming production information available",Commercial:"Large scale agricultural production",Recreational:"Leisure or hobby farming",Smallholder:"Small farm, limited production"}),e(i,"getOperationTypeDescription",function(a){return i.operationTypeDescriptions[a]||""}),i.validates(h.defaults({type:{required:!0,equal:{to:"farmer"}}},a.validations)),i}],a.add("farmer","Farmer")}]);var sdkModelMerchant=angular.module("ag.sdk.model.merchant",["ag.sdk.model.organization"]);sdkModelMerchant.provider("Merchant",["OrganizationFactoryProvider",function(a){this.$get=["Organization","Base","computedProperty","inheritModel","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e,f,g){function h(b){a.apply(this,arguments),c(this,"partnerTitle",function(){return i(this.partnerType)}),c(this,"subscriptionPlanTitle",function(){return j(this.subscriptionPlan)}),g.isUndefined(b)||0===arguments.length||(this.partnerType=b.partnerType,this.services=b.services||[])}function i(a){return h.partnerTypes[a]||""}function j(a){return h.subscriptionPlanTypes[a]||""}return d(h,a),f(h,"partnerTypes",{benefit:"Benefit",standard:"Standard"}),f(h,"subscriptionPlanTypes",{small:"Small",medium:"Medium",large:"Large",association:"Association"}),e(h,"getPartnerTitle",function(a){return i(a)}),e(h,"getSubscriptionPlanTitle",function(a){return j(a)}),h.validates(g.defaults({partnerType:{required:!1,inclusion:{"in":g.keys(h.partnerTypes)}},services:{required:!0,length:{min:1}},subscriptionPlan:{required:!1,inclusion:{"in":g.keys(h.subscriptionPlanTypes)}},type:{required:!0,equal:{to:"merchant"}}},a.validations)),h}],a.add("merchant","Merchant")}]);var sdkModelOrganization=angular.module("ag.sdk.model.organization",["ag.sdk.library","ag.sdk.model.base"]);sdkModelOrganization.provider("Organization",["listServiceMapProvider",function(a){this.$get=["Locale","Base","computedProperty","geoJSONHelper","inheritModel","privateProperty","readOnlyProperty","topologyHelper","underscore",function(a,b,c,d,e,f,g,h,i){function j(e){a.apply(this,arguments),c(this,"isActive",function(){return"active"===this.status}),f(this,"contains",function(a){return l(this,a)}),f(this,"centroid",function(){return k(this)}),f(this,"location",function(){var a=this.centroid();return this.data.loc?d(this.data.loc).getCenter():a?a:this.countryLocale.coordinates}),this.data=e&&e.data||{},b.initializeObject(this.data,"attachments",[]),b.initializeObject(this.data,"baseStyles",{}),i.isUndefined(e)||0===arguments.length||(this.id=e.id||e.$id,this.createdAt=e.createdAt,this.createdBy=e.createdBy,this.customerId=e.customerId,this.customerNumber=e.customerNumber,this.email=e.email,this.hostUrl=e.hostUrl,this.legalEntities=e.legalEntities||[],this.name=e.name,this.originHost=e.originHost,this.originPort=e.originPort,this.primaryContact=e.primaryContact,this.pointsOfInterest=e.pointsOfInterest||[],this.productionRegion=e.productionRegion,this.registered=e.registered,this.status=e.status,this.subscriptionPlan=e.subscriptionPlan,this.tags=e.tags||[],this.teams=e.teams||[],this.type=e.type,this.updatedAt=e.updatedAt,this.updatedBy=e.updatedBy,this.uuid=e.uuid)}function k(a){var b=m(a),c=b?b.getCentroid().getCoordinate():b;return c?[c.x,c.y]:c}function l(a,b){var c=m(a),d=h.readGeoJSON(b);return c&&d?c.contains(d):!1}function m(a){return i.chain(a.legalEntities).pluck("assets").flatten().compact().filter(function(a){return a.data&&a.data.loc}).reduce(function(a,b){var c=d(b.data.loc).geometry();return a&&c.isValid()?a.union(c):a||c},null).value()}return e(j,a),f(j,"contains",function(a,b){return l(a,b)}),f(j,"centroid",function(a){return k(a)}),f(j,"types",{farmer:"Farmer",merchant:"AgriBusiness"}),j.validates({country:{required:!0,length:{min:1,max:64}},email:{format:{email:!0}},name:{required:!0,length:{min:1,max:255}},organizationId:{numeric:!0},teams:{required:!0,length:{min:1}}}),j}],a.add("organization",["attachmentHelper","Organization","underscore",function(a,b,c){function d(a){return c.chain(a.legalEntities).map(function(a){return c.compact([a.cifKey,a.name,a.registrationNumber])}).flatten().uniq().value()}var e={danger:["Duplicate Farmland","Duplicate Legal Entities"],warning:["No CIF","No Farmland","No Homestead","No Segmentation"]};return function(f){return{id:f.id||f.$id,title:f.name,subtitle:(f.type&&b.types[f.type]||"")+(f.customerId?(f.type?": ":"")+f.customerId:""),thumbnailUrl:a.findSize(f,"thumb","img/profile-business.png"),searchingIndex:d(f),pills:c.chain(e).mapObject(function(a){return c.chain(f.tags).pluck("name").filter(function(b){return c.contains(a,b)}).value()}).omit(function(a){return c.isEmpty(a)}).value()}}}])}]),sdkModelOrganization.provider("OrganizationFactory",function(){var a={};this.add=function(b,c){a[b]=c},this.$get=["$injector","Organization",function(b,c){function d(b,d){return a[b.type]?(e(b.type),a[b.type][d](b)):c[d](b)}function e(c){a[c]&&"string"==typeof a[c]&&(a[c]=b.get(a[c]))}return{isInstanceOf:function(b){return b?(e(b.type),a[b.type]?b instanceof a[b.type]:b instanceof c):!1},"new":function(a){return d(a,"new")},newCopy:function(a){return d(a,"newCopy")}}}]});var sdkModelPointOfInterest=angular.module("ag.sdk.model.point-of-interest",["ag.sdk.library","ag.sdk.model.base"]);sdkModelPointOfInterest.provider("PointOfInterest",["listServiceMapProvider",function(a){this.$get=["inheritModel","md5Json","Model","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e,f){function g(a){c.Base.apply(this,arguments),d(this,"generateKey",function(){return this.poiKey=h(this),this.poiKey}),f.isUndefined(a)||0===arguments.length||(this.id=a.id||a.$id,this.accessAir=a.accessAir,this.accessRail=a.accessRail,this.accessRoad=a.accessRoad,this.accessSea=a.accessSea,this.addressCity=a.addressCity,this.addressCode=a.addressCode,this.addressCountry=a.addressCountry,this.addressDistrict=a.addressDistrict,this.addressStreet1=a.addressStreet1,this.addressStreet2=a.addressStreet2,this.location=a.location,this.name=a.name,this.organization=a.organization,this.organizationId=a.organizationId,this.poiKey=a.poiKey,this.type=a.type)}function h(a){return b(f.pick(a,["location","name","type"]))}a(g,c.Base);var i="Branch",j="Depot",k="Farm Gate",l="Ginnery",m="Grain Mill",n="Head Office",o="Homestead",p="Market",q="Packhouse",r="Shed",s="Silo",t="Sugar Mill",u="Tank";return e(g,"types",[i,j,k,l,m,n,o,p,q,r,s,t,u]),e(g,"organizationTypes",{farmer:[k,o,r,u],merchant:[i,j,l,m,n,p,q,s,t]}),d(g,"getOrganizationTypes",function(a){return g.organizationTypes[a]||g.organizationTypes.merchant}),g.validates({addressCity:{length:{min:1,max:255}},addressCode:{length:{min:1,max:255}},addressCountry:{length:{min:1,max:255}},addressDistrict:{length:{min:1,max:255}},addressStreet1:{length:{min:1,max:255}},addressStreet2:{length:{min:1,max:255}},location:{required:!1,object:!0},name:{required:!0,length:{min:1,max:255}},organizationId:{required:!0,numeric:!0},type:{required:!0,inclusion:{"in":g.types}}}),g}],a.add("point of interest",[function(){return function(a){return{id:a.id||a.$id,title:a.name,subtitle:a.type}}}])}]);var sdkModelProductionGroup=angular.module("ag.sdk.model.production-group",["ag.sdk.library","ag.sdk.utilities","ag.sdk.model"]);sdkModelProductionGroup.factory("ProductionGroup",["Base","computedProperty","EnterpriseBudgetBase","inheritModel","moment","naturalSort","privateProperty","ProductionSchedule","promiseService","safeArrayMath","safeMath","underscore",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(d,f){f=f||{},c.apply(this,arguments),a.initializeObject(this.data,"details",{}),a.initializeObject(this.data.details,"grossProfit",0),a.initializeObject(this.data.details,"size",0),this.commodities=[],this.productionSchedules=[],g(this,"addProductionSchedule",function(a){f.manualDateRange?a.inDateRange(this.startDate,this.endDate)&&n(this,a):((l.isUndefined(this.startDate)||e(a.startDate).isBefore(this.startDate))&&(this.startDate=e(a.startDate).format("YYYY-MM-DD")),(l.isUndefined(this.endDate)||e(a.endDate).isAfter(this.endDate))&&(this.endDate=e(a.endDate).format("YYYY-MM-DD")),n(this,a))}),g(this,"removeProductionSchedule",function(a){o(this,a)}),b(this,"costStage",function(){return this.defaultCostStage}),b(this,"options",function(){return f}),g(this,"addStock",function(a){r(this,a)}),g(this,"extractStock",function(a){return s(this,a)}),g(this,"replaceAllStock",function(a){t(this,a)}),g(this,"removeStock",function(a){u(this,a)}),g(this,"adjustCategory",function(a,b,c,d){return x(this,a,b,c,d)}),g(this,"getCategory",function(a,b,c){return l.chain(this.getSections(a,c)).pluck("productCategoryGroups").flatten().pluck("productCategories").flatten().findWhere(b).value()}),g(this,"getCategoryOptions",function(a){return l.chain(this.productionSchedules).map(function(b){return b.getCategoryOptions(a)}).reduce(function(a,b){return l.extend(a||{},b)},{}).value()}),g(this,"addCategory",function(a,b,c,d){return v(this,a,b,c,d)}),g(this,"removeCategory",function(a,b,c,d){w(this,a,b,c,d)}),g(this,"recalculate",function(){z(this)}),g(this,"recalculateCategory",function(a,b,c,d){A(this,a,b,c,d)}),b(this,"allocatedSize",function(){return k.round(this.data.details.size||0,2)}),b(this,"numberOfMonths",function(){return e(this.endDate).diff(this.startDate,"months")}),b(this,"startDateOffset",function(){return Math.max(0,e(l.chain(this.productionSchedules).sortBy(function(a){return e(a.startDate).unix()}).pluck("startDate").first().value()).diff(this.startDate,"months"))}),b(this,"endDateOffset",function(){return k.minus(this.numberOfMonths-1,Math.max(0,e(this.endDate).diff(l.chain(this.productionSchedules).sortBy(function(a){return e(a.endDate).unix()}).pluck("endDate").last().value(),"months")))}),l.isUndefined(d)||0===arguments.length||(f.startDate&&f.endDate?(f.manualDateRange=!0,this.startDate=e(f.startDate).format("YYYY-MM-DD"),this.endDate=e(f.endDate).format("YYYY-MM-DD")):(this.startDate=d.startDate&&e(d.startDate).format("YYYY-MM-DD"),this.endDate=d.endDate&&e(d.endDate).format("YYYY-MM-DD")),this.replaceAllStock(d.stock||[]),l.each(d.productionSchedules,this.addProductionSchedule,this),this.recalculate())}function n(a,b){a.productionSchedules.push(b),p(a),b.replaceAllStock(a.stock)}function o(a,b){a.productionSchedules=l.without(a.productionSchedules,b),p(a)}function p(a){a.commodities=l.chain(a.productionSchedules).pluck("commodityType").uniq().compact().value().sort(f),a.data.details.size=j.reduceProperty(a.productionSchedules,"allocatedSize")}function q(a,b){l.each(l.isArray(b)?b:[b],function(b){r(a,b)})}function r(a,b){b&&l.isArray(b.data.ledger)&&(a.stock=l.chain(a.stock).reject(function(a){return a.assetKey===b.assetKey}).union([b]).value(),l.each(a.productionSchedules,function(a){a.addStock(b)}))}function s(a,b){return l.each(a.productionSchedules,function(c){q(a,c.extractStock(b))}),a.stock}function t(a,b){a.stock=l.filter(b,function(a){return a&&l.isArray(a.data.ledger)}),l.each(a.productionSchedules,function(a){a.replaceAllStock(b)})}function u(a,b){a.stock=l.chain(a.stock).reject(function(a){return a.assetKey===b.assetKey}).value(),l.each(a.productionSchedules,function(a){a.removeStock(b)})}function v(a,b,d,e,g){var h=a.getCategory(b,e,g);if(l.isUndefined(h)){var i=a.addGroup(b,a.findGroupNameByCategory(b,d,e.code),g);if(h=l.extend({quantity:0,value:0},c.categories[e.code]),"EXP"===b&&(h.unit="Total"),e.name&&(h.name=e.name),h.per="livestock"===a.assetType?"LSU":"ha","livestock"===this.assetType){var j=a.getConversionRate(h.name);j&&(h.conversionRate=j),h.valuePerLSU=0}i.productCategories=l.union(i.productCategories,[h]).sort(function(d,e){return"livestock"===a.assetType&&"INC"===b?f(c.getCategorySortKey(d.name),c.getCategorySortKey(e.name)):f(d.name,e.name)}),a.setCache([h.code,g],h)}return h}function w(a,b,c,d,e){c=a.findGroupNameByCategory(b,c,d.code);var f=a.getGroup(b,c,e);f&&(f.productCategories=l.reject(f.productCategories,function(a){return l.every(d,function(b,c){return a[c]===b})}),a.resetCache([d.code,e]))}function x(b,c,d,e,f){var g=b.getCategory(c,d,e),h=0;if(g&&!l.isUndefined(g[f])){var i=l.chain(b.productionSchedules).filter(function(a){return l.some(g.categories,function(b){return a.scheduleKey===b.scheduleKey})}).uniq(!1,function(a){return a.scheduleKey}).indexBy("scheduleKey").value(),m=l.chain(i).pluck("budget").uniq(!1,l.iteratee("uuid")).value(),n={quantity:"quantityPerMonth",value:"valuePerMonth",quantityPerHa:"quantity",valuePerHa:"value"},o=n[f]||f;switch(f){case"stock":l.each(i,function(a){a.adjustCategory(c,d,a.costStage,f)});break;case"quantity":case"value":if(h=k.round(j.reduce(g[o]),2),0===h){var p=j.reduce(g.categoriesPerMonth);g[o]=l.reduce(g.categoriesPerMonth,function(a,b,c){return a[c]=k.dividedBy(k.times(b,g[f]),p),a},a.initializeArray(b.numberOfMonths)),f=o}else l.each(i,function(a){var b=a.getCategory(c,d.code,a.costStage);b&&(b[f]=k.dividedBy(k.times(b[f],g[f]),h),a.adjustCategory(c,d,a.costStage,f))});break;case"quantityPerHa":case"valuePerHa":h=k.round(k.dividedBy(j.reduce(g[o+"PerHaPerMonth"]),j.count(g[o+"PerHaPerMonth"])),2),g[o+"PerHaPerMonth"]=l.reduce(g[o+"PerHaPerMonth"],function(a,b,c){return a[c]=0===h?k.dividedBy(g[f],m.length):k.dividedBy(k.times(b,g[f]),h),a},a.initializeArray(b.numberOfMonths)),g[o+"PerMonth"]=j.round(j.times(g[o+"PerHaPerMonth"],g.haPerMonth),2),f=o+"PerMonth"}if(l.contains(["quantityPerMonth","valuePerMonth"],f)){var q=l.reduce(g.categories,function(a,b){return j.plus(a,b[f])},a.initializeArray(b.numberOfMonths));h=j.reduce(q);var r=l.reduce(g.categories,function(a,b){return j.plus(a,l.map(b[f],function(a){return 0!==a?1:0}))},a.initializeArray(b.numberOfMonths));l.each(g.categories,function(a){var b=i[a.scheduleKey],e=b&&b.getCategory(c,d.code,b.costStage);e&&(l.reduce(g[f],function(b,c,d){if(c!==q[d]){var e=d-a.offset,f=0!==r[d]?r[d]:g.categoriesPerMonth[d];e>=0&&e<b.length&&(0===r[d]||b[e]>0)&&(b[e]=k.dividedBy(c,f))}return b},e[f]),b.adjustCategory(c,d,b.costStage,f),l.each(i,function(a){a.budgetUuid===b.budgetUuid&&a.scheduleKey!==b.scheduleKey&&a.recalculateCategory(d.code)}))})}A(b,c,g.groupBy,d,e)}}function y(a){return function(b,c,d){var e=d+a;return e>=0&&e<b.length&&(b[e]=k.plus(b[e],c)),b}}function z(a){a.data.sections=[],a.clearCache(),l.each(a.productionSchedules,function(b){var c=e(b.startDate).diff(a.startDate,"months");b.recalculate(),l.each(b.data.sections,function(d){d.costStage===b.costStage&&(l.each(d.productCategoryGroups,function(e){l.each(e.productCategories,function(f){D(a,b,c,d,e,f)}),C(a,b,d,e)}),B(a,b,d))})}),a.addSection("INC"),a.addSection("EXP"),a.sortSections(),a.data.details.grossProfit=l.reduce(a.data.sections,function(a,b){return"INC"===b.code?k.plus(a,b.total.value):k.minus(a,b.total.value)},0)}function A(a,b,c,d,f){a.removeCategory(b,c,d,f),l.each(a.productionSchedules,function(b){b.recalculateCategory(d.code),l.each(b.data.sections,function(c){c.costStage===b.costStage&&l.each(c.productCategoryGroups,function(f){var g=l.findWhere(f.productCategories,d);if(g){var h=e(b.startDate).diff(a.startDate,"months");D(a,b,h,c,f,g),C(a,b,c,f),B(a,b,c)}})})}),a.data.details.grossProfit=l.reduce(a.data.sections,function(a,b){return"INC"===b.code?k.plus(a,b.total.value):k.minus(a,b.total.value)},0)}function B(a,b,c){var d=a.getSection(c.code,a.defaultCostStage);d&&(d.total.value=l.reduce(d.productCategoryGroups,function(a,b){return k.plus(a,b.total.value)},0),d.total.valuePerMonth=l.chain(d.productCategoryGroups).pluck("total").pluck("valuePerMonth").reduce(function(a,b){return a?l.map(b,function(b,c){return k.plus(a[c],b)}):angular.copy(b)}).value(),"livestock"===b.type&&(d.total.valuePerLSU=l.reduce(d.productCategoryGroups,function(a,b){return k.plus(a,b.total.valuePerLSU)},0)),a.data.details.grossProfit="INC"===d.code?k.plus(a.data.details.grossProfit,d.total.value):k.minus(a.data.details.grossProfit,d.total.value))}function C(a,b,c,d){var e=a.getGroup(c.code,d.name,a.defaultCostStage);e&&(e.total.value=j.reduceProperty(e.productCategories,"value"),e.total.valuePerMonth=l.chain(e.productCategories).pluck("valuePerMonth").reduce(function(a,b){return a?l.map(b,function(b,c){return k.plus(a[c],b)}):angular.copy(b)}).value(),"livestock"===b.type&&(e.total.valuePerLSU=j.reduceProperty(e.productCategories,"valuePerLSU")))}function D(b,c,d,e,f,g){var h=b.addCategory(e.code,f.name,l.pick(g,["code","name"]),b.defaultCostStage),i="INC-LSS"===f.code?"livestock":"stock",m=c.data.details.commodity;h.name=l.contains(["INC-CPS-CROP","INC-FRS-FRUT"],h.code)?m:h.name;var n=b.findStock(i,h.name,m),o=l.extend({commodity:c.commodityType,offset:d,scheduleKey:c.scheduleKey},g);h.per=g.per,h.categories=h.categories||[],h.categories.push(o),n&&(h.stock=h.stock||n),h.categoriesPerMonth=j.plus(l.reduce(a.initializeArray(b.numberOfMonths,1),y(d),a.initializeArray(b.numberOfMonths)),h.categoriesPerMonth||a.initializeArray(b.numberOfMonths)),o.valuePerMonth=l.reduce(g.valuePerMonth,y(d),a.initializeArray(b.numberOfMonths)),o.value=k.round(j.reduce(o.valuePerMonth),2),h.valuePerMonth=j.plus(o.valuePerMonth,h.valuePerMonth||a.initializeArray(b.numberOfMonths)),h.value=k.round(j.reduce(h.valuePerMonth),2),o.quantityPerMonth=l.reduce(g.quantityPerMonth,y(d),a.initializeArray(b.numberOfMonths)),o.quantity=k.round(j.reduce(o.quantityPerMonth),2),h.quantityPerMonth=j.plus(o.quantityPerMonth,h.quantityPerMonth||a.initializeArray(b.numberOfMonths)),h.quantity=k.round(j.reduce(h.quantityPerMonth),2),o.supplyPerMonth&&(o.supplyPerMonth=l.reduce(g.supplyPerMonth,y(d),a.initializeArray(b.numberOfMonths)),o.supply=k.round(j.reduce(o.supplyPerMonth),2),h.supplyPerMonth=j.plus(o.supplyPerMonth,h.supplyPerMonth||a.initializeArray(b.numberOfMonths)),h.supply=k.round(j.reduce(h.supplyPerMonth),2)),o.pricePerUnit=k.round(k.dividedBy(k.dividedBy(o.value,o.supply||1),o.quantity),4),h.pricePerUnit=k.round(k.dividedBy(k.dividedBy(h.value,h.supply||1),h.quantity),4),"livestock"===c.type?(o.valuePerLSU=k.dividedBy(k.times(o.value,g.valuePerLSU),g.value),o.quantityPerLSU=k.dividedBy(k.times(o.quantity,g.quantityPerLSU),g.quantity),h.valuePerLSU=k.plus(h.valuePerLSU,o.valuePerLSU),h.quantityPerLSU=k.plus(h.quantityPerLSU,o.quantityPerLSU)):(o.haPerMonth=l.reduce(a.initializeArray(b.numberOfMonths,c.allocatedSize),y(d),a.initializeArray(b.numberOfMonths)),h.haPerMonth=j.plus(o.haPerMonth,h.haPerMonth||a.initializeArray(b.numberOfMonths)),h.valuePerHaPerMonth=j.round(j.dividedBy(h.valuePerMonth,h.haPerMonth),2),h.quantityPerHaPerMonth=j.round(j.dividedBy(h.quantityPerMonth,h.haPerMonth),3),h.valuePerHa=k.round(k.dividedBy(j.reduce(h.valuePerHaPerMonth),j.count(h.valuePerHaPerMonth)),2),h.quantityPerHa=k.round(k.dividedBy(j.reduce(h.quantityPerHaPerMonth),j.count(h.quantityPerHaPerMonth)),3))}return d(m,c),m}]);var sdkModelProductionSchedule=angular.module("ag.sdk.model.production-schedule",["ag.sdk.library","ag.sdk.utilities","ag.sdk.model"]);sdkModelProductionSchedule.factory("ProductionSchedule",["AssetFactory","Base","computedProperty","EnterpriseBudget","EnterpriseBudgetBase","Field","inheritModel","Livestock","moment","privateProperty","promiseService","readOnlyProperty","safeArrayMath","safeMath","underscore",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(f){e.apply(this,arguments),b.initializeObject(this.data,"activities",[]),b.initializeObject(this.data,"details",{}),c(this,"costStage",function(){return"horticulture"!==this.type||0!==this.data.details.assetAge?this.defaultCostStage:o.first(p.costStages)}),j(this,"setDate",function(a){a=i(a).date(1),this.startDate=a.format("YYYY-MM-DD");var b=12/Math.floor(12/this.numberOfAllocatedMonths),c=this.budget?b*Math.floor((a.month()-this.budget.cycleStart)/b)+this.budget.cycleStart:a.month(),d=i([a.year()]).add(c,"M");if(this.startDate=d.format("YYYY-MM-DD"),this.endDate=d.add(1,"y").format("YYYY-MM-DD"),"horticulture"===this.type){a=i(this.startDate),this.data.details.establishedDate=o.isUndefined(this.data.details.establishedDate)?o.chain(this.assets).map(function(a){return a.data.establishedDate}).union([this.startDate]).compact().first().value():this.data.details.establishedDate;var e=a.isAfter(this.data.details.establishedDate)?a.diff(this.data.details.establishedDate,"years"):0;e!==this.data.details.assetAge&&(this.data.details.assetAge=e,this.recalculate())}}),j(this,"addAsset",function(b){b=a["new"](b),b.$local=!0,this.assets=o.chain(this.assets).reject(o.identity({assetKey:b.assetKey})).union([b]).value(),1===o.size(this.assets)&&q(this,b),this.recalculateSize()}),j(this,"removeAsset",function(a){var b=o.findWhere(this.assets,{assetKey:a.assetKey});b&&(b.$delete=!0),this.recalculateSize()}),j(this,"setBudget",function(a){this.budget=d["new"](o.omit(a,["followers","organization","region","user","userData"])),this.budgetUuid=this.budget.uuid,this.type=this.budget.assetType,this.data.budget=this.budget,this.data.details=o.extend(this.data.details,{commodity:this.budget.commodityType,grossProfit:0}),this.data.details="livestock"===this.type?o.defaults(this.data.details,{calculatedLSU:0,grossProfitPerLSU:0,herdSize:this.budget.data.details.herdSize||0,stockingDensity:0,multiplicationFactor:0}):o.extend(this.data.details,o.pick(this.budget.data.details,"horticulture"===this.type?["maturityFactor","cultivar","seedProvider"]:["cultivar","seedProvider"])),this.data.details.pastureType&&this.budget.data.details.stockingDensity&&this.setLivestockStockingDensity(this.budget.data.details.stockingDensity[this.data.details.pastureType]),this.recalculate(),this.startDate&&this.setDate(this.startDate)}),j(this,"setLivestockStockingDensity",function(a){"livestock"===this.type&&this.data.details.stockingDensity!==a&&(this.data.details.stockingDensity=a,this.setSize(this.allocatedSize))}),j(this,"setSize",function(a){this.data.details.size=a,"livestock"===this.type?(this.data.details.calculatedLSU=n.dividedBy(this.allocatedSize,this.data.details.stockingDensity),this.budget&&(this.data.details.multiplicationFactor=this.budget.data.details.herdSize?n.dividedBy(this.data.details.herdSize,this.budget.data.details.herdSize):1,this.data.details.grossProfit=n.times(this.budget.data.details.grossProfit,this.data.details.multiplicationFactor),this.data.details.grossProfitPerLSU=this.data.details.calculatedLSU?n.dividedBy(this.data.details.grossProfit,this.data.details.calculatedLSU):0)):this.budget&&(this.data.details.grossProfit=n.times(this.budget.data.details.grossProfit,this.data.details.size)),this.recalculate()}),j(this,"adjustCategory",function(a,b,c,d){return r(this,a,b,c,d)}),j(this,"extractStock",function(a){return t(this,a)}),j(this,"updateCategoryStock",function(a,b,c,d){w(this,a,b,c,d)}),j(this,"applyMaturityFactor",function(a,b){var c="horticulture"===this.type&&"Yearly"===this.costStage&&this.data.details.maturityFactor&&this.data.details.maturityFactor[a]?this.data.details.maturityFactor[a][this.data.details.assetAge-1]||0:100;return n.chain(b).times(c).dividedBy(100).toNumber()}),j(this,"reverseMaturityFactor",function(a,b){var c="horticulture"===this.type&&"Yearly"===this.costStage&&this.data.details.maturityFactor&&this.data.details.maturityFactor[a]?this.data.details.maturityFactor[a][this.data.details.assetAge-1]||0:100;return n.chain(b).times(100).dividedBy(c).toNumber()}),j(this,"recalculate",function(){y(this)}),j(this,"recalculateCategory",function(a){z(this,a)}),j(this,"recalculateSize",function(){var a=n.round(o.chain(this.assets).reject({$delete:!0}).reduce(function(a,b){return n.plus(a,b.data.plantedArea||b.data.size)},0).value(),2);a!==this.data.details.size&&(this.setSize(a),this.$dirty=!0)}),c(this,"scheduleKey",function(){return(this.budgetUuid?this.budgetUuid+"-":"")+(this.startDate?i(this.startDate).unix()+"-":"")+(this.endDate?i(this.endDate).unix():"")},{enumerable:!0}),c(this,"assetType",function(){return this.budget?this.budget.assetType:this.type}),c(this,"commodityType",function(){return this.budget?this.budget.commodityType:this.data.details.commodity}),c(this,"allocatedSize",function(){return n.round(this.data.details.size,2)}),c(this,"title",function(){return E(this)}),c(this,"numberOfMonths",function(){return i(this.endDate).diff(this.startDate,"months")}),j(this,"getAllocationIndex",function(a,b){return this.budget?this.budget.getAllocationIndex(a,b):0}),j(this,"getLastAllocationIndex",function(a,b){return this.budget?this.budget.getLastAllocationIndex(a,b):this.numberOfMonths}),j(this,"getAllocationMonth",function(a,b){return i(this.startDate).add(this.getAllocationIndex(a,b),"M")}),j(this,"getLastAllocationMonth",function(a,b){return i(this.startDate).add(this.getLastAllocationIndex(a,b),"M")}),c(this,"numberOfAllocatedMonths",function(){return this.budget?this.budget.numberOfAllocatedMonths:this.numberOfMonths}),j(this,"inDateRange",function(a,b){a=i(a),b=i(b);var c=i(this.startDate),d=i(this.endDate);return c.isSame(a)&&d.isSame(b)||c.isSameOrAfter(a)&&c.isBefore(b)||d.isAfter(a)&&d.isSameOrBefore(b)}),c(this,"income",function(){return o.findWhere(this.data.sections,{code:"INC",costStage:this.costStage})}),c(this,"expenses",function(){return o.findWhere(this.data.sections,{code:"EXP",costStage:this.costStage})}),o.isUndefined(f)||0===arguments.length||(b.initializeObject(this.data,"budget",f.budget),this.id=f.id||f.$id,this.assets=o.map(f.assets||[],a["new"]),this.budgetUuid=f.budgetUuid,this.endDate=f.endDate&&i(f.endDate).format("YYYY-MM-DD"),this.organization=f.organization,this.organizationId=f.organizationId,this.startDate=f.startDate&&i(f.startDate).format("YYYY-MM-DD"),this.type=f.type,this.assetId=o.chain(this.assets).pluck("id").first().value(),this.data.budget&&(this.budget=d["new"](this.data.budget)))}function q(a,b){if(a.type=p.typeByAsset[b.type],a.data.details.irrigated=b.data.irrigated===!0,a.assetId=b.id,b.data.crop&&"livestock"!==a.type&&(a.data.details.commodity=b.data.crop),"horticulture"===a.type){var c=i(a.startDate);a.data.details.establishedDate=b.data.establishedDate||a.startDate,a.data.details.assetAge=c.isAfter(a.data.details.establishedDate)?c.diff(a.data.details.establishedDate,"years"):0}else"livestock"===a.type&&(a.data.details.pastureType=b.data.intensified?"pasture":"grazing",a.budget&&a.budget.data.details.stockingDensity&&a.setLivestockStockingDensity(a.budget.data.details.stockingDensity[a.data.details.pastureType]))}function r(a,c,d,e,f){var g=o.isObject(d)?d.code:d,h=a.getCategory(c,g,e),i=a.budget.getCategory(c,g,e),j=f;if(h&&i){switch(f){case"pricePerUnit":i.pricePerUnit=h.pricePerUnit;break;case"quantity":i.quantity=n.dividedBy(a.reverseMaturityFactor(c,h.quantity),"livestock"===a.type?a.data.details.multiplicationFactor:a.allocatedSize);break;case"quantityPerHa":i.quantity=a.reverseMaturityFactor(c,h.quantityPerHa),j="quantity";break;case"quantityPerLSU":i.quantityPerLSU=h.quantityPerLSU;break;case"stock":h.name=o.contains(["INC-CPS-CROP","INC-FRS-FRUT"],g)?a.commodityType:h.name;var k=s.include(g,"INC-LSS")?"livestock":"stock",l=a.findStock(k,h.name,a.commodityType),p=[a.scheduleKey,"INC"===c?"Sale":"Consumption"].join("/"),q=["quantity","quantityPerMonth"];o.extend(i,o.chain(l.inventoryInRange(a.startDate,a.endDate)).reduce(function(a,b,c){return o.chain(b.entries).filter(function(a){return s.include(a.reference,p)}).each(function(b){i.supplyUnit&&b.quantityUnit===i.supplyUnit&&(a.supply=n.plus(a.supply,b.quantity),a.quantity=n.plus(a.quantity,b.rate)),a.valuePerMonth[c]=n.plus(a.valuePerMonth[c],b.value)}),a},{valuePerMonth:b.initializeArray(a.budget.numberOfMonths)}).mapObject(function(b,d){return o.contains(q,d)?b:o.isArray(b)?a.budget.unshiftMonthlyArray(o.map(b,function(b){return n.dividedBy(a.reverseMaturityFactor(c,b),"livestock"===a.type?a.data.details.multiplicationFactor:a.allocatedSize)})):n.dividedBy(a.reverseMaturityFactor(c,b),"livestock"===a.type?a.data.details.multiplicationFactor:a.allocatedSize)}).value()),u(a,l),j="valuePerMonth";break;case"supply":i.supply=n.dividedBy(h.supply,"livestock"===a.type?a.data.details.multiplicationFactor:a.allocatedSize);break;case"value":i.value=n.dividedBy(a.reverseMaturityFactor(c,h.value),"livestock"===a.type?a.data.details.multiplicationFactor:a.allocatedSize);break;case"valuePerHa":i.value=a.reverseMaturityFactor(c,h.valuePerHa),j="value";break;case"valuePerLSU":i.valuePerLSU=h.valuePerLSU;break;case"valuePerMonth":var r=m.count(h.valuePerMonth),t=0;i.value=n.round(n.dividedBy(a.reverseMaturityFactor(c,m.reduce(h.valuePerMonth)),"livestock"===a.type?a.data.details.multiplicationFactor:a.allocatedSize),4),i.valuePerMonth=a.budget.unshiftMonthlyArray(o.reduce(h.valuePerMonth,function(b,d,e){return d>0&&(b[e]=e===b.length-1||t===r-1?n.minus(i.value,m.reduce(b)):n.round(n.dividedBy(a.reverseMaturityFactor(c,d),"livestock"===a.type?a.data.details.multiplicationFactor:a.allocatedSize),4),t++),b},b.initializeArray(a.budget.numberOfMonths)));break;default:i[f]=h[f]}return a.budget.adjustCategory(c,g,e,j),z(a,g),"stock"!==f&&w(a,c,g),a.$dirty=!0,h[f]}}function t(a,b){var c=i(a.startDate);return o.isFunction(b)&&(o.each(a.data.sections,function(e){o.each(e.productCategoryGroups,function(f){if(o.each(f.productCategories,function(c){if(o.contains(d.stockableCategoryCodes,c.code)){var g="INC-LSS"===f.code?"livestock":"stock",h="Total"===c.unit?void 0:c.unit,i="INC"===e.code?a.commodityType:void 0;c.name=o.contains(["INC-CPS-CROP","INC-FRS-FRUT"],c.code)?a.commodityType:c.name;var j=b(g,i,c.name,h,c.supplyUnit);"livestock"===g&&c.value&&o.isUndefined(j.data.pricePerUnit)&&(j.data.pricePerUnit=n.dividedBy(c.value,c.supply||1),j.$dirty=!0),a.updateCategoryStock(e.code,c.code,j),a.addStock(j)}}),"INC-LSS"===f.code){var g=a.getRepresentativeAnimal(),j=o.findWhere(a.getGroupCategoryOptions("INC","Livestock Sales"),{name:g}),k=a.birthAnimal,l=o.findWhere(a.getGroupCategoryOptions("INC","Livestock Sales"),{name:k}),m=o.findWhere(a.getGroupCategoryOptions("INC","Livestock Sales"),{name:h.getWeanedAnimal(a.commodityType)});
if(!o.isUndefined(j)&&!o.isUndefined(l)&&!o.isUndefined(m)){var p=b("livestock",a.commodityType,g,j.unit,j.supplyUnit),q=b("livestock",a.commodityType,k,l.unit,l.supplyUnit),r=b("livestock",a.commodityType,m.name,m.unit,m.supplyUnit),s=o.first(q.data.ledger),t={Retain:q,Retained:r};p.data.openingBalance!==a.data.details.herdSize&&(o.isUndefined(s)||i(a.startDate).isSameOrBefore(s.date))&&(p.data.openingBalance=a.data.details.herdSize,p.$dirty=!0),a.budget.addCategory("INC","Livestock Sales",j.code,a.costStage),a.budget.addCategory("INC","Livestock Sales",l.code,a.costStage),a.budget.addCategory("INC","Livestock Sales",m.code,a.costStage),o.each(o.keys(a.budget.data.events).sort(),function(b){var d=a.budget.shiftMonthlyArray(a.budget.data.events[b]);o.each(d,function(d,e){if(d>0){var f=i(c).add(e,"M").format("YYYY-MM-DD"),g=p.inventoryBefore(f),h=q.findLedgerEntry({date:f,action:b,reference:a.scheduleKey}),j=[a.scheduleKey,b,f].join("/"),l=Math.floor(n.chain(d).times(g.closing.quantity).dividedBy(100).toNumber()),m=n.times(l,q.data.pricePerUnit);if(o.isUndefined(h)?q.addLedgerEntry({action:b,commodity:a.commodityType,date:f,price:q.data.pricePerUnit,priceUnit:q.data.quantityUnit,quantity:l,quantityUnit:q.data.quantityUnit,reference:j,value:m}):q.setLedgerEntry(h,{commodity:a.commodityType,price:q.data.pricePerUnit,priceUnit:q.data.quantityUnit,quantity:l,quantityUnit:q.data.quantityUnit,reference:j,value:m}),"Death"===b){var r=[a.scheduleKey,"Retain:"+k,f].join("/");q.removeLedgerEntriesByReference(r);var s=q.inventoryBefore(f);o.each(o.keys(t),function(b){var c=t[b],d=c.findLedgerEntry(r),e=s.closing.value||n.times(c.data.pricePerUnit,s.closing.quantity);o.isUndefined(d)?c.addLedgerEntry({action:b+":"+k,commodity:a.commodityType,date:f,price:c.data.pricePerUnit,priceUnit:c.data.quantityUnit,quantity:s.closing.quantity,quantityUnit:c.data.quantityUnit,reference:r,value:e}):q.setLedgerEntry(d,{commodity:a.commodityType,price:c.data.pricePerUnit,priceUnit:c.data.quantityUnit,quantity:s.closing.quantity,quantityUnit:c.data.quantityUnit,reference:r,value:e})})}}})}),a.addStock(p),a.addStock(q),a.addStock(r)}}})}),o.chain(a.data.activities).where({type:"delivery"}).each(function(c){var d="Deliver",e="livestock"===a.assetType?"livestock":"stock",f=c.unit,g=a.commodityType,h=b(e,g,a.commodityType,f),i=[a.scheduleKey,d,c.id].join("/"),j=h.findLedgerEntry(i),k=h.marketPriceAtDate(c.date),l=n.times(k,c.quantity),m=c.commodity||a.commodityType;o.isUndefined(j)?h.addLedgerEntry({action:d,commodity:m,date:c.date,delivery:c,price:k,priceUnit:c.unit,quantity:c.quantity,quantityUnit:c.unit,reference:i,value:l}):h.setLedgerEntry(j,{commodity:m,delivery:c,price:k,priceUnit:c.unit,quantity:c.quantity,quantityUnit:c.unit,reference:i,value:l}),a.addStock(h)})),a.stock}function u(a,b){if(b){var c=b.data.category,d=[a.scheduleKey,"Deliver"].join("/"),e=o.where(a.data.activities,{commodity:c,type:"delivery"});o.chain(b.data.ledger).filter(function(a){return s.include(a.reference,d)&&!o.isUndefined(a.delivery)}).each(function(b){e=o.reject(e,o.identity({id:b.delivery.id})),a.data.activities=o.chain(a.data.activities).reject(o.identity({id:b.delivery.id})).union([b.delivery]).value()}),a.data.activities=o.reject(a.data.activities,function(a){return o.some(e,function(b){return a.id===b.id})})}}function v(a,b,c,d,e,f,g,h){var i=[a.scheduleKey,e,d].join("/");if(h=o.defaults(h||{},{overwrite:!1}),o.isUndefined(c))c=o.extend({action:e,date:d,commodity:a.commodityType,reference:i,value:f.valuePerMonth[g]},"Total"===f.unit?{}:o.extend({price:f.pricePerUnit,priceUnit:f.unit},o.isUndefined(f.supplyPerMonth)?{quantity:f.quantityPerMonth[g],quantityUnit:f.unit}:{quantity:f.supplyPerMonth[g],quantityUnit:f.supplyUnit,rate:f.quantity})),b.addLedgerEntry(c,h);else if((!c.edited||h.overwrite)&&(b.setLedgerEntry(c,o.extend({commodity:a.commodityType,reference:i,value:f.valuePerMonth[g]},"Total"===f.unit?{}:o.extend({price:f.pricePerUnit,priceUnit:f.unit},o.isUndefined(f.supplyPerMonth)?{quantity:f.quantityPerMonth[g],quantityUnit:f.unit}:{quantity:f.supplyPerMonth[g],quantityUnit:f.supplyUnit,rate:f.quantity})),h),c.liabilityUuid)){var j=o.findWhere(b.liabilities,{uuid:c.liabilityUuid});x(j,f.name,d,e,f.valuePerMonth[g])}return c}function w(a,b,c,d,e){var f=a.getCategory(b,c,a.costStage),g=s.include(c,"INC-LSS")?"livestock":"stock",h={overwrite:e===!0,recalculate:!1};if(f&&(f.name=o.contains(["INC-CPS-CROP","INC-FRS-FRUT"],f.code)?a.commodityType:f.name,d=d||a.findStock(g,f.name,a.commodityType))){var j="INC"===b?"Production":"Purchase",k="INC"===b?"Sale":"Consumption",l=o.chain(f.valuePerMonth).reduce(function(b,c,e){if(0===c&&o.size(d.data.ledger)>0){var f=i(a.startDate).add(e,"M").format("YYYY-MM-DD"),g=d.findLedgerEntry({date:f,action:j,reference:a.scheduleKey}),l=d.findLedgerEntry({date:f,action:k,reference:a.scheduleKey});g&&g.liabilityUuid&&b.push(o.findWhere(d.liabilities,{uuid:g.liabilityUuid})),d.removeLedgerEntry(g,h),d.removeLedgerEntry(l,h)}return b},[]).compact().value();d.recalculateLedger(),o.each(f.valuePerMonth,function(c,e){if(c>0){var g=i(a.startDate).add(e,"M").format("YYYY-MM-DD"),m=d.findLedgerEntry({date:g,action:j,reference:a.scheduleKey}),n=d.findLedgerEntry({date:g,action:k,reference:a.scheduleKey});if(("EXP"===b||"livestock"!==a.assetType)&&(m=v(a,d,m,g,j,f,e,h),o.size(l)>0&&o.isUndefined(m.liabilityUuid)&&"Purchase"===j)){var p=l.shift();x(p,f.name,g,j,c),m.liabilityUuid=p.uuid}v(a,d,n,g,k,f,e,h)}}),d.recalculateLedger({checkEntries:!0})}}function x(a,b,c,d,e){var f=b+" "+d+" "+c;!a||a.name===f&&a.creditLimit===e&&a.openingDate===c||(a.name=f,a.creditLimit=e,a.openingDate=c,a.startDate=c,a.resetWithdrawals(),a.setWithdrawalInMonth(e,c),a.$dirty=!0)}function y(a){a.budget&&(a.budget.recalculate(),a.data.sections=[],a.clearCache(),o.each(a.budget.data.sections,function(b){b.costStage===a.costStage&&(o.each(b.productCategoryGroups,function(c){o.each(c.productCategories,function(d){D(a,b,c,d)}),C(a,b,c)}),B(a,b))}),a.sortSections(),A(a))}function z(a,b){a.budget&&(a.budget.recalculateCategory(b),o.each(a.budget.data.sections,function(c){c.costStage===a.costStage&&o.each(c.productCategoryGroups,function(d){o.each(d.productCategories,function(e){e.code===b&&(a.resetCache([e.code,c.costStage]),a.resetCache([d.name,c.costStage]),a.resetCache([c.code,c.costStage]),D(a,c,d,e),C(a,c,d),B(a,c))})})}),A(a))}function A(a){a.data.details.grossProfit=o.reduce(a.data.sections,function(a,b){return"INC"===b.code?n.plus(a,b.total.value):n.minus(a,b.total.value)},0),"livestock"===a.type&&(a.data.details.grossProfitPerLSU=n.dividedBy(a.data.details.grossProfit,a.data.details.calculatedLSU))}function B(a,b){var c=a.getSection(b.code,b.costStage);c&&(c.total.value=o.reduce(c.productCategoryGroups,function(a,b){return n.plus(a,b.total.value)},0),c.total.valuePerMonth=o.chain(c.productCategoryGroups).pluck("total").pluck("valuePerMonth").reduce(function(a,b){return a?o.map(b,function(b,c){return n.plus(a[c],b)}):angular.copy(b)}).value(),c.total.quantityPerMonth=o.chain(c.productCategoryGroups).pluck("total").pluck("quantityPerMonth").reduce(function(a,b){return a?o.map(b,function(b,c){return n.plus(a[c],b)}):angular.copy(b)}).value(),"livestock"===a.type&&(c.total.valuePerLSU=o.reduce(c.productCategoryGroups,function(a,b){return n.plus(a,b.total.valuePerLSU)},0)))}function C(a,b,c){var d=a.getGroup(b.code,c.name,b.costStage);d&&(d.total.value=o.reduce(d.productCategories,function(a,b){return n.plus(a,b.value)},0),d.total.valuePerMonth=o.chain(d.productCategories).pluck("valuePerMonth").reduce(function(a,b){return a?o.map(b,function(b,c){return n.plus(a[c],b)}):angular.copy(b)}).value(),d.total.quantityPerMonth=o.chain(d.productCategories).pluck("quantityPerMonth").reduce(function(a,b){return a?o.map(b,function(b,c){return n.plus(a[c],b)}):angular.copy(b)}).value(),"livestock"===a.type&&(d.total.valuePerLSU=o.reduce(d.productCategories,function(a,b){return n.plus(a,b.valuePerLSU)},0)))}function D(a,b,c,d){var e=a.addCategory(b.code,c.name,d.code,b.costStage);e.name=d.name,e.pricePerUnit=d.pricePerUnit,"livestock"===a.type?(e.valuePerLSU=n.plus(e.valuePerLSU,n.times(d.valuePerLSU,a.data.details.multiplicationFactor)),e.quantityPerLSU=d.quantity,"INC-LSS"===c.code&&(e.stock=o.isUndefined(d.stock)?d.name===a.getRepresentativeAnimal()?a.data.details.herdSize:0:d.stock,e.stockPrice=o.isUndefined(d.stockPrice)?d.pricePerUnit:d.stockPrice)):(e.quantityPerHa=a.applyMaturityFactor(b.code,d.quantity),"EXP"===b.code&&(e.valuePerHa=a.applyMaturityFactor(b.code,d.value))),"INC"===b.code&&e.supplyUnit&&e.unit!==d.unit&&(d.supplyUnit=e.supplyUnit,d.supply=d.quantity,d.quantity=1,d.unit=e.unit),o.isUndefined(d.supplyPerMonth)?e.quantityPerMonth=o.map(a.budget.shiftMonthlyArray(d.quantityPerMonth),function(c){return n.round(n.times(a.applyMaturityFactor(b.code,c),"livestock"===a.type?a.data.details.multiplicationFactor:a.allocatedSize),2)}):(e.supply=n.times(d.supply,"livestock"===a.type?a.data.details.multiplicationFactor:a.allocatedSize),e.quantityPerMonth=o.map(a.budget.shiftMonthlyArray(d.quantityPerMonth),function(c){return n.round(a.applyMaturityFactor(b.code,c),2)}),e.supplyPerMonth=o.map(a.budget.shiftMonthlyArray(d.supplyPerMonth),function(c){var e=n.times(a.applyMaturityFactor(b.code,c),"livestock"===a.type?a.data.details.multiplicationFactor:a.allocatedSize);return"hd"===d.supplyUnit?Math.round(e):e})),e.quantity=m.reduce(e.quantityPerMonth),e.valuePerMonth=o.map(a.budget.shiftMonthlyArray(d.valuePerMonth),function(c){return n.round(n.times(a.applyMaturityFactor(b.code,c),"livestock"===a.type?a.data.details.multiplicationFactor:a.allocatedSize),2)}),e.value=m.reduce(e.valuePerMonth)}function E(a){return a.data&&a.data.details?a.data.details.commodity+" - "+i(a.startDate).format("MMM YYYY"):""}return g(p,e),l(p,"productionScheduleTypes",{crop:"Crop",horticulture:"Horticulture",livestock:"Livestock"}),l(p,"allowedLandUse",o.difference(f.landClasses,["Building","Built-up","Erosion","Forest","Homestead","Mining","Non-vegetated","Water","Water (Seasonal)","Wetland"])),l(p,"allowedAssets",["crop","cropland","pasture","permanent crop"]),l(p,"typeByAsset",{crop:"crop",cropland:"crop",pasture:"livestock","permanent crop":"horticulture"}),l(p,"assetByType",o.chain(p.typeByAsset).omit("cropland").invert().value()),j(p,"getTypeTitle",function(a){return p.productionScheduleTypes[a]||""}),j(p,"getTitle",function(a){return E(a)}),p.validates({budget:{required:!0,object:!0},budgetUuid:{required:!0,format:{uuid:!0}},data:{required:!0,object:!0},endDate:{required:!0,format:{date:!0}},organizationId:{required:!0,numeric:!0},startDate:{required:!0,format:{date:!0}}}),p}]);var sdkModelComparableSale=angular.module("ag.sdk.model.comparable-sale",["ag.sdk.library","ag.sdk.model.base"]);sdkModelComparableSale.factory("ComparableSale",["Locale","computedProperty","Field","inheritModel","naturalSort","privateProperty","readOnlyProperty","safeMath","underscore",function(a,b,c,d,e,f,g,h,i){function j(c){a.apply(this,arguments),b(this,"distanceInKm",function(){return this.distance?h.dividedBy(this.distance,1e3):"-"}),b(this,"improvedRatePerHa",function(){return h.dividedBy(this.purchasePrice,this.area)},{enumerable:!0}),b(this,"vacantLandValue",function(){return h.dividedBy(this.valueMinusImprovements,this.area)},{enumerable:!0}),b(this,"valueMinusImprovements",function(){return h.minus(this.purchasePrice,this.depImpValue)},{enumerable:!0}),b(this,"farmName",function(){return i.chain(this.portions).groupBy("farmLabel").map(function(a,b){var c=i.chain(a).sortBy("portionLabel").pluck("portionLabel").map(function(a){return s.include(a,"/")?s.strLeftBack(a,"/"):""}).toSentence().value();return(c.length?(s.startsWith(c,"RE")?"":"Ptn ")+c+" of the ":"The ")+(b?(i.startsWith(b.toLowerCase(),"farm")?"":"farm ")+b:"")}).toSentence().value()},{enumerable:!0}),b(this,"totalLandComponentArea",function(){return i.chain(this.landComponents).reject(function(a){return"Water Rights"===a.type}).reduce(function(a,b){return h.plus(a,b.area)},0).value()}),b(this,"totalLandComponentValue",function(){return i.reduce(this.landComponents,function(a,b){return h.plus(a,b.assetValue)},0)}),f(this,"addAttachment",function(a){this.removeAttachment(a),this.attachments.push(a)}),f(this,"removeAttachment",function(a){this.attachments=i.reject(this.attachments,function(b){return b.key===a.key})}),f(this,"removeNewAttachments",function(){var a=this.attachments;return this.attachments=i.reject(a,function(a){return i.isObject(a.archive)}),i.difference(a,this.attachments)}),f(this,"addLandComponent",function(a){this.landComponents.push({type:a,assetValue:0})}),f(this,"removeLandComponent",function(a){this.landComponents=i.without(this.landComponents,a)}),f(this,"addPortion",function(a){this.hasPortion(a)||(this.portions.push(a),i.each(a.landCover||[],function(a){var b=i.findWhere(this.landComponents,{type:a.label});i.isUndefined(b)&&(b={type:a.label,assetValue:0},this.landComponents.push(b)),b.area=h.plus(b.area,a.area,3),b.unitValue&&(b.assetValue=h.times(b.area,b.unitValue))},this)),m(this)}),f(this,"hasPortion",function(a){return i.some(this.portions,function(b){return b.sgKey===a.sgKey})}),f(this,"removePortionBySgKey",function(a){this.portions=i.reject(this.portions,function(b){return b.sgKey===a}),m(this)}),f(this,"isEditable",function(a){return a&&this.authorData&&a.username===this.authorData.username&&a.company===this.authorData.company}),i.isUndefined(c)||0===arguments.length||(this.id=c.id||c.$id,this.uuid=c.uuid,this.area=c.area,this.attachments=c.attachments||[],this.authorData=c.authorData,this.centroid=c.centroid,this.comments=c.comments,this.createdAt=c.createdAt,this.createdBy=c.createdBy,this.depImpValue=c.depImpValue,this.distance=c.distance||0,this.geometry=c.geometry,this.landComponents=i.map(c.landComponents||[],k),this.portions=c.portions||[],this.regions=c.regions||[],this.propertyKnowledge=c.propertyKnowledge,this.purchasedAt=c.purchasedAt,this.purchasePrice=c.purchasePrice||0,this.useCount=c.useCount||0)}function k(a){return a.type=l(a.type),a}function l(a){switch(a){case"Cropland (Dry)":return"Cropland";case"Cropland (Equipped, Irrigable)":case"Cropland (Irrigable)":return"Cropland (Irrigated)";case"Conservation":return"Grazing (Bush)";case"Horticulture (Intensive)":return"Greenhouses";case"Horticulture (Perennial)":return"Orchard";case"Horticulture (Seasonal)":return"Vegetables";case"Housing":return"Homestead";case"Wasteland":return"Non-vegetated"}return a}function m(a){a.area=h.round(i.reduce(a.portions,function(a,b){return h.plus(a,b.area)},0),4)}return d(j,a),g(j,"landComponentTypes",i.union(c.landClasses,["Water Rights"]).sort(e)),g(j,"propertyKnowledgeOptions",["The valuer has no firsthand knowledge of this property.","The valuer has inspected this comparable from aerial photos, and has no firsthand knowledge of the property.","The valuer has inspected/valued this comparable before, and has firsthand knowledge of the property."]),f(j,"convertLandComponentType",l),j.validates({area:{required:!0,numeric:!0},country:{required:!0,length:{min:1,max:64}},landComponents:{required:!0,length:{min:1}},portions:{required:!0,length:{min:1}},purchasePrice:{required:!0,numeric:!0}}),j}]);var sdkModelFarmSale=angular.module("ag.sdk.model.farm-sale",["ag.sdk.library","ag.sdk.model.base","ag.sdk.model.farm-valuation"]);sdkModelFarmSale.factory("FarmSale",["Base","computedProperty","DocumentFactory","Locale","inheritModel","md5String","moment","naturalSort","privateProperty","readOnlyProperty","safeMath","underscore",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(e){d.apply(this,arguments),b(this,"farmland",function(){return this.data.farmland}),i(this,"generateUid",function(){return this.uid=f(l.chain(this.farmland).pluck("data").pluck("sgKey").compact().value().join(",")+(this.saleDate?"/"+g(this.saleDate).format("YYYY-MM-DD"):"")),this.uid}),i(this,"asComparable",function(){return{centroid:this.centroid,farmland:this.data.farmland,farmName:this.title,farmSize:this.area,uuid:this.uid}}),i(this,"addDocument",function(a){this.documents=l.chain(this.documents).reject(l.identity({documentId:a.documentId})).union([a]).sortBy(function(a){return g(a.data.report&&a.data.report.completionDate).unix()}).value(),this.documentCount=l.size(this.documents)}),i(this,"addFarmland",function(a){this.data.farmland=l.chain(this.data.farmland).reject(function(b){return b.data.sgKey===a.data.sgKey}).union([a]).value().sort(function(a,b){return h(a.data.sgKey,b.data.sgKey)}),n(this),o(this)}),i(this,"hasFarmland",function(a){return l.some(this.data.farmland,function(b){return b.data.sgKey===a.data.sgKey})}),i(this,"removeFarmlandBySgKey",function(a){this.data.farmland=l.reject(this.data.farmland,function(b){return b.data.sgKey===a}),n(this),o(this)}),this.data=e&&e.data?e.data:{},a.initializeObject(this.data,"farmland",[]),l.isUndefined(e)||0===arguments.length||(this.id=e.id||e.$id,this.area=e.area||0,this.centroid=e.centroid,this.documentCount=e.documentCount||0,this.salePrice=e.salePrice,this.saleDate=e.saleDate,this.title=e.title,this.uid=e.uid,this.documents=l.chain(e.documents).map(c.newCopy).sortBy(function(a){return g(a.data.report&&a.data.report.completionDate).unix()}).value())}function n(a){a.title=l.chain(a.farmland).groupBy(function(a){return a.data.farmLabel}).map(function(a,b){var c=l.chain(a).pluck("data").sortBy("portionLabel").pluck("portionLabel").compact().map(function(a){return s.include(a,"/")?s.strLeftBack(a,"/"):""}).toSentence().value();return(l.size(c)>0?(s.startsWith(c,"RE")?"":"Ptn ")+c+" of the ":"The ")+(b?(l.startsWith(b.toLowerCase(),"farm")?"":"farm ")+b:"")}).toSentence().prune(1024,"").value()}function o(a){a.area=k.round(l.reduce(a.data.farmland,function(a,b){return k.plus(a,b.data.area)},0),3)}return e(m,d),j(m,"propertyKnowledgeOptions",["The valuer has no firsthand knowledge of this property.","The valuer has inspected this property from aerial photos, and has no firsthand knowledge of the property.","The valuer has inspected/valued this property before, and has firsthand knowledge of the property."]),m.validates({area:{required:!0,numeric:!0},country:{required:!0,length:{min:1,max:64}},data:{required:!0,object:!0},farmland:{required:!0,length:{min:1}},salePrice:{required:!0,numeric:!0},saleDate:{required:!0,date:!0},title:{required:!0,length:{min:1,max:1024}},uid:{required:!0,format:{uid:!0}}}),m}]);var sdkModelTaskEmergenceInspection=angular.module("ag.sdk.model.task.emergence-inspection",["ag.sdk.model.crop-inspection","ag.sdk.model.task"]);sdkModelTaskEmergenceInspection.provider("EmergenceInspectionTask",["TaskFactoryProvider",function(a){this.$get=["computedProperty","CropInspection","inheritModel","Task","underscore",function(a,b,c,d,e){function f(){d.apply(this,arguments),a(this,"inspectionDate",function(){return this.data.inspectionDate}),a(this,"landRecommendation",function(){return this.data.landRecommendation}),a(this,"moistureStatus",function(){return this.data.moistureStatus}),a(this,"zones",function(){return this.data.asset.data.zones})}return c(f,d),f.validates(e.extend({inspectionDate:{required:!0,format:{date:!0}},landRecommendation:{required:!0,inclusion:{"in":b.approvalTypes}},moistureStatus:{requiredIf:function(a,b){return"Not Planted"!==b.landRecommendation},inclusion:{"in":b.moistureStatuses}},zones:{requiredIf:function(a,b){return"Not Planted"!==b.landRecommendation},length:{min:1}}},d.validations)),f}],a.add("emergence inspection","EmergenceInspectionTask")}]);var sdkModelTaskProgressInspection=angular.module("ag.sdk.model.task.progress-inspection",["ag.sdk.model.crop","ag.sdk.model.task"]);sdkModelTaskProgressInspection.provider("ProcessInspectionTask",["TaskFactoryProvider",function(a){this.$get=["Base","computedProperty","Crop","CropInspection","inheritModel","privateProperty","safeArrayMath","safeMath","Task","underscore",function(a,b,c,d,e,f,g,h,i,j){function k(){i.apply(this,arguments),a.initializeObject(this.data,"samples",[]),f(this,"calculateResults",function(){m(this)}),b(this,"inspectionDate",function(){return this.data.inspectionDate}),b(this,"moistureStatus",function(){return this.data.moistureStatus}),b(this,"pitWeight",function(){return this.data.pitWeight}),b(this,"realization",function(){return this.data.realization}),b(this,"samples",function(){return this.data.samples})}function l(a,b){return h.dividedBy(j.reduce(a,function(a,c){return h.plus(a,c[b])},0),a.length)}function m(a){var b=c.newCopy(a.data.asset),d=a.data.pitWeight||0,e=a.data.realization||100,f=j.map(b.zones,function(c){var f=j.where(a.data.samples,{zoneUuid:c.uuid}),i={zoneUuid:c.uuid,sampleSize:j.size(f),coverage:h.dividedBy(c.size,b.data.plantedArea),heads:l(f,"heads"),weight:l(f,"weight")};return"spikelet"===b.flower?i["yield"]=h.dividedBy(h.times(i.weight,i.heads),h.times(b.data.irrigated?3e3:3500,c.plantedInRows?h.times(c.rowWidth,3):1)):"pod"===b.flower?(i.pods=l(f,"pods"),i.seeds=l(f,"seeds"),i["yield"]=h.dividedBy(g.reduceOperator([d,i.seeds,i.pods,i.heads],"times",0),h.times(c.rowWidth,300))):i["yield"]=h.dividedBy(h.times(i.weight,i.heads),h.times(c.rowWidth,1e3)),i["yield"]=h.times(i["yield"],h.dividedBy(e,100)),i});a.data.inspection={flower:b.flower,results:f,totalYield:j.reduce(f,function(a,b){return a+b.coverage*b["yield"]},0)}}return e(k,i),k.validates(j.extend({inspectionDate:{required:!0,format:{date:!0}},moistureStatus:{required:!0,inclusion:{"in":d.moistureStatuses}},pitWeight:{required:!0,range:{from:0},numeric:!0},realization:{required:!0,range:{from:0,to:100},numeric:!0},samples:{required:!0,length:{min:1}}},i.validations)),k}],a.add("progress inspection","ProcessInspectionTask")}]);var sdkModelTask=angular.module("ag.sdk.model.task",["ag.sdk.library","ag.sdk.model.base"]);sdkModelTask.factory("Task",["Base","inheritModel","Model","underscore",function(a,b,c,d){function e(a){c.Base.apply(this,arguments),this.data=a&&a.data?a.data:{},d.isUndefined(a)||0===arguments.length||(this.id=a.id||a.$id,this.assignedAt=a.assignedAt,this.assignedBy=a.assignedBy,this.assignedTo=a.assignedTo,this.completedAt=a.completedAt,this.createdAt=a.createdAt,this.createdBy=a.createdBy,this.documentId=a.documentId,this.documentKey=a.documentKey,this.organizationId=a.organizationId,this.originUuid=a.originUuid,this.parentTaskId=a.parentTaskId,this.progressAt=a.progressAt,this.providerType=a.providerType,this.providerUuid=a.providerUuid,this.status=a.status,this.todo=a.todo,this.type=a.type,this.updatedAt=a.updatedAt,this.updatedBy=a.updatedBy,this.document=a.document,this.organization=a.organization)}return b(e,c.Base),e.validates({documentId:{required:!0,numeric:!0},organizationId:{required:!0,numeric:!0},originUuid:{requiredIf:function(a,b){return"external"===b.type},format:{uuid:!0}},parentTaskId:{requiredIf:function(a,b){return"parent"!==b.type},numeric:!0},providerType:{requiredIf:function(a,b){return"external"===b.type},length:{min:1,max:255}},providerUuid:{requiredIf:function(a,b){return"external"===b.type},format:{uuid:!0}},uuid:{format:{uuid:!0}}}),e}]),sdkModelTask.provider("TaskFactory",function(){var a={};this.add=function(b,c){a[b]=c},this.$get=["$injector","Task",function(b,c){function d(d,e){return a[d.todo]?("string"==typeof a[d.todo]&&(a[d.todo]=b.get(a[d.todo])),a[d.todo][e](d)):c[e](d)}return{isInstanceOf:function(b){return b?a[b.todo]?b instanceof a[b.todo]:b instanceof c:!1},"new":function(a){return d(a,"new")},newCopy:function(a){return d(a,"newCopy")}}}]});var sdkModelErrors=angular.module("ag.sdk.model.errors",["ag.sdk.library","ag.sdk.model.base"]);sdkModelErrors.factory("Errorable",["privateProperty","underscore",function(a,b){function c(){var c={};a(c,"count",0),a(c,"countFor",function(a){return b.isUndefined(a)?c.count:c[a]?c[a].length:0}),a(c,"add",function(a,d){b.isUndefined(c[a])&&(c[a]=[]),b.contains(c[a],d)===!1&&(c[a].push(d),c.count++)}),a(c,"clear",function(a,d){if(b.isUndefined(d)===!1)b.contains(c[a],d)&&(c[a]=b.without(c[a],d),c.count--,0===c[a].length&&delete c[a]);else{var e=[];b.isArray(a)&&(e=a),b.isString(a)&&e.push(a),b.isUndefined(a)&&(e=b.keys(c)),b.each(e,function(a){if(b.isUndefined(c[a])===!1){var d=c[a].length;delete c[a],c.count-=d}})}}),a(this,"__$errors",c)}return c}]);var sdkModelStore=angular.module("ag.sdk.model.store",["ag.sdk.library","ag.sdk.model.base"]);sdkModelStore.factory("Storable",["computedProperty","privateProperty",function(a,b){function c(){var a={};b(a,"set",function(a,c){c&&(angular.forEach(e,function(d){b(a,d,c[d])}),angular.forEach(d,function(d){b(a,d,c[d]===!0)}))}),b(this,"storable",function(b){a.set(this,b)})}var d=["$complete","$delete","$dirty","$local","$offline","$saved"],e=["$id","$uri"];return c}]);var sdkModelValidation=angular.module("ag.sdk.model.validation",["ag.sdk.library","ag.sdk.model.base","ag.sdk.model.validators"]);sdkModelValidation.factory("Validatable",["computedProperty","privateProperty","underscore","Validatable.Field","Validator.dateRange","Validator.equal","Validator.format","Validator.inclusion","Validator.inclusion.in","Validator.length","Validator.object","Validator.numeric","Validator.range","Validator.required","Validator.requiredIf",function(a,b,c,d){function e(){function e(a,b){b.validate(a)===!1?a.$errors.add(b.field,b.message):a.$errors.clear(b.field,b.message)}function f(a){return a&&g[a]?g[a]:c.chain(g).map(function(a){return a}).flatten().value()}var g={};b(g,"add",function(a){c.each(a,function(a,b){g[b]?g[b].addValidators(a):g[b]=new d(b,a)})}),b(g,"validate",function(a,b){var d=f(b);return c.each(d,function(b){e(a,b)}),0===a.$errors.countFor(b)}),b(this,"validations",g),b(this,"validates",g.add),b(this,"__validate",function(a){return this.constructor.validations.validate(this,a)}),a(this,"__$valid",function(){return this.constructor.validations.validate(this)}),a(this,"__$invalid",function(){return!this.constructor.validations.validate(this)})}return e}]),sdkModelValidation.factory("Validatable.DuplicateValidatorError",[function(){function a(a){this.name="DuplicateValidatorError",this.message="A validator by the name "+a+" is already registered"}return a.prototype=Error.prototype,a}]),sdkModelValidation.factory("Validatable.ValidationMessageNotFoundError",[function(){function a(a,b){this.name="ValidationMessageNotFound",this.message="Validation message not found for validator "+a+" on the field "+b+". Validation messages must be added to validators in order to provide your users with useful error messages."}return a.prototype=Error.prototype,a}]),sdkModelValidation.factory("Validatable.Field",["privateProperty","underscore","Validatable.Validation","Validatable.ValidationMessageNotFoundError","Validatable.Validator","Validatable.validators",function(a,b,c,d,e,f){function g(g,h){var i=[];return a(i,"addValidator",function(a,h){if(a instanceof c)i.push(a);else{var j=f.find(h)||new e(a,h),k=b.flatten([j.configure(a)]);if(b.isUndefined(j.message))throw new d(h,g);b.each(k,function(a){i.push(new c(g,a))})}}),a(i,"addValidators",function(a){b.each(a,i.addValidator)}),i.addValidators(h),i}return g}]),sdkModelValidation.factory("Validatable.Validation",["privateProperty",function(a){function b(b,c){a(this,"field",b),a(this,"message",c.message),a(this,"validate",function(a){return c(a[b],a,b)})}return b}]),sdkModelValidation.factory("Validatable.ValidationFunction",["underscore",function(a){function b(b,c){function d(){return a.isFunction(c.message)?c.message.apply(c):c.message}var e=a.bind(b,c);return e.message=d(),e}return b}]),sdkModelValidation.factory("Validatable.ValidatorNotFoundError",[function(){function a(a){this.name="ValidatorNotFoundError",this.message="No validator found by the name of "+a+". Custom validators must define a validator key containing the custom validation function"}return a.prototype=Error.prototype,a}]),sdkModelValidation.factory("Validatable.Validator",["privateProperty","underscore","Validatable.ValidationFunction","Validatable.ValidatorNotFoundError","Validatable.validators",function(a,b,c,d,e){function f(a,c){return b.isFunction(a.validator)?(a.message&&(a.validator.message=a.message),new g(a.validator,c)):void 0}function g(g,h){function i(a){b.each(a,function(a,b){"Validator"===a.constructor.name&&(l.childValidators[b]=a)})}function j(a){return b.chain(l.childValidators).map(function(b,c){return void 0!==a[c]?b.configure(a[c]):void 0}).compact().value()}function k(a){return("object"!=typeof a||b.isArray(a))&&(a={value:a,message:l.message}),0==b.isUndefined(g.name)&&(a[g.name]=a.value),a}if(g.validator)return new f(g,h);if(b.isFunction(g)===!1)throw new d(h);var l=this;a(l,"name",g.name),a(l,"message",g.message),a(l,"childValidators",{}),a(l,"configure",function(a){return a=k(a),b.size(l.childValidators)>0?j(a):new c(g,b.defaults(a,this))}),i(g.options),e.register(l)}return g}]),sdkModelValidation.factory("Validatable.validators",["Validatable.DuplicateValidatorError","privateProperty","underscore",function(a,b,c){var d={};return b(d,"register",function(b){if(!c.isUndefined(d[b.name]))throw new a(b.name);d[b.name]=b}),b(d,"find",function(a){return d[a]}),d}]);var sdkModelValidators=angular.module("ag.sdk.model.validators",["ag.sdk.library","ag.sdk.model.validation"]);sdkModelValidators.factory("Validator.dateRange",["moment","underscore","Validatable.Validator","Validator.dateRange.after","Validator.dateRange.before",function(a,b,c,d,e){function f(){}return f.message=function(){return"Is not a valid date"},f.options={after:d,before:e},new c(f)}]),sdkModelValidators.factory("Validator.dateRange.after",["moment","underscore","Validatable.Validator",function(a,b,c){function d(c){return b.isUndefined(this.after)||b.isUndefined(c)||b.isNull(c)||""===c?!0:a(c)>=a(this.after)}return d.message=function(){return"Must be at least "+a(this.after).format("dddd, MMMM Do YYYY, h:mm:ss a")},new c(d)}]),sdkModelValidators.factory("Validator.dateRange.before",["moment","underscore","Validatable.Validator",function(a,b,c){function d(c){return b.isUndefined(this.before)||b.isUndefined(c)||b.isNull(c)||""===c?!0:a(c)<=a(this.before)}return d.message=function(){return"Must be no more than "+a(this.before).format("dddd, MMMM Do YYYY, h:mm:ss a")},new c(d)}]),sdkModelValidators.factory("Validator.equal",["underscore","Validatable.Validator",function(a,b){function c(b){if(a.isUndefined(this.to))throw"Equal validator must specify an 'to' attribute";return b===this.to}return c.message=function(){return"Must be equal to '"+this.to+"'"},new b(c)}]),sdkModelValidators.factory("Validator.format",["underscore","Validatable.Validator","Validator.format.date","Validator.format.email","Validator.format.telephone","Validator.format.uuid",function(a,b,c,d,e,f){function g(){}return g.message=function(){return"Must be the correct format"},g.options={date:c,email:d,telephone:e,uuid:f},new b(g)}]),sdkModelValidators.factory("Validator.format.date",["moment","underscore","Validatable.Validator",function(a,b,c){function d(c){return b.isUndefined(c)||b.isNull(c)||""===c?!0:a(c).isValid()}return d.message=function(){return"Must be a valid date"},new c(d)}]),sdkModelValidators.factory("Validator.format.email",["moment","underscore","Validatable.Validator",function(a,b,c){function d(a){return b.isUndefined(a)||b.isNull(a)||""===a?!0:e.test(a)}var e=new RegExp("^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,6}$");return d.message=function(){return"Must be a valid email address"},new c(d)}]),sdkModelValidators.factory("Validator.format.telephone",["moment","underscore","Validatable.Validator",function(a,b,c){function d(a){return b.isUndefined(a)||b.isNull(a)||""===a?!0:e.test(a)}var e=new RegExp("^(\\(?\\+?[0-9]*\\)?)?[0-9_\\- \\(\\)]*$");return d.message=function(){return"Must be a valid telephone number"},new c(d)}]),sdkModelValidators.factory("Validator.format.uuid",["moment","underscore","Validatable.Validator",function(a,b,c){function d(a){return b.isUndefined(a)||b.isNull(a)||""===a?!0:e.test(a)
}var e=new RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$","i");return d.message=function(){return"Must be a valid UUID"},new c(d)}]),sdkModelValidators.factory("Validator.format.uid",["moment","underscore","Validatable.Validator",function(a,b,c){function d(a){return b.isUndefined(a)||b.isNull(a)||""===a?!0:e.test(a)}var e=new RegExp("^[0-9a-f]{16}$","i");return d.message=function(){return"Must be a valid UID"},new c(d)}]),sdkModelValidators.factory("Validator.inclusion",["underscore","Validatable.Validator","Validator.inclusion.in",function(a,b,c){function d(){}return d.message=function(){return"Must have an included value"},d.options={"in":c},new b(d)}]),sdkModelValidators.factory("Validator.inclusion.in",["underscore","Validatable.Validator",function(a,b){function c(b,c,d){var e="function"==typeof this.value?this.value(b,c,d):this.value;return a.isUndefined(b)||a.isNull(b)?!0:0==e.length?!0:a.some(e,function(a){return b===a})}return c.message=function(){return"Must be in array of values"},new b(c)}]),sdkModelValidators.factory("Validator.length",["Validatable.Validator","Validator.length.min","Validator.length.max",function(a,b,c){function d(){return!0}return d.message="does not meet the length requirement",d.options={},b&&(d.options.min=b),c&&(d.options.max=c),new a(d)}]),sdkModelValidators.factory("Validator.length.min",["underscore","Validatable.Validator",function(a,b){function c(b){return a.isUndefined(b)||a.isNull(b)?!0:b.length>=this.min}return c.message=function(){return"Length must be at least "+this.min},new b(c)}]),sdkModelValidators.factory("Validator.length.max",["underscore","Validatable.Validator",function(a,b){function c(b){return a.isUndefined(b)||a.isNull(b)?!0:b.length<=this.max}return c.message=function(){return"Length must be at most "+this.max},new b(c)}]),sdkModelValidators.factory("Validator.numeric",["underscore","Validatable.Validator",function(a,b){function c(b){return a.isUndefined(b)||a.isNull(b)?!0:"number"==typeof b&&a.isNumber(b)}return c.message=function(){return"Must be a number"},new b(c)}]),sdkModelValidators.factory("Validator.object",["underscore","Validatable.Validator",function(a,b){function c(b){return a.isUndefined(b)||a.isNull(b)?!0:"object"==typeof b}return c.message=function(){return"Must be an object"},new b(c)}]),sdkModelValidators.factory("Validator.range",["Validatable.Validator","Validator.range.from","Validator.range.to",function(a,b,c){function d(){return!0}return d.message="Must be with the range requirement",d.options={from:b,to:c},new a(d)}]),sdkModelValidators.factory("Validator.range.from",["underscore","Validatable.Validator",function(a,b){function c(b){return a.isUndefined(b)||a.isNull(b)||""===b?!0:b>=this.from}return c.message=function(){return"Must be at least "+this.from},new b(c)}]),sdkModelValidators.factory("Validator.range.to",["underscore","Validatable.Validator",function(a,b){function c(b){return a.isUndefined(b)||a.isNull(b)||""===b?!0:b<=this.to}return c.message=function(){return"Must be no more than "+this.to},new b(c)}]),sdkModelValidators.factory("Validator.required",["underscore","Validatable.Validator",function(a,b){function c(b){return this.required?a.isUndefined(b)||a.isNull(b)?!1:"String"===b.constructor.name?!!(b&&b.length||"object"==typeof b):void 0!==b:!0}return c.message="cannot be blank",new b(c)}]),sdkModelValidators.factory("Validator.requiredIf",["underscore","Validatable.Validator",function(a,b){function c(b,c,d){return this.value(b,c,d)?a.isUndefined(b)||a.isNull(b)?!1:"String"==b.constructor.name?!!(b&&b.length||"object"==typeof b):void 0!==b:!0}return c.message="Is a required field",new b(c)}]);var sdkTestDataApp=angular.module("ag.sdk.test.data",["ag.sdk.utilities","ag.sdk.id","ag.sdk.library"]);sdkTestDataApp.provider("mockDataService",["underscore",function(a){var b={},c={localStore:!0};this.config=function(b){c=a.defaults(b,c)},this.$get=["localStore","objectId","promiseService",function(d,e,f){return c.localStore&&(b=d.getItem("mockdata")||{}),{setItem:function(a,f){f instanceof Array?(b[a]={},angular.forEach(f,function(c){c.id=c.id||e().toString(),b[a][c.id]=c})):(f.id=f.id||e().toString(),b[a]=b[a]||{},b[a][f.id]=f),c.localStore&&d.setItem("mockdata",b)},getItem:function(c,d){return f.wrap(function(e){b[c]=b[c]||{},void 0===d?e.resolve(a.toArray(b[c]||{})):b[c][d]?e.resolve(b[c][d]):e.reject()})}}}]}]),angular.module("ag.sdk.helper",["ag.sdk.helper.asset","ag.sdk.helper.attachment","ag.sdk.helper.crop-inspection","ag.sdk.helper.document","ag.sdk.helper.favourites","ag.sdk.helper.task","ag.sdk.helper.user"]),angular.module("ag.sdk.interface",["ag.sdk.interface.geocledian","ag.sdk.interface.ui","ag.sdk.interface.list","ag.sdk.interface.map","ag.sdk.interface.navigation"]),angular.module("ag.sdk.model",["ag.sdk.model.asset","ag.sdk.model.base","ag.sdk.model.business-plan","ag.sdk.model.comparable-farm-valuation","ag.sdk.model.comparable-sale","ag.sdk.model.crop","ag.sdk.model.crop-inspection","ag.sdk.model.desktop-valuation","ag.sdk.model.document","ag.sdk.model.enterprise-budget","ag.sdk.model.expense","ag.sdk.model.farm","ag.sdk.model.farm-sale","ag.sdk.model.farm-valuation","ag.sdk.model.farmer","ag.sdk.model.field","ag.sdk.model.financial","ag.sdk.model.layer","ag.sdk.model.legal-entity","ag.sdk.model.liability","ag.sdk.model.livestock","ag.sdk.model.locale","ag.sdk.model.map-theme","ag.sdk.model.merchant","ag.sdk.model.organization","ag.sdk.model.point-of-interest","ag.sdk.model.production-group","ag.sdk.model.production-schedule","ag.sdk.model.errors","ag.sdk.model.stock","ag.sdk.model.store","ag.sdk.model.task","ag.sdk.model.task.emergence-inspection","ag.sdk.model.task.progress-inspection","ag.sdk.model.validation","ag.sdk.model.validators"]),angular.module("ag.sdk.test",["ag.sdk.test.data"]),angular.module("ag.sdk",["ag.sdk.authorization","ag.sdk.editor","ag.sdk.id","ag.sdk.geospatial","ag.sdk.utilities","ag.sdk.model","ag.sdk.api","ag.sdk.helper","ag.sdk.library","ag.sdk.interface.map","ag.sdk.test"]);