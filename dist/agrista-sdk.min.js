var sdkApiApp=angular.module("ag.sdk.api",["ag.sdk.config","ag.sdk.utilities","ag.sdk.library"]);sdkApiApp.factory("activeFlagApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getActiveFlags:function(b){return c.wrap(function(c){a.get(e+"api/active-flags"+(b?"?purpose="+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getActiveFlagsByPage:function(a){return b.page(e+"api/active-flags",a)},updateActiveFlag:function(b){return c.wrap(function(c){a.post(e+"api/active-flag/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("activityApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getActivities:function(a,c,d){return"object"==typeof c&&(d=c,c=void 0),"object"==typeof a&&(d=a,a=void 0),b.page(e+"api/activities"+(a?"/"+a:"")+(c?"/"+c:""),d)},createActivity:function(b){return c.wrap(function(c){a.post(e+"api/activity",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getActivity:function(b){return c.wrap(function(c){a.get(e+"api/activity/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteActivity:function(b){return c.wrap(function(c){a.post(e+"api/activity/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("aggregationApi",["$log","$http","configuration","promiseService","pagingService","underscore",function(a,b,c,d,e,f){var g=c.getServer();return{getCustomerLocations:function(){return d.wrap(function(a){b.get(g+"api/aggregation/customer-locations",{withCredentials:!0}).then(function(b){a.resolve(b.data)},a.reject)})},getCustomerFarmlands:function(a,c,e,f){return d.wrap(function(d){b.get(g+"api/aggregation/customer-geodata?x1="+f+"&y1="+e+"&x2="+c+"&y2="+a,{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})},getSubRegionBoundaries:function(a,c,e,f){return d.wrap(function(d){b.get(g+"api/aggregation/guideline-subregions?x1="+f+"&y1="+a+"&x2="+c+"&y2="+e,{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})},getGroupCustomerLocations:function(){return d.wrap(function(a){b.get(g+"api/aggregation/customer-locations-group",{withCredentials:!0}).then(function(b){a.resolve(b.data)},a.reject)})},getGroupCustomerFarmlands:function(a,c,e,f){return d.wrap(function(d){b.get(g+"api/aggregation/customer-geodata-group?x1="+f+"&y1="+a+"&x2="+c+"&y2="+e,{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})},getFarmlandOverlaps:function(a){return e.page(g+"api/aggregation/farmland-overlap",a)},getGuidelineExceptions:function(a){return e.page(g+"api/aggregation/guideline-exceptions",a)},getProductionRegionByPoint:function(c,e){return d.wrap(function(d){var f="";"number"==typeof c&&"number"==typeof e?f="?x="+c+"&y="+e:d.reject(),b.get(g+"api/aggregation/production-region"+f,{withCredentials:!0}).then(function(b){a.debug(b.data),d.resolve(b.data)},d.reject)})},listValuationStatus:function(a){return e.page(g+"api/aggregation/report-valuation-summary",a)},listBenefitAuthorisation:function(){return d.wrap(function(a){b.get(g+"api/aggregation/report-benefit-authorisation",{withCredentials:!0}).then(function(b){a.resolve(b.data)},a.reject)})},listFinancialResourcePlanStatus:function(a){return e.page(g+"api/aggregation/report-frp-summary",a)},listCrossSelling:function(a){return e.page(g+"api/aggregation/report-cross-selling",a)},searchProductionSchedules:function(a){return a=angular.copy(a),a.horticultureStage&&(a.horticulturestage=a.horticultureStage,delete a.horticultureStage),a.regionName&&(a.regionname=a.regionName,delete a.regionName),a=f.map(a,function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),d.wrap(function(c){b.get(g+"api/aggregation/search-production-schedules"+(a?"?"+a:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},averageProductionSchedules:function(a){return d.wrap(function(c){b.post(g+"api/aggregation/average-production-schedules",a,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getDistinctProductionScheduleYears:function(a){return a=f.map(a,function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),d.wrap(function(c){b.get(g+"api/aggregation/distinct-production-schedule-years"+(a?"?"+a:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getDistinctProductionScheduleEnterprises:function(a){return a=f.map(a,function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),d.wrap(function(c){b.get(g+"api/aggregation/distinct-production-schedule-enterprises"+(a?"?"+a:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getDistinctProductionScheduleCategories:function(){return d.wrap(function(a){b.get(g+"api/aggregation/distinct-production-schedule-categories",{withCredentials:!0}).then(function(b){a.resolve(b.data)},a.reject)})}}}]),sdkApiApp.factory("agristaApi",["$http","pagingService","promiseService","configuration","underscore",function(a,b,c,d,e){var f=d.getServer();return{getMerchants:function(){return c.wrap(function(b){a.get(f+"api/agrista/providers",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},searchMerchants:function(b){return b=e.map(b,function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),c.wrap(function(c){a.get(f+"api/agrista/providers"+(b?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getMerchant:function(b){return c.wrap(function(c){a.get(f+"api/agrista/provider/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("assetApi",["$http","pagingService","promiseService","configuration","underscore",function(a,b,c,d,e){var f=d.getServer();return{getAssets:function(a,c){return"object"==typeof a&&(c=a,a=void 0),b.page(f+"api/assets"+(a?"/"+a:""),c)},createAsset:function(b,d){return c.wrap(function(c){a.post(f+"api/asset",d?b:e.omit(b,["liabilities","productionSchedules"]),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getAsset:function(b){return c.wrap(function(c){a.get(f+"api/asset/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateAsset:function(b,d){return c.wrap(function(c){a.post(f+"api/asset/"+b.id,d?b:e.omit(b,["liabilities","productionSchedules"]),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},attachLiability:function(b,d){return c.wrap(function(c){a.post(f+"api/asset/"+b+"/liability",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},detachLiability:function(b,d){return c.wrap(function(c){a.post(f+"api/asset/"+b+"/liability/"+d+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteAsset:function(b){return c.wrap(function(c){a.post(f+"api/asset/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},uploadAssetAttachments:function(b,d){return c.wrap(function(c){a.post(f+"api/asset/"+b+"/attach",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("attachmentApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getAttachmentUri:function(c){return b.wrap(function(b){a.get(d+"api/file-attachment/url?key="+encodeURIComponent(c),{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getPDFPreviewImage:function(c){return b.wrap(function(b){a.get(d+"api/attachment/pdf/preview-image/"+encodeURIComponent(c),{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("benefitApi",["$http","pagingService","promiseService","configuration","underscore",function(a,b,c,d){var e=d.getServer();return{searchCustomerNumber:function(b){return c.wrap(function(c){a.get(e+"api/benefit/search?customerNumber="+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},linkCustomerNumber:function(b){return c.wrap(function(c){a.post(e+"api/benefit/link",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},unlinkCustomerNumber:function(b){return c.wrap(function(c){a.post(e+"api/benefit/unlink",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},authoriseCustomerNumber:function(b){return c.wrap(function(c){a.post(e+"api/benefit/authorise",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},modifyAuthorisedCustomerNumber:function(b){return c.wrap(function(c){a.post(e+"api/benefit/modify",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deauthoriseCustomerNumber:function(b){return c.wrap(function(c){a.post(e+"api/benefit/deauthorise",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},listMemberships:function(){return c.wrap(function(b){a.get(e+"api/benefit/memberships",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("comparableApi",["$http","pagingService","promiseService","configuration","underscore",function(a,b,c,d,e){var f=d.getServer();return{createComparable:function(b){return c.wrap(function(c){a.post(f+"api/comparable",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},searchComparables:function(b){return b=e.chain(b).defaults({resulttype:"simple"}).map(function(a,b){return b+"="+encodeURIComponent(a)}).value().join("&"),c.wrap(function(c){a.get(f+"api/comparables/search"+(b&&b.length>0?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getComparable:function(b){return c.wrap(function(c){a.get(f+"api/comparable/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateComparable:function(b,d){return c.wrap(function(c){a.post(f+"api/comparable/"+b,d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},useComparable:function(b){return c.wrap(function(c){a.post(f+"api/comparable/"+b+"/use",{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteComparable:function(b){return c.wrap(function(c){a.post(f+"api/comparable/"+b+"/delete",{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("dataApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{exportFile:function(c){return b.wrap(function(b){a.post(d+"api/data/export-file",c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},importFile:function(c){return b.wrap(function(b){a.post(d+"api/data/import-file",c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},validateFile:function(c){return b.wrap(function(b){a.post(d+"api/data/validate-file",c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("documentApi",["$cookieStore","$http","pagingService","promiseService","configuration","underscore",function(a,b,c,d,e,f){var g=e.getServer();return{getDocuments:function(a,b){return"object"==typeof a&&(b=a,a=void 0),c.page(g+"api/documents"+(a?"/"+a:""),b)},createDocument:function(a){return d.wrap(function(c){b.post(g+"api/document",f.omit(a,["organization","tasks"]),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getDocument:function(a){return d.wrap(function(c){b.get(g+"api/document/"+a,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},sendDocument:function(a,c){return d.wrap(function(d){b.post(g+"api/document/"+a+"/send",c,{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})},relateDocuments:function(a,c){return d.wrap(function(d){b.post(g+"api/document/"+a+"/relate",c,{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})},updateDocument:function(a){return d.wrap(function(c){b.post(g+"api/document/"+a.id,f.omit(a,["organization","tasks"]),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteDocument:function(a){return d.wrap(function(c){b.post(g+"api/document/"+a+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},uploadDocumentAttachments:function(a,c){return d.wrap(function(d){b.post(g+"api/document/"+a+"/attach",c,{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})},getDocumentPdf:function(a){return d.wrap(function(c){b.post(g+"api/document/pdf/get",a,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},saveDocumentPdf:function(a){return d.wrap(function(c){b.post(g+"api/document/pdf/save",a,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},mergeDocumentPdfs:function(a,c){return d.wrap(function(d){b.post(g+"api/document/pdf/merge?key="+a,c,{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})}}}]),sdkApiApp.factory("enterpriseBudgetApi",["$http","pagingService","promiseService","configuration","underscore",function(a,b,c,d,e){var f=d.getServer();return{getEnterpriseBudgets:function(a,c){return"object"==typeof a&&(c=a,a=void 0),b.page(f+"api/budgets"+(a?"?subregion="+a:""),c)},getAveragedBudgets:function(b){return b=e.chain(b).defaults({resulttype:"simple"}).map(function(a,b){return b+"="+encodeURIComponent(a)}).value().join("&"),c.wrap(function(c){a.get(f+"api/budgets/averaged"+(b&&b.length>0?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},searchEnterpriseBudgets:function(b){return b=e.chain(b).defaults({resulttype:"simple"}).map(function(a,b){return b+"="+encodeURIComponent(a)}).value().join("&"),c.wrap(function(c){a.get(f+"api/budgets/search"+(b&&b.length>0?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},createEnterpriseBudget:function(b){return c.wrap(function(c){a.post(f+"api/budget",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getEnterpriseBudget:function(b,d){return c.wrap(function(c){a.get(f+"api/budget/"+b+(d?"?requesttype="+d:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getEnterpriseBudgetPublishers:function(){return c.wrap(function(b){a.get(f+"api/budget/publishers",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getEnterpriseBudgetRegions:function(){return c.wrap(function(b){a.get(f+"api/budget/regions",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateEnterpriseBudget:function(b){return c.wrap(function(c){a.post(f+"api/budget/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},publishEnterpriseBudget:function(b,d){return d=d||{remote:"agrista"},c.wrap(function(c){a.post(f+"api/budget/"+b+"/publish",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteEnterpriseBudget:function(b){return c.wrap(function(c){a.post(f+"api/budget/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},uploadEnterpriseBudgetAttachments:function(b,d){return c.wrap(function(c){a.post(f+"api/budget/"+b+"/attach",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},favoriteEnterpriseBudget:function(b){return c.wrap(function(c){a.post(f+"api/budget/"+b+"/favorite",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("expenseApi",["$http","$log","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer();return{getExpenses:function(a){var b="api/expenses";return a&&a.key&&void 0!=a.id&&a.id>-1&&(b+="/"+a.id+"/"+a.key,delete a.key,delete a.id),c.page(f+b,a)},updateExpense:function(b){return d.wrap(function(c){a.post(f+"api/expense/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("farmApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getFarms:function(a,c){return"object"==typeof a&&(c=a,a=void 0),b.page(e+"api/farms"+(a?"/"+a:""),c)},createFarm:function(b){return c.wrap(function(c){a.post(e+"api/farm",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getFarm:function(b){return c.wrap(function(c){a.get(e+"api/farm/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateFarm:function(b){return c.wrap(function(c){a.post(e+"api/farm/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteFarm:function(b){return c.wrap(function(c){a.post(e+"api/farm/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("farmerApi",["$http","pagingService","promiseService","configuration","underscore",function(a,b,c,d,e){var f=d.getServer();return{getFarmers:function(a,c){return"object"==typeof a&&(c=a,a=void 0),b.page(f+"api/farmers"+(a?"/"+a:""),c)},searchFarmers:function(b){return c.wrap(function(c){"string"==typeof b?a.get(f+"api/farmers?search="+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject):"object"==typeof b&&b.ids&&a.get(f+"api/farmers?ids="+b.ids,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},createFarmer:function(b,d){return c.wrap(function(c){a.post(f+"api/farmer",d?b:e.omit(b,["farms","financials","legalEntities"]),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},inviteFarmer:function(b){return c.wrap(function(c){a.post(f+"api/farmer/"+b+"/invite",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getFarmer:function(b){return c.wrap(function(c){a.get(f+"api/farmer/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateFarmer:function(b,d){return c.wrap(function(c){a.post(f+"api/farmer/"+b.id,d?b:e.omit(b,["farms","financials","legalEntities"]),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteFarmer:function(b){return c.wrap(function(c){a.post(f+"api/farmer/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},hasOutstandingRequest:function(b){return c.wrap(function(c){a.get(f+"api/farmers/with-open-request?ids="+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getAssignedMerchant:function(b){return c.wrap(function(c){a.get(f+"api/farmer/"+b+"/assigned-merchant",{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("farmlandValueApi",["$http","promiseService","configuration","underscore",function(a,b,c,d){var e=c.getServer();return{getFarmlandValue:function(c,f){return f=d.map(f,function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),b.wrap(function(b){a.get(e+"api/farmland-value/"+c+(f?"?"+f:""),{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getFarmlandValues:function(c){return c=d.map(c,function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),b.wrap(function(b){a.get(e+"api/farmland-values"+(c?"?"+c:""),{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("financialApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getFinancials:function(c){return b.wrap(function(b){void 0!==c?a.get(d+"api/financials/"+c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject):b.reject()})},createFinancial:function(c){return b.wrap(function(b){a.post(d+"api/financial",c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getFinancial:function(c){return b.wrap(function(b){a.get(d+"api/financial/"+c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateFinancial:function(c){return b.wrap(function(b){a.post(d+"api/financial/"+c.id,c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteFinancial:function(c){return b.wrap(function(b){a.post(d+"api/financial/"+c+"/delete",{},{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("legalEntityApi",["$http","pagingService","promiseService","configuration","underscore",function(a,b,c,d,e){var f=d.getServer();return{getEntities:function(a,c){return"object"==typeof a&&(c=a,a=void 0),b.page(f+"api/legalentities"+(a?"/"+a:""),c)},updateEntity:function(b,d){return c.wrap(function(c){a.post(f+"api/legalentity/"+b.id,d?b:e.omit(b,["assets"]),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},uploadEntityAttachments:function(b,d){return c.wrap(function(c){a.post(f+"api/legalentity/"+b+"/attach",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getEntity:function(b){return c.wrap(function(c){a.get(f+"api/legalentity/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},createEntity:function(b,d){return c.wrap(function(c){a.post(f+"api/legalentity",d?b:e.omit(b,["assets"]),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteEntity:function(b){return c.wrap(function(c){a.post(f+"api/legalentity/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getDuplicateEntity:function(){return c.wrap(function(b){a.get(f+"api/legalentity/duplicates",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},attachLiability:function(b,d){return c.wrap(function(c){a.post(f+"api/legalentity/"+b+"/liability",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},detachLiability:function(b,d){return c.wrap(function(c){a.post(f+"api/legalentity/"+b+"/liability/"+d+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("liabilityApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{updateLiability:function(c){return b.wrap(function(b){a.post(d+"api/liability/"+c.id,c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("mapThemeApi",["$http","promiseService","configuration","underscore",function(a,b,c,d){var e=c.getServer();return{getMapThemes:function(c){return c=d.map(d.defaults(c||{},{resulttype:"simple"}),function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),b.wrap(function(b){a.get(e+"api/map-themes"+(c?"?"+c:""),{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},createMapTheme:function(c){return b.wrap(function(b){a.post(e+"api/map-theme",c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateMapTheme:function(c){return b.wrap(function(b){a.post(e+"api/map-theme/"+c.id,c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("merchantApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getMerchants:function(a){return b.page(e+"api/merchants",a)},searchMerchants:function(b){return c.wrap(function(c){a.get(e+"api/merchants?search="+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},searchByService:function(b,d,f){return c.wrap(function(c){a.get(e+"api/merchants/services?search="+b+(d?"&x="+d[0]+"&y="+d[1]:"")+(f?"&farmerId="+f:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},createMerchant:function(b){return c.wrap(function(c){a.post(e+"api/merchant",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},inviteMerchant:function(b){return c.wrap(function(c){a.post(e+"api/merchant/"+b+"/invite",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},inviteMerchantUser:function(b){return c.wrap(function(c){a.post(e+"api/merchant/"+b+"/invite-user",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getMerchant:function(b,d){return c.wrap(function(c){a.get(e+"api/merchant/"+b+(d?"?uuid=true":""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getMerchantActivities:function(b){return c.wrap(function(c){a.get(e+"api/merchant/"+b+"/activities",{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateMerchant:function(b){return c.wrap(function(c){a.post(e+"api/merchant/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},uploadMerchantAttachments:function(b,d){return c.wrap(function(c){a.post(e+"api/merchant/"+b+"/attach",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteMerchant:function(b){return c.wrap(function(c){a.post(e+"api/merchant/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("notificationApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getNotifications:function(a){return b.page(e+"api/notifications",a)},createNotification:function(b){return c.wrap(function(c){a.post(e+"api/notification",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getNotification:function(b){return c.wrap(function(c){a.get(e+"api/notification/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},rejectNotification:function(b,d){return c.wrap(function(c){a.post(e+"api/notification/"+b+"/reject",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},acceptNotification:function(b){return c.wrap(function(c){a.post(e+"api/notification/"+b+"/accept",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteNotification:function(b){return c.wrap(function(c){a.post(e+"api/notification/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("organizationalUnitApi",["$http","pagingService","promiseService","configuration","underscore",function(a,b,c,d,e){var f=d.getServer();return{createOrganizationalUnit:function(b){return c.wrap(function(c){a.post(f+"api/organizational-unit"+(b.type?"/"+b.type.toLowerCase():""),b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getOrganizationalUnits:function(a){return b.page(f+"api/organizational-units",a)},getOrganizationalUnitBranches:function(a){return b.page(f+"api/organizational-units/branches",a)},getOrganizationalUnitGroups:function(a){return b.page(f+"api/organizational-units/groups",a)},getOrganizationalUnitRegions:function(a){return b.page(f+"api/organizational-units/regions",a)},getOrganizationalUnit:function(b){return c.wrap(function(c){a.get(f+"api/organizational-unit/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateOrganizationalUnit:function(b){return c.wrap(function(c){a.post(f+"api/organizational-unit/"+b.id,e.omit(b,["organization","users"]),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteOrganizationalUnit:function(b){return c.wrap(function(c){a.post(f+"api/organizational-unit/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("pipGeoApi",["$http","promiseService","configuration","underscore",function(a,b,c,d){var e=c.getServer();return{getFieldPolygon:function(c,d){return b.wrap(function(b){a.get(e+"api/geo/field-polygon?x="+c+"&y="+d,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getPortionPolygon:function(c,d){return b.wrap(function(b){a.get(e+"api/geo/portion-polygon?x="+c+"&y="+d,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},searchPortions:function(c){return c=d.chain(c).omit(function(a){return null==a||""==a}).map(function(a,b){return b+"="+encodeURIComponent(a)}).value().join("&"),b.wrap(function(b){c||b.reject(),a.get(e+"api/geo/portion-polygons?"+c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getDistrictPolygon:function(c,d){return b.wrap(function(b){a.get(e+"api/geo/district-polygon?x="+c+"&y="+d,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getProvincePolygon:function(c,d){return b.wrap(function(b){a.get(e+"api/geo/province-polygon?x="+c+"&y="+d,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("productDemandApi",["$http","pagingService","promiseService","configuration","underscore",function(a,b,c,d,e){var f=d.getServer();return{getProductDemandAssumptions:function(b){return b=e.map(b,function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),c.wrap(function(c){a.get(f+"api/demand-assumptions"+(b?"?"+b:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getMapData:function(b){return c.wrap(function(c){a.post(f+"api/demand-assumptions/map-data",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},addAssumptionGroup:function(b){return c.wrap(function(c){a.post(f+"api/demand-assumption",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateProductDemandAssumption:function(b,d){return c.wrap(function(c){a.post(f+"api/demand-assumption/"+b,d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteProductDemandAssumption:function(b){return c.wrap(function(c){a.post(f+"api/demand-assumption/delete",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("productionRegionApi",["$http","$log","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer();return{getProductionRegions:function(a,d){return a&&"boolean"!=typeof a&&(b.debug(a),d=a,a=void 0),c.page(f+"api/subregions"+(a?"?geometries="+a:""),d)},getProductionRegion:function(b){return d.wrap(function(c){a.get(f+"api/subregion/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getProductionRegionsByRegion:function(b){return d.wrap(function(c){a.get(f+"api/subregions/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},createProductionRegion:function(b){return d.wrap(function(c){a.post(f+"api/subregion",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateProductionRegion:function(b){return d.wrap(function(c){a.post(f+"api/subregion/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getParentRegions:function(a){return c.page(f+"api/regions",a)}}}]),sdkApiApp.factory("productionScheduleApi",["$http","pagingService","promiseService","configuration","underscore",function(a,b,c,d,e){var f=d.getServer();return{getProductionSchedules:function(a){return b.page(f+"api/production-schedules"+(a?"/"+a:""))},createProductionSchedule:function(b){return c.wrap(function(c){a.post(f+"api/production-schedule",e.omit(b,["asset","budget","organization"]),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getProductionSchedule:function(b){return c.wrap(function(c){a.get(f+"api/production-schedule/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateProductionSchedule:function(b){return c.wrap(function(c){a.post(f+"api/production-schedule/"+b.id,e.omit(b,["asset","budget","organization"]),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteProductionSchedule:function(b){return c.wrap(function(c){a.post(f+"api/production-schedule/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("roleApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getRoles:function(){return b.wrap(function(b){a.get(d+"api/roles",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateRoleApps:function(c){return b.wrap(function(b){a.post(d+"api/role-apps",c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("serviceApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getServices:function(a){return b.page(e+"api/services",a)},getServiceTypes:function(){return c.wrap(function(b){a.get(e+"api/service/types",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getService:function(b){return c.wrap(function(c){a.get(e+"api/service/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("shareApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getDocument:function(c){return b.wrap(function(b){a.get(d+"api/share/document/"+c,{withCredentials:!0}).then(function(a){b.resolve(a.data)
},b.reject)})}}}]),sdkApiApp.factory("subRegionApi",["$http","$log","pagingService","promiseService","configuration",function(a,b,c,d,e){var f=e.getServer();return{getSubRegions:function(a,d){return a&&"boolean"!=typeof a&&(b.debug(a),d=a,a=void 0),c.page(f+"api/guidelines/subregions"+(a?"?geometries="+a:""),d)},getSubRegion:function(b,c){return d.wrap(function(d){a.get(f+"api/guidelines/"+b+(c?"?versionId="+c:""),{withCredentials:!0}).then(function(a){d.resolve(a.data)},d.reject)})}}}]),sdkApiApp.factory("taskApi",["$http","pagingService","promiseService","configuration","underscore",function(a,b,c,d,e){var f=d.getServer();return{getTasks:function(a){return b.page(f+"api/tasks",a)},getManagerTasks:function(a){return b.page(f+"api/tasks/manager",a)},createTask:function(b){return c.wrap(function(c){a.post(f+"api/task",e.omit(b,["document","organization","subtasks"]),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getTask:function(b){return c.wrap(function(c){a.get(f+"api/task/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},sendTask:function(b,d){return c.wrap(function(c){a.post(f+"api/task/"+b+"/send",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateTask:function(b){return c.wrap(function(c){a.post(f+"api/task/"+b.id,e.omit(b,["document","organization","subtasks"]),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteTask:function(b){return c.wrap(function(c){a.post(f+"api/task/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("teamApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getTeams:function(){return b.wrap(function(b){a.get(d+"api/teams",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},createTeam:function(c){return b.wrap(function(b){a.post(d+"api/team",c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getTeam:function(c){return b.wrap(function(b){a.get(d+"api/team/"+c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getTeamUsers:function(c){return b.wrap(function(b){a.get(d+"api/team/"+c+"/users",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateTeam:function(c){return b.wrap(function(b){a.post(d+"api/team/"+c.id,c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteTeam:function(c){return b.wrap(function(b){a.post(d+"api/team/"+c+"/delete",{},{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("userApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getUsers:function(a){return b.page(e+"api/users",a)},getUsersByRole:function(b,d){return c.wrap(function(c){a.get(e+"api/users/farmer/"+b+"?rolename="+d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getUsersPositions:function(){return c.wrap(function(b){a.get(e+"api/users/positions",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},createUser:function(b){return c.wrap(function(c){a.post(e+"api/user",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getUser:function(b,d){if(d)var f="?username="+d;return c.wrap(function(c){a.get(e+"api/user/"+b+(f?f:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateUser:function(b){return c.wrap(function(c){a.post(e+"api/user/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateUserGroups:function(b){return c.wrap(function(c){a.post(e+"api/user/"+b.id+"/groups",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteUser:function(b){return c.wrap(function(c){a.post(e+"api/user/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("workloadApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{updateWorkload:function(b){return c.wrap(function(c){a.post(e+"api/workload/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]);var sdkAuthorizationApp=angular.module("ag.sdk.authorization",["ag.sdk.config","ag.sdk.utilities","satellizer"]);sdkAuthorizationApp.factory("authorizationApi",["$http","promiseService","configuration","underscore",function(a,b,c,d){var e=c.getServer();return{requestPasswordReset:function(c){return b.wrap(function(b){a.post(e+"auth/request-reset",{email:c}).then(function(a){b.resolve(a.data)},b.reject)})},confirmPasswordReset:function(c,d,f){return b.wrap(function(b){a.post(e+"auth/confirm-reset",{code:c,email:d,password:f}).then(function(a){b.resolve(a.data)},b.reject)})},refresh:function(c){return b.wrap(function(b){a.post(e+"auth/refresh-token",{refresh_token:c},{skipAuthorization:!0}).then(function(a){b.resolve(a.data)},b.reject)})},changePassword:function(c,d){return b.wrap(function(b){a.post(e+"auth/change-password",{password:c,newPassword:d}).then(function(a){b.resolve(a.data)},b.reject)})},getUser:function(){return b.wrap(function(b){a.get(e+"api/me").then(function(a){b.resolve(a.data)},b.reject)})},updateUser:function(c){return b.wrap(function(b){a.post(e+"api/me",d.omit(c,"profilePhotoSrc")).then(function(a){b.resolve(a.data)},b.reject)})},logout:function(){return a.post(e+"logout",{})}}}]),sdkAuthorizationApp.provider("authorization",["$httpProvider",function(a){var b,c={open:1,user:2,admin:4},d={open:c.open|c.user|c.admin,user:c.user|c.admin,admin:c.admin},e={email:"",role:c.open},f=void 0;a.interceptors.push(["$injector","$rootScope","localStore","promiseService",function(a,c,d,e){function f(a){var b={config:a,defer:e.defer()};return h.push(b),b.defer.promise}function g(a){for(;h.length>0;){var b=h.shift();a&&(b.config.headers.Authorization="Bearer "+a),b.defer.resolve(b.config)}}var h=[];return{request:function(c){if(c.skipAuthorization||c.headers.Authorization)return c;if(b&&b.refresh_token){if(0==h.length){var e=a.get("$auth"),i=a.get("authorizationApi");i.refresh(b.refresh_token).then(function(a){a&&(e.setToken(a.token),d.setItem("tokens",a),b=a),g(a&&a.token)},function(){g()})}return f(c)}return c},responseError:function(a){return 401===a.status?c.$broadcast("authorization::unauthorized",a):403===a.status&&c.$broadcast("authorization::forbidden",a),e.reject(a)}}}]);var g=["promiseService",function(a){return function(){return a.wrap(function(a){a.resolve()})}}];return{userRole:c,accessLevel:d,setPreAuthenticate:function(a){g=a},$get:["$auth","$injector","$rootScope","$timeout","authorizationApi","localStore","promiseService",function(a,h,i,j,k,l,m){function n(){return l.getItem("user")||e}function o(a){return a=a||e,void 0===a.role&&(a.role="admin"==a.accessLevel?c.admin:c.user),l.setItem("user",a),a}function p(c){return c&&c.data&&(a.setToken(c.data.token),l.setItem("tokens",c.data),b=c.data),k.getUser()}function q(a){return function(b){f=void 0,s=o(b),a.resolve(s),i.$broadcast("authorization::login",s)}}function r(a){return function(b){f={code:b.status,type:"error",message:b.data&&b.data.message||"Unable to Authenticate. Please try again."},l.removeItem("user"),a.reject({data:f})}}var s=n();return b=l.getItem("tokens"),g instanceof Array&&(g=h.invoke(g)),k.getUser().then(function(a){s=o(a),i.$broadcast("authorization::login",s)},function(){i.$broadcast("authorization::unauthorized")}),i.$on("authorization::unauthorized",function(){l.removeItem("user"),l.removeItem("tokens"),b=void 0}),{userRole:c,accessLevel:d,lastError:function(){return f},currentUser:function(){return s},getAuthority:function(){return b&&b.authority},isAllowed:function(a){return 0!=(a&s.role)},isLoggedIn:function(){return 0!=(d.user&s.role)},login:function(b,c){var d={email:b,password:c};return m.wrap(function(b){return g().then(function(){return a.login(d)},m.throwError).then(p,m.throwError).then(q(b),r(b))})},authenticate:function(b,c){return m.wrap(function(d){return g().then(function(){return a.authenticate(b,c)},m.throwError).then(p,m.throwError).then(q(d),r(d))})},requestPasswordReset:k.requestPasswordReset,confirmPasswordReset:k.confirmPasswordReset,changePassword:function(a,b){return k.changePassword(a,b)},changeUserDetails:function(a){return k.updateUser(a).then(function(a){return s=o(a),i.$broadcast("authorization::user-details__changed",s),a})},register:function(b){return m.wrap(function(c){return g().then(function(){return a.signup(b)},m.throwError).then(p,m.throwError).then(q(c),r(c))})},logout:function(){return k.logout().then(function(){a.logout(),l.removeItem("user"),l.removeItem("tokens"),b=void 0,i.$broadcast("authorization::logout")})}}}]}}]);var sdkConfigApp=angular.module("ag.sdk.config",[]);sdkConfigApp.provider("configuration",["$httpProvider",function(a){var b="",c="local",d=[],e={local:"",testing:"https://dev-enterprise.agrista.com/",staging:"https://staging-enterprise.agrista.com/",production:"https://enterprise.agrista.com/"},f={},g=function(a){return-1!==d.indexOf(a)},h=function(a){0==g(a)&&d.push(a)};return{addModule:h,hasModule:g,setServers:function(a){angular.forEach(a,function(a,b){a.lastIndexOf("/")!==a.length-1&&(a+="/"),e[b]=a}),this.useHost(c,b)},setSslFingerprints:function(a,b){f={primary:a,secondary:b}},useHost:function(d,f,g){"function"==typeof f&&(g=f,f=""),b=f||"",void 0!==e[d]&&(c=d,a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]),"function"==typeof g&&g(e[c])},$get:function(){return{addModule:h,hasModule:g,getVersion:function(){return b},getHost:function(){return c},getServer:function(){return e[c]},getSslFingerprint:function(a){return f[a]}}}}}]);var sdkIdApp=angular.module("ag.sdk.id",["ag.sdk.utilities"]);sdkIdApp.factory("objectId",["localStore",function(a){var b=function(){function c(){return this instanceof b?void("object"==typeof arguments[0]?(this.timestamp=arguments[0].timestamp,this.machine=arguments[0].machine,this.pid=arguments[0].pid,this.increment=arguments[0].increment):"string"==typeof arguments[0]&&24==arguments[0].length?(this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))):4==arguments.length&&null!=arguments[0]?(this.timestamp=arguments[0],this.machine=arguments[1],this.pid=arguments[2],this.increment=arguments[3]):(this.timestamp=Math.floor((new Date).valueOf()/1e3),this.machine=f,this.pid=e,this.increment=d++,d>16777215&&(d=0))):new b(arguments[0],arguments[1],arguments[2],arguments[3]).toString()}var d=0,e=Math.floor(32767*Math.random()),f=Math.floor(16777216*Math.random()),g=parseInt(a.getItem("mongoMachineId"));return g>=0&&16777215>=g&&(f=Math.floor(a.getItem("mongoMachineId"))),a.setItem("mongoMachineId",f),c}();return b.prototype.getDate=function(){return new Date(1e3*this.timestamp)},b.prototype.toArray=function(){var a,b=this.toString(),c=[];for(a=0;12>a;a++)c[a]=parseInt(b.slice(2*a,2*a+2),16);return c},b.prototype.toString=function(){var a=this.timestamp.toString(16),b=this.machine.toString(16),c=this.pid.toString(16),d=this.increment.toString(16);return"00000000".substr(0,8-a.length)+a+"000000".substr(0,6-b.length)+b+"0000".substr(0,4-c.length)+c+"000000".substr(0,6-d.length)+d},b.prototype.toBase64String=function(){return window.btoa(this.toString())},function(){return new b}}]),sdkIdApp.factory("generateUUID",function(){function a(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:7&c|8).toString(16)});return b}return function(){return a()}});var sdkLibraryApp=angular.module("ag.sdk.library",[]);sdkLibraryApp.constant("underscore",window._),sdkLibraryApp.constant("moment",window.moment),sdkLibraryApp.constant("geojsonUtils",window.gju),sdkLibraryApp.constant("naturalSort",window.naturalSort);var sdkMonitorApp=angular.module("ag.sdk.monitor",["ag.sdk.utilities"]);sdkMonitorApp.factory("promiseMonitor",["$log","safeApply",function(a,b){function c(d){if(!(this instanceof c))return new c(d);var e={total:0,complete:0,resolved:0,rejected:0,percent:0},f=function(){e.complete++,e.percent=100/e.total*e.complete,a.debug("MONITOR TOTAL: "+e.total+" COMPLETE: "+e.complete+" PERCENT: "+e.percent),b(function(){d(e.complete==e.total?{type:"complete",percent:e.percent,stats:e}:{type:"progress",percent:e.percent,stats:e})})};return{stats:function(){return e},clear:function(){e={total:0,complete:0,resolved:0,rejected:0,percent:0}},add:function(a){return e.total++,a.then(function(){e.resolved++,f()},function(a){e.rejected++,b(function(){d({type:"error"},a)}),f()}),a}}}return function(a){return new c(a)}}]);var skdUtilitiesApp=angular.module("ag.sdk.utilities",["ngCookies","ag.sdk.id"]);skdUtilitiesApp.factory("safeApply",["$rootScope",function(a){return function(b){a.$$phase?b():a.$apply(b)}}]),skdUtilitiesApp.directive("stopEvent",function(){return{restrict:"A",link:function(a,b,c){b.bind(c.stopEvent,function(a){a.stopPropagation()})}}}),skdUtilitiesApp.factory("dataMapService",[function(){return function(a,b,c){var d=[];a instanceof Array==!1&&(a=void 0!==a?[a]:[]);for(var e=0;e<a.length;e++){var f,g=a[e];if("function"==typeof b)f=b(g);else{f={};for(var h in b)b.hasOwnProperty(h)&&(f[h]=g[b[h]])}f instanceof Array?d=d.concat(f):"object"==typeof f?(c!==!0&&(f.id=f.id||g.id),d.push(f)):void 0!==f&&d.push(f)}return d}}]),skdUtilitiesApp.factory("pagingService",["$rootScope","$http","promiseService","dataMapService","generateUUID","underscore",function(a,b,c,d,e,f){var g=e();return{initialize:function(b,f,h,i){"object"==typeof h&&(i=h,h=f,f=void 0),"object"==typeof f&&(i=f,h=void 0,f=void 0),g=e(),h=h||function(b){a.$broadcast("paging::items",b)};var j=_.defaults(i||{},{limit:50,resulttype:"simple"}),k={page:_.clone(j),busy:!1,complete:!1,disabled:function(){return k.busy||k.complete||void 0!==k.searching&&k.searching.complete},search:function(a){a&&a.length>0?((void 0===k.searching||k.searching.complete===!1||k.searching.search!==a)&&(k.searching=_.defaults({search:a},j)),k.request()):delete k.searching},request:function(a){return c.wrap(function(c){if(k.disabled())c.reject();else{var e=g;a=a||(k.searching?k.searching:k.page),k.busy=!0,delete a.complete,b(a).then(function(b){void 0===a.search?(k.page.offset=void 0===k.page.offset?b.length:k.page.offset+b.length,k.complete=b.length!==k.page.limit):(k.searching=a,k.searching.offset=void 0===k.searching.offset?b.length:k.searching.offset+b.length,k.searching.complete=b.length!==k.searching.limit),k.busy=!1,f&&(b=d(b,f)),e===g&&h(b),c.resolve(b)},function(a){k.complete=!0,k.busy=!1,c.reject(a)})}})}};return k},page:function(a,d){return c.wrap(function(c){var e=function(a){c.resolve(a.data)};if(f.isUndefined(d))b.get(a,{withCredentials:!0}).then(e,c.reject);else if(f.isString(d))b.get(d,{withCredentials:!0}).then(e,c.reject);else{var g=f.isObject(d.resulttype)?{method:"POST",url:a,data:d.resulttype,params:f.omit(d,"resulttype"),withCredentials:!0}:{method:"GET",url:a,params:d,withCredentials:!0};b(g).then(e,c.reject)}})}}}]),skdUtilitiesApp.factory("promiseService",["$q","safeApply",function(a,b){var c=function(){var c=a.defer();return{resolve:function(a){b(function(){c.resolve(a)})},reject:function(a){b(function(){c.reject(a)})},promise:c.promise}},d=function(b,c){var d=a.defer(),e=d.promise,f=[];b(c);var g=function(a){return e.then(function(b){return b instanceof Array?f=f.concat(b):b&&f.push(b),a?a():f},function(a){throw a})};return angular.forEach(c,function(a){e=g(a)}),d.resolve(),g()},e=function(b,c){return b(c),a.all(c)};return{all:function(b){return a.all(b)},chain:function(a){return d(a,[])},wrap:function(a){var b=c();return a(b),b.promise},wrapAll:function(a){return e(a,[])},arrayWrap:function(a){return e(a,[])},objectWrap:function(a){return e(a,{})},reject:function(b){return a.reject(b)},throwError:function(a){throw a},defer:c}}]),skdUtilitiesApp.factory("localStore",["$cookieStore","$window",function(a,b){return{setItem:function(c,d){b.localStorage?b.localStorage.setItem(c,JSON.stringify(d)):a.put(c,d)},getItem:function(c,d){return b.localStorage?JSON.parse(b.localStorage.getItem(c))||d:a.get(c)||d},removeItem:function(c){b.localStorage?b.localStorage.removeItem(c):a.remove(c)}}}]),skdUtilitiesApp.filter("round",["$filter",function(){return function(a,b){return b=b||2,Number(Math.round(a+"e"+b)+"e-"+b)}}]);var sdkHelperAssetApp=angular.module("ag.sdk.helper.asset",["ag.sdk.helper.farmer","ag.sdk.helper.attachment","ag.sdk.library"]);sdkHelperAssetApp.factory("assetHelper",["$filter","attachmentHelper","landUseHelper","underscore",function(a,b,c,d){var e=function(b){if(b.data)switch(b.type){case"crop":case"permanent crop":case"plantation":return(b.data.plantedArea?a("number")(b.data.plantedArea,2)+"ha":"")+(b.data.plantedArea&&b.data.crop?" of ":"")+(b.data.crop?b.data.crop:"")+(b.data.fieldName?" on field "+b.data.fieldName:"");case"farmland":return b.data.label?b.data.label:b.data.portionLabel?b.data.portionLabel:b.data.portionNumber?"Ptn. "+b.data.portionNumber:"Rem. extent of farm";case"improvement":return b.data.name;case"cropland":return(b.data.equipped?"Irrigated "+b.type+" ("+(b.data.irrigation?b.data.irrigation+" irrigation from ":"")+b.data.waterSource+")":(b.data.irrigated?"Irrigable, unequipped ":"Non irrigable ")+b.type)+(b.data.fieldName?" on field "+b.data.fieldName:"");case"livestock":return b.data.type+(b.data.category?" - "+b.data.category:"");case"pasture":return(b.data.intensified?b.data.crop||"Intensified pasture":"Natural grazing")+(b.data.fieldName?" on field "+b.data.fieldName:"");case"vme":return b.data.category+(b.data.model?" model "+b.data.model:"");case"wasteland":return"Wasteland";case"water source":case"water right":return b.data.waterSource+(b.data.fieldName?" on field "+b.data.fieldName:"")}return g[type]},f=function(c,f){var g={id:c.id||c.$id,type:c.type,updatedAt:c.updatedAt};return c.data&&("crop"==c.type?(g.title=e(c),g.subtitle=c.data.season?c.data.season:"",g.groupby=c.farmId):"farmland"==c.type?(g.title=e(c),g.subtitle=void 0!==c.data.area?"Area: "+a("number")(c.data.area,2)+"ha":"Unknown area",g.groupby=c.farmId):"improvement"==c.type?(g.title=e(c),g.subtitle=c.data.type+(c.data.category?" - "+c.data.category:""),g.summary=c.data.description||"",g.groupby=c.farmId):"cropland"==c.type?(g.title=e(c),g.subtitle=void 0!==c.data.size?"Area: "+a("number")(c.data.size,2)+"ha":"Unknown area",g.groupby=c.farmId):"livestock"==c.type?(g.title=e(c),g.subtitle=(c.data.breed?c.data.breed+" for ":"For ")+c.data.purpose,g.summary=c.data.description||"",g.groupby=c.data.type):"pasture"==c.type?(g.title=e(c),g.subtitle=void 0!==c.data.size?"Area: "+a("number")(c.data.size,2)+"ha":"Unknown area",g.groupby=c.farmId):"permanent crop"==c.type?(g.title=e(c),g.subtitle=c.data.establishedDate?"Established: "+a("date")(c.data.establishedDate,"dd/MM/yy"):"",g.groupby=c.farmId):"plantation"==c.type?(g.title=e(c),g.subtitle=c.data.establishedDate?"Established: "+a("date")(c.data.establishedDate,"dd/MM/yy"):"",g.groupby=c.farmId):"vme"==c.type?(g.title=e(c),g.subtitle="Quantity: "+c.data.quantity,g.summary=c.data.description||"",g.groupby=c.data.type):"wasteland"==c.type?(g.title=e(c),g.subtitle=void 0!==c.data.size?"Area: "+a("number")(c.data.size,2)+"ha":"Unknown area",g.groupby=c.farmId):"water right"==c.type&&(g.title=e(c),g.subtitle=void 0!==c.data.size?"Irrigatable Extent: "+a("number")(c.data.size,2)+"ha":"Unknown area",g.groupby=c.farmId),g.thumbnailUrl=b.findSize(c,"thumb","img/camera.png")),f&&(g=d.extend(g,f)),g},g={crop:"Crops",farmland:"Farmlands",improvement:"Fixed Improvements",cropland:"Cropland",livestock:"Livestock",pasture:"Pastures","permanent crop":"Permanent Crops",plantation:"Plantations",vme:"Vehicles, Machinery & Equipment",wasteland:"Wasteland","water right":"Water Rights"},h={improvement:["Livestock & Game","Crop Cultivation & Processing","Residential","Business","Equipment & Utilities","Infrastructure","Recreational & Misc."],livestock:["Cattle","Sheep","Pigs","Chickens","Ostriches","Goats"],vme:["Vehicles","Machinery","Equipment"]},i={improvement:[{category:"Airport",subCategory:"Hangar"},{category:"Airport",subCategory:"Helipad"},{category:"Airport",subCategory:"Runway"},{category:"Poultry",subCategory:"Hatchery"},{category:"Aquaculture",subCategory:"Pond"},{category:"Aquaculture",subCategory:"Net House"},{category:"Aviary"},{category:"Beekeeping"},{category:"Borehole"},{category:"Borehole",subCategory:"Equipped"},{category:"Borehole",subCategory:"Pump"},{category:"Borehole",subCategory:"Windmill"},{category:"Poultry",subCategory:"Broiler House"},{category:"Poultry",subCategory:"Broiler House - Atmosphere"},{category:"Poultry",subCategory:"Broiler House - Semi"},{category:"Poultry",subCategory:"Broiler House - Zinc"},{category:"Building",subCategory:"Administrative"},{category:"Building"},{category:"Building",subCategory:"Commercial"},{category:"Building",subCategory:"Entrance"},{category:"Building",subCategory:"Lean-to"},{category:"Building",subCategory:"Outbuilding"},{category:"Building",subCategory:"Gate"},{category:"Cold Storage"},{category:"Commercial",subCategory:"Coffee Shop"},{category:"Commercial",subCategory:"Sales Facility"},{category:"Commercial",subCategory:"Shop"},{category:"Commercial",subCategory:"Bar"},{category:"Commercial",subCategory:"Café"},{category:"Commercial",subCategory:"Restaurant"},{category:"Commercial",subCategory:"Factory"},{category:"Commercial",subCategory:"Tasting Facility"},{category:"Commercial",subCategory:"Cloth House"},{category:"Compost",subCategory:"Preparing Unit"},{category:"Crocodile Dam"},{category:"Crop Processing",subCategory:"Degreening Room"},{category:"Crop Processing",subCategory:"Dehusking Facility"},{category:"Crop Processing",subCategory:"Drying Facility"},{category:"Crop Processing",subCategory:"Drying Tunnels"},{category:"Crop Processing",subCategory:"Sorting Facility"},{category:"Crop Processing",subCategory:"Drying Oven"},{category:"Crop Processing",subCategory:"Drying Racks"},{category:"Crop Processing",subCategory:"Crushing Plant"},{category:"Crop Processing",subCategory:"Nut Cracking Facility"},{category:"Crop Processing",subCategory:"Nut Factory"},{category:"Dairy"},{category:"Dairy",subCategory:"Pasteurising Facility"},{category:"Dairy",subCategory:"Milking Parlour"},{category:"Dam"},{category:"Dam",subCategory:"Filter"},{category:"Dam",subCategory:"Trout"},{category:"Domestic",subCategory:"Chicken Coop"},{category:"Domestic",subCategory:"Chicken Run"},{category:"Domestic",subCategory:"Kennels"},{category:"Domestic",subCategory:"Gardening Facility"},{category:"Education",subCategory:"Conference Room"},{category:"Education",subCategory:"Classroom"},{category:"Education",subCategory:"Crèche"},{category:"Education",subCategory:"School"},{category:"Education",subCategory:"Training Facility"},{category:"Equipment",subCategory:"Air Conditioner"},{category:"Equipment",subCategory:"Gantry"},{category:"Equipment",subCategory:"Oven"},{category:"Equipment",subCategory:"Pump"},{category:"Equipment",subCategory:"Pumphouse"},{category:"Equipment",subCategory:"Scale"},{category:"Feed Mill"},{category:"Feedlot"},{category:"Fencing"},{category:"Fencing",subCategory:"Electric"},{category:"Fencing",subCategory:"Game"},{category:"Fencing",subCategory:"Perimeter"},{category:"Fencing",subCategory:"Security"},{category:"Fencing",subCategory:"Wire"},{category:"Fuel",subCategory:"Tanks"},{category:"Fuel",subCategory:"Tank Stand"},{category:"Fuel",subCategory:"Fuelling Facility"},{category:"Grain Mill"},{category:"Greenhouse"},{category:"Infrastructure"},{category:"Irrigation",subCategory:"Sprinklers"},{category:"Irrigation"},{category:"Laboratory"},{category:"Livestock Handling",subCategory:"Auction Facility"},{category:"Livestock Handling",subCategory:"Cages"},{category:"Livestock Handling",subCategory:"Growing House"},{category:"Livestock Handling",subCategory:"Pens"},{category:"Livestock Handling",subCategory:"Shelter"},{category:"Livestock Handling",subCategory:"Breeding Facility"},{category:"Livestock Handling",subCategory:"Culling Shed"},{category:"Livestock Handling",subCategory:"Dipping Facility"},{category:"Livestock Handling",subCategory:"Elephant Enclosures"},{category:"Livestock Handling",subCategory:"Feed Troughs/Dispensers"},{category:"Livestock Handling",subCategory:"Horse Walker"},{category:"Livestock Handling",subCategory:"Maternity Shelter/Pen"},{category:"Livestock Handling",subCategory:"Quarantine Area"},{category:"Livestock Handling",subCategory:"Rehab Facility"},{category:"Livestock Handling",subCategory:"Shearing Facility"},{category:"Livestock Handling",subCategory:"Stable"},{category:"Livestock Handling",subCategory:"Surgery"},{category:"Livestock Handling",subCategory:"Treatment Area"},{category:"Livestock Handling",subCategory:"Weaner House"},{category:"Livestock Handling",subCategory:"Grading Facility"},{category:"Livestock Handling",subCategory:"Inspection Facility"},{category:"Logistics",subCategory:"Handling Equipment"},{category:"Logistics",subCategory:"Handling Facility"},{category:"Logistics",subCategory:"Depot"},{category:"Logistics",subCategory:"Loading Area"},{category:"Logistics",subCategory:"Loading Shed"},{category:"Logistics",subCategory:"Hopper"},{category:"Logistics",subCategory:"Weigh Bridge"},{category:"Meat Processing",subCategory:"Abattoir"},{category:"Meat Processing",subCategory:"Deboning Room"},{category:"Meat Processing",subCategory:"Skinning Facility"},{category:"Mill"},{category:"Mushrooms",subCategory:"Cultivation"},{category:"Mushrooms",subCategory:"Sweat Room"},{category:"Nursery ",subCategory:"Plant"},{category:"Nursery ",subCategory:"Plant Growing Facility"},{category:"Office"},{category:"Packaging Facility"},{category:"Paddocks",subCategory:"Camp"},{category:"Paddocks",subCategory:"Kraal"},{category:"Paddocks"},{category:"Piggery",subCategory:"Farrowing House"},{category:"Piggery",subCategory:"Pig Sty"},{category:"Processing",subCategory:"Bottling Facility"},{category:"Processing",subCategory:"Flavour Shed"},{category:"Processing",subCategory:"Processing Facility"},{category:"Recreation",subCategory:"Viewing Area"},{category:"Recreation",subCategory:"BBQ"},{category:"Recreation",subCategory:"Clubhouse"},{category:"Recreation",subCategory:"Event Venue"},{category:"Recreation",subCategory:"Gallery"},{category:"Recreation",subCategory:"Game Room"},{category:"Recreation",subCategory:"Gazebo"},{category:"Recreation",subCategory:"Gymnasium"},{category:"Recreation",subCategory:"Jacuzzi"},{category:"Recreation",subCategory:"Judging Booth"},{category:"Recreation",subCategory:"Museum"},{category:"Recreation",subCategory:"Play Area"},{category:"Recreation",subCategory:"Pool House"},{category:"Recreation",subCategory:"Pottery Room"},{category:"Recreation",subCategory:"Racing Track"},{category:"Recreation",subCategory:"Salon"},{category:"Recreation",subCategory:"Sauna"},{category:"Recreation",subCategory:"Shooting Range"},{category:"Recreation",subCategory:"Spa Facility"},{category:"Recreation",subCategory:"Squash Court"},{category:"Recreation",subCategory:"Swimming Pool"},{category:"Recreation"},{category:"Religeous",subCategory:"Church"},{category:"Residential",subCategory:"Carport"},{category:"Residential",subCategory:"Driveway"},{category:"Residential",subCategory:"Flooring"},{category:"Residential",subCategory:"Paving"},{category:"Residential",subCategory:"Roofing"},{category:"Residential",subCategory:"Water Feature"},{category:"Residential",subCategory:"Hall"},{category:"Residential",subCategory:"Balcony"},{category:"Residential",subCategory:"Canopy"},{category:"Residential",subCategory:"Concrete Surface"},{category:"Residential",subCategory:"Courtyard"},{category:"Residential",subCategory:"Covered"},{category:"Residential",subCategory:"Deck"},{category:"Residential",subCategory:"Mezzanine"},{category:"Residential",subCategory:"Parking Area"},{category:"Residential",subCategory:"Patio"},{category:"Residential",subCategory:"Porch"},{category:"Residential",subCategory:"Porte Cochere"},{category:"Residential",subCategory:"Terrace"},{category:"Residential",subCategory:"Veranda"},{category:"Residential",subCategory:"Walkways"},{category:"Residential",subCategory:"Rondavel"},{category:"Residential",subCategory:"Accommodation Units"},{category:"Residential",subCategory:"Boma"},{category:"Residential",subCategory:"Bungalow"},{category:"Residential",subCategory:"Bunker"},{category:"Residential",subCategory:"Cabin"},{category:"Residential",subCategory:"Chalet"},{category:"Residential",subCategory:"Community Centre"},{category:"Residential",subCategory:"Dormitory"},{category:"Residential",subCategory:"Dwelling"},{category:"Residential",subCategory:"Flat"},{category:"Residential",subCategory:"Kitchen"},{category:"Residential",subCategory:"Lapa"},{category:"Residential",subCategory:"Laundry Facility"},{category:"Residential",subCategory:"Locker Room"},{category:"Residential",subCategory:"Lodge"},{category:"Residential",subCategory:"Shower"},{category:"Residential",subCategory:"Toilets"},{category:"Residential",subCategory:"Room"},{category:"Residential",subCategory:"Cottage"},{category:"Residential",subCategory:"Garage"},{category:"Roads",subCategory:"Access Roads"},{category:"Roads",subCategory:"Gravel"},{category:"Roads",subCategory:"Tarred"},{category:"Security",subCategory:"Control Room"},{category:"Security",subCategory:"Guardhouse"},{category:"Security",subCategory:"Office"},{category:"Shade Nets"},{category:"Silo"},{category:"Sports",subCategory:"Arena"},{category:"Sports",subCategory:"Tennis Court"},{category:"Staff",subCategory:"Hostel"},{category:"Staff",subCategory:"Hut"},{category:"Staff",subCategory:"Retirement Centre"},{category:"Staff",subCategory:"Staff Building"},{category:"Staff",subCategory:"Canteen"},{category:"Staff",subCategory:"Dining Facility"},{category:"Storage",subCategory:"Truck Shelter"},{category:"Storage",subCategory:"Barn"},{category:"Storage",subCategory:"Dark Room"},{category:"Storage",subCategory:"Bin Compartments"},{category:"Storage",subCategory:"Machinery"},{category:"Storage",subCategory:"Saddle Room"},{category:"Storage",subCategory:"Shed"},{category:"Storage",subCategory:"Chemicals"},{category:"Storage",subCategory:"Tools"},{category:"Storage",subCategory:"Dry"},{category:"Storage",subCategory:"Equipment"},{category:"Storage",subCategory:"Feed"},{category:"Storage",subCategory:"Fertilizer"},{category:"Storage",subCategory:"Fuel"},{category:"Storage",subCategory:"Grain"},{category:"Storage",subCategory:"Hides"},{category:"Storage",subCategory:"Oil"},{category:"Storage",subCategory:"Pesticide"},{category:"Storage",subCategory:"Poison"},{category:"Storage",subCategory:"Seed"},{category:"Storage",subCategory:"Zinc"},{category:"Storage",subCategory:"Sulphur"},{category:"Storage"},{category:"Storage",subCategory:"Vitamin Room"},{category:"Sugar Mill"},{category:"Tanks",subCategory:"Water"},{category:"Timber Mill"},{category:"Trench"},{category:"Utilities",subCategory:"Battery Room"},{category:"Utilities",subCategory:"Boiler Room"},{category:"Utilities",subCategory:"Compressor Room"},{category:"Utilities",subCategory:"Engine Room"},{category:"Utilities",subCategory:"Generator"},{category:"Utilities",subCategory:"Power Room"},{category:"Utilities",subCategory:"Pumphouse"},{category:"Utilities",subCategory:"Transformer Room"},{category:"Utilities"},{category:"Vacant Area"},{category:"Vehicles",subCategory:"Transport Depot"},{category:"Vehicles",subCategory:"Truck Wash"},{category:"Vehicles",subCategory:"Workshop"},{category:"Walls"},{category:"Walls",subCategory:"Boundary"},{category:"Walls",subCategory:"Retaining"},{category:"Walls",subCategory:"Security"},{category:"Warehouse"},{category:"Water",subCategory:"Reservoir"},{category:"Water",subCategory:"Tower"},{category:"Water",subCategory:"Purification Plant"},{category:"Water",subCategory:"Reticulation Works"},{category:"Water",subCategory:"Filter Station"},{category:"Wine Cellar",subCategory:"Tanks"},{category:"Wine Cellar"},{category:"Wine Cellar",subCategory:"Winery"},{category:"Wine Cellar",subCategory:"Barrel Maturation Room"}],livestock:[{category:"Cattle",subCategory:"Phase A Bulls",purpose:"Breeding"},{category:"Cattle",subCategory:"Phase B Bulls",purpose:"Breeding"},{category:"Cattle",subCategory:"Phase C Bulls",purpose:"Breeding"},{category:"Cattle",subCategory:"Phase D Bulls",purpose:"Breeding"},{category:"Cattle",subCategory:"Heifers",purpose:"Breeding"},{category:"Cattle",subCategory:"Bull Calves",purpose:"Breeding"},{category:"Cattle",subCategory:"Heifer Calves",purpose:"Breeding"},{category:"Cattle",subCategory:"Tollies 1-2",purpose:"Breeding"},{category:"Cattle",subCategory:"Heifers 1-2",purpose:"Breeding"},{category:"Cattle",subCategory:"Culls",purpose:"Breeding"},{category:"Cattle",subCategory:"Bulls",purpose:"Dairy"},{category:"Cattle",subCategory:"Dry Cows",purpose:"Dairy"},{category:"Cattle",subCategory:"Lactating Cows",purpose:"Dairy"},{category:"Cattle",subCategory:"Heifers",purpose:"Dairy"},{category:"Cattle",subCategory:"Calves",purpose:"Dairy"},{category:"Cattle",subCategory:"Culls",purpose:"Dairy"},{category:"Cattle",subCategory:"Bulls",purpose:"Slaughter"},{category:"Cattle",subCategory:"Cows",purpose:"Slaughter"},{category:"Cattle",subCategory:"Heifers",purpose:"Slaughter"},{category:"Cattle",subCategory:"Weaners",purpose:"Slaughter"},{category:"Cattle",subCategory:"Calves",purpose:"Slaughter"},{category:"Cattle",subCategory:"Culls",purpose:"Slaughter"},{category:"Sheep",subCategory:"Rams",purpose:"Breeding"},{category:"Sheep",subCategory:"Young Rams",purpose:"Breeding"},{category:"Sheep",subCategory:"Ewes",purpose:"Breeding"},{category:"Sheep",subCategory:"Young Ewes",purpose:"Breeding"},{category:"Sheep",subCategory:"Lambs",purpose:"Breeding"},{category:"Sheep",subCategory:"Wethers",purpose:"Breeding"},{category:"Sheep",subCategory:"Culls",purpose:"Breeding"},{category:"Sheep",subCategory:"Rams",purpose:"Slaughter"},{category:"Sheep",subCategory:"Ewes",purpose:"Slaughter"},{category:"Sheep",subCategory:"Lambs",purpose:"Slaughter"},{category:"Sheep",subCategory:"Wethers",purpose:"Slaughter"},{category:"Sheep",subCategory:"Culls",purpose:"Slaughter"},{category:"Pigs",subCategory:"Boars",purpose:"Slaughter"},{category:"Pigs",subCategory:"Breeding Sows",purpose:"Slaughter"},{category:"Pigs",subCategory:"Weaned pigs",purpose:"Slaughter"},{category:"Pigs",subCategory:"Piglets",purpose:"Slaughter"},{category:"Pigs",subCategory:"Porkers",purpose:"Slaughter"},{category:"Pigs",subCategory:"Baconers",purpose:"Slaughter"},{category:"Pigs",subCategory:"Culls",purpose:"Slaughter"},{category:"Chickens",subCategory:"Day Old Chicks",purpose:"Broilers"},{category:"Chickens",subCategory:"Broilers",purpose:"Broilers"},{category:"Chickens",subCategory:"Hens",purpose:"Layers"},{category:"Chickens",subCategory:"Point of Laying Hens",purpose:"Layers"},{category:"Chickens",subCategory:"Culls",purpose:"Layers"},{category:"Ostriches",subCategory:"Breeding Stock",purpose:"Slaughter"},{category:"Ostriches",subCategory:"Slaughter Birds > 3 months",purpose:"Slaughter"},{category:"Ostriches",subCategory:"Slaughter Birds < 3 months",purpose:"Slaughter"},{category:"Ostriches",subCategory:"Chicks",purpose:"Slaughter"},{category:"Goats",subCategory:"Rams",purpose:"Slaughter"},{category:"Goats",subCategory:"Breeding Ewes",purpose:"Slaughter"},{category:"Goats",subCategory:"Young Ewes",purpose:"Slaughter"},{category:"Goats",subCategory:"Kids",purpose:"Slaughter"}],vme:[{category:"Vehicles",subCategory:"Bakkie"},{category:"Vehicles",subCategory:"Car"},{category:"Vehicles",subCategory:"Truck"},{category:"Vehicles",subCategory:"Tractor"},{category:"Machinery",subCategory:"Mower"},{category:"Machinery",subCategory:"Mower Conditioner"},{category:"Machinery",subCategory:"Hay Rake"},{category:"Machinery",subCategory:"Hay Baler"},{category:"Machinery",subCategory:"Harvester"},{category:"Equipment",subCategory:"Plough"},{category:"Equipment",subCategory:"Harrow"},{category:"Equipment",subCategory:"Ridgers"},{category:"Equipment",subCategory:"Rotovator"},{category:"Equipment",subCategory:"Cultivator"},{category:"Equipment",subCategory:"Planter"},{category:"Equipment",subCategory:"Combine"},{category:"Equipment",subCategory:"Spreader"},{category:"Equipment",subCategory:"Sprayer"},{category:"Equipment",subCategory:"Mixer"}]},j=["Good","Good to fair","Fair","Fair to poor","Poor"],k={livestock:{Cattle:["Breeding","Dairy","Slaughter"],Sheep:["Breeding","Slaughter"],Pigs:["Slaughter"],Chickens:["Broilers","Layers"],Ostriches:["Slaughter"],Goats:["Slaughter"]}},l=["Cape","Summer","Fruit","Winter"],m={crop:["Cropland"],farmland:[],improvement:[],cropland:["Cropland","Irrigated Cropland"],livestock:["Grazing","Planted Pastures","Conservation"],pasture:["Grazing","Planted Pastures","Conservation"],"permanent crop":["Horticulture (Perennial)"],plantation:["Plantation"],vme:[],wasteland:["Grazing","Structures (Handling)","Structures (Processing)","Structures (Storage)","Utilities","Wasteland"],"water right":["Water Right"]},n=["Bahia-Notatum","Birdsfoot Trefoil","Bottle Brush","Buffalo","Buffalo (Blue)","Buffalo (White)","Bush","Carribean Stylo","Clover","Clover (Arrow Leaf)","Clover (Crimson)","Clover (Persian)","Clover (Red)","Clover (Rose)","Clover (Strawberry)","Clover (Subterranean)","Clover (White)","Cocksfoot","Common Setaria","Dallis","Kikuyu","Lucerne","Lupin","Lupin (Narrow Leaf)","Lupin (White)","Lupin (Yellow)","Medic","Medic (Barrel)","Medic (Burr)","Medic (Gama)","Medic (Snail)","Medic (Strand)","Phalaris","Rescue","Rhodes","Russian Grass","Ryegrass","Ryegrass (Hybrid)","Ryegrass (Italian)","Ryegrass (Westerwolds)","Serradella","Serradella (Yellow)","Silver Leaf Desmodium","Smuts Finger","Soutbos","Tall Fescue","Teff","Veld","Weeping Lovegrass"],o={Cropland:["Barley","Bean","Bean (Broad)","Bean (Dry)","Bean (Sugar)","Bean (Green)","Bean (Kidney)","Canola","Cassava","Cotton","Cowpea","Grain Sorghum","Groundnut","Lucerne","Maize","Maize (White)","Maize (Yellow)","Oat","Peanut","Pearl Millet","Potato","Rape","Rice","Rye","Soya Bean","Sunflower","Sweet Corn","Sweet Potato","Tobacco","Triticale","Wheat","Wheat (Durum)"],Grazing:n,"Horticulture (Perennial)":["Almond","Aloe","Apple","Apricot","Avocado","Banana","Barberry","Berry","Bilberry","Blackberry","Blueberry","Cherry","Cloudberry","Coconut","Coffee","Fig","Gooseberry","Grape","Grape (Bush Vine)","Grape (Red)","Grape (Table)","Grape (White)","Grapefruit","Guava","Hops","Kiwi Fruit","Lemon","Litchi","Macadamia Nut","Mandarin","Mango","Nectarine","Olive","Orange","Papaya","Peach","Pear","Prickly Pear","Pecan Nut","Persimmon","Pineapple","Pistachio Nut","Plum","Pomegranate","Protea","Raspberry","Rooibos","Sisal","Strawberry","Sugarcane","Tea","Walnut","Wineberry"],"Horticulture (Seasonal)":["Asparagus","Beet","Beetroot","Blackberry","Borecole","Brinjal","Broccoli","Brussel Sprout","Cabbage","Cabbage (Chinese)","Cabbage (Savoy)","Cactus Pear","Carrot","Cauliflower","Celery","Chicory","Chili","Cucumber","Cucurbit","Garlic","Ginger","Granadilla","Kale","Kohlrabi","Leek","Lentil","Lespedeza","Lettuce","Makataan","Mustard","Mustard (White)","Onion","Paprika","Parsley","Parsnip","Pea","Pea (Dry)","Pepper","Pumpkin","Quince","Radish","Squash","Strawberry","Swede","Sweet Melon","Swiss Chard","Tea","Tomato","Turnip","Vetch (Common)","Vetch (Hairy)","Watermelon","Youngberry"],Plantation:["Bluegum","Pine","Wattle"],"Planted Pastures":n},p={"bi-monthly":"Bi-Monthly",monthly:"Monthly",quarterly:"Quarterly","bi-yearly":"Bi-Yearly",yearly:"Yearly"},q={rent:"Rented","short-term":"Short Term Loan","medium-term":"Medium Term Loan","long-term":"Long Term Loan"};
return{assetTypes:function(){return g},seasonTypes:function(){return l},listServiceMap:function(){return f},getAssetClass:function(a){return g[a]},getAssetTitle:function(a){return e(a)},getAssetLandUse:function(a){return m[a]},getAssetSubtypes:function(a){return h[a]||[]},getAssetCategories:function(a,b){return i[a]?b?i[a][b]||[]:i[a]:[]},getCategoryLabel:function(a){return a&&a.category?a.category+(a.subCategory?" ("+a.subCategory+(a.purpose?", "+a.purpose:"")+")":""):""},getAssetPurposes:function(a,b){return k[a]?k[a][b]||[]:[]},getCropsForLandUse:function(a){return o[a]||[]},getLiabilityFrequencyTitle:function(a){return p[a]||""},getLiabilityTitle:function(a){return q[a]||""},getZoneTitle:function(b){return a("number")(b.size,2)+"Ha at Stage "+b.growthStage+" ("+b.cultivar+")"},conditionTypes:function(){return j},isFieldApplicable:function(a,b){return m[a]&&-1!==m[a].indexOf(b.landUse)},generateAssetKey:function(a,b,c){a.assetKey="entity."+b.uuid+("farmland"!==a.type&&c?"-f."+c.name:"")+("crop"===a.type&&a.data.season?"-s."+a.data.season:"")+(a.data.fieldName?"-fi."+a.data.fieldName:"")+(a.data.crop?"-c."+a.data.crop:"")+("cropland"===a.type&&a.data.irrigated?"-i."+a.data.irrigation:"")+("farmland"===a.type&&a.data.sgKey?"-"+a.data.sgKey:"")+("improvement"===a.type||"livestock"===a.type||"vme"===a.type?(a.data.type?"-t."+a.data.type:"")+(a.data.category?"-c."+a.data.category:"")+(a.data.name?"-n."+a.data.name:"")+(a.data.purpose?"-p."+a.data.purpose:"")+(a.data.model?"-m."+a.data.model:"")+(a.data.identificationNo?"-in."+a.data.identificationNo:""):"")+(a.data.waterSource?"-ws."+a.data.waterSource:"")},cleanAssetData:function(a){return"vme"==a.type?(a.data.quantity=a.data.identificationNo&&a.data.identificationNo.length>0?1:a.data.quantity,a.data.identificationNo=1!=a.data.quantity?"":a.data.identificationNo):"cropland"==a.type&&(a.data.equipped=a.data.irrigated?a.data.equipped:!1),a},calculateLiability:function(a){return a.data.financing&&(a.data.financing.financed||a.data.financing.leased)&&(a.data.financing.closingBalance=this.calculateLiabilityForMonth(a,moment().format("YYYY-MM"))),a},calculateLiabilityForMonth:function(a,b){var c={Monthly:12,"Bi-Monthly":24,Quarterly:4,"Bi-Yearly":2,Yearly:1},d=a.data.financing,e=d.openingBalance||0,f=moment(d.paymentStart),g=moment(d.paymentEnd),h=moment(b),i=(d.leased&&h>g?g:h).diff(f,"months")*((c[d.paymentFrequency]||1)/12);if(a.data.financing.financed)for(var j=0;i>=j;j++)e-=Math.min(e,(d.installment||0)-(d.interestRate||0)/100/c[d.paymentFrequency]*e);else h>=f&&(e=Math.ceil(i)*(d.installment||0));return e},calculateValuation:function(a,b){return"vme"==a.type&&0==isNaN(a.data.quantity)?b.assetValue=a.data.quantity*(b.unitValue||0):"livestock"==a.type&&0==isNaN(b.totalStock)?b.assetValue=b.totalStock*(b.unitValue||0):"crop"==a.type&&0==isNaN(b.expectedYield)?b.assetValue=b.expectedYield*(b.unitValue||0):"improvement"!=a.type&&0==isNaN(a.data.size)&&(b.assetValue=a.data.size*(b.unitValue||0)),b},generateFarmlandAssetLabels:function(a){a.data&&"farmland"==a.type&&(a.data.portionLabel=a.data.portionNumber?a.data.remainder?"Rem. portion "+a.data.portionNumber:"Ptn. "+a.data.portionNumber:"Rem. extent",a.data.farmLabel=(a.data.officialFarmName&&!_(a.data.officialFarmName.toLowerCase()).startsWith("farm")?_(a.data.officialFarmName).titleize()+" ":"")+(a.data.farmNumber?a.data.farmNumber:""),a.data.label=a.data.portionLabel+(a.data.farmLabel&&_.words(a.data.farmLabel).length>0?" of "+("farm"==_.words(a.data.farmLabel.toLowerCase())[0]?_(a.data.farmLabel).titleize():"farm "+_(a.data.farmLabel).titleize()):"farm Unknown"))},generateAssetName:function(a,b,c){var e=d.chain(c).where({type:a.type}).reduce(function(a,c){if(c.data.name){var d,e=c.data.name.search(/\s+[0-9]+$/),f=c.data.name;-1!=e&&(f=f.substr(0,e),d=parseInt(c.data.name.substring(e).trim())),b&&f==b&&(!d||d>a)&&(a=d||1)}return a},-1).value();a.data.name=b+(e+1?" "+(e+1):"")}}}]),sdkHelperAssetApp.factory("assetValuationHelper",["assetHelper","underscore",function(a,b){var c=function(a){return{title:a.organization.name,subtitle:"Valued at "+a.currency+" "+a.assetValue,date:a.date}};return{listServiceMap:function(){return c},calculateAssetValue:function(a){"vme"==a.type&&0==isNaN(a.data.quantity)?a.data.assetValue=a.data.quantity*(a.data.unitValue||0):"livestock"==a.type&&0==isNaN(a.data.totalStock)?a.data.assetValue=a.data.totalStock*(a.data.unitValue||0):"crop"==a.type&&0==isNaN(a.data.expectedYield)?a.data.assetValue=a.data.expectedYield*(a.data.unitValue||0):"improvement"==a.type?(a.data.valuation=a.data.valuation||{},a.data.valuation.replacementValue=a.data.size*(a.data.valuation&&a.data.valuation.constructionCost||0),a.data.valuation.totalDepreciation=b.reduce(["physicalDepreciation","functionalDepreciation","economicDepreciation","purchaserResistance"],function(b,c){return isNaN(a.data.valuation[c])?b:b*(1-a.data.valuation[c])},1),a.data.assetValue=Math.round((a.data.valuation.replacementValue||0)*Math.min(a.data.valuation.totalDepreciation,1))):"improvement"!=a.type&&0==isNaN(a.data.size)&&(a.data.assetValue=a.data.size*(a.data.unitValue||0)),a.data.assetValue=Math.round(100*a.data.assetValue)/100},getApplicableGuidelines:function(c,d,e){var f=a.getAssetLandUse(d.type),g=b.chain(c).filter(function(a){return-1!==f.indexOf(a.assetClass)});if("cropland"===d.type)g=g.filter(function(a){return e.irrigated?d.data.waterSource?a.waterSource&&-1!==a.waterSource.indexOf(d.data.waterSource):"Potential Irrigable Land"===a.category:"Cropland"===a.assetClass&&(void 0===a.soilPotential||a.soilPotential===e.croppingPotential)});else if("pasture"===d.type||"wasteland"===d.type)g=g.where({assetClass:e.landUse}).filter(function(a){return(void 0===d.data.crop&&void 0===a.crop||void 0!==a.crop&&-1!==a.crop.indexOf(d.data.crop))&&(void 0===e.terrain&&void 0===a.terrain||a.terrain===e.terrain)});else if("permanent crop"===d.type){var h=moment(d.data.establishedDate),i=moment().diff(h,"months");g=g.filter(function(a){return a.crop&&-1!==a.crop.indexOf(d.data.crop)&&(!d.data.irrigation||void 0===a.irrigationType||-1!==a.irrigationType.indexOf(d.data.irrigation))&&(void 0===a.minAge||i>=a.minAge)&&(void 0===a.maxAge||i<a.maxAge)})}else"plantation"===d.type?g=g.filter(function(a){return void 0===a.crop||-1!==a.crop.indexOf(d.data.crop)}):"water right"===d.type&&(g=g.filter(function(a){return void 0===a.waterSource||-1!==a.waterSource.indexOf(d.data.waterSource)}));return g.value()}}}]);var sdkHelperAttachmentApp=angular.module("ag.sdk.helper.attachment",["ag.sdk.library"]);sdkHelperAttachmentApp.provider("attachmentHelper",["underscore",function(a){var b={defaultImage:"img/camera.png",fileResolver:function(a){return a}};this.config=function(c){b=a.defaults(c||{},b)},this.$get=["$injector","promiseService",function(c){b.fileResolver instanceof Array&&(b.fileResolver=c.invoke(b.fileResolver));var d=function(c,d,e,f){c instanceof Array==0&&(c=[c]),e=e||b.defaultImage;var g=a.chain(c).filter(function(a){return(void 0===f||a.type==f)&&a.sizes&&a.sizes[d]}).map(function(a){return a.sizes[d].src}).last().value();return g?b.fileResolver(g):e};return{findSize:function(a,b,c,e){return d(a.data&&a.data.attachments?a.data.attachments:[],b,c,e)},getSize:function(a,b,c,e){return d(a?a:[],b,c,e)},getThumbnail:function(a,b,c){return d(a?a:[],"thumb",b,c)},resolveUri:function(a){return b.fileResolver(a)}}}]}]),sdkHelperAttachmentApp.factory("resizeImageService",["promiseService","underscore",function(a,b){return function(c,d){var e=function(a){var c=document.createElement("canvas"),e=c.getContext("2d");if(d=b.defaults(d||{},{width:80,height:80,center:!0,crop:!0,output:"image/png"}),c.width=d.width,c.height=d.height,d.crop){var f=0,g=0,h=d.width*a.height/d.height>a.width,i=Math.floor(h?a.width:d.width*a.height/d.height),j=Math.floor(h?d.height*a.width/d.width:a.height);d.center&&(f=h?0:Math.floor((i-d.width)/2),g=h?Math.floor((j-d.height)/2):0),e.drawImage(a,f,g,i,j,0,0,d.width,d.height)}else e.drawImage(a,0,0,d.width,d.height);return c.toDataURL(d.output,1)};return a.wrap(function(a){if("string"==typeof c){var b=new Image;b.onload=function(){a.resolve(e(b))},b.src=c}else a.resolve(e(c))})}}]);var sdkHelperCropInspectionApp=angular.module("ag.sdk.helper.crop-inspection",["ag.sdk.helper.document","ag.sdk.library"]);sdkHelperCropInspectionApp.factory("cropInspectionHelper",["documentHelper","underscore",function(a,b){var c=["Approved","Not Approved","Not Planted"],d=["Crop amendment","Crop re-plant","Insurance coverage discontinued","Multi-insured","Other","Without prejudice","Wrongfully reported"],e=[["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12","R13","R14"],["V0","V1","V2","V3","V4","V5","R1","R2","R3","R4","R5","R6"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","R1","R2","R3","R4","R5","R6","R7","R8","R9"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","V17","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","V17","V18","V19","V20","V21","V22","V23","V24","V25","V26","V27","V28","R1","R2","R3","R4","R5","R6","R7","R8"],["V0","V1","V2","V3","V4","V5","V6","V7","R1","R2","R3","R4","R5","R6","R7","R8","R9"],["V0","V1","V2","V3","V4","V5","V6","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12","R13","R14","R15","R16","R17","R18"],["V0","V1","V2","V3","V4","R1","R2","R3","R4","R5","R6"],["V0","V1","V2","V3","V4","V5","V6","V7","R1","R2","R3","R4","R5","R6"]],f={Barley:e[1],Bean:e[5],"Bean (Broad)":e[5],"Bean (Dry)":e[5],"Bean (Sugar)":e[5],"Bean (Green)":e[5],"Bean (Kidney)":e[5],Canola:e[7],Cotton:e[6],"Grain Sorghum":e[3],Maize:e[0],"Maize (White)":e[0],"Maize (Yellow)":e[0],"Soya Bean":e[2],Sunflower:e[4],Wheat:e[1],"Wheat (Durum)":e[1]},g={"emergence inspection":"Emergence Inspection","hail inspection":"Hail Inspection","progress inspection":"Progress Inspection"},h=["Dry","Moist","Wet"],i=[["Maize Commodity","Maize Hybrid","Maize Silo Fodder"]],j={Maize:i[0],"Maize (White)":i[0],"Maize (Yellow)":i[0]},k=["Hail","Multi Peril"],l={Hail:["emergence inspection","hail inspection"],"Multi Peril":b.keys(g)},m={disease:"Disease",fading:"Fading",uneven:"Uneven",other:"Other",root:"Root",shortage:"Shortage",weed:"Weed"},n={"Dry Bean":"pod","Grain Sorghum":"panicle","Maize (White)":"ear","Maize (Yellow)":"ear",Sunflower:"flower",Wheat:"spikelet","Soya Bean":"pod"};return{approvalTypes:function(){return c},commentTypes:function(){return d},inspectionTitles:function(){return g},inspectionTypes:function(){return b.keys(g)},moistureStatusTypes:function(){return h},policyTypes:function(){return k},policyInspectionTypes:function(a){return l[a]||[]},problemTypes:function(){return m},getFlowerType:function(a){return n[a]||""},getGrowthStages:function(a){return f[a]||e[0]},getSeedTypes:function(a){return j[a]},getInspectionTitle:function(a){return g[a]||""},getProblemTitle:function(a){return m[a]||""},getSampleArea:function(a,b){return"spikelet"===n[a.data.crop]?b&&b.plantedInRows===!0?"3m":"m²":"pod"===n[a.data.crop]?"3m":"10m"},hasSeedTypes:function(a){return void 0!==j[a]},calculateProgressYield:function(a,c,d,e){d=d||0,e=void 0===e?100:e;var f=function(a,c){return b.reduce(a,function(a,b){return b[c]?a+b[c]:a},0)/a.length||0},g=b.map(a.data.zones,function(g,h){var i=b.where(c,{zone:h}),j={coverage:g.size/a.data.plantedArea,heads:f(i,"heads"),weight:f(i,"weight")};return"spikelet"===n[a.data.crop]?j["yield"]=j.weight*j.heads/((a.data.irrigated?3e3:3500)*(g.plantedInRows?3*g.rowWidth:1)):"pod"===n[a.data.crop]?(j.pods=f(i,"pods"),j.seeds=f(i,"seeds"),j["yield"]=d*j.seeds*j.pods*j.heads/(300*g.rowWidth)):j["yield"]=j.weight*j.heads/(1e3*g.rowWidth),j["yield"]*=e/100,j});return{zones:g,"yield":b.reduce(g,function(a,b){return a+b.coverage*b["yield"]},0)}}}}]),sdkHelperCropInspectionApp.factory("cultivarHelper",["underscore",function(a){var b={Barley:{Agricol:["Other","SKG 9","SVG 13"],Other:["Clipper","Cocktail","Other","Puma","SabbiErica","SabbiNemesia","SSG 564","SSG 585"]},"Bean (Dry)":{Capstone:["CAP 2000","CAP 2001","CAP 2008","Other"],"Dry Bean Seed Pty (Ltd)":["DBS 310","DBS 360","DBS 830","DBS 840","Kranskop HR1","OPS RS1","OPS RS2","OPS RS4","OPS-KW1","Other","RS 5","RS 6","RS 7"],Pannar:["Other","PAN 116","PAN 123","PAN 128","PAN 135","PAN 139","PAN 146","PAN 148","PAN 148 Plus","PAN 9213","PAN 9216","PAN 9225","PAN 9249","PAN 9280","PAN 9281","PAN 9292","PAN 9298"],Other:["AFG 470","AFG 471","BONUS","CALEDON","CARDINAL","CERRILLOS","DONGARA","DPO 820","JENNY","KAMIESBERG","KOMATI","KRANSKOP","MAJUBA","MASKAM","MINERVA","MKONDENI","MKUZI","Other","RUBY","SC Silk","SC Superior","SEDERBERG","SSB 20","STORMBERG","TEEBUS","TEEBUS-RCR2","TEEBUS-RR1","TYGERBERG","UKULINGA","UMTATA","WERNA"]},Canola:{Agricol:["Aga Max","AV Garnet","CB Jardee HT","Cobbler","Other","Tawriffic"],"Klein Karoo":["Hyola 61","Other","Rocket CL","Thunder TT","Varola 54"],Other:["Other"]},"Grain Sorghum":{Agricol:["AVENGER GH","DOMINATOR GM","ENFORCER GM","MAXIMIZER","Other","PREMIUM 4065 T GH","PREMIUM 100","NS 5511 GH","NS 5540","NS 5555","NS 5655 GM","NS 5751","NS 5832","TIGER GM"],Capstone:["CAP 1002","CAP 1003","CAP 1004","Other"],"Klein Karoo Saad":["MR 32 GL","MR 43 GL","MR BUSTER GL","MR PACER","Other"],Pannar:["PAN 8625 GH","PAN 8816 GM","PAN 8906 GM","PAN 8909 GM","PAN 8006 T","PAN 8507","PAN 8609","PAN 8648","PAN 8706","PAN 8806","PAN 8901","PAN 8902","PAN 8903","PAN 8904","PAN 8905","PAN 8906","PAN 8907","PAN 8908","PAN 8909","PAN 8911","PAN 8912","PAN 8913","PAN 8914","PAN 8915","PAN 8916","PAN 8918","PAN 8919","PAN 8920","PAN 8921","PAN 8922","PAN 8923","PAN 8924","PAN 8925","PAN 8926","PAN 8927","PAN 8928","PAN 8929","PAN 8930","PAN 8931","PAN 8932","PAN 8933","PAN 8936","PAN 8937","PAN 8938","PAN 8939","PAN 8940","PAN 8966","Other"],Other:["APN 881","MACIA-SA","NK 8830","Other","OVERFLOW","SA 1302-M27","TITAN","X868"]},"Maize (Yellow)":{Afgri:["AFG 4222 B","AFG 4244","AFG 4270 B","AFG 4410","AFG 4412 B","AFG 4414","AFG 4416 B","AFG 4434 R","AFG 4440","AFG 4448","AFG 4452 B","AFG 4474 R","AFG 4476","AFG 4478 BR","AFG 4512","AFG 4520","AFG 4522 B","AFG 4530","AFG 4540","AFG 4546","AFG 4548","AFG 4566 B","AFG 4572 R","AFG 4660","AFG 4664","DK 618","Other"],Agricol:["IMP 50-90 BR","IMP 51-22 B","IMP 51-92","IMP 51-92 R","Other","QS 7646","SC 602","SC 608"],"Capstone Seeds":["CAP 121-30","CAP 122-60","CAP 130-120","CAP 130-140","CAP 444 NG","CAP 766 NG","CAP 9004","CAP 9444 NG","Other"],"Dekalb (Monsanto)":["DKC 61-90","DKC 62-80 BR","DKC 62-80 BR GEN","DKC 62-84 R","DKC 64-78 BR","DKC 64-78 BR GEN","DKC 66-32 B","DKC 66-36 R","DKC 66-60 BR","DKC 73-70 B GEN","DKC 73-72","DKC 73-74 BR GEN","DKC 73-76 R","DKC 80-10","DKC 80-12 B GEN","DKC 80-30 R","DKC 80-40 BR GEN","Other"],"Delta Seed":["Amber","DE 2004","DE 2006","DE 2016","DE 222","Other"],"Klein Karoo Saad":["Helen","KKS 8202","KKS 8204 B","KKS 8400","KKS 8402","Other"],Linksaad:["LS 8518","LS 8524 R","LS 8526","LS 8528 R","LS 8532 B","LS 8536 B","Other"],Pannar:["BG 3268","BG 3292","BG 3492BR","BG 3568R","BG 3592R","BG 3768BR","BG 4296","BG 6308B","Other","PAN 14","PAN 3D-736 BR","PAN 3P-502 R","PAN 3P-730 BR","PAN 3Q-222","PAN 3Q-240","PAN 3Q-740 BR","PAN 3R-644 R","PAN 4P-228","PAN 4P-716 BR","PAN 6126 ","PAN 66","PAN 6616","PAN 6P-110","PAN 6P110","PAN 6Q-408B","PAN 6Q-508 R","PAN 6Q-708 BR"],Pioneer:["Other","P 1615 R","P 2048","Phb 31D21 B","Phb 31D24","Phb 31D46 BR","Phb 31D48 B","Phb 31G54 BR","Phb 31G56 R","Phb 31K58 B","Phb 32D95 BR","Phb 32D96 B","Phb 32D99","Phb 32P68 R","Phb 32T50","Phb 32W71","Phb 32W72 B","Phb 33A14 B","Phb 33H52 B","Phb 33H56","Phb 33Y72 B","Phb 33Y74","Phb 3442","Phb 34N44 B","Phb 34N45 BR","Phb 35T05 R"],"Sensako (Monsanto)":["Other","SNK 2472","SNK 2682","SNK 2778","SNK 2900","SNK 2942","SNK 2972","SNK 6326 B","SNK 7510 Y","SNK 8520"],Other:["Brasco","Cobber Flint","Cumbre","Energy","Gold Finger","High Flyer","IMP 50-10 R","IMP 51-22","IMP 52-12","MEH 114","MMH 1765","MMH 8825","Maverik","NK Arma","NK MAYOR B","NS 5000","NS 5004","NS 5066","NS 5914","NS 5916","NS 5918","NS 5920","Other","Premium Flex","QS 7608","RO 430","SA 24","SABI 7004","SABI 7200","Silmaster","Syncerus","US 9570","US 9580","US 9600","US 9610","US 9620","US 9770","US 9772","Woodriver"]},"Maize (White)":{Afgri:["AFG 4211","AFG 4321","AFG 4331","AFG 4333","AFG 4361","AFG 4383","AFG 4411","AFG 4445","AFG 4447","AFG 4471","AFG 4475 B","AFG 4477","AFG 4479 R","AFG 4501","AFG 4517","AFG 4555","AFG 4571 B","AFG 4573 B","AFG 4575","AFG 4577 B","AFG 4579 B","AFG 4581 BR","AFG 4611","AFG 4663","AFRIC 1","Other"],Agricol:["IMP 52-11","Other","SC 701","SC 709"],"Capstone Seeds":["CAP 341 NG","CAP 341 T NG","CAP 441 NG","CAP 775 NG","CAP 9001","CAP 9013","CAP 9421","Other"],"Dekalb (Monsanto)":["CRN 3505","CRN 4141","DKC 77-61 B","DKC 77-85 B GEN","DKC 78-15 B","DKC 78-17 B","DKC 78-35 R","DKC 78-45 BR","DKC 78-45 BR GEN","DKC 79-05","Other"],"Delta Seed":["DE 111","DE 303","Other"],"Klein Karoo Saad":["KKS 4383","KKS 4445","KKS 4447","KKS 4471","KKS 4473","KKS 4477","KKS 4479 R","KKS 4485","KKS 4501","KKS 4517","KKS 4519","KKS 4555","KKS 4575","KKS 4581 BR","KKS 8401","Other"],Linksaad:["LS 8519","LS 8529","LS 8533 R","LS 8535 B","LS 8537","LS 8539 B","Other"],Pannar:["BG 5485B","BG 5685R","BG4201","BG4401B","BG5285","BG5785BR","BG6683R","Other","PAN 413","PAN 4P-767BR","PAN 53","PAN 5Q-649 R","PAN 5Q-749 BR","PAN 5Q-751BR","PAN 6227","PAN 6479","PAN 6611","PAN 6671","PAN 67","PAN 6777","PAN 69","PAN 6Q-745BR","PAN 93","PAN413","PAN53","PAN6Q245","PAN6Q345CB","SC 701 (Green mealie)"],Pioneer:["Other","P 2369 W","P 2653 WB","P 2823 WB","P 2961 W","Phb 30B95 B","Phb 30B97 BR","Phb 30D04 R","Phb 30D07 B","Phb 30D09 BR","Phb 30Y79 B","Phb 30Y81 R","Phb 30Y83","Phb 31M09","Phb 31M84 BR","Phb 31T91","Phb 31V31","Phb 3210B","Phb 32A05 B","Phb 32B07 BR","Phb 32Y85","Phb 32Y87 B"],"Sensako (Monsanto)":["SNK 2021","SNK 2147","SNK 2401","SNK 2551","SNK 2721","SNK 2911","SNK 2969","SNK 6025","SNK 7811 B"],Other:["CG 4141","GM 2000","KGALAGADI","MRI 514","MRI 624","NG 761","NS 5913","NS 5917","NS 5919","Other","PGS 7053","PGS 7061","PGS 7071","PLATINUM","Panthera","QS 7707","RO 413","RO 413","RO 419","SAFFIER","SC 401","SC 403","SC 405","SC 407","SC 513","SC 627","SC 631","SC 633","SC 713","SC 715","Scout"]},Oat:{Agricol:["Magnifico","Maida","Nugene","Other","Overberg","Pallinup","Saia","SWK001"],"Sensako (Monsanto)":["Other","SSH 39W","SSH 405","SSH 421","SSH 423","SSH 491"],Other:["Drakensberg","H06/19","H06/20","H07/04","H07/05","Heros","Kompasberg","Le Tucana","Maluti","Other","Potoroo","Witteberg"]},Peanut:{Other:["Other"]},"Soya Bean":{Agriocare:["AGC 58007 R","AGC 60104 R","AGC 64107 R","AS 4801 R","Other"],Linksaad:["LS 6146 R","LS 6150 R","LS 6161 R","LS 6164 R","LS 6248 R","LS 6261 R","LS 6444 R","LS 6466 R","Other"],Pannar:["A 5409 RG","Other","PAN 1454 R","PAN 1583 R","PAN 1664 R","PAN 1666 R"],Pioneer:["Other","Phb 94Y80 R","Phb 95B53 R","Phb 95Y20 R","Phb 95Y40 R"],Other:["AG 5601","AMSTEL NO 1","DUMELA","DUNDEE","EGRET","HERON","HIGHVELD TOP","IBIS 2000","JF 91","JIMMY","KIAAT","KNAP","LEX 1233 R","LEX 1235 R","LEX 2257 R","LEX 2685 R","LIGHTNING","MARULA","MARUTI","MOPANIE","MPIMBO","MUKWA","NQUTU","OCTA","Other","SONOP","SPITFIRE","STORK","TAMBOTIE","WENNER"]},Sugarcane:{Other:["ACRUNCH","BONITA","CHIEFTAIN","EARLISWEET","GLADIATOR","GSS 9299","HOLLYWOOD","HONEYMOON","INFERNO","JUBILEE","MADHUR","MAJESTY","MANTRA","MATADOR","MAX","MEGATON","MMZ 9903","ORLA","OSCAR","Other","OVERLAND","PRIMEPLUS","RUSALTER","RUSTICO","RUSTLER","SENTINEL","SHIMMER","STAR 7708","STAR 7713","STAR 7714","STAR 7715","STAR 7717","STAR 7718","STAR 7719","STETSON","SWEET SUCCESS","SWEET SURPRISE","SWEET TALK","TENDER TREAT","WINSTAR"]},Sunflower:{Agricol:["AGSUN 5161 CL","AGSUN 5182 CL","Agsun 5264","Agsun 5671","Agsun 8251","Nonjana","Other","SUNSTRIPE"],"Klein Karoo Saad":["AFG 271","HYSUN 333","KKS 318","NK ADAGIO","NK Armoni","NK FERTI","Other","Sirena","Sunbird"],Pannar:["Other","PAN 7033","PAN 7049","PAN 7050","PAN 7057","PAN 7063 CL","PAN 7080","PAN 7086 HO","PAN 7095 CL","PAN 7351"],Other:["Ella","Grainco Sunstripe","HV 3037","HYSUN 334","HYSUN 338","HYSUN 346","HYSUN 350","Jade Emperor","Marica-2","NK Adagio CL","Nallimi CL","Other","SEA 2088 CL AO","SY 4045","SY 4200","Sikllos CL","WBS 3100"]},Triticale:{Agricol:["AG Beacon","Other","Rex"],Pannar:["PAN 248","PAN 299","Other"],Other:["Bacchus","Cloc 1","Cultivars","Falcon","Ibis","Kiewiet","Korhaan","Other","Tobie","US 2009","US 2010","US2007"]},Wheat:{Afgri:["AFG 554-8","AFG 75-3","Other"],"All-Grow Seed":["BUFFELS","DUZI","KARIEGA","KROKODIL","Other","SABIE","STEENBRAS"],"Klein Karoo Saad":["HARTBEES","KOMATI","KOONAP","MATLABAS","Other","SELATI","SENQU"],Sensako:["CRN 826","ELANDS","Other","SST 015","SST 026","SST 027","SST 035","SST 036","SST 037","SST 039","SST 047","SST 056","SST 057","SST 065","SST 077","SST 087","SST 088","SST 094","SST 096","SST 107","SST 124","SST 308","SST 316","SST 317","SST 319","SST 322","SST 333","SST 334","SST 347","SST 356","SST 363","SST 366","SST 367","SST 374","SST 387","SST 398","SST 399","SST 802","SST 805","SST 806","SST 807","SST 815","SST 816","SST 822","SST 825","SST 835","SST 843","SST 866","SST 867","SST 875","SST 876","SST 877","SST 878","SST 884","SST 885","SST 886","SST 895","SST 896","SST 935","SST 936","SST 946","SST 954","SST 963","SST 964","SST 966","SST 972","SST 983","SST 0127","SST 1327","SST 3137","SST 8125","SST 8126","SST 8134","SST 8135","SST 8136"],Pannar:["Other","PAN 3118","PAN 3120","PAN 3122","PAN 3144","PAN 3161","PAN 3172","PAN 3195","PAN 3198","PAN 3355","PAN 3364","PAN 3368","PAN 3369","PAN 3377","PAN 3378","PAN 3379","PAN 3394","PAN 3400","PAN 3404","PAN 3405","PAN 3408","PAN 3434","PAN 3471","PAN 3478","PAN 3489","PAN 3490","PAN 3492","PAN 3497","PAN 3111","PAN 3349","PAN 3515","PAN 3623"],Other:["BAVIAANS","BELINDA","BETTA-DN","BIEDOU","CALEDON","CARINA","CAROL","GARIEP","HUGENOOT","INIA","KOUGA","KWARTEL","LIMPOPO","MacB","MARICO","NOSSOB","OLIFANTS","Other","SNACK","TAMBOTI","TANKWA","TARKA","TIMBAVATI","TUGELA-DN","UMLAZI","RATEL"]}};b.Maize=angular.copy(b["Maize (Yellow)"]),angular.forEach(b["Maize (White)"],function(a,c){b.Maize[c]=_.chain(b.Maize[c]||[]).union(a).compact().uniq().sortBy(function(a){return a}).value()});var c={"Phb 30F40":23,"Phb 31G54 BR":19,"Phb 31G58":21,"Phb 32D95BR":18,"Phb 32D96 B":18,"Phb 32P68 R":20,"Phb 32T50":18,"Phb 32W71":21,"Phb 32W72 B":20,"Phb 33A14 B":19,"Phb 33H56":20,"Phb 33R78 B":21,"Phb 33Y72B":17,"Phb 3442":21,"Phb 30B95 B":23,"Phb 30B97 BR":23,"Phb 30D09 BR":20,"Phb 31M09":18,"Phb 32A05 B":19,"Phb 32B10":18,"Phb 32Y85":21,"Phb 31D48 BR":21,"Phb 32D91 R":20,"Phb 32D99":20,"Phb 32Y68":20,"Phb 3394":19,"Phb 33A13":19,"Phb 33H52 B":19,"Phb 33H54 BR":19,"Phb 33P34":20,"Phb 33P66":20,"Phb 33P67":20,"X 70200 T":23,"X 7268 TR":21,"Phb 30N35":23,"Phb 32A03":19,"Phb 32Y52":19,"Phb 32Y53":20,"Phb 33A03":19,"Phb 30H22":21,"Phb 32P75":20,"Phb 3335":20,"DKC62-74R":20,"DKC62-80BR":18,"DKC64-78BR":17,"DKC66-32B":21,"DKC66-36R":19,"DKC73-70BGEN":20,"DKC73-74BR":20,"DKC73-74BRGEN":20,"DKC73-76R":20,"DKC80-10":20,"DKC80-12B":20,"DKC80-30R":20,"DKC80-40BR":19,"DKC80-40BRGEN":21,CRN3505:21,"DKC77-61B":20,"DKC77-71R":20,"DKC77-85B":21,"DKC78-15B":20,"DKC78-35BR":21,"DKC78-45BRGEN":21,"DKC 78-79 BR":21,"CRN 3604":21,"CRN 37-60":20,"CRN 4760 B":23,"DKC 63-20":20,"DKC 66-21":21,"DKC 66-38 B":21,"DKC 63-28 R":21,"CRN 3549":21,"DKC 71-21":20,"SNK 2472":23,"SNK 2682":23,"SNK 2778":23,"SNK 2900":20,"SNK 2942":24,"SNK 2972":21,"SNK 6326 B":21,"SNK 8520":24,"SNK 2911":21,"SNK 6025":18,"LS 8504":20,"LS 8512":20,"LS 8518":19,"LS 8522 R":19,"LS 8511":19,"LS 8513":19,"LS 8519":19,"LS 8521 B":19,"LS 8523 B":19,"LS 8527 BR":19,"LS 8506":21,"LS 8508":20,"LS 8524 R":20,"LEX 800":23,"LS 8509":21,"LS 8517":23,"LS 8525":21,"LS 8529":21,"LS 8533 R":21,"LS 8536 B":19,"PAN 3D-432Bt ":18,"PAN 3D-736BR":18,"PAN 3P-502RR":19,"PAN 3P-730BR":18,"PAN 3Q-422B":18,"PAN 3Q-740BR":19,"PAN 3R-644R":18,"PAN 4P-116":19,"PAN 4P-316Bt":19,"PAN 4P-516RR":20,"PAN 4P-716BR":19,"PAN 6114":19,"PAN 6126":18,"PAN 6146":24,"PAN 6236Bt":18,"PAN 6238RR":18,"PAN 6480":23,"PAN 6616":23,"PAN 6724Bt":25,"PAN 6734":23,"PAN 6P-110":21,"PAN 6Q-308 B":21,"PAN 6Q-308 Bt":21,"PAN 6Q-408 CB":21,"PAN 6Q-508R":21,"PAN 6Q-508RR":20,"PAN 4P-767BR":19,"PAN 5Q-433Bt *":20,"PAN 5R-541RR":19,"PAN 6013Bt":23,"PAN 6017":21,"PAN 6043":23,"PAN 6053":23,"PAN 6223Bt":21,"PAN 6479":23,"PAN 6611":23,"PAN 6723":23,"PAN 6777":25,"PAN 6Q-419B":20,"PAN 6Q-445Bt":21,"PAN 6000 Bt":19,"PAN 6012 Bt":21,"PAN 6118":19,"PAN 6124 Bt":19,"PAN 6128 RR":19,"PAN 6256":24,"PAN 6310":24,"PAN 6316":25,"PAN 6320":25,"PAN 6432 B":23,"PAN 6568":23,"PAN 6622":25,"PAN 6710":21,"PAN 6804":20,"PAN 6844":25,"PAN 6994 Bt":24,"PAN 5Q-749 BR":23,"PAN 6243":24,"PAN 6335":23,"PAN 6573":23,"PAN 6633":23,"PAN 6757":25,"PAN 6839":23,"PAN 6Q-321 B":23,"PAN 6Q-345 CB":21,"AFG 4270B":18,"AFG 4412B":19,"AFG 4434R":20,"AFG 4522B":20,"AFG 4530":19,"AFG 4222 B":19,"AFG 4244":19,"AFG 4410":19,"AFG 4414":20,"AFG 4416 B":20,"AFG 4448":20,"AFG 4474 R":19,"AFG 4476":20,"AFG 4512":23,"AFG 4520":20,"AFG 4540":20,"DK 618":21,"EXPG 5002":20,"EXP Stack":20,"AFG 4321":19,"AFG 4331":20,"AFG 4333":20,"AFG 4411":21,"AFG 4445":21,"AFG 4447":21,"AFG 4471":23,"AFG 4475 B":21,"AFG 4477":20,"AFG 4479 R":21,"AFG 4573 B":21,"AFG 4577 B":21,"AFG 4611":23,"KKS 8204B":15,"KKS 4581 BR":21,"KKS 8301":19,"IMP 50 - 90BR":18,"IMP 51 - 22":19,"IMP 51-92":19,"IMP 52-12":20,"NS 5920":20,"QS 7646":20,"BG 5485 B":23,"BG 8285":23,Brasco:19,Energy:18,"Gold Finger":19,Helen:17,"High Flyer":17,Maverik:19,"NK Arma":18,"QS 7608":23,"SC 506":19,"SC 602":21,Woodriver:18,"P 1615 R":19,"P 1973 Y":19,"P 2653 WB":20,"P 2048":20,"IMP 52-11 B":18,Panthera:21,"QS 7707":23,"SC 401":18,"SC 403":20,"SC 405":20,"SC 407":20,"SC 533":21,"SC 719":24,Scout:20};return{getCultivars:function(a,c){return b[a]&&b[a][c]?b[a][c]:[]},getCultivarLeafCount:function(a){return c[a]||22},getSeedProviders:function(c){return b[c]?a.keys(b[c]):[]}}}]);var sdkHelperDocumentApp=angular.module("ag.sdk.helper.document",["ag.sdk.helper.task","ag.sdk.library"]);sdkHelperDocumentApp.provider("documentHelper",function(){var a=[],b={},c=function(a,b){return 1!=b?a.lastIndexOf("y")==a.length-1?a.substr(0,a.length-1)+"ies":a+"s":a};this.registerDocuments=function(c){c instanceof Array==!1&&(c=[c]),angular.forEach(c,function(c){-1===a.indexOf(c.docType)&&a.push(c.docType),c.deletable=c.deletable===!0,c.state=c.state||"document."+c.docType.replace(" ","-"),b[c.docType]=c})},this.getDocument=function(a){return b[a]},this.$get=["$filter","$injector","taskHelper","underscore",function(d,e,f,g){var h=function(a){var c={error:"danger",information:"info",warning:"warning"},f=g.chain(a.activeFlags).groupBy(function(a){return a.flag.type}).map(function(a,b){var d=!1;return angular.forEach(a,function(a){"open"==a.status&&(d=!0)}),{label:c[b],count:a.length,hasOpen:d}}).value(),h=b[a.docType],i={id:a.id||a.$id,title:a.documentId?a.documentId:"",subtitle:(a.author?"By "+a.author+" on ":"On ")+d("date")(a.createdAt),docType:a.docType,group:h?h.title:a.docType,flags:f};return a.organization&&a.organization.name&&(i.title=a.organization.name,i.subtitle=a.documentId||""),a.data&&h&&h.listServiceMap&&(h.listServiceMap instanceof Array&&(h.listServiceMap=e.invoke(h.listServiceMap)),h.listServiceMap(i,a)),i},i=function(a){if(b[a.docType]){var c=h(a),d=g.findWhere(a.tasks,{type:"parent"});return c&&d&&(c.status={text:d.status,label:f.getTaskLabel(d.status)}),c}};return{listServiceMap:function(){return h},listServiceWithTaskMap:function(){return i},filterDocuments:function(a){return g.filter(a,function(a){return void 0!==b[a.docType]})},pluralMap:function(a,b){return c(a,b)},documentTypes:function(){return a},documentTitles:function(){return g.pluck(b,"title")},getDocumentTitle:function(a){return b[a]?b[a].title:""},getDocumentState:function(a){return b[a]?b[a].state:void 0},getDocumentMap:function(a){return b[a]}}}]});var sdkHelperEnterpriseBudgetApp=angular.module("ag.sdk.helper.enterprise-budget",["ag.sdk.library"]);sdkHelperEnterpriseBudgetApp.factory("enterpriseBudgetHelper",["naturalSort","underscore",function(a,b){function c(a){a.data=a.data||{},a.data.details=a.data.details||{},a.data.details.cycleStart=a.data.details.cycleStart||0,a.data.sections=a.data.sections||[],a.data.schedules=a.data.schedules||{}}function d(a){return n[a]||a}function e(a){return b.chain(u).keys().filter(function(c){return b.contains(u[c],a)}).value()}function f(a,c){return angular.forEach(["income","expenses"],function(d){var e=b.findWhere(a.data.sections,void 0===c?{code:i[d].code}:{code:i[d].code,horticultureStage:c});void 0===e&&(e={code:i[d].code,name:i[d].name,productCategoryGroups:[],total:{value:0}},void 0!==c&&(e.horticultureStage=c),a.data.sections.push(e))}),a}var g=function(a){function b(a){var b=[a.name,a.assetType,a.commodityType];return a.data&&a.data.details&&a.data.details.regionName&&b.push(a.data.details.regionName),b}return{id:a.id||a.$id,title:a.name,subtitle:a.commodityType+(a.regionName?" in "+a.regionName:""),status:a.published?{text:"public",label:"label-success"}:a.internallyPublished?{text:"internal",label:"label-info"}:!1,searchingIndex:b(a)}},h={crop:"Field Crop",livestock:"Livestock",horticulture:"Horticulture"},i={expenses:{code:"EXP",name:"Expenses"},income:{code:"INC",name:"Income"}},j=b.indexBy([{code:"INC-CPS",name:"Crop Sales"},{code:"INC-FRS",name:"Fruit Sales"},{code:"HVT",name:"Harvest"},{code:"HVP",name:"Preharvest"},{code:"INC-LSS",name:"Livestock Sales"},{code:"INC-LSP",name:"Product Sales"},{code:"EXP-AMF",name:"Animal Feed"},{code:"HBD",name:"Husbandry"},{code:"IDR",name:"Indirect Costs"},{code:"MRK",name:"Marketing"},{code:"RPM",name:"Replacements"}],"name"),k=b.indexBy([{code:"INC-LSS-SLAMB",name:"Lamb",unit:"head"},{code:"INC-LSS-SWEAN",name:"Weaner lambs",unit:"head"},{code:"INC-LSS-SEWE",name:"Ewe",unit:"head"},{code:"INC-LSS-SWTH",name:"Wether (2-tooth plus)",unit:"head"},{code:"INC-LSS-SRAM",name:"Ram",unit:"head"},{code:"INC-LSS-CCALV",name:"Calf",unit:"head"},{code:"INC-LSS-CWEN",name:"Weaner calves",unit:"head"},{code:"INC-LSS-CCOW",name:"Cow or heifer",unit:"head"},{code:"INC-LSS-CST18",name:"Steer (18 moths plus)",unit:"head"},{code:"INC-LSS-CST36",name:"Steer (3 years plus)",unit:"head"},{code:"INC-LSS-CBULL",name:"Bull (3 years plus)",unit:"head"},{code:"INC-LSS-GKID",name:"Kid",unit:"head"},{code:"INC-LSS-GWEAN",name:"Weaner kids",unit:"head"},{code:"INC-LSS-GEWE",name:"Ewe (2-tooth plus)",unit:"head"},{code:"INC-LSS-GCAST",name:"Castrate (2-tooth plus)",unit:"head"},{code:"INC-LSS-GRAM",name:"Ram (2-tooth plus)",unit:"head"},{code:"INC-LSP-MILK",name:"Milk",unit:"l"},{code:"INC-LSP-WOOL",name:"Wool",unit:"kg"},{code:"INC-HVT-CROP",name:"Crop",unit:"t"},{code:"INC-HVT-FRUT",name:"Fruit",unit:"t"},{code:"EXP-HVP-SEED",name:"Seed",unit:"kg"},{code:"EXP-HVP-PLTM",name:"Plant Material",unit:"each"},{code:"EXP-HVP-FERT",name:"Fertiliser",unit:"t"},{code:"EXP-HVP-LIME",name:"Lime",unit:"t"},{code:"EXP-HVP-HERB",name:"Herbicides",unit:"l"},{code:"EXP-HVP-PEST",name:"Pesticides",unit:"l"},{code:"EXP-HVP-SPYA",name:"Aerial spraying",unit:"ha"},{code:"EXP-HVP-INSH",name:"Crop Insurance (Hail)",unit:"t"},{code:"EXP-HVP-INSM",name:"Crop Insurance (Multiperil)",unit:"t"},{code:"EXP-HVP-HEDG",name:"Hedging cost",unit:"t"},{code:"EXP-HVT-LABC",name:"Contract work (Harvest)",unit:"ha"},{code:"EXP-HVT-STOR",name:"Storage",unit:"days"},{code:"EXP-HVT-PAKM",name:"Packaging material",unit:"each"},{code:"EXP-HVT-DYCL",name:"Drying and cleaning",unit:"t"},{code:"EXP-HVT-PAKC",name:"Packing cost",unit:"each"},{code:"EXP-IDR-FUEL",name:"Fuel",unit:"l"},{code:"EXP-IDR-REPP",name:"Repairs & parts",unit:"Total"},{code:"EXP-IDR-ELEC",name:"Electricity",unit:"Total"},{code:"EXP-IDR-WATR",name:"Water",unit:"Total"},{code:"EXP-IDR-LABP",name:"Permanent labour",unit:"Total"},{code:"EXP-IDR-SCHED",name:"Scheduling",unit:"Total"},{code:"EXP-IDR-LICS",name:"License",unit:"Total"},{code:"EXP-IDR-INSA",name:"Insurance assets",unit:"Total"},{code:"EXP-IDR-OTHER",name:"Other costs",unit:"Total"},{code:"EXP-RPM-SLAMB",name:"Lamb",unit:"head"},{code:"EXP-RPM-SWEAN",name:"Weaner lambs",unit:"head"},{code:"EXP-RPM-SEWE",name:"Ewe",unit:"head"},{code:"EXP-RPM-SWTH",name:"Wether (2-tooth plus)",unit:"head"},{code:"EXP-RPM-SRAM",name:"Ram",unit:"head"},{code:"EXP-RPM-CCALV",name:"Calf",unit:"head"},{code:"EXP-RPM-CWEN",name:"Weaner calves",unit:"head"},{code:"EXP-RPM-CCOW",name:"Cow or heifer",unit:"head"},{code:"EXP-RPM-CST18",name:"Steer (18 moths plus)",unit:"head"},{code:"EXP-RPM-CST36",name:"Steer (3 years plus)",unit:"head"},{code:"EXP-RPM-CBULL",name:"Bull (3 years plus)",unit:"head"},{code:"EXP-RPM-GKID",name:"Kid",unit:"head"},{code:"EXP-RPM-GWEAN",name:"Weaner kids",unit:"head"},{code:"EXP-RPM-GEWE",name:"Ewe (2-tooth plus)",unit:"head"},{code:"EXP-RPM-GCAST",name:"Castrate (2-tooth plus)",unit:"head"},{code:"EXP-RPM-GRAM",name:"Ram (2-tooth plus)",unit:"head"},{code:"EXP-AMF-LICK",name:"Lick",unit:"kg"},{code:"EXP-HBD-VACC",name:"Drenching & vaccination",unit:"head"},{code:"EXP-HBD-DIPP",name:"Dipping & jetting",unit:"head"},{code:"EXP-HBD-VETY",name:"Veterinary",unit:"head"},{code:"EXP-HBD-SHER",name:"Shearing",unit:"head"},{code:"EXP-HBD-CRCH",name:"Crutching",unit:"head"},{code:"EXP-MRK-LSSF",name:"Livestock sales marketing fees",incomeGroup:"Livestock Sales",unit:"%"},{code:"EXP-MRK-LSPF",name:"Livestock products marketing fees",incomeGroup:"Product Sales",unit:"%"},{code:"EXP-MRK-HOTF",name:"Horticulture marketing fees",incomeGroup:"Fruit Sales",unit:"%"},{code:"EXP-MRK-CRPF",name:"Crop marketing fees",incomeGroup:"Crop Sales",unit:"%"},{code:"EXP-MRK-LSTP",name:"Livestock transport",unit:"head"},{code:"EXP-MRK-HOTT",name:"Horticulture transport",unit:"t"},{code:"EXP-MRK-CRPT",name:"Crop transport",unit:"t"}],"code"),l={crop:{income:{"Crop Sales":[k["INC-HVT-CROP"]]},expenses:{Preharvest:[k["EXP-HVP-SEED"],k["EXP-HVP-FERT"],k["EXP-HVP-LIME"],k["EXP-HVP-HERB"],k["EXP-HVP-PEST"],k["EXP-HVP-SPYA"],k["EXP-HVP-INSH"],k["EXP-HVP-INSM"],k["EXP-HVP-HEDG"]],Harvest:[k["EXP-HVT-LABC"]],Marketing:[k["EXP-MRK-CRPF"],k["EXP-MRK-CRPT"]],"Indirect Costs":[k["EXP-IDR-FUEL"],k["EXP-IDR-REPP"],k["EXP-IDR-ELEC"],k["EXP-IDR-WATR"],k["EXP-IDR-LABP"],k["EXP-IDR-SCHED"],k["EXP-IDR-OTHER"]]}},horticulture:{income:{"Fruit Sales":[k["INC-HVT-FRUT"]]},expenses:{Preharvest:[k["EXP-HVP-PLTM"],k["EXP-HVP-FERT"],k["EXP-HVP-LIME"],k["EXP-HVP-HERB"],k["EXP-HVP-PEST"],k["EXP-HVP-SPYA"],k["EXP-HVP-INSH"],k["EXP-HVP-INSM"]],Harvest:[k["EXP-HVT-LABC"],k["EXP-HVT-STOR"],k["EXP-HVT-PAKM"],k["EXP-HVT-DYCL"],k["EXP-HVT-PAKC"]],Marketing:[k["EXP-MRK-HOTF"],k["EXP-MRK-HOTT"]],"Indirect Costs":[k["EXP-IDR-FUEL"],k["EXP-IDR-REPP"],k["EXP-IDR-ELEC"],k["EXP-IDR-WATR"],k["EXP-IDR-LABP"],k["EXP-IDR-SCHED"],k["EXP-IDR-LICS"],k["EXP-IDR-INSA"],k["EXP-IDR-OTHER"]]}},livestock:{Cattle:{income:{"Livestock Sales":[k["INC-LSS-CCALV"],k["INC-LSS-CWEN"],k["INC-LSS-CCOW"],k["INC-LSS-CST18"],k["INC-LSS-CST36"],k["INC-LSS-CBULL"]],"Product Sales":[k["INC-LSP-MILK"]]},expenses:{Replacements:[k["EXP-RPM-CCALV"],k["EXP-RPM-CWEN"],k["EXP-RPM-CCOW"],k["EXP-RPM-CST18"],k["EXP-RPM-CST36"],k["EXP-RPM-CBULL"]],"Animal Feed":[k["EXP-AMF-LICK"]],Husbandry:[k["EXP-HBD-VACC"],k["EXP-HBD-DIPP"],k["EXP-HBD-VETY"]],Marketing:[k["EXP-MRK-LSSF"],k["EXP-MRK-LSPF"],k["EXP-MRK-LSTP"]],"Indirect Costs":[k["EXP-IDR-FUEL"],k["EXP-IDR-REPP"],k["EXP-IDR-ELEC"],k["EXP-IDR-WATR"],k["EXP-IDR-LABP"],k["EXP-IDR-LICS"],k["EXP-IDR-INSA"],k["EXP-IDR-OTHER"]]}},Goats:{income:{"Livestock Sales":[k["INC-LSS-GKID"],k["INC-LSS-GWEAN"],k["INC-LSS-GEWE"],k["INC-LSS-GCAST"],k["INC-LSS-GRAM"]],"Product Sales":[k["INC-LSP-WOOL"],k["INC-LSP-MILK"]]},expenses:{Replacements:[k["EXP-RPM-GKID"],k["EXP-RPM-GWEAN"],k["EXP-RPM-GEWE"],k["EXP-RPM-GCAST"],k["EXP-RPM-GRAM"]],"Animal Feed":[k["EXP-AMF-LICK"]],Husbandry:[k["EXP-HBD-VACC"],k["EXP-HBD-DIPP"],k["EXP-HBD-VETY"],k["EXP-HBD-SHER"],k["EXP-HBD-CRCH"]],Marketing:[k["EXP-MRK-LSSF"],k["EXP-MRK-LSPF"],k["EXP-MRK-LSTP"]],"Indirect Costs":[k["EXP-IDR-FUEL"],k["EXP-IDR-REPP"],k["EXP-IDR-ELEC"],k["EXP-IDR-WATR"],k["EXP-IDR-LABP"],k["EXP-IDR-LICS"],k["EXP-IDR-INSA"],k["EXP-IDR-OTHER"]]}},Sheep:{income:{"Livestock Sales":[k["INC-LSS-SLAMB"],k["INC-LSS-SWEAN"],k["INC-LSS-SEWE"],k["INC-LSS-SWTH"],k["INC-LSS-SRAM"]],"Product Sales":[k["INC-LSP-WOOL"],k["INC-LSP-MILK"]]},expenses:{Replacements:[k["EXP-RPM-SLAMB"],k["EXP-RPM-SWEAN"],k["EXP-RPM-SEWE"],k["EXP-RPM-SWTH"],k["EXP-RPM-SRAM"]],"Animal Feed":[k["EXP-AMF-LICK"]],Husbandry:[k["EXP-HBD-VACC"],k["EXP-HBD-DIPP"],k["EXP-HBD-VETY"],k["EXP-HBD-SHER"],k["EXP-HBD-CRCH"]],Marketing:[k["EXP-MRK-LSSF"],k["EXP-MRK-LSPF"],k["EXP-MRK-LSTP"]],"Indirect Costs":[k["EXP-IDR-FUEL"],k["EXP-IDR-REPP"],k["EXP-IDR-ELEC"],k["EXP-IDR-WATR"],k["EXP-IDR-LABP"],k["EXP-IDR-LICS"],k["EXP-IDR-INSA"],k["EXP-IDR-OTHER"]]}}}},m={Cattle:"Cow or heifer",Sheep:"Ewe",Goats:"Ewe (2-tooth plus)"},n={"Cattle (Extensive)":"Cattle","Cattle (Feedlot)":"Cattle","Cattle (Stud)":"Cattle","Sheep (Extensive)":"Sheep","Sheep (Feedlot)":"Sheep","Sheep (Stud)":"Sheep"},o={Cattle:{Calf:.32,"Weaner calves":.44,"Cow or heifer":1.1,"Steer (18  months plus)":.75,"Steer (3 years plus)":1.1,"Bull (3 years plus)":1.36},Sheep:{Lamb:.08,"Weaner Lambs":.11,Ewe:.16,"Wether (2-tooth plus)":.16,"Ram (2-tooth plus)":.23},Goats:{Kid:.08,"Weaner kids":.12,"Ewe (2-tooth plus)":.17,"Castrate (2-tooth plus)":.17,"Ram (2-tooth plus)":.22}},p={crop:"Field Crops",horticulture:"Horticulture",livestock:"Livestock"},q={crop:["Barley","Bean (Dry)","Bean (Green)","Canola","Cotton","Cowpea","Grain Sorghum","Groundnut","Lucerne","Lupin","Maize (Fodder)","Maize (Green)","Maize (Seed)","Maize (White)","Maize (Yellow)","Oat","Potato","Rye","Soya Bean","Sunflower","Sweet Corn","Tobacco","Triticale","Wheat"],horticulture:["Almond","Apple","Apricot","Avocado","Banana","Blueberry","Cherry","Chicory","Chili","Citrus (Hardpeel)","Citrus (Softpeel)","Coffee","Fig","Garlic","Grape (Table)","Grape (Wine)","Guava","Hops","Kiwi","Lemon","Lentil","Macadamia Nut","Mango","Melon","Nectarine","Olive","Onion","Orange","Papaya","Pea","Peach","Peanut","Pear","Pecan Nut","Persimmon","Pineapple","Pistachio Nut","Plum","Pomegranate","Prickly Pear","Prune","Pumpkin","Quince","Rooibos","Strawberry","Sugarcane","Tomato","Watermelon"],livestock:["Cattle (Extensive)","Cattle (Feedlot)","Cattle (Stud)","Chicken (Broilers)","Chicken (Layers)","Dairy","Game","Goats","Horses","Ostrich","Pigs","Sheep (Extensive)","Sheep (Feedlot)","Sheep (Stud)"]},r={Apple:["0-3 years","3-10 years","10-15 years","15-25 years","25+ years"],Apricot:["0-2 years","2-5 years","5-15 years","15-18 years","18+ years"],Avocado:["0-1 years","1-3 years","3-5 years","5-8 years","8+ years"],Blueberry:["0-1 years","1-3 years","3-5 years","5-8 years","8+ years"],"Citrus (Hardpeel)":["0-1 years","1-4 years","4-8 years","8-20 years","20-25 years","25+ years"],"Citrus (Softpeel)":["0-1 years","1-4 years","4-8 years","8-20 years","20-25 years","25+ years"],Fig:["0-1 years","1-3 years","3-6 years","6-18 years","18-30 years","30+ years"],"Grape (Table)":["0-3 years","3-10 years","10-15 years","15-25 years","25+ years"],"Grape (Wine)":["0-3 years","3-10 years","10-15 years","15-25 years","25+ years"],"Macadamia Nut":["0-1 years","1-3 years","3-6 years","6-9 years","10+ years"],Mango:["0-1 years","1-3 years","3-5 years","5-18 years","18-30 years","30+ years"],Nectarine:["0-2 years","2-5 years","5-15 years","15-18 years","18+ years"],Olive:["0-1 years","1-3 years","3-5 years","5-10 years","10+ years"],Orange:["0-1 years","1-4 years","4-8 years","8-20 years","20-25 years","25+ years"],"Pecan Nut":["0-1 years","1-3 years","3-7 years","7-10 years","10+ years"],Peach:["0-2 years","2-5 years","5-15 years","15-18 years","18+ years"],Pear:["0-3 years","3-10 years","10-15 years","15-25 years","25+ years"],Persimmon:["0-1 years","1-4 years","4-12 years","12-20 years","20+ years"],Plum:["0-2 years","2-5 years","5-15 years","15-18 years","18+ years"],Pomegranate:["0-1 years","1-3 years","3-5 years","5-18 years","18-30 years","30+ years"],Rooibos:["0-1 years","1-2 years","2-4 years","4-5 years","5+ years"]},s=[{id:0,name:"January",shortname:"Jan"},{id:1,name:"February",shortname:"Feb"},{id:2,name:"March",shortname:"Mar"},{id:3,name:"April",shortname:"Apr"},{id:4,name:"May",shortname:"May"},{id:5,name:"June",shortname:"Jun"},{id:6,name:"July",shortname:"Jul"},{id:7,name:"August",shortname:"Aug"},{id:8,name:"September",shortname:"Sep"},{id:9,name:"October",shortname:"Oct"},{id:10,name:"November",shortname:"Nov"},{id:11,name:"December",shortname:"Dec"}],t={"default":["Fertilise","Harvest","Plant/Seed","Plough","Spray"],livestock:["Lick","Sales","Shearing","Vaccination"]},u={Calving:["Cattle (Extensive)","Cattle (Feedlot)","Cattle (Stud)","Dairy"],Hatching:["Chicken (Broilers)","Chicken (Layers)","Ostrich"],Kidding:["Game","Goats"],Foaling:["Horses"],Farrowing:["Pigs"],Lambing:["Sheep (Extensive)","Sheep (Feedlot)","Sheep (Stud)"]};
return{listServiceMap:function(){return g},commodityTypes:function(){return p},commodities:function(){return q},cycleMonths:function(){return s},scheduleTypes:function(){return t},getRepresentativeAnimal:function(a){return m[d(a)]},getConversionRate:function(a){return o[d(a)][m[d(a)]]},getConversionRates:function(a){return o[d(a)]},getCommodities:function(a){return q[a]||""},getHorticultureStages:function(a){return r[a]||[]},getHorticultureStage:function(a,b){var c=this.getHorticultureStages(a),d=c.length>0?c[0]:void 0;if(b&&b.data.establishedDate){var e=moment().diff(b.data.establishedDate,"years",!0);angular.forEach(c,function(a){var b=a.match(/\d+/g);(1==b.length&&b[0]<=e||2==b.length&&b[0]<=e&&b[1]>=e)&&(d=a)})}return d},getCategories:function(a,b,c,e,f){var g={};"livestock"==b&&l[b][d(c)]&&(g=angular.copy(l[b][d(c)][e])||{}),"crop"==b&&l[b][e]&&(g=angular.copy(l[b][e])||{}),"horticulture"==b&&l[b][e]&&(g=angular.copy(l[b][e])||{}),angular.forEach(a.data.sections,function(b){b.name.toLowerCase().indexOf(e)>-1&&("horticulture"!=a.assetType||"horticulture"==a.assetType&&b.horticultureStage==f)&&angular.forEach(b.productCategoryGroups,function(a){angular.forEach(a.productCategories,function(b){angular.forEach(g[a.name],function(c,d){c.code==b.code&&g[a.name].splice(d,1)})})})});var h=[];for(var i in g)g[i].forEach(function(a){a.groupBy=i,h.push(a)});return h},getModelType:function(a){return h[a]||""},getScheduleTypes:function(c,d){return b.chain(t[c]?t[c]:t["default"]).union(e(d)).compact().value().sort(function(b,c){return a(b,c)})},validateBudgetData:function(a,b){return c(a),f(a,b),this.calculateTotals(a)},initNewSections:function(a,b){return f(a,b)},addCategoryToBudget:function(a,b,c,e,f){var g=angular.copy(k[e]);"livestock"==a.assetType&&(g.valuePerLSU=0,o[d(a.commodityType)][g.name]&&(g.conversionRate=o[d(a.commodityType)][g.name]));var h=!0,l=!0,m=-1,n=-1,p=angular.copy(i[b]),q=angular.copy(j[c]);return p.productCategoryGroups=[],q.productCategories=[],angular.forEach(a.data.sections,function(b,d){("horticulture"!=a.assetType&&b.name==p.name||"horticulture"==a.assetType&&b.name==p.name&&b.horticultureStage==f)&&(h=!1,m=d,p=b,b.productCategoryGroups.forEach(function(a,b){a.name==c&&(l=!1,n=b,q=a)}))}),h&&("horticulture"==a.assetType&&f&&(p.horticultureStage=f),a.data.sections.push(p),m=a.data.sections.length-1),l&&(a.data.sections[m].productCategoryGroups.push(q),n=a.data.sections[m].productCategoryGroups.length-1),a.data.sections[m].productCategoryGroups[n].productCategories.push(g),a},calculateTotals:function(a){c(a),"livestock"==a.assetType&&(a.data.details.calculatedLSU=a.data.details.herdSize*o[d(a.commodityType)][m[d(a.commodityType)]]);var e=0,f=0;return a.data.sections.forEach(function(c){c.total={value:0},"livestock"==a.assetType&&(c.total.valuePerLSU=0),c.productCategoryGroups.forEach(function(e){e.total={value:0},"livestock"==a.assetType&&(e.total.valuePerLSU=0),e.productCategories.forEach(function(f){if("%"==f.unit){var g=b.chain(a.data.sections).filter(function(b){return"horticulture"!=a.assetType||b.horticultureStage===c.horticultureStage}).pluck("productCategoryGroups").flatten().reduce(function(a,b){return b.name==f.incomeGroup&&void 0!==b.total?a+b.total.value:a},0).value();f.value=(f.pricePerUnit||0)*g/100}else f.quantity="Total"==f.unit?1:f.quantity,f.value=(f.pricePerUnit||0)*(f.quantity||0);"livestock"==a.assetType&&(f.valuePerLSU=(f.pricePerUnit||0)/o[d(a.commodityType)][f.name],e.total.valuePerLSU+=f.valuePerLSU);var h=f.schedule&&a.data.schedules[f.schedule]?a.data.schedules[f.schedule]:b.range(12).map(function(){return 100/12});f.valuePerMonth=b.map(h,function(a){return a/100*f.value}),e.total.value+=f.value,e.total.valuePerMonth=e.total.valuePerMonth?b.map(e.total.valuePerMonth,function(a,b){return a+f.valuePerMonth[b]}):f.valuePerMonth}),c.total.value+=e.total.value,c.total.valuePerMonth=c.total.valuePerMonth?b.map(c.total.valuePerMonth,function(a,b){return a+e.total.valuePerMonth[b]}):e.total.valuePerMonth,"livestock"==a.assetType&&(c.total.valuePerLSU+=e.total.valuePerLSU)}),"Income"==c.name?e=c.total.value:f+=c.total.value}),a.data.details.grossProfit=e-f,"horticulture"==a.assetType&&(a.data.details.grossProfitByStage={},angular.forEach(r[a.commodityType],function(c){a.data.details.grossProfitByStage[c]=b.chain(a.data.sections).where({horticultureStage:c}).reduce(function(a,b){return"Income"===b.name?a+b.total.value:"Expenses"===b.name?a-b.total.value:a},0).value()})),"livestock"==a.assetType&&(a.data.details.grossProfitPerLSU=a.data.details.grossProfit/a.data.details.calculatedLSU),a}}}]);var sdkHelperExpenseApp=angular.module("ag.sdk.helper.expense",["ag.sdk.library"]);sdkHelperExpenseApp.factory("expenseHelper",["underscore",function(){var a={area:"Area",distance:"Distance",hours:"Hours"},b={area:"ha",distance:"km",hours:"h"},c={area:"inspected",distance:"travelled",hours:"worked"};return{expenseTypes:function(){return a},getExpenseTitle:function(b){return a[b]||""},getExpenseUnit:function(a){return b[a]||""},getExpenseAction:function(a){return c[a]||""}}}]);var sdkHelperFarmerApp=angular.module("ag.sdk.helper.farmer",["ag.sdk.interface.map","ag.sdk.helper.attachment","ag.sdk.library"]);sdkHelperFarmerApp.factory("farmerHelper",["attachmentHelper","geoJSONHelper","underscore",function(a,b,c){var d=function(b){function d(a){var b=[];return angular.forEach(a.legalEntities,function(a){b.push(a.name),a.registrationNumber&&b.push(a.registrationNumber)}),b}typeColorMap={error:"danger",information:"info",warning:"warning"};var e=c.chain(b.activeFlags).groupBy(function(a){return a.flag.type}).map(function(a,b){var c=!1;return angular.forEach(a,function(a){"open"==a.status&&(c=!0)}),{label:typeColorMap[b],count:a.length,hasOpen:c}}).value();return{id:b.id||b.$id,title:b.name,subtitle:b.operationType,thumbnailUrl:a.findSize(b,"thumb","img/profile-business.png"),searchingIndex:d(b),flags:e}},e=["Commercial","Recreational","Smallholder"],f={Commercial:"Large scale agricultural production",Recreational:"Leisure or hobby farming",Smallholder:"Small farm, limited production"};return{listServiceMap:function(){return d},businessEntityTypes:function(){return e},getBusinessEntityDescription:function(a){return f[a]||""},getFarmerLocation:function(a){if(a){if(a.data&&a.data.loc)return a.data.loc.geometry?a.data.loc.geometry.coordinates:a.data.loc.coordinates;if(a.legalEntities){var c=b();return angular.forEach(a.legalEntities,function(a){a.assets&&angular.forEach(a.assets,function(a){c.addGeometry(a.data.loc)})}),c.getCenter().reverse()}}return null},isFarmerActive:function(a){return a&&"active"==a.status}}}]),sdkHelperFarmerApp.factory("legalEntityHelper",["attachmentHelper","underscore",function(a,b){function c(a){this.enterprises=b.map(a||[],function(a){return a.name?a.name:a}),this.selection={category:void 0,item:void 0}}var d=function(b){var c={id:b.id||b.$id,title:b.name,subtitle:b.type};return c.thumbnailUrl=a.findSize(b,"thumb","img/profile-user.png"),c},e=["Individual","Sole Proprietary","Joint account","Partnership","Close Corporation","Private Company","Public Company","Trust","Non-Profitable companies","Cooperatives","In- Cooperatives","Other Financial Intermediaries"],f={"Field Crops":["Barley","Bean","Bean (Broad)","Bean (Dry)","Bean (Sugar)","Bean (Green)","Bean (Kidney)","Canola","Cassava","Cotton","Cowpea","Grain Sorghum","Groundnut","Lucerne","Maize","Maize (White)","Maize (Yellow)","Oat","Peanut","Pearl Millet","Potato","Rape","Rice","Rye","Soya Bean","Sunflower","Sweet Corn","Sweet Potato","Tobacco","Triticale","Wheat","Wheat (Durum)"],Grazing:["Bahia-Notatum","Birdsfoot Trefoil","Bottle Brush","Buffalo","Buffalo (Blue)","Buffalo (White)","Bush","Carribean Stylo","Clover","Clover (Arrow Leaf)","Clover (Crimson)","Clover (Persian)","Clover (Red)","Clover (Rose)","Clover (Strawberry)","Clover (Subterranean)","Clover (White)","Cocksfoot","Common Setaria","Dallis","Kikuyu","Lucerne","Lupin","Lupin (Narrow Leaf)","Lupin (White)","Lupin (Yellow)","Medic","Medic (Barrel)","Medic (Burr)","Medic (Gama)","Medic (Snail)","Medic (Strand)","Phalaris","Rescue","Rhodes","Russian Grass","Ryegrass","Ryegrass (Hybrid)","Ryegrass (Italian)","Ryegrass (Westerwolds)","Serradella","Serradella (Yellow)","Silver Leaf Desmodium","Smuts Finger","Soutbos","Tall Fescue","Teff","Veld","Weeping Lovegrass"],Horticulture:["Almond","Aloe","Apple","Apricot","Avocado","Banana","Barberry","Berry","Bilberry","Blackberry","Blueberry","Cherry","Cloudberry","Coconut","Coffee","Fig","Gooseberry","Grape","Grape (Bush Vine)","Grape (Red)","Grape (Table)","Grape (White)","Grapefruit","Guava","Hops","Kiwi Fruit","Lemon","Litchi","Macadamia Nut","Mandarin","Mango","Mulberry","Nectarine","Olive","Orange","Papaya","Peach","Pear","Pomegranate","Prickly Pear","Pecan Nut","Persimmon","Pineapple","Pistachio Nut","Plum","Protea","Raspberry","Rooibos","Sisal","Strawberry","Sugarcane","Tea","Walnut","Wineberry"],Livestock:["Cattle (Extensive)","Cattle (Feedlot)","Cattle (Stud)","Chicken (Broilers)","Chicken (Layers)","Dairy","Game","Goats","Horses","Ostrich","Pigs","Sheep (Extensive)","Sheep (Feedlot)","Sheep (Stud)"],Plantation:["Bluegum","Pine","Wattle"]};return c.prototype.addEnterprise=function(a){a=a||this.selection.item,-1==this.enterprises.indexOf(a)&&(this.enterprises.push(a),this.selection.item=void 0)},c.prototype.removeEnterprise=function(a){"string"==typeof a&&(a=this.enterprises.indexOf(a)),-1!==a&&this.enterprises.splice(a,1)},{listServiceMap:function(){return d},legalEntityTypes:function(){return e},enterpriseTypes:function(){return f},enterpriseEditor:function(a){return new c(a)}}}]),sdkHelperFarmerApp.factory("landUseHelper",function(){var a=["High","Medium","Low"],b=["0 - 30cm","30 - 60cm","60 - 90cm","90 - 120cm","120cm +"],c=["Centre-Pivot","Flood","Micro","Sub-drainage","Sprinkler","Drip"],d=["Cropland","Grazing","Horticulture (Intensive)","Horticulture (Perennial)","Horticulture (Seasonal)","Housing","Plantation","Planted Pastures","Structures (Handling)","Structures (Processing)","Structures (Storage)","Utilities","Wasteland","Conservation"],e=["Sand","Loamy Sand","Clay Sand","Sandy Loam","Fine Sandy Loam","Loam","Silty Loam","Sandy Clay Loam","Clay Loam","Clay","Gravel","Other","Fine Sandy Clay","Medium Sandy Clay Loam","Fine Sandy Clay Loam","Loamy Medium Sand","Medium Sandy Loam","Coarse Sandy Clay Loam","Coarse Sand","Loamy Fine Sand","Loamy Coarse Sand","Fine Sand","Silty Clay","Coarse Sandy Loam","Medium Sand","Medium Sandy Clay","Coarse Sandy Clay","Sandy Clay"],f=["Plains","Mountains"],g=["Irrigation Scheme","River","Dam","Borehole"],h={Crops:"Cropland",Orchards:"Horticulture (Perennial)",Plantations:"Plantation",Vineyards:"Horticulture (Perennial)"};return{croppingPotentialTypes:function(){return a},effectiveDepthTypes:function(){return b},irrigationTypes:function(){return c},landUseTypes:function(){return d},soilTextureTypes:function(){return e},terrainTypes:function(){return f},waterSourceTypes:function(){return g},isCroppingPotentialRequired:function(a){return"Cropland"==a},isTerrainRequired:function(a){return"Grazing"==a},getPipLandUseType:function(a){return h[a]}}}),sdkHelperFarmerApp.factory("farmHelper",["geoJSONHelper","geojsonUtils","underscore",function(a,b,c){var d=function(a){return{id:a.id||a.$id,title:a.name}};return{listServiceMap:function(){return d},containsPoint:function(a,c,d){var e=!1;return angular.forEach(c,function(c){"farmland"==c.type&&c.farmId&&c.farmId==d.id&&b.pointInPolygon(a,c.data.loc)&&(e=!0)}),e},getCenter:function(b,d){var e=a();return c.chain(b.legalEntities).pluck("assets").flatten().compact().each(function(a){"farmland"==a.type&&a.farmId&&a.farmId==d.id&&e.addGeometry(a.data.loc)}),e.getCenterAsGeojson()},validateFieldName:function(a,b,d){b.fieldName=b.fieldName?b.fieldName.trim().replace(/[^0-9A-Za-z\s]/g,""):"";var e=c.find(a.data.fields,function(a){return a.fieldName.toUpperCase().replace(/[^0-9A-Z]/g,"")===b.fieldName.toUpperCase().replace(/[^0-9A-Z]/g,"")});return angular.isObject(e)?angular.isObject(d)&&e.fieldName===d.fieldName:!0}}}]);var sdkHelperFavouritesApp=angular.module("ag.sdk.helper.favourites",["ag.sdk.helper.document","ag.sdk.helper.task"]);sdkHelperFavouritesApp.factory("activityHelper",["documentHelper",function(a){var b=function(b){var f={id:b.id||b.$id,date:b.date};return"object"==typeof b.actor?(b.actor.displayName?(f.title=b.actor.displayName,f.subtitle=b.actor.displayName):(f.title=b.actor.firstName+" "+b.actor.lastName,f.subtitle=b.actor.firstName+" "+b.actor.lastName),b.actor.position&&(f.title+=" ("+b.actor.position+")"),f.profilePhotoSrc=b.actor.profilePhotoSrc):b.organization?(f.title=b.organization.name,f.subtitle=b.organization.name):(f.title="Someone",f.subtitle="Someone"),f.subtitle+=" "+d(b.action)+" ",f.referenceId="farmer"==b.referenceType?b.organization.id:b[b.referenceType+"Id"],"farmer"==b.referenceType?(f.subtitle+="invite"==b.action?b.organization.name+" to create an Agrista account":"register"==b.action?"your request to join Agrista":"create"==b.action?"a customer portfolio for "+b.organization.name:"decline"==b.action?"a task for "+b.organization.name:"the portfolio of "+b.organization.name,f.referenceState="customer.details"):(void 0!==b[b.referenceType]?"document"==b.referenceType?(f.subtitle+=e(b[b.referenceType].docType)+" "+a.getDocumentTitle(b[b.referenceType].docType)+" "+b.referenceType,f.referenceState="document.details"):"task"==b.referenceType?(f.subtitle+="the "+taskHelper.getTaskTitle(b[b.referenceType].todo)+" "+b.referenceType,f.referenceState=a.getTaskState(b[b.referenceType].todo)):f.subtitle+=e(b.referenceType)+" "+b.referenceType:f.subtitle+=e(b.referenceType)+" "+b.referenceType,b.actor&&b.organization&&b.organization.name&&(f.subtitle+=" "+c(b.action)+" "+b.organization.name)),f},c=function(a){return f[a]||"for"},d=function(a){var b=["a","e","i","o","u"];return g[a]||(a.lastIndexOf("e")==a.length-1?a+"d":a.lastIndexOf("y")==a.length-1&&-1==b.indexOf(a.substr(a.length-1,a.length))?a.substr(0,a.length-1)+"ied":a+"ed")},e=function(a){var b=["a","e","i","o","u"];return h[a]||(-1!=b.indexOf(a.substr(0,1))?"an":"a")},f={share:"of",sent:"to"},g={register:"accepted",sent:"sent"},h={"asset register":"an"};return{listServiceMap:function(){return b},getActionVerb:d,getReferenceArticle:e}}]),sdkHelperFavouritesApp.factory("notificationHelper",["taskHelper","documentHelper",function(){var a=function(a){return{id:a.id||a.$id,title:a.sender,subtitle:a.message,state:b(a.notificationType,a.dataType)}},b=function(a,b){var d=c[a]?c[a].state:"view";return"notification."+d+"-"+b},c={reassign:{title:"Reassign",state:"manage"},"import":{title:"Import",state:"import"},view:{title:"View",state:"view"},reject:{title:"Rejected",state:"view"},review:{title:"Review",state:"view"}};return{listServiceMap:function(){return a},getNotificationState:function(a,c){return b(a,c)},getNotificationTitle:function(a){return c[a]?c[a].title:""}}}]);var sdkHelperMerchantApp=angular.module("ag.sdk.helper.merchant",["ag.sdk.library"]);sdkHelperMerchantApp.factory("merchantHelper",["underscore",function(a){function b(b,c){b=b||[],this.services=a.map(c||[],function(a){return a.name?a.name:a}),this.selection={list:b,mode:0==b.length?"add":"select",text:""}}var c=function(a){return{id:a.id||a.$id,title:a.name,subtitle:(a.subscriptionPlan?g(a.subscriptionPlan)+" ":"")+(a.partnerType?f(a.partnerType)+" partner":""),status:a.registered?{text:"registered",label:"label-success"}:!1}},d={benefit:"Benefit",standard:"Standard"},e={small:"Small",medium:"Medium",large:"Large",association:"Association"},f=function(a){return d[a]||""},g=function(a){return e[a]||""};return b.prototype.toggleMode=function(){this.selection.list.length>0&&(this.selection.mode="select"==this.selection.mode?"add":"select",this.selection.text="")},b.prototype.addService=function(a){a=a||this.selection.text,-1==this.services.indexOf(a)&&(this.services.push(a),this.selection.text="")},b.prototype.removeService=function(a){"string"==typeof a&&(a=this.services.indexOf(a)),-1!==a&&this.services.splice(a,1)},{listServiceMap:function(){return c},partnerTypes:function(){return d},getPartnerType:f,subscriptionPlans:function(){return e},getSubscriptionPlan:g,serviceEditor:function(a,c){return new b(a,c)}}}]);var sdkHelperProductionPlanApp=angular.module("ag.sdk.helper.production-plan",[]);sdkHelperProductionPlanApp.factory("productionPlanHelper",[function(){var a={crop:["Cropland"],livestock:["Grazing","Planted Pastures","Conservation"],horticulture:["Horticulture (Perennial)"]};return{isFieldApplicable:function(a){return void 0!==this.getAssetType(a)},getAssetType:function(b){var c;return angular.forEach(a,function(a,d){-1!==a.indexOf(b.landUse)&&(c=d)}),c}}}]);var sdkHelperRegionApp=angular.module("ag.sdk.helper.region",[]);sdkHelperRegionApp.factory("regionHelper",[function(){var a=function(a){var b={title:a.name,subtitle:a.region.province,region:a.region.name};return a.subRegionNumber&&(b.subtitle+=" - "+a.subRegionNumber),a.plotCode&&(b.subtitle+=" - "+a.plotCode),b};return{listServiceMap:function(){return a}}}]);var sdkHelperTaskApp=angular.module("ag.sdk.helper.task",["ag.sdk.authorization","ag.sdk.utilities","ag.sdk.interface.list","ag.sdk.library"]);sdkHelperTaskApp.provider("taskHelper",["underscore",function(a){var b=["assigned","in progress","in review"],c=function(c){var d=c.documentKey,e=a.filter(c.subtasks,function(a){return a.type&&-1!==b.indexOf(a.status)&&"child"==a.type}).map(function(a){return{id:a.id||c.$id,title:c.organization.name,subtitle:g(a.todo,a),todo:a.todo,groupby:d,status:{text:a.status||" ",label:j(a.status)}}});return e.length?e:void 0},d=function(a){return{id:a.documentId,title:a.organization.name,subtitle:a.documentKey,status:{text:a.status||" ",label:j(a.status)}}},e={},f=function(a){return e[a]?e[a].state:void 0},g=function(a,b){var c=e[a];return void 0!==c?"string"==typeof c.title?c.title:c.title(b):void 0},h=function(a){return k[a]||a||" "},i=function(a){return l[a]||a||" "},j=function(a){switch(a){case"in progress":case"in review":return"label-warning";case"done":return"label-success";default:return"label-default"}},k={backlog:"Backlog",assigned:"Assigned","in progress":"In Progress","in review":"In Review",done:"Done",archive:"Archived"},l={accept:"Accept",decline:"Decline",assign:"Assign",start:"Start",complete:"Complete",approve:"Approve",reject:"Reject",release:"Release"};this.addTasks=function(b){e=a.extend(e,b)},this.$get=["authorization","listService","dataMapService",function(e,l,m){return{listServiceMap:function(){return c},parentListServiceMap:function(){return d},getTaskState:f,getTaskTitle:g,getTaskStatusTitle:h,getTaskActionTitle:i,getTaskLabel:j,taskStatusTitles:function(){return k},filterTasks:function(b,c){return c=c||[],a.filter(b,function(b){return void 0!==f(b.todo)&&0==a.contains(c,b.status)})},updateListService:function(d,f,g,h){var i=e.currentUser(),j=a.findWhere(g,{id:d});l.addItems(m({id:j.parentTaskId,documentKey:j.documentKey,type:"parent",todo:f,organization:h,subtasks:a.filter(g,function(a){return a&&a.assignedTo==i.username})},c)),j&&-1===b.indexOf(j.status)&&l.removeItems(j.id)}}}]}]),sdkHelperTaskApp.factory("taskWorkflowHelper",["underscore",function(a){var b=["accept","decline","start","assign","complete","approve","reject","release"],c={accept:["backlog","assigned","in progress","in review","complete"],decline:["assigned"],start:["assigned","in progress"],assign:["backlog","assigned","in progress","in review"],complete:["assigned","in progress"],approve:["in review"],reject:["assigned","in review"],release:["done"]},d={parent:{complete:["in progress"],reject:["done"],release:["done"]},child:c,external:c};return{canChangeToState:function(c,e){return a.contains(b,e)?d[c.type]&&d[c.type][e]?-1!==d[c.type][e].indexOf(c.status):!1:!0}}}]);var sdkHelperTeamApp=angular.module("ag.sdk.helper.team",["ag.sdk.library"]);sdkHelperTeamApp.factory("teamHelper",["underscore",function(a){function b(b,c){b=b||[],c=c||[],this.teams=a.map(c,function(a){return a.name?a.name:a}),this.teamsDetails=angular.copy(c),this.filterList=function(){var c=this;c.selection.list=a.reject(b,function(b){return a.contains(c.teams,b.name?b.name:b)})},this.selection={mode:0==b.length?"add":"select",text:""},this.filterList()}return b.prototype.toggleMode=function(){this.selection.list.length>0&&(this.selection.mode="select"==this.selection.mode?"add":"select",this.selection.text="")},b.prototype.addTeam=function(b){b=b||this.selection.text,-1==this.teams.indexOf(b)&&(this.teams.push(b),this.teamsDetails.push(a.findWhere(this.selection.list,{name:b})),this.selection.text="",this.filterList())},b.prototype.removeTeam=function(a){"string"==typeof a&&(a=this.teams.indexOf(a)),-1!==a&&(this.teams.splice(a,1),this.teamsDetails.splice(a,1),this.selection.text="",this.filterList())},{teamEditor:function(a,c){return new b(a,c)}}}]);var sdkHelperUserApp=angular.module("ag.sdk.helper.user",[]);sdkHelperUserApp.factory("userHelper",[function(){var a=function(a){return{id:a.id||a.$id,title:a.firstName+" "+a.lastName,subtitle:a.position,teams:a.teams}},b=["English"];return{listServiceMap:function(){return a},languageList:function(){return b}}}]);var sdkInterfaceGeocledianApp=angular.module("ag.sdk.interface.geocledian",["ag.sdk.utilities","ag.sdk.id","ag.sdk.library"]);sdkInterfaceGeocledianApp.provider("geocledianService",["underscore",function(a){var b={key:"46552fa9-6a5v-2346-3z67-s4b8556cxvwp",layers:["vitality","visible"],url:"https://geocledian.com/agknow/api/v3/",source:"sentinel2"};this.config=function(c){b=a.defaults(c||{},b)},this.$get=["$http","moment","promiseService","underscore",function(a,c,d,e){function f(){this.ids=[],this.dates=[],this.parcels=[]}function g(a,c){return d.wrapAll(function(d){var f=a.getParcels(c);c&&f&&0==f.length?(a.ids.push(c),e.each(b.layers,function(b){d.push(h(a,c,b))})):e.each(f,function(a){d.push(a)})})}function h(c,d,f){return a.get(b.url+"parcels/"+d+"/"+f+"?key="+b.key+(b.source?"&source="+b.source:"")).then(function(a){a&&a.data&&a.data.content&&(c.parcels=c.parcels.concat(e.map(a.data.content,function(a){return e.extend(a,{type:f})})))})}return f.prototype={config:b,createParcel:function(c){return d.wrap(function(d){a.post(b.url+"parcels",e.extend({key:b.key},c)).then(function(a){a&&a.data&&e.isNumber(a.data.id)?d.resolve(a.data):d.reject()},d.reject)})},addParcel:function(a){return g(this,a)},getDates:function(){return e.chain(this.parcels).pluck("date").uniq().sortBy(function(a){return c(a)}).value()},getParcels:function(a){return"object"!=typeof a&&(a={parcel_id:a}),e.where(this.parcels,a)},getParcelImageUrl:function(a,c){return b.url+a[c||"png"]+"?key="+b.key}},function(){return new f}}]}]);var sdkInterfaceListApp=angular.module("ag.sdk.interface.list",["ag.sdk.id"]);sdkInterfaceListApp.factory("listService",["$rootScope","objectId",function(a,b){var c,d,e,f,g,h,i=[],j=function(){a.$broadcast("list::button__clicked")},k=function(b){c!==b&&("object"==typeof b?(c=b,c.click=c.click||j):c=void 0,a.$broadcast("list::button__changed",c))},l=function(b){d!==b&&(d=void 0!==b?b:void 0,a.$broadcast("list::groupby__changed",d))},m=function(b){e!==b&&(void 0!==b?(i=[],e=b):e=void 0,a.$broadcast("list::scroll__changed",e))},n=function(b){f!==b&&(f=void 0!==b?b:void 0,a.$broadcast("list::search__changed",f))},o=function(b){g!==b&&(g=b?b:void 0,a.$broadcast("list::title__changed",g))},p=function(a){if(h=a,i instanceof Array)for(var b=0;b<i.length;b++)i[b].active=!1,void 0!==a&&(i[b].id==a?i[b].active=!0:i[b].type==a&&(i[b].active=!0));else for(var c in i)i.hasOwnProperty(c)&&(i[c].active=c==a)},q=function(){if(i instanceof Array){for(var a=0;a<i.length;a++)if(i[a].id==h)return i[a]}else for(var b in i)if(i.hasOwnProperty(b)&&b==h)return i[b];return null};return a.$on("$stateChangeSuccess",function(a,b,c){p(c.id?c.id:c.type)}),a.$on("list::item__selected",function(a,b){p("object"==typeof b?b.id?b.id:b.type:b)}),{config:function(a){a.reset&&(c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,i=[],h=void 0),k(a.button),l(a.groupby),m(a.infiniteScroll),n(a.search),o(a.title)},button:function(a){return 1==arguments.length&&k(a),c},groupby:function(a){return 1==arguments.length&&l(a),d},infiniteScroll:function(a){return 1==arguments.length&&m(a),e},search:function(a){return 1==arguments.length&&n(a),f},title:function(a){return 1==arguments.length&&o(a),g},items:function(b){return void 0!==b&&(i=angular.copy(b),h=void 0,a.$broadcast("list::items__changed",i)),i},length:function(){return i.length},addItems:function(c,d){if(void 0!==c){c instanceof Array==!1&&(c=[c]);for(var e=0;e<c.length;e++){var f=c[e];if(f.id=f.id||b().toBase64String(),i instanceof Array){for(var g=!1,j=0;j<i.length;j++)if(f.id==i[j].id){i[j]=f,i[j].active=void 0!==h&&h==f.id,g=!0;break}0==g&&(d===!0?i.unshift(f):i.push(f))}else i[f.id]=f,i[f.id].active=void 0!==h&&h==f.id}a.$broadcast("list::items__changed",i)}},removeItems:function(b){if(void 0!==b){b instanceof Array==!1&&(b=[b]);for(var c=0;c<b.length;c++){var d=b[c];if(i instanceof Array){for(var e=0;e<i.length;e++)if(d==i[e].id){if(i.splice(e,1),d==h&&i.length){var f=i[e]?i[e]:i[e-1];a.$broadcast("list::item__selected",f)}break}}else delete i[d]}i instanceof Array&&0==i.length&&a.$broadcast("list::items__empty"),a.$broadcast("list::items__changed",i)}},selectFirstItem:function(){a.$broadcast("list::selectFirst__requested")},setActiveItem:function(a){p(a)},getActiveItem:function(){return q()},updateLabel:function(b){a.$broadcast("list::labels__changed",b)}}}]);var sdkInterfaceMapApp=angular.module("ag.sdk.interface.map",["ag.sdk.utilities","ag.sdk.id","ag.sdk.config","ag.sdk.library"]);sdkInterfaceMapApp.factory("geoJSONHelper",function(){function a(b,c){return this instanceof a?void this.addGeometry(b,c):new a(b,c)}function b(a,c){c&&(angular.isArray(c[0])?angular.forEach(c,function(c){b(a,c)}):angular.isArray(c)&&a.push([c[1],c[0]]))}return a.prototype={getJson:function(){return this._json},getType:function(){return this._json.type},getGeometryType:function(){return this._json.geometry?this._json.geometry.type:this._json.type},getBounds:function(){var a=[];if(this._json){var c=this._json.features||[this._json];angular.forEach(c,function(c){var d=c.geometry||c;b(a,d.coordinates)})}return a},getBoundingBox:function(a){a=a||this.getBounds();var b=0,c=0,d=0,e=0;return angular.forEach(a,function(a,f){0==f?(b=c=a[0],d=e=a[1]):(b=b<a[0]?b:a[0],c=c<a[0]?a[0]:c,d=d<a[1]?d:a[1],e=e<a[1]?a[1]:e)}),[[b,d],[c,e]]},getCenter:function(a){var b=this.getBoundingBox(a);return[b[0][0]+(b[1][0]-b[0][0])/2,b[0][1]+(b[1][1]-b[0][1])/2]},getCenterAsGeojson:function(a){return{coordinates:this.getCenter(a).reverse(),type:"Point"}},getProperty:function(a){return this._json&&this._json.properties?this._json.properties[a]:void 0},setCoordinates:function(a){this._json&&"FeatureCollection"!=this._json.type&&(this._json.geometry?this._json.geometry.coordinates=a:this._json.coordinates=a)},addProperties:function(a){var b=this;return this._json&&a&&("FeatureCollection"!=b._json.type&&"Feature"!=b._json.type?b._json={type:"Feature",geometry:b._json,properties:a}:(b._json.properties=b._json.properties||{},angular.forEach(a,function(a,c){b._json.properties[c]=a}))),b},addGeometry:function(a,b){return a&&(void 0===this._json?(this._json=a,this.addProperties(b)):("FeatureCollection"!=this._json.type&&"Feature"!=this._json.type&&(this._json={type:"Feature",geometry:this._json}),"Feature"==this._json.type&&(this._json={type:"FeatureCollection",features:[this._json]}),"FeatureCollection"==this._json.type&&this._json.features.push({type:"Feature",geometry:a,properties:b}))),this},formatGeoJson:function(a,b){if("point"==b.toLowerCase())switch(a&&a.type&&a.type.toLowerCase()){case"feature":if(a.geometry&&a.geometry.type&&"Point"==a.geometry.type)return console.log(a.geometry),a.geometry;break;case"featurecollection":break;case"geometrycollection":}return a},validGeoJson:function(a,b){var c=!0;if(!a||void 0==a.type||"string"!=typeof a.type||b&&a.type.toLowerCase()!=b)return!1;switch(a.type.toLowerCase()){case"feature":break;case"featurecollection":break;case"geometrycollection":break;default:if(!a.coordinates||!a.coordinates instanceof Array)return!1;var d=_.flatten(a.coordinates);d.forEach(function(a){"number"!=typeof a&&(c=!1)})}return c}},function(b,c){return new a(b,c)}}),sdkInterfaceMapApp.provider("mapMarkerHelper",["underscore",function(a){var b=function(b,c,d){return a.defaults(d||{},{iconUrl:"img/icons/"+b+"."+(c?c:"default")+".png",shadowUrl:"img/icons/"+b+".shadow.png",iconSize:[48,48],iconAnchor:[22,42],shadowSize:[73,48],shadowAnchor:[22,40],labelAnchor:[12,-24]})},c=this.getMarker=function(a,c,d){return"object"==typeof c&&(d=c,c="default"),b(a,c,d)},d=this.getMarkerStates=function(a,c,d){var e={};return"string"==typeof a&&angular.forEach(c,function(c){e[c]=b(a,c,d)}),e};this.$get=function(){return{getMarker:c,getMarkerStates:d}}}]),sdkInterfaceMapApp.provider("mapStyleHelper",["mapMarkerHelperProvider",function(a){var b={asset:a.getMarkerStates("asset",["default","success","error"]),zone:a.getMarkerStates("marker",["default","success","error"])},c={foreground:{district:{style:{weight:2,color:"white",opacity:.8,fillColor:"#0094D6",fillOpacity:.5}},farmland:{style:{weight:2,color:"white",opacity:.8,fillColor:"blue",fillOpacity:.3}},field:{icon:"success",style:{weight:2,color:"white",opacity:.8,fillColor:"#5b4723",fillOpacity:.8}},crop:{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#aa64b0",fillOpacity:.8}},improvement:{icon:"success",style:{weight:4,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.8}},cropland:{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#4573d5",fillOpacity:.8}},pasture:{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#ffde40",fillOpacity:.8}},"permanent crop":{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#487811",fillOpacity:.8}},plantation:{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#00e64a",fillOpacity:.8}},zone:{icon:b.zone.success,style:{weight:4,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.8}},farmgate:{icon:"success"},homestead:{icon:"success"},search:{style:{weight:2,color:"white",opacity:.8,fillColor:"#f7b2bf",fillOpacity:.8,dashArray:"5,5"}}},background:{district:{style:{weight:1,color:"white",opacity:.8,fillColor:"#0094D6",fillOpacity:.2}},farmland:{style:{weight:1,color:"white",opacity:.8,fillColor:"blue",fillOpacity:.1}},field:{icon:"default",style:{weight:1,color:"white",opacity:.8,fillColor:"#5b4723",fillOpacity:.4}},crop:{icon:b.asset["default"],style:{weight:1,color:"white",opacity:.8,fillColor:"#aa64b0",fillOpacity:.4}},improvement:{icon:"default",style:{weight:4,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.5}},cropland:{icon:b.asset["default"],style:{weight:1,color:"white",opacity:.8,fillColor:"#4573d5",fillOpacity:.4}},pasture:{icon:b.asset["default"],style:{weight:1,color:"white",opacity:.8,fillColor:"#ffde40",fillOpacity:.4}},"permanent crop":{icon:b.asset["default"],style:{weight:1,color:"white",opacity:.8,fillColor:"#487811",fillOpacity:.4}},plantation:{icon:b.asset["default"],style:{weight:1,color:"white",opacity:.8,fillColor:"#00e64a",fillOpacity:.4}},zone:{icon:b.zone["default"],style:{weight:2,color:"white",opacity:.5,fillColor:"#ff6666",fillOpacity:.5}},farmgate:{icon:"default"},homestead:{icon:"default",label:{message:"Homestead"}}}},d=this.getStyle=function(d,e,f){var g=c[d]&&c[d][e]?angular.copy(c[d][e]):{};return"string"==typeof g.icon&&(void 0===b[e]&&(b[e]=a.getMarkerStates(e,["default","success","error"])),g.icon=b[e][g.icon]),"object"==typeof f&&(g.label=f),g},e=this.setStyle=function(a,b,d){c[a]=c[a]||{},c[a][b]=d};this.$get=function(){return{getStyle:d,setStyle:e}}}]),sdkInterfaceMapApp.provider("mapboxService",["underscore",function(a){var b={options:{attributionControl:!0,layersControl:!0,scrollWheelZoom:!1,zoomControl:!0},layerControl:{baseTile:"Agriculture",baseLayers:{Agriculture:{tiles:"agrista.f9f5628d",type:"mapbox"},Satellite:{tiles:"agrista.a7235891",type:"mapbox"},Hybrid:{tiles:"agrista.01e3fb18",type:"mapbox"},Light:{tiles:"agrista.e7367e07",type:"mapbox"},"Production Regions":{tiles:"agrista.87ceb2ab",type:"mapbox"}},overlays:{}},controls:{},events:{},view:{coordinates:[-28.691,24.714],zoom:6},bounds:{},leafletLayers:{},layers:{},geojson:{}},c={};
this.config=function(c){b=a.defaults(c||{},b)},this.$get=["$rootScope","objectId",function(d,e){function f(a,c){var e=this;e._id=a,e._ready=!1,e._options=c,e._show=e._options.show||!1,e._config=angular.copy(b),e._requestQueue=[],d.$on("mapbox-"+e._id+"::init",function(){e.dequeueRequests(),e._ready=!0}),d.$on("mapbox-"+e._id+"::destroy",function(){e._ready=!1,e._options.persist!==!0&&(e._config=angular.copy(b))})}return f.prototype={getId:function(){return this._id},reset:function(){this._config=angular.copy(b),d.$broadcast("mapbox-"+this._id+"::reset")},clearLayers:function(){this.removeOverlays(),this.removeGeoJSON(),this.removeLayers()},enqueueRequest:function(a,b){this._ready?d.$broadcast(a,b):this._requestQueue.push({event:a,args:b})},dequeueRequests:function(){if(this._requestQueue.length)do{var a=this._requestQueue.shift();d.$broadcast(a.event,a.args)}while(this._requestQueue.length)},shouldShow:function(){return this._show},hide:function(){this._show=!1,this.enqueueRequest("mapbox-"+this._id+"::hide",{})},show:function(){this._show=!0,this.enqueueRequest("mapbox-"+this._id+"::show",{})},invalidateSize:function(){this.enqueueRequest("mapbox-"+this._id+"::invalidate-size",{})},getOptions:function(){return this._config.options},setOptions:function(a){var b=this;angular.forEach(a,function(a,c){b._config.options[c]=a})},getMapCenter:function(a){this.enqueueRequest("mapbox-"+this._id+"::get-center",a)},getMapBounds:function(a){this.enqueueRequest("mapbox-"+this._id+"::get-bounds",a)},getMapControl:function(a,b){this.enqueueRequest("mapbox-"+this._id+"::get-control",{control:a,handler:b})},getBaseTile:function(){return this._config.layerControl.baseTile},setBaseTile:function(a){this._config.layerControl.baseTile=a,this.enqueueRequest("mapbox-"+this._id+"::set-basetile",a)},getBaseLayers:function(){return this._config.layerControl.baseLayers},setBaseLayers:function(a){this._config.layerControl.baseLayers=a,this.enqueueRequest("mapbox-"+this._id+"::set-baselayers",a)},addBaseLayer:function(a,b,c){this._config.layerControl.baseLayers[a]=b,this.enqueueRequest("mapbox-"+this._id+"::add-baselayer",{name:a,layer:b,show:c})},getOverlays:function(){return this._config.layerControl.overlays},addOverlay:function(a,b){a&&void 0==this._config.layerControl.overlays[a]&&(this._config.layerControl.overlays[a]=b,this.enqueueRequest("mapbox-"+this._id+"::add-overlay",{layerName:a,name:b||a}))},removeOverlay:function(a){a&&this._config.layerControl.overlays[a]&&(d.$broadcast("mapbox-"+this._id+"::remove-overlay",a),delete this._config.layerControl.overlays[a])},removeOverlays:function(){var a=this;angular.forEach(this._config.layerControl.overlays,function(b,c){d.$broadcast("mapbox-"+a._id+"::remove-overlay",c),delete a._config.layerControl.overlays[c]})},getControls:function(){return this._config.controls},addControl:function(a,b){this._config.controls[a]={name:a,options:b},d.$broadcast("mapbox-"+this._id+"::add-control",this._config.controls[a])},removeControl:function(a){delete this._config.controls[a],d.$broadcast("mapbox-"+this._id+"::remove-control",a)},getEventHandlers:function(){return this._config.events},addEventHandler:function(a,b){a=a instanceof Array?a:[a];var c=this;angular.forEach(a,function(a){c.removeEventHandler(a),c._config.events[a]=b,c.enqueueRequest("mapbox-"+c._id+"::add-event-handler",{event:a,handler:b})})},removeEventHandler:function(a){a=a instanceof Array?a:[a];var b=this;angular.forEach(a,function(a){void 0!==b._config.events[a]&&(b.enqueueRequest("mapbox-"+b._id+"::remove-event-handler",{event:a,handler:b._config.events[a]}),delete b._config.events[a])})},getView:function(){return{coordinates:this._config.view.coordinates,zoom:this._config.view.zoom}},setView:function(a,b){a instanceof Array&&(this._config.view.coordinates=a,this._config.view.zoom=b||this._config.view.zoom,d.$broadcast("mapbox-"+this._id+"::set-view",this._config.view))},getBounds:function(){return this._config.bounds},setBounds:function(a,b){this._config.bounds={coordinates:a,options:b||{reset:!1}},d.$broadcast("mapbox-"+this._id+"::set-bounds",this._config.bounds)},zoomTo:function(a,b,c){d.$broadcast("mapbox-"+this._id+"::zoom-to",{coordinates:a,zoom:b,options:c})},createLayer:function(a,b,c,d){"function"==typeof c&&(d=c,c={});var e=this;this._config.layers[a]={name:a,type:b,options:c,handler:function(b){e._config.leafletLayers[a]=b,d(b)}},this.enqueueRequest("mapbox-"+this._id+"::create-layer",this._config.layers[a])},getLayer:function(a){return this._config.leafletLayers[a]},getLayers:function(){return this._config.layers},addLayer:function(a,b){this._config.leafletLayers[a]=b,d.$broadcast("mapbox-"+this._id+"::add-layer",a)},removeLayer:function(a){a instanceof Array==!1&&(a=[a]);var b=this;angular.forEach(a,function(a){b.enqueueRequest("mapbox-"+b._id+"::remove-layer",a),delete b._config.layers[a],delete b._config.leafletLayers[a]})},removeLayers:function(){var a=this;angular.forEach(this._config.layers,function(b,c){a.enqueueRequest("mapbox-"+a._id+"::remove-layer",c),delete a._config.layers[c],delete a._config.leafletLayers[c]})},showLayer:function(a){this.enqueueRequest("mapbox-"+this._id+"::show-layer",a)},hideLayer:function(a){this.enqueueRequest("mapbox-"+this._id+"::hide-layer",a)},fitLayer:function(a,b){this.enqueueRequest("mapbox-"+this._id+"::fit-layer",{name:a,options:b||{reset:!1}})},getGeoJSON:function(){return this._config.geojson},getGeoJSONFeature:function(a,b){return this._config.geojson[a]&&this._config.geojson[a][b]?this._config.geojson[a][b]:null},getGeoJSONLayer:function(a){return this._config.geojson[a]?this._config.geojson[a]:null},addGeoJSON:function(b,c,d,f,g){"function"==typeof f&&(g=f,f={});var h=this;f=a.defaults(f||{},{featureId:e().toString()});var i={layerName:b,geojson:c,options:d,properties:f,handler:function(a,c,d){h._config.leafletLayers[b]=a,h._config.leafletLayers[f.featureId]=d,"function"==typeof g&&g(c,d)}};return this._config.geojson[b]=this._config.geojson[b]||{},this._config.geojson[b][f.featureId]=i,this.enqueueRequest("mapbox-"+this._id+"::add-geojson",i),f.featureId},addPhotoMarker:function(b,c,d,f,g){"function"==typeof f&&(g=f,f={});var h=this;f=a.defaults(f||{},{featureId:e().toString()});var i={layerName:b,geojson:c,options:d,properties:f,handler:function(a,c,d){h._config.leafletLayers[b]=a,"function"==typeof g&&g(c,d)}};return i.properties.isMedia=!0,this._config.geojson[b]=this._config.geojson[b]||{},this._config.geojson[b][f.featureId]=i,this.enqueueRequest("mapbox-"+this._id+"::add-photo-marker",i),f.featureId},removeGeoJSONFeature:function(a,b){this._config.geojson[a]&&this._config.geojson[a][b]&&(d.$broadcast("mapbox-"+this._id+"::remove-geojson-feature",this._config.geojson[a][b]),delete this._config.geojson[a][b])},removeGeoJSONLayer:function(a){a instanceof Array==!1&&(a=[a]);var b=this;angular.forEach(a,function(a){b._config.geojson[a]&&(angular.forEach(b._config.geojson[a],function(c,d){b.enqueueRequest("mapbox-"+b._id+"::remove-layer",d),delete b._config.leafletLayers[d],delete b._config.geojson[a][d]}),b.enqueueRequest("mapbox-"+b._id+"::remove-geojson-layer",a),delete b._config.leafletLayers[a],delete b._config.geojson[a])})},removeGeoJSON:function(){var a=this;angular.forEach(a._config.geojson,function(b,c){angular.forEach(b,function(b,d){a.enqueueRequest("mapbox-"+a._id+"::remove-layer",d),delete a._config.leafletLayers[d],delete a._config.geojson[c][d]}),a.enqueueRequest("mapbox-"+a._id+"::remove-geojson-layer",c),delete a._config.leafletLayers[c],delete a._config.geojson[c]})},editingOn:function(a,b,c,d,e){"string"==typeof c&&(c={exclude:"exclude"==c}),this.enqueueRequest("mapbox-"+this._id+"::edit-on",{layerName:a,controls:b,controlOptions:c,styleOptions:d,addLayer:e})},editingUpdate:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-update")},editingClear:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-clear")},editingOff:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-off")},pickPortionOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-portion-on")},pickDistrictOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-district-on")},pickFieldOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-field-on")},defineFarmOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-on")},defineServiceAreaOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-service-area-on")},defineFieldGroupOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-field-group-on")},featureClickOn:function(){this.enqueueRequest("mapbox-"+this._id+"::feature-click-on")},pickPortionOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-portion-off")},pickDistrictOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-district-off")},pickFieldOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-field-off")},defineFarmOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-off")},defineServiceAreaOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-service-area-off")},defineFieldGroupOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-field-group-off")},featureClickOff:function(){this.enqueueRequest("mapbox-"+this._id+"::feature-click-off")},enableSidebar:function(){this.enqueueRequest("mapbox-"+this._id+"::enable-sidebar")},showSidebar:function(){this.enqueueRequest("mapbox-"+this._id+"::sidebar-show")},hideSidebar:function(){this.enqueueRequest("mapbox-"+this._id+"::sidebar-hide")},toggleSidebar:function(){this.enqueueRequest("mapbox-"+this._id+"::sidebar-toggle")}},function(a,b){return b=b||{},void 0===c[a]&&(c[a]=new f(a,b)),b.clean===!0&&c[a].reset(),c[a]}}]}]),sdkInterfaceMapApp.directive("mapbox",["$rootScope","$http","$log","$timeout","configuration","mapboxService","geoJSONHelper","mapStyleHelper","objectId","underscore",function(a,b,c,d,e,f,g,h,i,j){function k(a,b){var c=this;c._id=a.id,c._optionSchema={},c._editing=!1,c._editableLayer,c._editableFeature=L.featureGroup(),c._featureClickable,c._geoJSON={},c._layers={},c._controls={},c._layerControls={baseTile:"",baseLayers:{},overlays:{}},c._draw={exclude:!1,addLayer:!0,options:{},controls:{}},a.delay=a.delay||0,d(function(){c.mapInit(),c.addListeners(b),c.broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::init",c._map)},a.delay)}var l={};return k.prototype.mapInit=function(){var a=this;a._mapboxServiceInstance=f(a._id);var b=a._mapboxServiceInstance.getView(),c=a._mapboxServiceInstance.getOptions();a._map=L.map(a._id,c).setView(b.coordinates,b.zoom),a._map.whenReady(function(){a.broadcast("mapbox-"+a._mapboxServiceInstance.getId()+"::ready",a._map)}),a._map.on("baselayerchange",function(b){a._layerControls.baseTile=b.name}),a._editableFeature=L.featureGroup(),a._editableFeature.addTo(a._map),a.setEventHandlers(a._mapboxServiceInstance.getEventHandlers()),a.resetLayerControls(a._mapboxServiceInstance.getBaseTile(),a._mapboxServiceInstance.getBaseLayers(),a._mapboxServiceInstance.getOverlays()),a.addControls(a._mapboxServiceInstance.getControls()),a.setBounds(a._mapboxServiceInstance.getBounds()),a.resetLayers(a._mapboxServiceInstance.getLayers()),a.resetGeoJSON(a._mapboxServiceInstance.getGeoJSON()),a._map.on("draw:drawstart",a.onDrawStart,a),a._map.on("draw:editstart",a.onDrawStart,a),a._map.on("draw:deletestart",a.onDrawStart,a),a._map.on("draw:drawstop",a.onDrawStop,a),a._map.on("draw:editstop",a.onDrawStop,a),a._map.on("draw:deletestop",a.onDrawStop,a)},k.prototype.addListeners=function(a){a.hidden=!this._mapboxServiceInstance.shouldShow();var b=this,c=this._mapboxServiceInstance.getId();a.$on("mapbox-"+c+"::get-center",function(a,c){"function"==typeof c&&c(b._map.getCenter())}),a.$on("mapbox-"+c+"::get-bounds",function(a,c){"function"==typeof c&&c(b._map.getBounds())}),a.$on("mapbox-"+c+"::get-control",function(a,c){"function"==typeof c.handler&&c.handler(b._controls[c.control])}),a.$on("$destroy",function(){delete l[c],b.mapDestroy(),b.broadcast("mapbox-"+c+"::destroy")}),a.$on("mapbox-"+c+"::set-basetile",function(a,c){b.setBaseTile(c)}),a.$on("mapbox-"+c+"::set-baselayers",function(a,c){b.setBaseLayers(c)}),a.$on("mapbox-"+c+"::add-baselayer",function(a,c){b.addBaseLayer(c.layer,c.name,c.show)}),a.$on("mapbox-"+c+"::add-overlay",function(a,c){b.addOverlay(c.layerName,c.name)}),a.$on("mapbox-"+c+"::remove-overlay",function(a,c){b.removeOverlay(c)}),a.$on("mapbox-"+c+"::add-control",function(a,c){b.addControls({control:c})}),a.$on("mapbox-"+c+"::remove-control",function(a,c){b.removeControl(c)}),a.$on("mapbox-"+c+"::add-event-handler",function(a,c){b.addEventHandler(c.event,c.handler)}),a.$on("mapbox-"+c+"::remove-event-handler",function(a,c){b.removeEventHandler(c.event,c.handler)}),a.$on("mapbox-"+c+"::set-view",function(a,c){b.setView(c)}),a.$on("mapbox-"+c+"::set-bounds",function(a,c){b.setBounds(c)}),a.$on("mapbox-"+c+"::zoom-to",function(a,c){b.zoomTo(c)}),a.$on("mapbox-"+c+"::create-layer",function(a,c){"function"==typeof c.handler&&c.handler(b.createLayer(c.name,c.type,c.options))}),a.$on("mapbox-"+c+"::add-layer",function(a,c){b.addLayer(c)}),a.$on("mapbox-"+c+"::remove-layer",function(a,c){b.removeLayer(c)}),a.$on("mapbox-"+c+"::show-layer",function(a,c){b.showLayer(c)}),a.$on("mapbox-"+c+"::hide-layer",function(a,c){b.hideLayer(c)}),a.$on("mapbox-"+c+"::fit-layer",function(a,c){b.fitLayer(c)}),a.$on("mapbox-"+c+"::add-geojson",function(a,c){b.addGeoJSONFeature(c)}),a.$on("mapbox-"+c+"::add-photo-marker",function(a,c){b.addPhotoMarker(c)}),a.$on("mapbox-"+c+"::remove-geojson-feature",function(a,c){b.removeGeoJSONFeature(c)}),a.$on("mapbox-"+c+"::remove-geojson-layer",function(a,c){b.removeGeoJSONLayer(c)}),a.$on("mapbox-"+c+"::hide",function(){a.hidden=!0}),a.$on("mapbox-"+c+"::show",function(){a.hidden=!1}),a.$on("mapbox-"+c+"::invalidate-size",function(){b._map.invalidateSize()}),a.$on("mapbox-"+c+"::edit-on",function(a,c){b.setOptionSchema(c.styleOptions),b.makeEditable(c.layerName,c.addLayer,!0),b.setDrawControls(c.controls,c.controlOptions),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-update",function(){b.makeEditable(b._editableLayer,b._draw.addLayer,!1),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-clear",function(){b.cleanEditable(),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-off",function(){b.makeEditable(void 0,{},!0),b.updateDrawControls()}),a.$on("mapbox-"+c+"::pick-portion-on",function(){b._map.on("click",b.pickPortion,b)}),a.$on("mapbox-"+c+"::pick-district-on",function(){b._map.on("click",b.pickDistrict,b)}),a.$on("mapbox-"+c+"::pick-field-on",function(){b._map.on("click",b.pickField,b)}),a.$on("mapbox-"+c+"::define-farm-on",function(){b._map.on("click",b.defineNewFarm,b)}),a.$on("mapbox-"+c+"::define-service-area-on",function(){b._map.on("click",b.defineServiceArea,b)}),a.$on("mapbox-"+c+"::define-field-group-on",function(){b._map.on("click",b.defineFieldGroup,b)}),a.$on("mapbox-"+c+"::feature-click-on",function(){b._featureClickable=!0}),a.$on("mapbox-"+c+"::pick-portion-off",function(){b._map.off("click",b.pickPortion,b)}),a.$on("mapbox-"+c+"::pick-field-off",function(){b._map.off("click",b.pickField,b)}),a.$on("mapbox-"+c+"::pick-district-off",function(){b._map.off("click",b.pickDistrict,b)}),a.$on("mapbox-"+c+"::define-farm-off",function(){b._map.off("click",b.defineNewFarm,b)}),a.$on("mapbox-"+c+"::define-service-area-off",function(){b._map.off("click",b.defineServiceArea,b)}),a.$on("mapbox-"+c+"::define-field-group-off",function(){b._map.off("click",b.defineFieldGroup,b)}),a.$on("mapbox-"+c+"::feature-click-off",function(){b._featureClickable=!1}),a.$on("mapbox-"+c+"::enable-sidebar",function(){var a=L.control.sidebar("sidebar",{closeButton:!0,position:"right"});b._sidebar=a,b._map.addControl(a)}),a.$on("mapbox-"+c+"::sidebar-show",function(){null!=b._sidebar&&b._sidebar.show()}),a.$on("mapbox-"+c+"::sidebar-hide",function(){null!=b._sidebar&&b._sidebar.hide()}),a.$on("mapbox-"+c+"::sidebar-toggle",function(){null!=b._sidebar&&b._sidebar.toggle()})},k.prototype.mapDestroy=function(){if(this._map){for(var a in this._map._layers)this._map._layers.hasOwnProperty(a)&&this._map.removeLayer(this._map._layers[a]);this._map.remove(),this._map=null}this._optionSchema={},this._editing=!1,this._editableLayer=null,this._editableFeature=null,this._geoJSON={},this._layers={},this._layerControls={baseTile:"",baseLayers:{},overlays:{}},this._draw={exclude:!1,addLayer:!0,options:{},controls:{}}},k.prototype.broadcast=function(b,d){c.debug(b),a.$broadcast(b,d)},k.prototype.resetLayerControls=function(a,b,c){this._layerControls.baseTile=a;try{this.map.removeControl(this._layerControls.control)}catch(d){}this.setBaseLayers(b),this.setOverlays(c)},k.prototype.resetLayers=function(a){var b=this;angular.forEach(b._layers,function(a,c){b._map.removeLayer(a),delete b._layers[c]}),angular.forEach(a,function(a,c){"function"==typeof a.handler&&a.handler(b.createLayer(c,a.type,a.options))})},k.prototype.resetGeoJSON=function(a){var b=this;angular.forEach(b._geoJSON,function(a,c){b._layers[c]&&(b._map.removeLayer(b._layers[c]),delete b._layers[c])}),angular.forEach(a,function(a){b.addGeoJSONLayer(a)})},k.prototype.setBaseTile=function(a){var b=this,c=!1;b._layerControls.baseTile!==a&&(angular.forEach(b._layerControls.baseLayers,function(d,e){b._map.hasLayer(d.layer)&&b._map.removeLayer(d.layer),e===a&&(c=!0)}),c&&(b._layerControls.baseTile=a),angular.forEach(b._layerControls.baseLayers,function(a,c){c===b._layerControls.baseTile&&b._map.addLayer(a.layer)}))},k.prototype.setBaseLayers=function(a){var b=this,c=b._mapboxServiceInstance.getOptions();void 0===b._layerControls.control&&(b._layerControls.control=L.control.layers({},{}),c.layersControl&&b._map.addControl(b._layerControls.control)),angular.forEach(b._layerControls.baseLayers,function(c,d){void 0===a[d]?b._layerControls.control.removeLayer(c.layer):void 0===c.layer&&b.addBaseLayer(c,d)}),angular.forEach(a,function(a,c){void 0===b._layerControls.baseLayers[c]?b.addBaseLayer(a,c):(a=b._layerControls.baseLayers[c],c===b._layerControls.baseTile&&a.layer.addTo(b._map))})},k.prototype.addBaseLayer=function(a,b,c){void 0===this._layerControls.baseLayers[b]&&("tile"==a.type?a.layer=L.tileLayer(a.tiles):"mapbox"==a.type?a.layer=L.mapbox.tileLayer(a.tiles):"google"==a.type&&"function"==typeof L.Google&&(a.layer=new L.Google(a.tiles)),(b===this._layerControls.baseTile||c)&&a.layer.addTo(this._map),this._layerControls.baseLayers[b]=a,this._layerControls.control.addBaseLayer(a.layer,b))},k.prototype.setOverlays=function(a){var b=this;angular.forEach(b._layerControls.overlays,function(c,d){void 0===a[d]&&b.removeOverlay(d,c)}),angular.forEach(a,function(a,c){b.addOverlay(c,a)})},k.prototype.addOverlay=function(a,b){var c=this._layers[a];b=b||a,this._layerControls.control&&c&&void 0===this._layerControls.overlays[a]&&(this._layerControls.overlays[a]=c,this._layerControls.control.addOverlay(c,b))},k.prototype.removeOverlay=function(a,b){var c=b||this._layers[a];this._layerControls.control&&c&&(this._layerControls.control.removeLayer(c),delete this._layerControls.overlays[a])},k.prototype.addControls=function(a){var b=this;angular.forEach(a,function(a){"function"==typeof L.control[a.name]&&(b.removeControl(a.name),b._controls[a.name]=L.control[a.name](a.options),b._map.addControl(b._controls[a.name]))})},k.prototype.removeControl=function(a){this._controls[a]&&(this._map.removeControl(this._controls[a]),delete this._controls[a])},k.prototype.setEventHandlers=function(a){var b=this;angular.forEach(a,function(a,c){b.addEventHandler(c,a)})},k.prototype.addEventHandler=function(a,b){this._map.on(a,b)},k.prototype.removeEventHandler=function(a,b){this._map.off(a,b)},k.prototype.setView=function(a){this._map&&void 0!==a&&this._map.setView(a.coordinates,a.zoom)},k.prototype.setBounds=function(a){this._map&&a.coordinates&&(a.coordinates instanceof Array?a.coordinates.length>1?this._map.fitBounds(a.coordinates,a.options):1==a.coordinates.length&&this._map.fitBounds(a.coordinates.concat(a.coordinates),a.options):this._map.fitBounds(a.coordinates,a.options))},k.prototype.zoomTo=function(a){this._map&&a.coordinates&&a.zoom&&this._map.setZoomAround(a.coordinates,a.zoom,a.options)},k.prototype.createLayer=function(a,b,c){return b=b||"featureGroup",c=j.defaults(c||{},{enabled:!0}),void 0===this._layers[a]&&("featureGroup"==b&&L.featureGroup?this._layers[a]=L.featureGroup(c):"layerGroup"==b&&L.layerGroup?this._layers[a]=L.layerGroup(c):"markerClusterGroup"==b&&L.markerClusterGroup&&(this._layers[a]=L.markerClusterGroup(c)),this._layers[a]&&c.enabled&&this._layers[a].addTo(this._map)),this._layers[a]},k.prototype.addLayer=function(a){var b=this._mapboxServiceInstance.getLayer(a),c=!1;return b&&(c=void 0==this._layers[a],this._layers[a]=b,this._map.addLayer(b)),c},k.prototype.addLayerToLayer=function(a,b,c){var d=this._layers[c],e=!1;return d&&(e=void 0==this._layers[a],this._layers[a]=b,d.addLayer(b)),e},k.prototype.removeLayer=function(a){var b=this._layers[a],c=!1;return b&&(c=void 0!=this._layers[a],this.removeOverlay(a),this._map.removeLayer(b),delete this._layers[a]),c},k.prototype.removeLayerFromLayer=function(a,b){var c=this._layers[b],d=this._layers[a],e=!1;return c&&(e=void 0!=this._layers[a],c.removeLayer(d),delete this._layers[a]),e},k.prototype.showLayer=function(a){var b=this._layers[a];b&&0==this._map.hasLayer(b)&&(this._map.addLayer(b),b.eachLayer&&b.eachLayer(function(a){a.bindLabel&&a.feature&&a.feature.properties&&a.feature.properties.label&&a.bindLabel(a.feature.properties.label.message,a.feature.properties.label.options)}))},k.prototype.hideLayer=function(a){var b=this._layers[a];b&&this._map.hasLayer(b)&&this._map.removeLayer(b)},k.prototype.fitLayer=function(a){if(a.name){var b=this._layers[a.name];if(b&&this._map.hasLayer(b)){var c=b.getBounds();this._map.fitBounds(c,a.options)}}},k.prototype.addGeoJSONLayer=function(a){var b=this;angular.forEach(a,function(a){b.addGeoJSONFeature(a)})},k.prototype.makeIcon=function(a){return a instanceof L.Class?a:a.type&&L[a.type]?L[a.type].icon?L[a.type].icon(a):L[a.type](a):L.icon(a)},k.prototype.addLabel=function(a,b,c){var d=this,e=g(b);if("object"==typeof a&&"Point"!==b.geometry.type)if(a.options=a.options||{},(a.options.centered||a.options.noHide)&&"function"==typeof d._map.showLabel){var f=new L.Label(j.extend(a.options),{offset:[6,-15]});f.setContent(a.message),f.setLatLng(e.getCenter()),1==a.options.noHide?(d._map.showLabel(f),c.on("add",function(){d._map.showLabel(f)}),c.on("remove",function(){d._map.removeLayer(f)})):(c.on("mouseover",function(){d._map.showLabel(f)}),c.on("mouseout",function(){d._map.removeLayer(f)}))}else"function"==typeof c.bindLabel&&c.bindLabel(a.message,a.options)},k.prototype.addPhotoMarker=function(a){var b=this,c=g(a.geojson,a.properties);b.createLayer(a.layerName,a.type,a.options),b._geoJSON[a.layerName]=b._geoJSON[a.layerName]||{},b._geoJSON[a.layerName][a.properties.featureId]=a;var d=a,e={iconSize:[40,40],className:"leaflet-marker-agrista-photo"},f={helpers:{overlay:{css:{background:"rgba(0,0,0,0.7)"}}},aspectRatio:!0,autoSize:!1,width:640,height:640};L.geoJson(c.getJson(),{pointToLayer:function(a,b){return L.marker(b,{icon:L.icon(L.extend({iconUrl:d.geojson.properties.data.src},e)),title:d.caption||""})},onEachFeature:function(c,d){var e=b.addLayerToLayer(c.properties.featureId,d,a.layerName);e&&"function"==typeof a.handler&&a.handler(b._layers[a.layerName],c,d),d.on("click",function(){$.fancybox({href:c.properties.data.src,title:(c.properties.data.photoDate||c.properties.data.uploadDate)+" @ "+c.geometry.coordinates[1].toFixed(4)+(c.geometry.coordinates[1]>0?" N":" S")+" "+c.geometry.coordinates[0].toFixed(4)+(c.geometry.coordinates[0]>0?" E":"  W"),type:"image"},f)})}})},k.prototype.addGeoJSONFeature=function(a){var b=this,c=g(a.geojson,a.properties);b.createLayer(a.layerName,a.type,a.options),b._geoJSON[a.layerName]=b._geoJSON[a.layerName]||{},b._geoJSON[a.layerName][a.properties.featureId]=a;var d=a.options?angular.copy(a.options):{};d.icon&&(d.icon=b.makeIcon(d.icon)),L.geoJson(c.getJson(),{style:d.style,pointToLayer:function(a,b){var c;return c=d.radius?L.circleMarker(b,d):L.marker(b,d),d.label&&c.bindLabel(d.label.message,d.label.options),c},onEachFeature:function(c,e){var f=b.addLayerToLayer(c.properties.featureId,e,a.layerName);b.addLabel(d.label,c,e),f&&"function"==typeof a.handler&&a.handler(b._layers[a.layerName],c,e),!b._featureClickable||"Polygon"!==c.geometry.type&&"MultiPolygon"!==c.geometry.type||e.on("click",function(){c&&c.properties&&(c.properties.highlighted?(c.properties.highlighted=!1,e.setStyle({color:e.options.fillColor||"blue",opacity:e.options.fillOpacity||.4})):(c.properties.highlighted=!0,e.setStyle({color:"white",opacity:1,fillColor:e.options.fillColor||"blue",fillOpacity:e.options.fillOpacity||.4}))),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::polygon-clicked",{properties:c.properties,highlighted:c.properties.highlighted})})}})},k.prototype.removeGeoJSONFeature=function(a){this._geoJSON[a.layerName]&&this._geoJSON[a.layerName][a.properties.featureId]&&(this.removeLayerFromLayer(a.properties.featureId,a.layerName),delete this._geoJSON[a.layerName][a.properties.featureId])},k.prototype.removeGeoJSONLayer=function(a){this._geoJSON[a]&&(this.removeLayer(a),delete this._geoJSON[a])},k.prototype.makeEditable=function(a,b,c){var d=this;1==c&&d.cleanEditable(),a&&d._layers[a]&&d._layers[a].eachLayer(function(b){d._layers[a].removeLayer(b),d._editableFeature.addLayer(b)}),d._editableLayer=a,d._draw.addLayer=void 0==b?!0:b},k.prototype.cleanEditable=function(){var a=this;a._editableFeature.eachLayer(function(b){a._editableFeature.removeLayer(b)})},k.prototype.setDrawControls=function(a,b){this._draw.controlOptions=b||{},this._draw.controls={},a instanceof Array&&"function"==typeof L.Control.Draw&&(this._draw.controls.polyline=new L.Control.Draw({draw:{polyline:-1!=a.indexOf("polyline"),polygon:!1,rectangle:!1,circle:!1,marker:!1}}),this._draw.controls.polygon=new L.Control.Draw({draw:{polyline:!1,polygon:-1==a.indexOf("polygon")?!1:{allowIntersection:!1,showArea:!0,metric:!0},rectangle:!1,circle:!1,marker:!1}}),this._draw.controls.marker=new L.Control.Draw({draw:{polyline:!1,polygon:!1,rectangle:!1,circle:!1,marker:-1==a.indexOf("marker")?!1:{icon:this._optionSchema.icon?L.icon(this._optionSchema.icon):L.Icon.Default()}}}),this._draw.controls.edit=new L.Control.Draw({draw:!1,edit:{featureGroup:this._editableFeature,remove:1!=this._draw.controlOptions.nodelete}}))},k.prototype.setOptionSchema=function(a){this._optionSchema=a||{}},k.prototype.updateDrawControls=function(){try{this._map.removeControl(this._draw.controls.polyline)}catch(a){}try{this._map.removeControl(this._draw.controls.polygon)}catch(a){}try{this._map.removeControl(this._draw.controls.marker)}catch(a){}try{this._map.removeControl(this._draw.controls.edit)}catch(a){}try{this._map.off("draw:created",this.onDrawn,this),this._map.off("draw:edited",this.onEdited,this),this._map.off("draw:deleted",this.onDeleted,this)}catch(a){}if(this._editableFeature.getLayers().length>0&&(this._map.on("draw:edited",this.onEdited,this),this._map.on("draw:deleted",this.onDeleted,this),this._draw.controls.edit&&this._map.addControl(this._draw.controls.edit)),this._editableLayer&&(0==this._editableFeature.getLayers().length||this._draw.controlOptions.multidraw)){var b={polyline:!0,polygon:!0,marker:!0};this._editableFeature.eachLayer(function(a){if(a.feature&&a.feature.geometry&&a.feature.geometry.type)switch(a.feature.geometry.type){case"LineString":b.polyline=!1;break;case"Polygon":b.polygon=!1;break;case"Point":b.marker=!1}}),this._draw.controlOptions.exclude?(b.polyline&&this._map.addControl(this._draw.controls.polyline),b.polygon&&this._map.addControl(this._draw.controls.polygon),b.marker&&this._map.addControl(this._draw.controls.marker),this._map.on("draw:created",this.onDrawn,this)):(this._draw.controls.polyline&&this._map.addControl(this._draw.controls.polyline),this._draw.controls.polygon&&this._map.addControl(this._draw.controls.polygon),this._draw.controls.marker&&this._map.addControl(this._draw.controls.marker),this._map.on("draw:created",this.onDrawn,this))}},k.prototype.pickPortion=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/portion-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::portion-added",a))}).error(function(a){c.debug(a)})}},k.prototype.defineNewFarm=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/portion-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey,portion:a}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::portion-added",a))}).error(function(a){c.debug(a)})}},k.prototype.pickDistrict=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/district-polygon"+g).success(function(a){if(!d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)){var b=h.getStyle("background","district");d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,b,{featureId:a.sgKey}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::district-added",a)}}).error(function(a){c.debug(a)})}},k.prototype.defineServiceArea=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/district-polygon"+g).success(function(a){if(!d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)){var b=h.getStyle("background","district");d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,b,{featureId:a.sgKey,districtName:a.name}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::district-added",a)}}).error(function(a){c.debug(a)})}},k.prototype.pickField=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/field-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::field-added",a))}).error(function(a){c.debug(a)})}},k.prototype.defineFieldGroup=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/field-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::field-added",a))}).error(function(a){c.debug(a)})}},k.prototype.onDrawStart=function(){this._editing=!0,this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-editing",this._editing)},k.prototype.onDrawStop=function(){this._editing=!1,this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-editing",this._editing)},k.prototype.onDrawn=function(a){var b={type:"Feature",geometry:{},properties:{featureId:i().toString()}};switch(a.layerType){case"polyline":b.geometry={type:"LineString",coordinates:[]},angular.forEach(a.layer._latlngs,function(a){b.geometry.coordinates.push([a.lng,a.lat])
}),this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b);break;case"polygon":if(b.geometry={type:"Polygon",coordinates:[[]]},angular.forEach(a.layer._latlngs,function(a){b.geometry.coordinates[0].push([a.lng,a.lat])}),b.geometry.coordinates[0].length>0&&b.geometry.coordinates[0][0]!=b.geometry.coordinates[0][b.geometry.coordinates[0].length-1]&&b.geometry.coordinates[0].push(b.geometry.coordinates[0][0]),this._draw.controls.polygon.options.draw.polygon.showArea){var c=L.GeometryUtil.geodesicArea(a.layer._latlngs),d=1.19599*c;b.properties.area={m_sq:c,ha:1e-4*c,mi_sq:d/3097600,acres:d/4840,yd_sq:d}}this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b);break;case"marker":b.geometry={type:"Point",coordinates:[a.layer._latlng.lng,a.layer._latlng.lat]},this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b)}this._draw.addLayer&&(this._mapboxServiceInstance.addGeoJSON(this._editableLayer,b,this._optionSchema,b.properties),this.makeEditable(this._editableLayer),this.updateDrawControls())},k.prototype.onEdited=function(b){var c=this;b.layers.eachLayer(function(b){var d={type:"Feature",geometry:{type:b.feature.geometry.type},properties:{featureId:b.feature.properties.featureId}};c._draw.controls.polygon.options.draw.polygon.showArea&&(d.properties.area={m_sq:0,ha:0,mi_sq:0,acres:0,yd_sq:0});var e=function(a,b){var c=[];if(angular.forEach(a._latlngs,function(a){c.push([a.lng,a.lat])}),c.length>0&&c[0]!=c[c.length-1]&&c.push(c[0]),void 0!==b.properties.area){var d=L.GeometryUtil.geodesicArea(a._latlngs),e=1.19599*d;b.properties.area.m_sq+=d,b.properties.area.ha+=1e-4*d,b.properties.area.mi_sq+=e/3097600,b.properties.area.acres+=e/4840,b.properties.area.yd_sq+=e}return c};switch(b.feature.geometry.type){case"Point":d.geometry.coordinates=[b._latlng.lng,b._latlng.lat],c.broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d);break;case"Polygon":d.geometry.coordinates=[e(b,d)],a.$broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d);break;case"MultiPolygon":d.geometry.coordinates=[[]],b.eachLayer(function(a){d.geometry.coordinates[0].push(e(a,d))}),c.broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d);break;case"LineString":d.geometry.coordinates=[],angular.forEach(b._latlngs,function(a){d.geometry.coordinates.push([a.lng,a.lat])}),c.broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::geometry-edited",d)}})},k.prototype.onDeleted=function(a){var b=this,c=function(a){b._editableFeature.removeLayer(a),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-deleted",a.feature.properties.featureId)};a.layers.getLayers().length>0?a.layers.eachLayer(function(a){void 0!==a.feature?c(a):b._editableFeature.eachLayer(function(b){b.hasLayer(a)&&c(b)})}):(b._editableFeature.clearLayers(),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-deleted")),b.updateDrawControls()},{restrict:"E",template:'<div class="map" ng-hide="hidden" ng-transclude></div>',replace:!0,transclude:!0,link:function(a,b,c){void 0===l[c.id]&&(l[c.id]=new k(c,a))},controller:function(a,b){this.getMap=function(){return l[b.id]._map}}}}]),sdkInterfaceMapApp.directive("mapboxControl",["$rootScope",function(a){function b(b,d){var e=d.parent();a.$on("mapbox-"+e.attr("id")+"::init",function(){e.find(".leaflet-control-container "+c[b.position]).prepend(d),b.hidden=!1})}var c={topleft:".leaflet-top.leaflet-left",topright:".leaflet-top.leaflet-right",bottomleft:".leaflet-bottom.leaflet-left",bottomright:".leaflet-bottom.leaflet-right"};return{restrict:"E",require:"^mapbox",replace:!0,transclude:!0,scope:{position:"@"},template:'<div class="leaflet-control"><div class="leaflet-bar" ng-hide="hidden" ng-transclude></div></div>',link:function(a){a.hidden=!0},controller:function(a,c){b(a,c)}}}]);var sdkInterfaceNavigiationApp=angular.module("ag.sdk.interface.navigation",["ag.sdk.authorization","ag.sdk.library"]);sdkInterfaceNavigiationApp.provider("navigationService",["underscore",function(a){var b={},c=[],d={Favourites:1,Assets:2,Apps:3,Administration:4},e={left:[],right:[]},f=function(a,b){return a.order-b.order},g=this.registerApps=function(c){c=c instanceof Array?c:[c],angular.forEach(c,function(c){c=a.defaults(c,{id:c.title,order:100,group:"Apps",include:function(a,b){return-1!==b.indexOf(a.id)}}),c.title&&c.state&&(b[c.title]=c)})};this.$get=["$rootScope","$state","authorization",function(h,i,j){var k=!1,l="",m=function(b){var e=a.findWhere(c,{title:b.group});void 0===e&&(e={title:b.group,order:d[b.group]||100,items:[]},c.push(e),c=c.sort(f));var g=a.findWhere(e.items,{id:b.id});void 0===g&&(b.active=i.includes(b.state),e.items.push(b),e.items=e.items.sort(f),h.$broadcast("navigation::items__changed",c),h.$broadcast("navigation::app__allowed",b))},n=function(b){var d=a.findWhere(c,{title:b.group});void 0!==d&&(d.items=a.reject(d.items,function(a){return a.id===b.id}),0===d.items.length&&(c=a.reject(c,function(a){return a.title===d.title})),h.$broadcast("navigation::items__changed",c),h.$broadcast("navigation::app__revoked",b))},o=function(){c=[],h.$broadcast("navigation::items__changed",c)},p=function(c){var d=c||j.currentUser(),e=d.userRole?a.pluck(d.userRole.apps,"name"):[],f=d.organization?a.pluck(d.organization.services,"serviceType"):[];o(),angular.forEach(b,function(a){("function"==typeof a.include&&a.include(a,e,f)||a.include===!0)&&m(a)})},q=function(a,b){b&&(b instanceof Array==!1?e[a].push(b):e[a]=b,h.$broadcast("navigation::"+a+"-buttons__changed",e[a]),h.$broadcast("navigation::buttons__changed"))};return h.$on("$stateChangeSuccess",function(){angular.forEach(c,function(a){angular.forEach(a.items,function(a){a.active=i.includes(a.state)})})}),h.$on("authorization::login",function(a,b){p(b)}),h.$on("authorization::unauthorized",function(){o()}),h.$on("authorization::logout",function(){o()}),p(),{getApp:function(c){return a.findWhere(b,{id:c})},getGroupedApps:function(){return c},renameApp:function(d,e){var f=a.findWhere(b,{id:d});f&&(f.title=e,h.$broadcast("navigation::items__changed",c))},selectItem:function(a){return h.$broadcast("navigation::item__selected",a),i.go(a)},registerApps:function(a){g(a)},unregisterApps:function(){b={},c=[]},allowApp:function(a){b[a]&&m(b[a])},revokeApp:function(a){b[a]&&n(b[a])},toggleSlim:function(){k=!k,h.$broadcast("navigation::slim__changed",k)},isSlim:function(){return k},footerText:function(a){return void 0!==a&&(l=a,h.$broadcast("navigation::footerText",l)),l},leftButtons:function(a){return q("left",a),e.left},rightButtons:function(a){return q("right",a),e.right}}}]}]);var sdkInterfaceUiApp=angular.module("ag.sdk.interface.ui",[]);sdkInterfaceUiApp.directive("dynamicName",function(){return{restrict:"A",require:"?form",link:function(a,b,c,d){var e=null!=d?d:b.parent().controller("form"),f=e[b.attr("name")];e&&f&&(b.attr("name",c.name),e.$removeControl(f),f.$name=c.name,e.$addControl(f))}}}),sdkInterfaceUiApp.directive("defaultSrc",[function(){return{restrict:"A",link:function(a,b,c){b.bind("error",function(){b.attr("src",c.defaultSrc)})}}}]),sdkInterfaceUiApp.filter("location",["$filter",function(a){return function(b,c){var d=b&&b.geometry||b,e=d&&d.coordinates?{lng:d.coordinates[0],lat:d.coordinates[1]}:d;return(e?a("number")(c?Math.abs(e.lat):e.lng,3)+(c?"° "+(e.lat>=0?"N":"S"):"")+", "+a("number")(c?Math.abs(e.lng):e.lat,3)+(c?"° "+(e.lng<=0?"W":"E"):""):"")+(b&&b.properties&&b.properties.accuracy?" at "+a("number")(b.properties.accuracy,2)+"m":"")}}]),sdkInterfaceUiApp.filter("floor",["$filter",function(a){return function(b){return a("number")(Math.floor(b),0)}}]),sdkInterfaceUiApp.directive("locationFormatter",["$filter",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$formatters.push(function(c){var e="";return void 0!==c&&(e=a("location")(c,"true"===d.locationFormatter),d.ngChange&&b.$eval(d.ngChange)),e})}}}]),sdkInterfaceUiApp.directive("dateFormatter",["$filter",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$formatters.push(function(b){return void 0!==b?a("date")(new Date(b),d.dateFormat||"yyyy-MM-dd"):""})}}}]),sdkInterfaceUiApp.directive("dateParser",["$filter",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$parsers.push(function(b){return void 0!==b?a("date")(new Date(b),d.dateFormat||"yyyy-MM-dd"):""})}}}]),sdkInterfaceUiApp.directive("inputNumber",["$filter",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f=d.max?parseFloat(d.max):!1,g=d.min?parseFloat(d.min):!1,h=d.round?parseInt(d.round):!1;e.$formatters.push(function(b){return h===!1?b:a("number")(b,h)}),e.$parsers.push(function(a){var b=isNaN(a)||isNaN(parseFloat(a));if(e.$setValidity("number",b===!1),b===!1){var c=parseFloat(a);return e.$setValidity("range",(g===!1||c>=g)&&(f===!1||f>=c)),c}return void 0})}}}]),sdkInterfaceUiApp.directive("inputDate",["moment",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f=d.dateFormat||"YYYY-MM-DD";e.$formatters.length=0,e.$parsers.length=0,e.$formatters.push(function(b){return b?a(b).format(f):b}),e.$parsers.push(function(b){if(b){var c="string"==typeof b?a(b,["DD/MM/YYYY","MM/DD/YYYY","YYYY-MM-DD"],!0):a(b);return c&&"function"==typeof c.isValid&&c.isValid()?(e.$setValidity("date-format",!0),"string"==typeof b?c.format("YYYY-MM-DD"):c):(e.$setValidity("date-format",!1),b)}})}}}]),sdkInterfaceUiApp.directive("sparkline",["$window","underscore",function(a,b){return{restrict:"A",template:'<div class="sparkline"></div>',replace:!0,scope:{sparkline:"=",sparklineText:"="},link:function(c,d,e){function f(a,b){return function(c){return a(c[b])}}function g(){c.data=b.map(c.sparkline,function(a){return b.isArray(a)?{x:b.isNumber(a[0])?a[0]:0,y:b.isNumber(a[1])?a[1]:0}:{x:b.isNumber(a.x)?a.x:0,y:b.isNumber(a.y)?a.y:0}}),c.data.unshift({x:-1,y:0}),r.domain(j&&0!=j?[0,j]:h.extent(c.data,function(a){return a.x})),s.domain(l&&0!=l?[0,l]:h.extent(c.data,function(a){return a.y})),p.attr("d",t(c.data)),q.attr("d",u(c.data))}var h=a.d3,i=e.width||100,j=e.xExtent,k=e.height||20,l=e.yExtent||100,m=e.interpolate||"step-before",n=h.select(d[0]).append("svg").attr("width",i).attr("height",k),o=n.append("text").attr("class","sparkline-text").attr("x",i/2).attr("y",k/2+5),p=n.append("path").attr("class","sparkline-area"),q=n.append("path").attr("class","sparkline-line"),r=h.scale.linear().range([0,i]),s=h.scale.linear().range([k,0]),t=h.svg.area().interpolate(m).x(f(r,"x")).y0(k).y1(f(s,"y")),u=h.svg.line().interpolate(m).x(f(r,"x")).y(f(s,"y"));c.$watchCollection("sparkline",function(){g()}),c.$watch("sparklineText",function(){o.text(function(){return c.sparklineText})})}}}]);var sdkModelAsset=angular.module("ag.sdk.model.asset",["ag.sdk.library","ag.sdk.model.base","ag.sdk.model.liability","ag.sdk.model.production-schedule"]);sdkModelAsset.factory("Asset",["$filter","attachmentHelper","computedProperty","inheritModel","Liability","Model","moment","privateProperty","ProductionSchedule","readOnlyProperty","underscore",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){f.Base.apply(this,arguments),this.data=a&&a.data?a.data:{},h(this,"generateKey",function(a,b){return this.assetKey=(a?"entity."+a.uuid:"")+("farmland"!==this.type&&b?"-f."+b.name:"")+("crop"===this.type&&this.data.season?"-s."+this.data.season:"")+(this.data.fieldName?"-fi."+this.data.fieldName:"")+(this.data.crop?"-c."+this.data.crop:"")+("cropland"===this.type&&this.data.irrigated?"-i."+this.data.irrigation:"")+("farmland"===this.type&&this.data.sgKey?"-"+this.data.sgKey:"")+("improvement"===this.type||"livestock"===this.type||"vme"===this.type?(this.data.type?"-t."+this.data.type:"")+(this.data.category?"-c."+this.data.category:"")+(this.data.name?"-n."+this.data.name:"")+(this.data.purpose?"-p."+this.data.purpose:"")+(this.data.model?"-m."+this.data.model:"")+(this.data.identificationNo?"-in."+this.data.identificationNo:""):"")+(this.data.waterSource?"-ws."+this.data.waterSource:"")+("other"===this.type&&this.data.name?"-n."+this.data.name:""),this.assetKey}),h(this,"getPhoto",function(){return b.findSize(this,"thumb","img/camera.png")}),h(this,"getTitle",function(a,b){return m(this,a,b)}),c(this,"age",function(a){return this.data.establishedDate?g(a).diff(this.data.establishedDate,"years",!0):0}),c(this,"title",function(){return m(this,!0)}),c(this,"description",function(){return this.data.description||""}),c(this,"fieldName",function(){return this.data.fieldName}),c(this,"size",function(){return"farmland"!==this.type?this.data.size:this.data.area}),h(this,"availableCrops",function(){return l.cropsByType[this.type]||[]}),c(this,"crop",function(){return this.data.crop}),c(this,"establishedDate",function(){return this.data.establishedDate}),c(this,"liquidityTypeTitle",function(){return this.data.liquidityType&&this.assetTypes[this.data.liquidityType]||""}),h(this,"incomeInRange",function(a,b){var c={};return this.data.sold===!0&&this.data.salePrice&&g(this.data.soldDate,"YYYY-MM-DD").isBetween(a,b)&&(c.Sales=this.data.salePrice),c}),h(this,"totalIncomeInRange",function(a,b){return k.reduce(this.incomeInRange(a,b),function(a,b){return a+(b||0)},0)}),h(this,"totalLiabilityInRange",function(a,b){return k.reduce(this.liabilities,function(c,d){return c+d.totalLiabilityInRange(a,b)},0)}),k.isUndefined(a)||0===arguments.length||(this.id=a.id||a.$id,this.assetKey=a.assetKey,this.farmId=a.farmId,this.legalEntityId=a.legalEntityId,this.liabilities=k.map(a.liabilities,function(a){return e.newCopy(a)}),this.productionSchedules=k.map(a.productionSchedules,function(a){return i.newCopy(a)}),this.type=a.type)}function m(b,c,d){switch(b.type){case"crop":case"permanent crop":case"plantation":return(b.data.plantedArea?a("number")(b.data.plantedArea,2)+"ha":"")+(b.data.plantedArea&&b.data.crop?" of ":"")+(b.data.crop?b.data.crop:"")+(c&&b.data.fieldName?" on field "+b.data.fieldName:"")+(d?" on farm "+d.name:"");case"farmland":return b.data.label?b.data.label:b.data.portionLabel?b.data.portionLabel:b.data.portionNumber?"Ptn. "+b.data.portionNumber:"Rem. extent of farm";case"cropland":return(b.data.irrigation?b.data.irrigation+" irrigated":b.data.irrigated?"Irrigated"+(b.data.equipped?", equipped":", unequipped"):"Non irrigable")+" "+b.type+(b.data.waterSource?" from "+b.data.waterSource:"")+(c&&b.data.fieldName?" on field "+b.data.fieldName:"")+(d?" on farm "+d.name:"");case"livestock":return b.data.type+(b.data.category?" - "+b.data.category:"");case"pasture":return(b.data.intensified?(b.data.crop?b.data.crop+" intensified ":"Intensified ")+b.type:"Natural grazing")+(c&&b.data.fieldName?" on field "+b.data.fieldName:"")+(d?" on farm "+d.name:"");case"vme":return b.data.category+(b.data.model?" model "+b.data.model:"");case"wasteland":return"Homestead & Wasteland";case"water source":case"water right":return b.data.waterSource+(c&&b.data.fieldName?" on field "+b.data.fieldName:"")+(d?" on farm "+d.name:"");default:return b.data.name||b.data.category||l.assetTypes[b.type]}}d(l,f.Base),j(l,"assetTypes",{crop:"Crops",farmland:"Farmlands",improvement:"Fixed Improvements",cropland:"Cropland",livestock:"Livestock",pasture:"Pastures","permanent crop":"Permanent Crops",plantation:"Plantations",vme:"Vehicles, Machinery & Equipment",wasteland:"Homestead & Wasteland","water right":"Water Rights"});var n=["Barley","Bean","Bean (Broad)","Bean (Dry)","Bean (Sugar)","Bean (Green)","Bean (Kidney)","Canola","Cassava","Cotton","Cowpea","Grain Sorghum","Groundnut","Lucerne","Maize","Maize (White)","Maize (Yellow)","Oat","Peanut","Pearl Millet","Potato","Rape","Rice","Rye","Soya Bean","Sunflower","Sweet Corn","Sweet Potato","Tobacco","Triticale","Wheat","Wheat (Durum)"],o=["Bahia-Notatum","Birdsfoot Trefoil","Bottle Brush","Buffalo","Buffalo (Blue)","Buffalo (White)","Bush","Carribean Stylo","Clover","Clover (Arrow Leaf)","Clover (Crimson)","Clover (Persian)","Clover (Red)","Clover (Rose)","Clover (Strawberry)","Clover (Subterranean)","Clover (White)","Cocksfoot","Common Setaria","Dallis","Kikuyu","Lucerne","Lupin","Lupin (Narrow Leaf)","Lupin (White)","Lupin (Yellow)","Medic","Medic (Barrel)","Medic (Burr)","Medic (Gama)","Medic (Snail)","Medic (Strand)","Phalaris","Rescue","Rhodes","Russian Grass","Ryegrass","Ryegrass (Hybrid)","Ryegrass (Italian)","Ryegrass (Westerwolds)","Serradella","Serradella (Yellow)","Silver Leaf Desmodium","Smuts Finger","Soutbos","Tall Fescue","Teff","Veld","Weeping Lovegrass"],p=["Almond","Aloe","Apple","Apricot","Avocado","Banana","Barberry","Berry","Bilberry","Blackberry","Blueberry","Cherry","Cloudberry","Coconut","Coffee","Fig","Gooseberry","Grape","Grape (Bush Vine)","Grape (Red)","Grape (Table)","Grape (White)","Grapefruit","Guava","Hops","Kiwi Fruit","Lemon","Litchi","Macadamia Nut","Mandarin","Mango","Mulberry","Nectarine","Olive","Orange","Papaya","Peach","Pear","Prickly Pear","Pecan Nut","Persimmon","Pineapple","Pistachio Nut","Plum","Pomegranate","Protea","Raspberry","Rooibos","Sisal","Strawberry","Sugarcane","Tea","Walnut","Wineberry"],q=["Bluegum","Pine","Wattle"];return j(l,"cropsByType",{crop:n,cropland:n,livestock:o,pasture:o,"permanent crop":p,plantation:q}),j(l,"liquidityTypes",{"long-term":"Long-term","medium-term":"Movable","short-term":"Current"}),j(l,"liquidityCategories",{"long-term":["Fixed Improvements","Investments","Land","Other"],"medium-term":["Breeding Stock","Vehicles, Machinery & Equipment","Other"],"short-term":["Crops & Crop Products","Cash on Hand","Debtors","Short-term Investments","Prepaid Expenses","Production Inputs","Life Insurance","Livestock Products","Marketable Livestock","Negotiable Securities","Other"]}),j(l,"assetTypesWithOther",k.extend({other:"Other"},l.assetTypes)),h(l,"getTypeTitle",function(a){return l.assetTypes[a]||""}),h(l,"getTitleType",function(a){var b=k.keys(l.assetTypes);return b[k.values(l.assetTypes).indexOf(a)]}),h(l,"getTitle",function(a){return m(a)}),l.validates({crop:{requiredIf:function(a,b){return k.contains(["crop","permanent crop","plantation"],b.type)},inclusion:{"in":function(a,b){return l.cropsByType[b.type]}}},establishedDate:{requiredIf:function(a,b){return k.contains(["permanent crop","plantation"],b.type)},format:{date:!0}},farmId:{numeric:!0},fieldName:{requiredIf:function(a,b){return k.contains(["crop","cropland","pasture","permanent crop","plantation"],b.type)},length:{min:1,max:255}},legalEntityId:{required:!0,numeric:!0},assetKey:{required:!0},size:{requiredIf:function(a,b){return k.contains(["crop","cropland","pasture","permanent crop","plantation","wasteland","water right"],b.type)},numeric:!0},type:{required:!0,inclusion:{"in":k.keys(l.assetTypesWithOther)}}}),l}]),angular.module("ag.sdk.model.base",["ag.sdk.library","ag.sdk.model.validation","ag.sdk.model.errors","ag.sdk.model.store"]).factory("Model",["Base",function(a){var b={};return b.Base=a,b}]).factory("Base",["Errorable","Storable","underscore","Validatable",function(a,b,c,d){function e(){{var e=this;e.prototype}e["new"]=function(a){var b=new e(a);return"function"==typeof b.storable&&b.storable(a),b},e.newCopy=function(a){return e["new"](c.extend({},angular.copy(a)))},e.asJSON=function(){return c.omit(JSON.parse(JSON.stringify(this)),["$complete","$dirty","$id","$local","$saved","$uri"])},e.copy=function(){var a=this,b={},d=Object.getOwnPropertyNames(a);return c.each(d,function(c){Object.defineProperty(b,c,Object.getOwnPropertyDescriptor(a,c))}),b},e.extend=function(a){var b=new a,d=Object.getOwnPropertyNames(b),e=c.filter(d,function(a){return"__"!==a.slice(0,2)});c.each(e,function(a){Object.defineProperty(this,a,Object.getOwnPropertyDescriptor(b,a))},this)},e.include=function(a){var b=new a,d=Object.getOwnPropertyNames(b),e=c.filter(d,function(a){return"__"==a.slice(0,2)}),f=this["new"];this["new"]=function(){var a=f.apply(this,arguments);return c.each(e,function(c){Object.defineProperty(a,c.slice(2),Object.getOwnPropertyDescriptor(b,c))}),a}},e.extend(d),e.extend(b),e.include(d),e.include(a),e.include(b)}return e}]).factory("computedProperty",["underscore",function(a){return function(b,c,d,e){Object.defineProperty(b,c,a.defaults(e||{},{get:d}))}}]).factory("readOnlyProperty",["underscore",function(a){return function(b,c,d,e){Object.defineProperty(b,c,a.defaults(e||{},{writable:!1,value:d}))}}]).factory("inheritModel",["underscore",function(a){return function(b,c){c.apply(b),a.each(Object.getOwnPropertyNames(c),function(d){var e=Object.getOwnPropertyDescriptor(c,d);a.isUndefined(b[d])&&e&&Object.defineProperty(b,d,e)})}}]).factory("privateProperty",["underscore",function(a){return function(b,c,d,e){var f;Object.defineProperty(b,c,a.defaults(e||{},{enumerable:!1,configurable:!1,get:function(){return f},set:function(a){f=a}})),void 0!==d&&(b[c]=d)}}]).factory("interfaceProperty",["underscore",function(a){return function(b,c,d,e){var f;Object.defineProperty(b,c,a.defaults(e||{},{enumerable:!1,configurable:!0,get:function(){return f},set:function(a){f=a}})),void 0!==d&&(b[c]=d)}}]);var sdkModelBusinessPlanDocument=angular.module("ag.sdk.model.business-plan",["ag.sdk.id","ag.sdk.helper.enterprise-budget","ag.sdk.model.asset","ag.sdk.model.document","ag.sdk.model.liability","ag.sdk.model.production-schedule"]);sdkModelBusinessPlanDocument.factory("BusinessPlan",["Asset","computedProperty","Document","Financial","generateUUID","inheritModel","Liability","privateProperty","ProductionSchedule","readOnlyProperty","underscore",function(Asset,computedProperty,Document,Financial,generateUUID,inheritModel,Liability,privateProperty,ProductionSchedule,readOnlyProperty,underscore){function BusinessPlan(attrs){function reEvaluateBusinessPlan(a){reEvaluateProductionSchedules(a),reEvaluateAssetsAndLiabilities(a),reEvaluateIncomeAndExpenses(a),recalculate(a)}function recalculate(a){recalculateSummary(a),recalculatePrimaryAccount(a),recalculateRatios(a)}function initializeArray(a){return underscore.range(a).map(function(){return 0})}function initializeObject(a,b,c){return a[b]=a[b]||c}function infinityToZero(a){return isFinite(a)?a:0}function sumCollectionProperty(a,b){return underscore.chain(a).pluck(b).reduce(function(a,b){return a+b},0).value()}function divideArrayValues(a,b){return a&&b&&a.length==b.length?underscore.reduce(b,function(a,b,c){return a[c]=infinityToZero(a[c]/b),a},angular.copy(a)):[]}function addArrayValues(a,b){return a&&b&&a.length==b.length?underscore.reduce(a,function(a,b,c){return a[c]+=b,a},angular.copy(b)):[]}function subtractArrayValues(a,b){return addArrayValues(a,negateArrayValues(b))}function negateArrayValues(a){return underscore.map(a,function(a){return-1*a})}function initializeCategoryValues(a,b,c,d){a.data[b]=a.data[b]||{},a.data[b][c]=a.data[b][c]||underscore.range(d).map(function(){return 0})}function getLowerIndexBound(a,b){return a?Math.min(a.length,Math.abs(Math.min(0,b))):0}function getUpperIndexBound(a,b,c){return a?Math.min(c,b+a.length)-b:0}function extractGroupCategories(a,b,c,d,e){var f=underscore.findWhere(b.data.sections,{code:c}),g=moment(b.startDate).add(1,"days");if(f){var h=g.diff(d,"months");angular.forEach(f.productCategoryGroups,function(d){angular.forEach(d.productCategories,function(d){var f="livestock"!==b.type&&"INC"===c?b.data.details.commodity:d.name;a[f]=a[f]||underscore.range(e).map(function(){return 0});for(var g=getLowerIndexBound(d.valuePerMonth,h),i=getUpperIndexBound(d.valuePerMonth,h,e),j=g;i>j;j++)a[f][j+h]+=d.valuePerMonth[j]||0})})}}function calculateIncomeComposition(a,b,c,d){var e=underscore.findWhere(b.data.sections,{code:"INC"}),f=moment(b.startDate).add(1,"days");if(e){for(var g=Math.ceil(d/12);a.data.productionIncomeComposition.length<g;)a.data.productionIncomeComposition.push({});for(var h=0;g>h;h++){var i=Math.min(12,d-12*h),j=f.diff(moment(c,"YYYY-MM-DD").add(h,"years"),"months");angular.forEach(e.productCategoryGroups,function(c){angular.forEach(c.productCategories,function(c){for(var d="livestock"!==b.type?b.data.details.commodity:c.name,e=a.data.productionIncomeComposition[h][d]||{unit:c.unit,pricePerUnit:0,quantity:0,value:0},f=getLowerIndexBound(c.valuePerMonth,j),g=getUpperIndexBound(c.valuePerMonth,j,i),k=f;g>k;k++)e.value+=c.valuePerMonth[k];for(f=getLowerIndexBound(c.quantityPerMonth,j),g=getUpperIndexBound(c.quantityPerMonth,j,i),k=f;g>k;k++)e.quantity+=c.quantityPerMonth[k];e.pricePerUnit=!e.pricePerUnit&&c.pricePerUnit?c.pricePerUnit:infinityToZero(e.value/e.quantity),a.data.productionIncomeComposition[h][d]=e})});var k=underscore.chain(a.data.productionIncomeComposition[h]).omit("total").values().pluck("value").reduce(function(a,b){return a+b},0).value();for(var l in a.data.productionIncomeComposition[h])a.data.productionIncomeComposition[h].hasOwnProperty(l)&&"total"!=l&&(a.data.productionIncomeComposition[h][l].contributionPercent=100*infinityToZero(a.data.productionIncomeComposition[h][l].value/k));a.data.productionIncomeComposition[h].total={value:k}}}}function extractLivestockBreedingStockComposition(a,b){if("livestock"==b.type){var c=b.getGroup("INC","Livestock Sales",b.defaultCostStage);c&&underscore.each(c.productCategories,function(b){b.breedingStock&&updateAssetStatementCategory(a,"medium-term","Breeding Stock",{data:{name:"Breeding Stock",liquidityType:"medium-term",assetValue:(b.stock||0)*b.pricePerUnit}})})}}function reEvaluateProductionSchedules(a){var b=moment(a.startDate,"YYYY-MM-DD"),c=a.numberOfMonths;a.data.enterpriseProductionExpenditure={},a.data.productionIncome={},a.data.productionExpenditure={},a.data.productionIncomeComposition=[],angular.forEach(a.models.productionSchedules,function(d){var e=ProductionSchedule["new"](d);initializeObject(a.data.enterpriseProductionExpenditure,e.data.details.commodity,{}),extractGroupCategories(a.data.enterpriseProductionExpenditure[e.data.details.commodity],e,"EXP",b,c),extractGroupCategories(a.data.productionIncome,e,"INC",b,c),extractGroupCategories(a.data.productionExpenditure,e,"EXP",b,c),calculateIncomeComposition(a,e,b,c)}),a.data.unallocatedProductionIncome=a.data.unallocatedProductionIncome||a.data.productionIncome,a.data.unallocatedProductionExpenditure=a.data.unallocatedProductionExpenditure||a.data.productionExpenditure}function reEvaluateIncomeAndExpenses(a){var b=moment(a.startDate,"YYYY-MM-DD"),c=moment(a.endDate,"YYYY-MM-DD"),d=c.diff(b,"months"),e=[];a.data.otherIncome={},a.data.otherExpenditure={},underscore.each(a.models.income,function(b){var c=underscore.findWhere(a.data.legalEntities,{id:b.legalEntityId}),f=underscore.findWhere(e,{uuid:b.uuid}),g=(b.type?b.type:"other")+"Income";c&&underscore.isUndefined(f)&&a.data[g]&&(initializeCategoryValues(a,g,b.name,d),a.data[g][b.name]=underscore.map(b.months,function(c,d){return(c||0)+(a.data[g][b.name][d]||0)}),e.push(b))}),underscore.each(a.models.expenses,function(b){var c=underscore.findWhere(a.data.legalEntities,{id:b.legalEntityId}),f=underscore.findWhere(e,{uuid:b.uuid}),g=(b.type?b.type:"other")+"Expenditure";c&&underscore.isUndefined(f)&&a.data[g]&&(initializeCategoryValues(a,g,b.name,d),a.data[g][b.name]=underscore.map(b.months,function(c,d){return(c||0)+(a.data[g][b.name][d]||0)}),e.push(b))}),a.data.unallocatedProductionIncome=a.data.unallocatedProductionIncome||a.data.productionIncome,a.data.unallocatedProductionExpenditure=a.data.unallocatedProductionExpenditure||a.data.productionExpenditure}function reEvaluateProductionCredit(a,b){var c=underscore.where(b,{type:"production-credit"});a.data.unallocatedEnterpriseProductionExpenditure=angular.copy(a.data.enterpriseProductionExpenditure),a.data.unallocatedProductionIncome=angular.copy(a.data.productionIncome),a.data.unallocatedProductionExpenditure=angular.copy(a.data.productionExpenditure),underscore.each(c,function(b){b.resetRepayments(),b.resetWithdrawalsInRange(a.startDate,a.endDate),b.$dirty=!0,underscore.each(b.data.customRepayments,function(a,c){moment(c).isBefore(b.startDate)&&b.addRepaymentInMonth(a,c,"bank")});for(var c=underscore.chain(a.data.unallocatedEnterpriseProductionExpenditure).reduce(function(a,c,d){return(underscore.isEmpty(b.data.enterprises)||underscore.contains(b.data.enterprises,d))&&(a[d]=underscore.chain(c).reduce(function(a,c,d){return(underscore.isEmpty(b.data.inputs)||underscore.contains(b.data.inputs,d))&&(a[d]=c),a},{}).value()),a},{}).value(),d=0;d<a.numberOfMonths;d++){var e=moment(b.startDate,"YYYY-MM-DD").add(d,"M"),f=e.format("YYYY-MM-DD");underscore.each(c,function(c){underscore.each(c,function(c,f){var g=c[d];c[d]=b.addWithdrawalInMonth(g,e),a.data.unallocatedProductionExpenditure[f][d]+=c[d]-g})}),b.data.customRepayments&&b.data.customRepayments[f]&&b.addRepaymentInMonth(b.data.customRepayments[f],e,"bank")}})}function updateAssetStatementCategory(a,b,c,d){a.data.assetStatement[b]=a.data.assetStatement[b]||[];var e=underscore.findIndex(a.data.assetStatement[b],function(a){return a.name==c}),f=Math.ceil(moment(a.endDate,"YYYY-MM-DD").diff(moment(a.startDate,"YYYY-MM-DD"),"years",!0)),g=-1!==e?a.data.assetStatement[b].splice(e,1)[0]:{name:c,estimatedValue:0,currentRMV:0,yearlyRMV:initializeArray(f),assets:[]};underscore.findWhere(g.assets,{assetKey:d.assetKey})||g.assets.push("function"==typeof d.asJSON?d.asJSON():d),g.estimatedValue+=d.data.assetValue||0,a.data.assetStatement[b].push(g)}function updateLiabilityStatementCategory(a,b){var c="production-credit"==b.type?"medium-term":"rent"==b.type?"short-term":b.type,d="rent"==b.type?"Rent overdue":b.name,e=underscore.findIndex(a.data.liabilityStatement[c],function(a){return a.name==d}),f=Math.ceil(moment(a.endDate,"YYYY-MM-DD").diff(moment(a.startDate,"YYYY-MM-DD"),"years",!0)),g=-1!==e?a.data.liabilityStatement[c].splice(e,1)[0]:{name:d,currentValue:0,yearlyValues:initializeArray(f),liabilities:[]};a.data.liabilityStatement[c]=a.data.liabilityStatement[c]||[],g.currentValue+=b.liabilityInMonth(a.startDate).opening;for(var h=0;f>h;h++){var i=moment.min(moment(a.endDate,"YYYY-MM-DD"),moment(a.startDate,"YYYY-MM-DD").add(h,"years").add(11,"months"));g.yearlyValues[h]+=b.liabilityInMonth(i).closing}underscore.findWhere(g.liabilities,{uuid:b.uuid})||g.liabilities.push("function"==typeof b.asJSON?b.asJSON():b),a.data.liabilityStatement[c].push(g)}function calculateAssetStatementRMV(instance){angular.forEach(instance.data.assetStatement,function(statementItems,category){"total"!=category&&angular.forEach(statementItems,function(item){var adjustmentFactor=instance.data.adjustmentFactors[item.name]||1;item.currentRMV=(item.estimatedValue||0)*adjustmentFactor;for(var year=0;year<item.yearlyRMV.length;year++){var rmv=0==year?item.currentRMV:item.yearlyRMV[year-1];angular.forEach(_assetYearEndValueAdjustments[item.name],function(adjustment){if(instance.data[adjustment.category][adjustment.item]){var value=underscore.reduce(instance.data[adjustment.category][adjustment.item].slice(12*year,12*(year+1)),function(a,b){return a+(b||0)},0);rmv=-1!=["+","-"].indexOf(adjustment.operation)?eval(rmv+adjustment.operation+value):rmv}}),item.yearlyRMV[year]=rmv*adjustmentFactor}})})}function totalAssetsAndLiabilities(a){var b=Math.ceil(moment(a.endDate,"YYYY-MM-DD").diff(moment(a.startDate,"YYYY-MM-DD"),"years",!0));a.data.assetStatement.total=underscore.chain(a.data.assetStatement).omit("total").values().flatten(!0).reduce(function(a,b){return a.estimatedValue+=b.estimatedValue,a.currentRMV+=b.currentRMV,a.yearlyRMV=addArrayValues(a.yearlyRMV,b.yearlyRMV),a},{estimatedValue:0,currentRMV:0,yearlyRMV:initializeArray(b)}).value(),a.data.liabilityStatement.total=underscore.chain(a.data.liabilityStatement).omit("total").values().flatten(!0).reduce(function(a,b){return a.currentValue+=b.currentValue,a.yearlyValues=addArrayValues(a.yearlyValues,b.yearlyValues),a},{currentValue:0,yearlyValues:initializeArray(b)}).value(),recalculate(a)}function reEvaluateAssetsAndLiabilities(a){var b=moment(a.startDate,"YYYY-MM-DD"),c=moment(a.endDate,"YYYY-MM-DD"),d=c.diff(b,"months"),e=[];a.data.capitalIncome={},a.data.capitalExpenditure={},a.data.debtRedemption={},a.data.assetStatement={},a.data.liabilityStatement={},underscore.each(a.models.assets,function(f){var g=underscore.findWhere(a.data.legalEntities,{id:f.legalEntityId}),h=underscore.findWhere(e,{assetKey:f.assetKey});
if(g&&underscore.isUndefined(h)){e.push(f),f=Asset["new"](f);var i=f.data.acquisitionDate?moment(f.data.acquisitionDate):void 0,j=f.data.soldDate?moment(f.data.soldDate):void 0,k=f.data.constructionDate?moment(f.data.constructionDate):void 0,l=f.data.demolitionDate?moment(f.data.demolitionDate):void 0;if("vme"===f.type?"Vehicles"===f.data.type?(f.data.assetValue&&i&&i.isBetween(b,c)&&(initializeCategoryValues(a,"capitalExpenditure","Vehicle Purchases",d),a.data.capitalExpenditure["Vehicle Purchases"][i.diff(b,"months")]+=f.data.assetValue),f.data.sold&&f.data.salePrice&&j&&j.isBetween(b,c)&&(initializeCategoryValues(a,"capitalIncome","Vehicle Sales",d),a.data.capitalIncome["Vehicle Sales"][j.diff(b,"months")]+=f.data.salePrice)):"Machinery"===f.data.type&&(f.data.assetValue&&i&&i.isBetween(b,c)&&(initializeCategoryValues(a,"capitalExpenditure","Machinery & Plant Purchases",d),a.data.capitalExpenditure["Machinery & Plant Purchases"][i.diff(b,"months")]+=f.data.assetValue),f.data.sold&&f.data.salePrice&&j&&j.isBetween(b,c)&&(initializeCategoryValues(a,"capitalIncome","Machinery & Plant Sales",d),a.data.capitalIncome["Machinery & Plant Sales"][j.diff(b,"months")]+=f.data.salePrice)):"improvement"===f.type&&f.data.assetValue&&k&&k.isBetween(b,c)?(initializeCategoryValues(a,"capitalExpenditure","Development",d),a.data.capitalExpenditure.Development[k.diff(b,"months")]+=f.data.assetValue):"farmland"===f.type&&(f.data.assetValue&&i&&i.isBetween(b,c)&&(initializeCategoryValues(a,"capitalExpenditure","Land Purchases",d),a.data.capitalExpenditure["Land Purchases"][i.diff(b,"months")]+=f.data.assetValue),f.data.sold&&f.data.salePrice&&j&&j.isBetween(b,c)&&(initializeCategoryValues(a,"capitalIncome","Land Sales",d),a.data.capitalIncome["Land Sales"][j.diff(b,"months")]+=f.data.salePrice)),!(!f.data.assetValue||f.data.sold&&j&&j.isBefore(b)||f.data.demolished&&l&&l.isBefore(b)))switch(f.type){case"cropland":case"farmland":case"pasture":case"permanent crop":case"plantation":case"wasteland":updateAssetStatementCategory(a,"long-term","Land",f);break;case"improvement":updateAssetStatementCategory(a,"long-term","Fixed Improvements",f);break;case"livestock":updateAssetStatementCategory(a,"medium-term","Breeding Stock",f);break;case"vme":updateAssetStatementCategory(a,"medium-term","Vehicles, Machinery & Equipment",f);break;case"other":updateAssetStatementCategory(a,f.data.liquidityType,f.data.category,f)}angular.forEach(f.liabilities,function(g){if(void 0===underscore.findWhere(e,{uuid:g.uuid})){e.push(g);var h="rent"===g.type?"capitalExpenditure":"debtRedemption",i="other"!==g.type?Liability.getTypeTitle(g.type):g.name,j=g.liabilityInRange(a.startDate,a.endDate);"farmland"==f.type&&"rent"!==g.type&&moment(g.startDate,"YYYY-MM-DD").isBetween(b,c)&&(initializeCategoryValues(a,"capitalExpenditure","Land Purchases",d),a.data.capitalExpenditure["Land Purchases"][moment(g.startDate,"YYYY-MM-DD").diff(b,"months")]+=g.openingBalance),initializeCategoryValues(a,h,i,d),a.data[h][i]=underscore.map(j,function(b,c){return(b.repayment&&b.repayment.bank||0)+(a.data[h][i][c]||0)}),updateLiabilityStatementCategory(a,g)}})}}),underscore.each(a.models.liabilities,function(b){if(void 0===underscore.findWhere(e,{uuid:b.uuid})){e.push(b),b=Liability["new"](b);var c="rent"===b.type?"capitalExpenditure":"debtRedemption",f="other"!==b.type?Liability.getTypeTitle(b.type):b.name,g=b.liabilityInRange(a.startDate,a.endDate);initializeCategoryValues(a,c,f,d),a.data[c][f]=underscore.map(g,function(b,d){return(b.repayment&&b.repayment.bank||0)+(a.data[c][f][d]||0)}),updateLiabilityStatementCategory(a,b)}}),underscore.each(a.models.productionSchedules,function(b){var c=ProductionSchedule["new"](b);extractLivestockBreedingStockComposition(a,c)}),calculateAssetStatementRMV(a),totalAssetsAndLiabilities(a)}function calculateYearlyTotal(a,b){return underscore.reduce(a.slice(12*(b-1),12*b),function(a,b){return a+(b||0)},0)}function calculateYearlyEndLiabilityBalance(a,b){var c=a.slice(12*(b-1),12*b);return c[c.length-1]}function calculateAssetLiabilityGroupTotal(a,b,c){var d=Math.ceil(moment(a.endDate,"YYYY-MM-DD").diff(moment(a.startDate,"YYYY-MM-DD"),"years",!0)),e="asset"==b?{estimatedValue:0,currentRMV:0,yearlyRMV:initializeArray(d)}:{currentValue:0,yearlyValues:initializeArray(d)},f="asset"==b?"assetStatement":"liabilityStatement";return a.data[f][c]&&0!=a.data[f][c].length?underscore.reduce(a.data[f][c],function(a,c){return"asset"==b?(a.estimatedValue+=c.estimatedValue||0,a.currentRMV+=c.currentRMV||0,a.yearlyRMV=addArrayValues(a.yearlyRMV,c.yearlyRMV)):(a.currentValue+=c.currentValue||0,a.yearlyValues=addArrayValues(a.yearlyValues,c.yearlyValues)),a},e):e}function calculateMonthlyLiabilityPropertyTotal(a,b,c,d,e){var f=underscore.filter(a.models.liabilities,function(a){return b&&0!=b.length?-1!=b.indexOf(a.type):!0});return 0==f.length?initializeArray(a.numberOfMonths):underscore.chain(f).map(function(a){var b=new Liability(a).liabilityInRange(d,e);return underscore.pluck(b,c)}).unzip().map(function(a){return underscore.reduce(a,function(a,b){return a+(b||0)},0)}).value()}function calculateMonthlyCategoriesTotal(a,b){return underscore.reduce(a,function(a,b){return underscore.each(b,function(b,c){a[c]+=b}),a},b),b}function calculateMonthlySectionsTotal(a,b){return underscore.reduce(a,function(a,b){return b?calculateMonthlyCategoriesTotal(b,a):a},b)}function getDepreciation(a){var b=underscore.chain(a.data.assetStatement["medium-term"]).filter(function(a){return underscore.contains(["Vehicle","Machinery","Equipment"],a.name)}).map(function(b){for(var c=a.data.adjustmentFactors[b.name]||1,d=0;d<b.yearlyRMV.length;d++)b.yearlyRMV[d]=b.yearlyRMV[d]/c*(1-(a.data.account.depreciationRate||0));return b}).pluck("yearlyRMV").reduce(function(a,b){return 0==a.length&&(a=initializeArray(b.length)),addArrayValues(a,b)},[]).value();return 0==b.length?[0,0]:b}function recalculateSummary(a){var b=moment(a.startDate,"YYYY-MM-DD"),c=moment(a.endDate,"YYYY-MM-DD"),d=c.diff(b,"months");a.data.summary={},a.data.summary.monthly={unallocatedProductionIncome:calculateMonthlySectionsTotal([a.data.unallocatedProductionIncome],initializeArray(d)),productionIncome:calculateMonthlySectionsTotal([a.data.productionIncome],initializeArray(d)),capitalIncome:calculateMonthlySectionsTotal([a.data.capitalIncome],initializeArray(d)),otherIncome:calculateMonthlySectionsTotal([a.data.otherIncome],initializeArray(d)),totalIncome:calculateMonthlySectionsTotal([a.data.capitalIncome,a.data.unallocatedProductionIncome,a.data.otherIncome],initializeArray(d)),unallocatedProductionExpenditure:calculateMonthlySectionsTotal([a.data.unallocatedProductionExpenditure],initializeArray(d)),productionExpenditure:calculateMonthlySectionsTotal([a.data.productionExpenditure],initializeArray(d)),capitalExpenditure:calculateMonthlySectionsTotal([a.data.capitalExpenditure],initializeArray(d)),otherExpenditure:calculateMonthlySectionsTotal([a.data.otherExpenditure],initializeArray(d)),debtRedemption:calculateMonthlySectionsTotal([a.data.debtRedemption],initializeArray(d)),totalExpenditure:calculateMonthlySectionsTotal([a.data.capitalExpenditure,a.data.unallocatedProductionExpenditure,a.data.debtRedemption,a.data.otherExpenditure],initializeArray(d)),primaryAccountInterest:initializeArray(d),productionCreditInterest:calculateMonthlyLiabilityPropertyTotal(a,["short-term","production-credit"],"interest",b,c),mediumTermInterest:calculateMonthlyLiabilityPropertyTotal(a,["medium-term"],"interest",b,c),longTermInterest:calculateMonthlyLiabilityPropertyTotal(a,["long-term"],"interest",b,c),totalInterest:initializeArray(d),currentLiabilities:calculateMonthlyLiabilityPropertyTotal(a,["short-term","production-credit"],"closing",b,c),mediumLiabilities:calculateMonthlyLiabilityPropertyTotal(a,["medium-term"],"closing",b,c),longLiabilities:calculateMonthlyLiabilityPropertyTotal(a,["long-term"],"closing",b,c),totalLiabilities:calculateMonthlyLiabilityPropertyTotal(a,[],"closing",b,c),totalRent:calculateMonthlyLiabilityPropertyTotal(a,["rent"],"rent",b,c)},a.data.summary.yearly={unallocatedProductionIncome:[calculateYearlyTotal(a.data.summary.monthly.unallocatedProductionIncome,1),calculateYearlyTotal(a.data.summary.monthly.unallocatedProductionIncome,2)],productionIncome:[calculateYearlyTotal(a.data.summary.monthly.productionIncome,1),calculateYearlyTotal(a.data.summary.monthly.productionIncome,2)],capitalIncome:[calculateYearlyTotal(a.data.summary.monthly.capitalIncome,1),calculateYearlyTotal(a.data.summary.monthly.capitalIncome,2)],otherIncome:[calculateYearlyTotal(a.data.summary.monthly.otherIncome,1),calculateYearlyTotal(a.data.summary.monthly.otherIncome,2)],totalIncome:[calculateYearlyTotal(a.data.summary.monthly.totalIncome,1),calculateYearlyTotal(a.data.summary.monthly.totalIncome,2)],unallocatedProductionExpenditure:[calculateYearlyTotal(a.data.summary.monthly.unallocatedProductionExpenditure,1),calculateYearlyTotal(a.data.summary.monthly.unallocatedProductionExpenditure,2)],productionExpenditure:[calculateYearlyTotal(a.data.summary.monthly.productionExpenditure,1),calculateYearlyTotal(a.data.summary.monthly.productionExpenditure,2)],capitalExpenditure:[calculateYearlyTotal(a.data.summary.monthly.capitalExpenditure,1),calculateYearlyTotal(a.data.summary.monthly.capitalExpenditure,2)],otherExpenditure:[calculateYearlyTotal(a.data.summary.monthly.otherExpenditure,1),calculateYearlyTotal(a.data.summary.monthly.otherExpenditure,2)],debtRedemption:[calculateYearlyTotal(a.data.summary.monthly.debtRedemption,1),calculateYearlyTotal(a.data.summary.monthly.debtRedemption,2)],totalExpenditure:[calculateYearlyTotal(a.data.summary.monthly.totalExpenditure,1),calculateYearlyTotal(a.data.summary.monthly.totalExpenditure,2)],primaryAccountInterest:initializeArray(2),productionCreditInterest:[calculateYearlyTotal(a.data.summary.monthly.productionCreditInterest,1),calculateYearlyTotal(a.data.summary.monthly.productionCreditInterest,2)],mediumTermInterest:[calculateYearlyTotal(a.data.summary.monthly.mediumTermInterest,1),calculateYearlyTotal(a.data.summary.monthly.mediumTermInterest,2)],longTermInterest:[calculateYearlyTotal(a.data.summary.monthly.longTermInterest,1),calculateYearlyTotal(a.data.summary.monthly.longTermInterest,2)],totalInterest:initializeArray(2),currentLiabilities:calculateAssetLiabilityGroupTotal(a,"liability","short-term"),mediumLiabilities:calculateAssetLiabilityGroupTotal(a,"liability","medium-term"),longLiabilities:calculateAssetLiabilityGroupTotal(a,"liability","long-term"),totalLiabilities:[calculateYearlyEndLiabilityBalance(a.data.summary.monthly.totalLiabilities,1),calculateYearlyEndLiabilityBalance(a.data.summary.monthly.totalLiabilities,2)],totalRent:[calculateYearlyTotal(a.data.summary.monthly.totalRent,1),calculateYearlyTotal(a.data.summary.monthly.totalRent,2)],currentAssets:calculateAssetLiabilityGroupTotal(a,"asset","short-term"),movableAssets:calculateAssetLiabilityGroupTotal(a,"asset","medium-term"),fixedAssets:calculateAssetLiabilityGroupTotal(a,"asset","long-term"),totalAssets:a.data.assetStatement.total.yearlyRMV||initializeArray(2),depreciation:getDepreciation(a)},a.data.summary.yearly.netFarmIncome=subtractArrayValues(a.data.summary.yearly.productionIncome,addArrayValues(a.data.summary.yearly.productionExpenditure,a.data.summary.yearly.depreciation)),a.data.summary.yearly.farmingProfitOrLoss=subtractArrayValues(a.data.summary.yearly.netFarmIncome,addArrayValues(a.data.summary.yearly.totalRent,a.data.summary.yearly.totalInterest))}function recalculatePrimaryAccount(a){for(var b=moment(a.startDate,"YYYY-MM-DD"),c=moment(a.endDate,"YYYY-MM-DD"),d=Math.ceil(c.diff(b,"years",!0)),e={opening:0,inflow:0,outflow:0,balance:0,interestPayable:0,interestReceivable:0,closing:0};a.account.monthly.length<a.numberOfMonths;)a.account.monthly.push(e);for(;a.account.yearly.length<d;)a.account.yearly.push(underscore.extend(e,{worstBalance:0,bestBalance:0,openingMonth:null,closingMonth:null}));a.data.summary.monthly.primaryAccountInterest=initializeArray(a.numberOfMonths),a.data.summary.monthly.totalInterest=calculateMonthlyLiabilityPropertyTotal(a,[],"interest",b,c),underscore.each(a.account.monthly,function(b,c){b.opening=0===c?a.account.openingBalance:a.account.monthly[c-1].closing,b.inflow=a.data.summary.monthly.totalIncome[c],b.outflow=a.data.summary.monthly.totalExpenditure[c],b.balance=b.opening+b.inflow-b.outflow,b.interestPayable=b.balance<0&&a.account.interestRateCredit?(b.opening+b.balance)/2*(a.account.interestRateCredit/100/12):0,b.interestReceivable=b.balance>0&&a.account.interestRateDebit?(b.opening+b.balance)/2*(a.account.interestRateDebit/100/12):0,b.closing=b.balance+b.interestPayable+b.interestReceivable,a.data.summary.monthly.totalInterest[c]+=-b.interestPayable,a.data.summary.monthly.primaryAccountInterest[c]+=-b.interestPayable}),underscore.each(a.account.yearly,function(c,d){var e=a.account.monthly.slice(12*d,12*(d+1));c.opening=e[0].opening,c.inflow=sumCollectionProperty(e,"inflow"),c.outflow=sumCollectionProperty(e,"outflow"),c.balance=c.opening+c.inflow-c.outflow,c.interestPayable=sumCollectionProperty(e,"interestPayable"),c.interestReceivable=sumCollectionProperty(e,"interestReceivable"),c.closing=c.balance+c.interestPayable+c.interestReceivable,c.openingMonth=moment(b,"YYYY-MM-DD").add(d,"years").format("YYYY-MM-DD"),c.closingMonth=moment(b,"YYYY-MM-DD").add(d,"years").add(e.length-1,"months").format("YYYY-MM-DD");var f=underscore.max(e,function(a){return a.closing}),g=underscore.min(e,function(a){return a.closing});c.bestBalance={balance:f.closing,month:moment(c.openingMonth,"YYYY-MM-DD").add(e.indexOf(f),"months").format("YYYY-MM-DD")},c.worstBalance={balance:g.closing,month:moment(c.openingMonth,"YYYY-MM-DD").add(e.indexOf(g),"months").format("YYYY-MM-DD")}}),a.data.summary.yearly.primaryAccountInterest=[calculateYearlyTotal(a.data.summary.monthly.primaryAccountInterest,1),calculateYearlyTotal(a.data.summary.monthly.primaryAccountInterest,2)],a.data.summary.yearly.totalInterest=[calculateYearlyTotal(a.data.summary.monthly.totalInterest,1),calculateYearlyTotal(a.data.summary.monthly.totalInterest,2)]}function recalculateRatios(a){a.data.ratios={interestCover:calculateRatio(a,"netFarmIncome","totalInterest"),inputOutput:calculateRatio(a,"productionIncome",["productionExpenditure","productionCreditInterest","primaryAccountInterest"]),productionCost:calculateRatio(a,"productionExpenditure","productionIncome"),cashFlowBank:calculateRatio(a,"unallocatedProductionIncome",["unallocatedProductionExpenditure","primaryAccountInterest"]),cashFlowFarming:calculateRatio(a,["productionIncome","capitalIncome","otherIncome"],["totalExpenditure","primaryAccountInterest"]),debtToTurnover:calculateRatio(a,"totalLiabilities",["productionIncome","otherIncome"]),interestToTurnover:calculateRatio(a,"totalInterest",["productionIncome","otherIncome"]),returnOnInvestment:calculateRatio(a,"netFarmIncome","totalAssets")},calculateAssetRatios(a)}function calculateAssetRatios(a){var b={yearly:[],currentRMV:0,estimatedValue:0};a.data.ratios=underscore.extend(a.data.ratios,{netCapital:b,gearing:b,debt:b}),a.data.ratios.netCapital=underscore.mapObject(a.data.ratios.netCapital,function(b,c){return underscore.contains(["currentRMV","estimatedValue"],c)?infinityToZero(a.data.assetStatement.total[c]/a.data.liabilityStatement.total.currentValue):"yearly"===c?divideArrayValues(a.data.assetStatement.total.yearlyRMV,a.data.liabilityStatement.total.yearlyValues):void 0}),a.data.ratios.debt=underscore.mapObject(a.data.ratios.debt,function(b,c){return underscore.contains(["currentRMV","estimatedValue"],c)?infinityToZero(a.data.liabilityStatement.total.currentValue/a.data.assetStatement.total[c]):"yearly"===c?divideArrayValues(a.data.liabilityStatement.total.yearlyValues,a.data.assetStatement.total.yearlyRMV):void 0}),a.data.ratios.gearing=underscore.mapObject(a.data.ratios.gearing,function(b,c){return underscore.contains(["currentRMV","estimatedValue"],c)?infinityToZero(a.data.liabilityStatement.total.currentValue/(a.data.assetStatement.total[c]-a.data.liabilityStatement.total.currentValue)):"yearly"===c?divideArrayValues(a.data.liabilityStatement.total.yearlyValues,subtractArrayValues(a.data.assetStatement.total.yearlyRMV,a.data.liabilityStatement.total.yearlyValues)):void 0})}function calculateRatio(a,b,c){function d(b,c){if(!a.data.summary[c])return[];var d=underscore.chain(b).map(function(b){return"-"===b.charAt(0)?(b=b.substr(1),negateArrayValues(a.data.summary[c][b])):a.data.summary[c][b]}).compact().value();return underscore.reduce(d.slice(1),function(a,b){return addArrayValues(a,b)},angular.copy(d[0])||[])}return underscore.isArray(b)||(b=[b]),underscore.isArray(c)||(c=[c]),{monthly:divideArrayValues(d(b,"monthly"),d(c,"monthly")),yearly:divideArrayValues(d(b,"yearly"),d(c,"yearly"))}}Document.apply(this,arguments),this.docType="financial resource plan",this.data.startDate=moment(this.data.startDate).format("YYYY-MM-DD"),this.data.endDate=moment(this.data.startDate).add(2,"y").format("YYYY-MM-DD"),initializeObject(this.data,"account",{}),initializeObject(this.data,"models",{}),initializeObject(this.data,"adjustmentFactors",{}),initializeObject(this.data,"assetStatement",{}),initializeObject(this.data,"liabilityStatement",{}),initializeObject(this.data.assetStatement,"total",{}),initializeObject(this.data.liabilityStatement,"total",{}),initializeObject(this.data.account,"monthly",[]),initializeObject(this.data.account,"yearly",[]),initializeObject(this.data.account,"openingBalance",0),initializeObject(this.data.account,"interestRateCredit",0),initializeObject(this.data.account,"interestRateDebit",0),initializeObject(this.data.account,"depreciationRate",0),initializeObject(this.data.models,"assets",[]),initializeObject(this.data.models,"expenses",[]),initializeObject(this.data.models,"financials",[]),initializeObject(this.data.models,"income",[]),initializeObject(this.data.models,"liabilities",[]),initializeObject(this.data.models,"productionSchedules",[]),privateProperty(this,"updateProductionSchedules",function(a){var b=moment(this.startDate,"YYYY-MM-DD"),c=moment(this.endDate,"YYYY-MM-DD");this.models.productionSchedules=[],angular.forEach(a,function(a){a&&ProductionSchedule["new"](a).validate()&&(b.isBetween(a.startDate,a.endDate)||b.isBefore(a.endDate)&&c.isAfter(a.startDate))&&this.models.productionSchedules.push(a)},this),reEvaluateBusinessPlan(this)}),privateProperty(this,"addIncome",function(a){this.models.income=underscore.reject(this.models.income,function(b){return b.uuid===a.uuid}),this.models.income.push(a),reEvaluateBusinessPlan(this),recalculate(this)}),privateProperty(this,"removeIncome",function(a){this.models.income=underscore.reject(this.models.income,function(b){return b.uuid===a.uuid}),reEvaluateBusinessPlan(this),recalculate(this)}),privateProperty(this,"addExpense",function(a){this.models.expenses=underscore.reject(this.models.expenses,function(b){return b.uuid===a.uuid}),this.models.expenses.push(a),reEvaluateBusinessPlan(this),recalculate(this)}),privateProperty(this,"removeExpense",function(a){this.models.expenses=underscore.reject(this.models.expenses,function(b){return b.uuid===a.uuid}),reEvaluateBusinessPlan(this),recalculate(this)}),privateProperty(this,"updateFinancials",function(a){this.models.financials=underscore.chain(a).filter(function(a){return Financial["new"](a).validate()}).sortBy(function(a){return-a.year}).first(3).sortBy(function(a){return a.year}).value()}),privateProperty(this,"addAsset",function(a){var b=this;a=Asset["new"](a),a.validate()&&(b.models.assets=underscore.reject(b.models.assets,function(b){return b.assetKey===a.assetKey}),a.liabilities=underscore.chain(a.liabilities).map(function(a){return a.validate()&&(b.models.liabilities=underscore.reject(b.models.liabilities,function(b){return b.uuid===a.uuid}),b.models.liabilities.push(a.asJSON())),a.asJSON()}).value(),b.models.assets.push(a.asJSON()),reEvaluateAssetsAndLiabilities(b),recalculate(b))}),privateProperty(this,"removeAsset",function(a){var b=this;b.models.assets=underscore.reject(b.models.assets,function(b){return b.assetKey===a.assetKey}),underscore.each(a.liabilities,function(a){b.models.liabilities=underscore.reject(b.models.liabilities,function(b){return b.uuid===a.uuid})}),reEvaluateAssetsAndLiabilities(b),recalculate(b)}),privateProperty(this,"addLiability",function(a){a=Liability["new"](a),a.validate()&&(this.models.liabilities=underscore.reject(this.models.liabilities,function(b){return b.uuid===a.uuid}),this.models.liabilities.push(a.asJSON()),reEvaluateAssetsAndLiabilities(this),recalculate(this))}),privateProperty(this,"removeLiability",function(a){this.models.liabilities=underscore.reject(this.models.liabilities,function(b){return b.uuid===a.uuid}),reEvaluateAssetsAndLiabilities(this),recalculate(this)}),privateProperty(this,"reEvaluateProductionCredit",function(a){return reEvaluateProductionCredit(this,a)}),computedProperty(this,"startDate",function(){return this.data.startDate}),computedProperty(this,"endDate",function(){return this.data.endDate=this.data.startDate?moment(this.data.startDate).add(2,"y").format("YYYY-MM-DD"):this.data.endDate,this.data.endDate}),computedProperty(this,"account",function(){return this.data.account}),computedProperty(this,"adjustmentFactors",function(){return this.data.adjustmentFactors}),computedProperty(this,"numberOfMonths",function(){return moment(this.endDate,"YYYY-MM-DD").diff(moment(this.startDate,"YYYY-MM-DD"),"months")}),computedProperty(this,"models",function(){return this.data.models}),privateProperty(this,"reEvaluate",function(){reEvaluateBusinessPlan(this)}),privateProperty(this,"recalculateAccount",function(){recalculatePrimaryAccount(this)})}var _assetYearEndValueAdjustments={"Land and fixed improvements":[{operation:"+",category:"capitalIncome",item:"Land Sales"},{operation:"-",category:"capitalExpenditure",item:"Land Purchases"},{operation:"-",category:"capitalExpenditure",item:"Development"}],Vehicles:[{operation:"+",category:"capitalIncome",item:"Vehicle Sales"},{operation:"-",category:"capitalExpenditure",item:"Vehicle Purchases"}],Machinery:[{operation:"+",category:"capitalIncome",item:"Machinery & Plant Sales"},{operation:"-",category:"capitalExpenditure",item:"Machinery & Plant Purchases"}],"Breeding Stock":[{operation:"+",category:"capitalIncome",item:"Breeding Stock Sales"},{operation:"-",category:"capitalExpenditure",item:"Breeding Stock Purchases"}]};return inheritModel(BusinessPlan,Document),readOnlyProperty(BusinessPlan,"incomeExpenseTypes",{capital:"Capital",production:"Production",other:"Other"}),BusinessPlan.validates({author:{required:!0,length:{min:1,max:255}},docType:{required:!0,equal:{to:"financial resource plan"}},organizationId:{required:!0,numeric:!0},startDate:{required:!0,format:{date:!0}},title:{length:{min:1,max:255}}}),BusinessPlan}]);var sdkModelDocument=angular.module("ag.sdk.model.document",["ag.sdk.library","ag.sdk.model.base"]);sdkModelDocument.factory("Document",["inheritModel","Model","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e){function f(a){b.Base.apply(this,arguments),this.data=a&&a.data||{},c(this,"updateRegister",function(a){this.data=e.extend(this.data,{farmer:e.omit(a,["activeFlags","farms","legalEntities","primaryContact","teams"]),farms:a.farms,legalEntities:e.map(a.legalEntities,function(a){return e.omit(a,["assets","farms"])}),assets:e.chain(a.legalEntities).pluck("assets").flatten().compact().groupBy("type").value(),liabilities:e.chain(a.legalEntities).pluck("liabilities").flatten().compact().value()})}),e.isUndefined(a)||0===arguments.length||(this.author=a.author,this.docType=a.docType,this.documentId=a.documentId,this.id=a.id||a.$id,this.organization=a.organization,this.organizationId=a.organizationId,this.title=a.title)}return a(f,b.Base),d(f,"docTypes",{"asset register":"Asset Register","emergence report":"Emergence Report","farm valuation":"Farm Valuation","financial resource plan":"Financial Resource Plan","insurance policy":"Insurance Policy","production plan":"Production Plan","progress report":"Progress Report"}),f.validates({author:{required:!0,length:{min:1,max:255}},docType:{required:!0,inclusion:{"in":e.keys(f.docTypes)}},organizationId:{required:!0,numeric:!0}}),f}]);var sdkModelEnterpriseBudget=angular.module("ag.sdk.model.enterprise-budget",["ag.sdk.library","ag.sdk.utilities","ag.sdk.model.base"]);sdkModelEnterpriseBudget.factory("EnterpriseBudgetBase",["computedProperty","inheritModel","interfaceProperty","Model","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e,f,g){function h(b){d.Base.apply(this,arguments),this.data=b&&b.data?b.data:{},this.data.sections=this.data.sections||[],a(this,"defaultCostStage",function(){return g.last(h.costStages)}),e(this,"getSections",function(a,b){var c=g.where(this.data.sections,{code:a,costStage:b||this.defaultCostStage});return c.length>0?c:g.filter(this.data.sections,function(b){return b.code===a&&g.isUndefined(b.costStage)})}),e(this,"getSection",function(a,b){return g.first(this.getSections(a,b))}),e(this,"addSection",function(a,b){var c=this.getSection(a,b);return g.isUndefined(c)&&(c=g.extend({productCategoryGroups:[],total:{value:0}},h.sections[a]),"livestock"==this.assetType&&(c.total.valuePerLSU=0),b&&(c.costStage=b),this.data.sections.push(c)),c}),e(this,"getGroup",function(a,b,c){return g.chain(this.getSections(a,c)).pluck("productCategoryGroups").flatten().findWhere({name:b}).value()}),e(this,"addGroup",function(a,b,c){var d=this.getGroup(a,b,c);if(g.isUndefined(d)){var e=this.addSection(a,c);d=g.extend({productCategories:[],total:{value:0}},h.groups[b]),"livestock"==this.assetType&&(d.total.valuePerLSU=0),e.productCategoryGroups.push(d)}return d}),e(this,"removeGroup",function(a,b,c){var d=this.getSection(a,c);d&&(d.productCategoryGroups=g.reject(d.productCategoryGroups,function(a){return a.name===b})),this.recalculate()}),e(this,"getCategory",function(a,b,c){return g.chain(this.getSections(a,c)).pluck("productCategoryGroups").flatten().pluck("productCategories").flatten().findWhere({code:b}).value()}),c(this,"getCategoryOptions",function(a){return this.assetType?"livestock"==this.assetType?h.categoryOptions[this.assetType][this.baseAnimal][a]:h.categoryOptions[this.assetType][a]:[]}),e(this,"getAvailableGroupCategories",function(a,b,c){var d=this.getGroup(a,b,c);return k(this,a,d?d.productCategories:[],b)}),e(this,"getAvailableCategories",function(a,b){var c=g.chain(this.getSections(a,b)).pluck("productCategoryGroups").flatten().pluck("productCategories").flatten().value();return k(this,a,c)}),e(this,"addCategory",function(a,b,c,d){var e=this.getCategory(a,c,d);if(g.isUndefined(e)){var f=this.addGroup(a,j(this,a,b,c),d);e=g.extend({quantity:0,value:0},h.categories[c]),"EXP"===a&&(e.unit="Total"),"livestock"==this.assetType?(e=g.extend(e,{conversionRate:this.getConversionRate(e.name),valuePerLSU:0,per:"LSU"}),p[this.commodityType]&&g.contains(p[this.commodityType],e.name)&&(e.breedingStock=!0)):e.per="ha",f.productCategories.push(e)}return e}),e(this,"removeCategory",function(a,b,c,d){b=j(this,a,b,c);var e=this.getGroup(a,b,d);e&&(e.productCategories=g.reject(e.productCategories,function(a){return a.code===c}),0==e.productCategories.length&&this.removeGroup(a,b,d)),this.recalculate()}),c(this,"recalculate",function(){}),a(this,"baseAnimal",function(){return n[this.commodityType]||this.commodityType}),e(this,"getBaseAnimal",function(){return this.baseAnimal}),e(this,"getRepresentativeAnimal",function(){return m[this.baseAnimal]}),e(this,"getConversionRate",function(a){return o[this.baseAnimal][a]||o[this.baseAnimal][m[this.baseAnimal]]}),e(this,"getConversionRates",function(){return o[this.baseAnimal]}),e(this,"getUnitAbbreviation",function(a){return l[a]||a})}function i(a){return g.chain(a).map(function(a){return h.categories[a]}).compact().value()}function j(a,b,c,d){return c?c:g.chain(a.getCategoryOptions(b)).map(function(a,b){return g.where(a,{code:d}).length>0?b:void 0}).compact().first().value()}function k(a,b,c,d){return g.chain(a.getCategoryOptions(b)).map(function(a,b){return g.chain(a).reject(function(a){return d&&b!==d||g.findWhere(c,{code:a.code})}).map(function(a){return g.extend(a,{groupBy:b})}).value()}).values().flatten().value()}b(h,d.Base),f(h,"sections",g.indexBy([{code:"EXP",name:"Expenses"},{code:"INC",name:"Income"}],"code")),f(h,"groups",g.indexBy([{code:"INC-CPS",name:"Crop Sales"},{code:"INC-FRS",name:"Fruit Sales"},{code:"HVT",name:"Harvest"},{code:"HVP",name:"Preharvest"},{code:"INC-LSS",name:"Livestock Sales"},{code:"INC-LSP",name:"Product Sales"},{code:"EXP-AMF",name:"Animal Feed"},{code:"HBD",name:"Husbandry"},{code:"IDR",name:"Indirect Costs"},{code:"MRK",name:"Marketing"},{code:"RPM",name:"Replacements"}],"name")),f(h,"categories",g.indexBy([{code:"INC-LSS-SLAMB",name:"Lamb",unit:"head"},{code:"INC-LSS-SWEAN",name:"Weaner lambs",unit:"head"},{code:"INC-LSS-SEWE",name:"Ewe",unit:"head"},{code:"INC-LSS-SWTH",name:"Wether (2-tooth plus)",unit:"head"},{code:"INC-LSS-SRAM",name:"Ram",unit:"head"},{code:"INC-LSS-CCALV",name:"Calf",unit:"head"},{code:"INC-LSS-CWEN",name:"Weaner calves",unit:"head"},{code:"INC-LSS-CCOW",name:"Cow or heifer",unit:"head"},{code:"INC-LSS-CST18",name:"Steer (18 months plus)",unit:"head"},{code:"INC-LSS-CST36",name:"Steer (3 years plus)",unit:"head"},{code:"INC-LSS-CBULL",name:"Bull (3 years plus)",unit:"head"},{code:"INC-LSS-GKID",name:"Kid",unit:"head"},{code:"INC-LSS-GWEAN",name:"Weaner kids",unit:"head"},{code:"INC-LSS-GEWE",name:"Ewe (2-tooth plus)",unit:"head"},{code:"INC-LSS-GCAST",name:"Castrate (2-tooth plus)",unit:"head"},{code:"INC-LSS-GRAM",name:"Ram (2-tooth plus)",unit:"head"},{code:"INC-LSP-MILK",name:"Milk",unit:"l"},{code:"INC-LSP-WOOL",name:"Wool",unit:"kg"},{code:"INC-HVT-CROP",name:"Crop",unit:"t"},{code:"INC-HVT-FRUT",name:"Fruit",unit:"t"},{code:"EXP-HVP-SEED",name:"Seed",unit:"kg"},{code:"EXP-HVP-PLTM",name:"Plant Material",unit:"each"},{code:"EXP-HVP-FERT",name:"Fertiliser",unit:"t"},{code:"EXP-HVP-LIME",name:"Lime",unit:"t"},{code:"EXP-HVP-HERB",name:"Herbicides",unit:"l"},{code:"EXP-HVP-PEST",name:"Pesticides",unit:"l"},{code:"EXP-HVP-SPYA",name:"Aerial spraying",unit:"ha"},{code:"EXP-HVP-INSH",name:"Crop Insurance (Hail)",unit:"t"},{code:"EXP-HVP-INSM",name:"Crop Insurance (Multiperil)",unit:"t"},{code:"EXP-HVP-HEDG",name:"Hedging cost",unit:"t"},{code:"EXP-HVT-LABC",name:"Contract work (Harvest)",unit:"ha"},{code:"EXP-HVT-STOR",name:"Storage",unit:"days"},{code:"EXP-HVT-PAKM",name:"Packaging material",unit:"each"},{code:"EXP-HVT-DYCL",name:"Drying and cleaning",unit:"t"},{code:"EXP-HVT-PAKC",name:"Packing cost",unit:"each"},{code:"EXP-IDR-FUEL",name:"Fuel",unit:"l"},{code:"EXP-IDR-REPP",name:"Repairs & parts",unit:"Total"},{code:"EXP-IDR-ELEC",name:"Electricity",unit:"Total"},{code:"EXP-IDR-WATR",name:"Water",unit:"Total"},{code:"EXP-IDR-LABP",name:"Permanent labour",unit:"Total"},{code:"EXP-IDR-SCHED",name:"Scheduling",unit:"Total"},{code:"EXP-IDR-LICS",name:"License",unit:"Total"},{code:"EXP-IDR-INSA",name:"Insurance assets",unit:"Total"},{code:"EXP-IDR-OTHER",name:"Other costs",unit:"Total"},{code:"EXP-RPM-SLAMB",name:"Lamb",unit:"head"},{code:"EXP-RPM-SWEAN",name:"Weaner lambs",unit:"head"},{code:"EXP-RPM-SEWE",name:"Ewe",unit:"head"},{code:"EXP-RPM-SWTH",name:"Wether (2-tooth plus)",unit:"head"},{code:"EXP-RPM-SRAM",name:"Ram",unit:"head"},{code:"EXP-RPM-CCALV",name:"Calf",unit:"head"},{code:"EXP-RPM-CWEN",name:"Weaner calves",unit:"head"},{code:"EXP-RPM-CCOW",name:"Cow or heifer",unit:"head"},{code:"EXP-RPM-CST18",name:"Steer (18 moths plus)",unit:"head"},{code:"EXP-RPM-CST36",name:"Steer (3 years plus)",unit:"head"},{code:"EXP-RPM-CBULL",name:"Bull (3 years plus)",unit:"head"},{code:"EXP-RPM-GKID",name:"Kid",unit:"head"},{code:"EXP-RPM-GWEAN",name:"Weaner kids",unit:"head"},{code:"EXP-RPM-GEWE",name:"Ewe (2-tooth plus)",unit:"head"},{code:"EXP-RPM-GCAST",name:"Castrate (2-tooth plus)",unit:"head"},{code:"EXP-RPM-GRAM",name:"Ram (2-tooth plus)",unit:"head"},{code:"EXP-AMF-LICK",name:"Lick",unit:"kg"},{code:"EXP-HBD-VACC",name:"Drenching & vaccination",unit:"head"},{code:"EXP-HBD-DIPP",name:"Dipping & jetting",unit:"head"},{code:"EXP-HBD-VETY",name:"Veterinary",unit:"head"},{code:"EXP-HBD-SHER",name:"Shearing",unit:"head"},{code:"EXP-HBD-CRCH",name:"Crutching",unit:"head"},{code:"EXP-MRK-LSSF",name:"Livestock sales marketing fees",unit:"t"},{code:"EXP-MRK-LSPF",name:"Livestock products marketing fees",unit:"t"},{code:"EXP-MRK-HOTF",name:"Horticulture marketing fees",unit:"t"},{code:"EXP-MRK-CRPF",name:"Crop marketing fees",unit:"t"},{code:"EXP-MRK-LSTP",name:"Livestock transport",unit:"head"},{code:"EXP-MRK-HOTT",name:"Horticulture transport",unit:"t"},{code:"EXP-MRK-CRPT",name:"Crop transport",unit:"t"}],"code")),f(h,"categoryOptions",{crop:{INC:{"Crop Sales":i(["INC-HVT-CROP"])},EXP:{Preharvest:i(["EXP-HVP-SEED","EXP-HVP-FERT","EXP-HVP-LIME","EXP-HVP-HERB","EXP-HVP-PEST","EXP-HVP-SPYA","EXP-HVP-INSH","EXP-HVP-INSM","EXP-HVP-HEDG"]),Harvest:i(["EXP-HVT-LABC"]),Marketing:i(["EXP-MRK-CRPF","EXP-MRK-CRPT"]),"Indirect Costs":i(["EXP-IDR-FUEL","EXP-IDR-REPP","EXP-IDR-ELEC","EXP-IDR-WATR","EXP-IDR-LABP","EXP-IDR-SCHED","EXP-IDR-OTHER"])}},horticulture:{INC:{"Fruit Sales":i(["INC-HVT-FRUT"])},EXP:{Preharvest:i(["EXP-HVP-PLTM","EXP-HVP-FERT","EXP-HVP-LIME","EXP-HVP-HERB","EXP-HVP-PEST","EXP-HVP-SPYA","EXP-HVP-INSH","EXP-HVP-INSM"]),Harvest:i(["EXP-HVT-LABC","EXP-HVT-STOR","EXP-HVT-PAKM","EXP-HVT-DYCL","EXP-HVT-PAKC"]),Marketing:i(["EXP-MRK-HOTF","EXP-MRK-HOTT"]),"Indirect Costs":i(["EXP-IDR-FUEL","EXP-IDR-REPP","EXP-IDR-ELEC","EXP-IDR-WATR","EXP-IDR-LABP","EXP-IDR-SCHED","EXP-IDR-LICS","EXP-IDR-INSA","EXP-IDR-OTHER"])}},livestock:{Cattle:{INC:{"Livestock Sales":i(["INC-LSS-CCALV","INC-LSS-CWEN","INC-LSS-CCOW","INC-LSS-CST18","INC-LSS-CST36","INC-LSS-CBULL"]),"Product Sales":i(["INC-LSP-MILK"])},EXP:{Replacements:i(["EXP-RPM-CCALV","EXP-RPM-CWEN","EXP-RPM-CCOW","EXP-RPM-CST18","EXP-RPM-CST36","EXP-RPM-CBULL"]),"Animal Feed":i(["EXP-AMF-LICK"]),Husbandry:i(["EXP-HBD-VACC","EXP-HBD-DIPP","EXP-HBD-VETY"]),Marketing:i(["EXP-MRK-LSSF","EXP-MRK-LSPF","EXP-MRK-LSTP"]),"Indirect Costs":i(["EXP-IDR-FUEL","EXP-IDR-REPP","EXP-IDR-ELEC","EXP-IDR-WATR","EXP-IDR-LABP","EXP-IDR-LICS","EXP-IDR-INSA","EXP-IDR-OTHER"])}},Goats:{INC:{"Livestock Sales":i(["INC-LSS-GKID","INC-LSS-GWEAN","INC-LSS-GEWE","INC-LSS-GCAST","INC-LSS-GRAM"]),"Product Sales":i(["INC-LSP-WOOL","INC-LSP-MILK"])},EXP:{Replacements:i(["EXP-RPM-GKID","EXP-RPM-GWEAN","EXP-RPM-GEWE","EXP-RPM-GCAST","EXP-RPM-GRAM"]),"Animal Feed":i(["EXP-AMF-LICK"]),Husbandry:i(["EXP-HBD-VACC","EXP-HBD-DIPP","EXP-HBD-VETY","EXP-HBD-SHER","EXP-HBD-CRCH"]),Marketing:i(["EXP-MRK-LSSF","EXP-MRK-LSPF","EXP-MRK-LSTP"]),"Indirect Costs":i(["EXP-IDR-FUEL","EXP-IDR-REPP","EXP-IDR-ELEC","EXP-IDR-WATR","EXP-IDR-LABP","EXP-IDR-LICS","EXP-IDR-INSA","EXP-IDR-OTHER"])}},Sheep:{INC:{"Livestock Sales":i(["INC-LSS-SLAMB","INC-LSS-SWEAN","INC-LSS-SEWE","INC-LSS-SWTH","INC-LSS-SRAM"]),"Product Sales":i(["INC-LSP-WOOL","INC-LSP-MILK"])},EXP:{Replacements:i(["EXP-RPM-SLAMB","EXP-RPM-SWEAN","EXP-RPM-SEWE","EXP-RPM-SWTH","EXP-RPM-SRAM"]),"Animal Feed":i(["EXP-AMF-LICK"]),Husbandry:i(["EXP-HBD-VACC","EXP-HBD-DIPP","EXP-HBD-VETY","EXP-HBD-SHER","EXP-HBD-CRCH"]),Marketing:i(["EXP-MRK-LSSF","EXP-MRK-LSPF","EXP-MRK-LSTP"]),"Indirect Costs":i(["EXP-IDR-FUEL","EXP-IDR-REPP","EXP-IDR-ELEC","EXP-IDR-WATR","EXP-IDR-LABP","EXP-IDR-LICS","EXP-IDR-INSA","EXP-IDR-OTHER"])}}}}),f(h,"costStages",["Establishment","Yearly"]);
var l={head:"hd",each:"ea."},m={Cattle:"Cow or heifer",Sheep:"Ewe",Goats:"Ewe (2-tooth plus)"},n={"Cattle (Extensive)":"Cattle","Cattle (Feedlot)":"Cattle","Cattle (Stud)":"Cattle","Sheep (Extensive)":"Sheep","Sheep (Feedlot)":"Sheep","Sheep (Stud)":"Sheep"},o={Cattle:{Calf:.32,"Weaner calves":.44,"Cow or heifer":1.1,"Steer (18 months plus)":.75,"Steer (18 moths plus)":.75,"Steer (3 years plus)":1.1,"Bull (3 years plus)":1.36},Sheep:{Lamb:.08,"Weaner Lambs":.11,Ewe:.16,"Wether (2-tooth plus)":.16,"Ram (2-tooth plus)":.23},Goats:{Kid:.08,"Weaner kids":.12,"Ewe (2-tooth plus)":.17,"Castrate (2-tooth plus)":.17,"Ram (2-tooth plus)":.22}},p={"Cattle (Extensive)":["Cow or heifer","Bull (3 years plus)"],"Sheep (Extensive)":["Ewe","Ram (2-tooth plus)"]};return h.validates({data:{required:!0,object:!0}}),h}]),sdkModelEnterpriseBudget.factory("EnterpriseBudget",["$filter","computedProperty","EnterpriseBudgetBase","inheritModel","moment","naturalSort","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e,f,g,h,i){function j(a){c.apply(this,arguments),this.data.details=this.data.details||{},this.data.details.cycleStart=this.data.details.cycleStart||0,this.data.details.productionArea=this.data.details.productionArea||"1 Hectare",this.data.schedules=this.data.schedules||{},b(this,"commodityTitle",function(){return k(this.assetType)}),g(this,"getCommodities",function(){return l(this.assetType)}),g(this,"getShiftedCycle",function(){return m(this)}),g(this,"getScheduleTypes",function(){return i.chain(s[this.assetType]?s[this.assetType]:s["default"]).union(o(this)).compact().value().sort(f)}),g(this,"getSchedule",function(a,b){return a&&this.data.schedules[a]?this.data.schedules[a]:i.isUndefined(b)?angular.copy(t):i.range(12).map(function(){return 0})}),g(this,"shiftMonthlyArray",function(a){return a?i.rest(a,this.data.details.cycleStart).concat(i.first(a,this.data.details.cycleStart)):a}),g(this,"unshiftMonthlyArray",function(a){return a?i.rest(a,a.length-this.data.details.cycleStart).concat(i.first(a,a.length-this.data.details.cycleStart)):a}),g(this,"getShiftedSchedule",function(a){return this.shiftMonthlyArray(i.isArray(a)?a:this.getSchedule(a))}),g(this,"getAvailableSchedules",function(a){return p(this,a)}),b(this,"cycleStart",function(){return this.data.details.cycleStart}),b(this,"cycleStartMonth",function(){return j.cycleMonths[this.data.details.cycleStart].name}),g(this,"getAllocationIndex",function(a,b){var c=this.getSection(a,b),d=c&&c.total?i.findIndex(this.shiftMonthlyArray(c.total.valuePerMonth),function(a){return 0!=a}):-1;return-1!==d?d:0}),g(this,"getLastAllocationIndex",function(a,b){var c=this.getSection(a,b),d=c&&c.total?i.findLastIndex(this.shiftMonthlyArray(c.total.valuePerMonth),function(a){return 0!=a}):-1;return-1!==d?d+1:12}),b(this,"numberOfAllocatedMonths",function(){return this.getLastAllocationIndex("INC")-this.getAllocationIndex("EXP")}),g(this,"recalculate",function(){return r(this)}),i.isUndefined(a)||0===arguments.length||(this.assetType=a.assetType,this.averaged=a.averaged||!1,this.cloneCount=a.cloneCount||0,this.createdAt=a.createdAt,this.createdBy=a.createdBy,this.commodityType=a.commodityType,this.favoriteCount=a.favoriteCount||0,this.favorited=a.favorited||!1,this.id=a.id||a.$id,this.internallyPublished=a.internallyPublished||!1,this.name=a.name,this.organization=a.organization,this.organizationUuid=a.organizationUuid,this.published=a.published||!1,this.region=a.region,this.sourceUuid=a.sourceUuid,this.useCount=a.useCount||0,this.updatedAt=a.updatedAt,this.updatedBy=a.updatedBy,this.user=a.user,this.userData=a.userData,this.userId=a.userId,this.uuid=a.uuid,"livestock"===this.assetType?(this.data.details.representativeAnimal=this.getRepresentativeAnimal(),this.data.details.conversions=this.getConversionRates(),this.data.details.budgetUnit="LSU"):"horticulture"===this.assetType&&(this.data.details.yearsToMaturity=this.data.details.yearsToMaturity||n(this),this.data.details.maturityFactor=this.data.details.maturityFactor||[]),this.recalculate())}function k(a){return j.commodityTypes[a]||""}function l(a){return j.assetCommodities[a]||[]}function m(a){return i.sortBy(j.cycleMonths,function(b){return b.id<a.data.details.cycleStart?b.id+12:b.id})}function n(a){return u[a.commodityType]}function o(a){return i.chain(v).keys().filter(function(b){return i.contains(v[b],a.commodityType)}).value()}function p(a,b){return i.reject(a.getScheduleTypes(),function(c){return(void 0===b||c!==b)&&void 0!==a.data.schedules[c]})}function q(a){if(i.each(j.sections,function(b){for(var c=j.costStages.length-1;c>=0;c--){var d=a.getSection(b.code,j.costStages[c]);i.isUndefined(d)&&(d=angular.copy(b),d.productCategoryGroups=[],a.data.sections.push(d)),d.costStage=j.costStages[c]}}),"horticulture"==a.assetType&&a.data.details.yearsToMaturity){for(;a.data.details.maturityFactor.length<a.data.details.yearsToMaturity;)a.data.details.maturityFactor.push(Math.floor(100/a.data.details.yearsToMaturity*(a.data.details.maturityFactor.length+1)));a.data.details.maturityFactor=a.data.details.maturityFactor.slice(0,a.data.details.yearsToMaturity)}}function r(a){q(a),"livestock"==a.assetType&&(a.data.details.calculatedLSU=a.data.details.herdSize*a.getConversionRate()),angular.forEach(a.data.sections,function(b){b.total={value:0},"livestock"==a.assetType&&(b.total.valuePerLSU=0),angular.forEach(b.productCategoryGroups,function(c){c.total={value:0},"livestock"==a.assetType&&(c.total.valuePerLSU=0),angular.forEach(c.productCategories,function(d){if("%"==d.unit){var e=i.chain(a.data.sections).filter(function(a){return a.costStage===b.costStage}).pluck("productCategoryGroups").flatten().reduce(function(a,b){return b.name==d.incomeGroup&&void 0!==b.total?a+b.total.value:a},0).value();d.quantity=w(e/100)}else d.quantity="Total"==d.unit?1:d.quantity;"livestock"==a.assetType&&(d.valuePerLSU=(d.pricePerUnit||0)/a.getConversionRate(d.name),c.total.valuePerLSU+=d.valuePerLSU);var f=i.isArray(d.schedule)?d.schedule:a.getSchedule(d.schedule),g=i.reduce(f,function(a,b){return a+(b||0)},0);d.value=(d.pricePerUnit||0)*(d.quantity||0)/100*g,d.valuePerMonth=i.map(f,function(a){return d.value/100*a}),d.quantityPerMonth=i.map(f,function(a){return d.quantity/100*a}),c.total.value+=d.value,c.total.valuePerMonth=c.total.valuePerMonth?i.map(c.total.valuePerMonth,function(a,b){return a+d.valuePerMonth[b]}):angular.copy(d.valuePerMonth)}),b.total.value+=c.total.value,b.total.valuePerMonth=b.total.valuePerMonth?i.map(b.total.valuePerMonth,function(a,b){return a+c.total.valuePerMonth[b]}):angular.copy(c.total.valuePerMonth),"livestock"==a.assetType&&(b.total.valuePerLSU+=c.total.valuePerLSU)})}),a.data.details.grossProfitByStage=i.object(j.costStages,i.map(j.costStages,function(b){return i.chain(a.data.sections).where({costStage:b}).reduce(function(a,b){return"INC"===b.code?a+b.total.value:"EXP"===b.code?a-b.total.value:a},0).value()})),a.data.details.grossProfit=a.data.details.grossProfitByStage[a.defaultCostStage],"livestock"==a.assetType&&(a.data.details.grossProfitPerLSU=a.data.details.grossProfit/a.data.details.calculatedLSU)}d(j,c),h(j,"commodityTypes",{crop:"Field Crops",horticulture:"Horticulture",livestock:"Livestock"}),h(j,"assetCommodities",{crop:["Barley","Bean (Dry)","Bean (Green)","Canola","Cotton","Cowpea","Grain Sorghum","Groundnut","Lucerne","Lupin","Maize (Fodder)","Maize (Green)","Maize (Seed)","Maize (White)","Maize (Yellow)","Oat","Potato","Rye","Soya Bean","Sunflower","Sweet Corn","Tobacco","Triticale","Wheat"],horticulture:["Almond","Apple","Apricot","Avocado","Banana","Barberry","Berry","Bilberry","Blackberry","Blueberry","Cherry","Chicory","Chili","Cloudberry","Citrus (Hardpeel)","Citrus (Softpeel)","Coffee","Fig","Garlic","Gooseberry","Grape (Table)","Grape (Wine)","Guava","Hops","Kiwi","Lemon","Lentil","Macadamia Nut","Mandarin","Mango","Melon","Mulberry","Nectarine","Olive","Onion","Orange","Papaya","Pea","Peach","Peanut","Pear","Prickly Pear","Pecan Nut","Persimmon","Pineapple","Pistachio Nut","Plum","Pomegranate","Protea","Prune","Pumpkin","Quince","Raspberry","Rooibos","Strawberry","Sugarcane","Tea","Tomato","Watermelon","Wineberry"],livestock:["Cattle (Extensive)","Cattle (Feedlot)","Cattle (Stud)","Chicken (Broilers)","Chicken (Layers)","Dairy","Game","Goats","Horses","Ostrich","Pigs","Sheep (Extensive)","Sheep (Feedlot)","Sheep (Stud)"]});var s={"default":["Fertilise","Harvest","Plant/Seed","Plough","Spray"],livestock:["Lick","Sales","Shearing","Vaccination"]};h(j,"cycleMonths",i.map(["January","February","March","April","May","June","July","August","September","October","November","December"],function(a,b){return{id:b,name:a,shortname:a.substring(0,3)}})),g(j,"getCycleMonth",function(a){return j.cycleMonths[a%12]});var t=[8.33,8.33,8.34,8.33,8.33,8.34,8.33,8.33,8.34,8.33,8.33,8.34],u={Apple:25,Apricot:18,Avocado:8,Blueberry:8,"Citrus (Hardpeel)":25,"Citrus (Softpeel)":25,Fig:30,"Grape (Table)":25,"Grape (Wine)":25,"Macadamia Nut":10,Mango:30,Nectarine:18,Olive:10,Orange:25,"Pecan Nut":10,Peach:18,Pear:25,Persimmon:20,Plum:18,Pomegranate:30,Rooibos:5},v={Calving:["Cattle (Extensive)","Cattle (Feedlot)","Cattle (Stud)","Dairy"],Hatching:["Chicken (Broilers)","Chicken (Layers)","Ostrich"],Kidding:["Game","Goats"],Foaling:["Horses"],Farrowing:["Pigs"],Lambing:["Sheep (Extensive)","Sheep (Feedlot)","Sheep (Stud)"]},w=a("round");return j.validates({assetType:{required:!0,inclusion:{"in":i.keys(j.assetCommodities)}},commodityType:{required:!0,inclusion:{"in":function(a,b){return l(b.assetType)}}},data:{required:!0,object:!0},name:{required:!0,length:{min:1,max:255}},region:{required:!0,object:!0}}),j}]);var sdkModelFarm=angular.module("ag.sdk.model.farm",["ag.sdk.library","ag.sdk.model.base"]);sdkModelFarm.factory("Farm",["inheritModel","Model","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e){function f(a){b.Base.apply(this,arguments),this.data=a&&a.data||{},e.isUndefined(a)||0===arguments.length||(this.id=a.id||a.$id,this.name=a.name,this.organizationId=a.organizationId,this.organization=a.organization)}return a(f,b.Base),f.validates({name:{required:!0,length:{min:1,max:255}},organizationId:{required:!0,numeric:!0}}),f}]);var sdkModelFarmValuationDocument=angular.module("ag.sdk.model.farm-valuation",["ag.sdk.model.asset","ag.sdk.model.document"]);sdkModelFarmValuationDocument.factory("FarmValuation",["Asset","computedProperty","Document","inheritModel","privateProperty",function(a,b,c,d){function e(){c.apply(this,arguments),this.docType="farm valuation"}return d(e,c),e.validates({author:{required:!0,length:{min:1,max:255}},docType:{required:!0,equal:{to:"farm valuation"}},organizationId:{required:!0,numeric:!0}}),e}]);var sdkModelFinancial=angular.module("ag.sdk.model.financial",["ag.sdk.library","ag.sdk.model.base","ag.sdk.utilities"]);sdkModelFinancial.factory("Financial",["$filter","inheritModel","Model","privateProperty","underscore",function(a,b,c,d,e){function f(a){c.Base.apply(this,arguments),this.data=a&&a.data||{},this.data.assets=this.data.assets||{},this.data.liabilities=this.data.liabilities||{},this.data.ratios=this.data.ratios||{},d(this,"recalculate",function(){return h(this)}),e.isUndefined(a)||0===arguments.length||(this.month=a.month,this.year=a.year,this.id=a.id||a.$id,this.organizationId=a.organizationId,this.organization=a.organization)}function g(a,b){a=e.isArray(a)?a:[a],b=e.isArray(b)?b:[b];var c=e.reduce(a,function(a,b){return a+(b||0)},0),d=e.reduce(b,function(a,b){return a+(b||0)},0);return d?i(c/d):0}function h(a){a.data.totalAssets=i(e.chain(a.data.assets).values().flatten().reduce(function(a,b){return a+(b.estimatedValue||0)},0).value()),a.data.totalLiabilities=i(e.chain(a.data.liabilities).values().flatten().reduce(function(a,b){return a+(b.estimatedValue||0)},0).value()),a.netWorth=i(a.data.totalAssets-a.data.totalLiabilities),a.grossProfit=i((a.data.productionIncome||0)-(a.data.productionExpenditure||0)),a.data.ebitda=i(a.grossProfit+(a.data.otherIncome||0)-(a.data.otherExpenditure||0)),a.data.ebit=i(a.data.ebitda-(a.data.depreciationAmortization||0)),a.data.ebt=i(a.data.ebit-(a.data.interestPaid||0)),a.netProfit=i(a.data.ebt-(a.data.taxPaid||0)),a.data.ratios={debt:g(a.data.totalLiabilities,a.data.totalAssets),debtToTurnover:g(a.data.totalLiabilities,[a.data.productionIncome,a.data.otherIncome]),gearing:g(a.data.totalLiabilities,a.netWorth),inputOutput:g(a.data.productionIncome,a.data.productionExpenditure),interestCover:g(a.grossProfit,a.data.interestPaid),interestToTurnover:g(a.data.interestPaid,[a.data.productionIncome,a.data.otherIncome]),productionCost:g(a.data.productionExpenditure,a.data.productionIncome),returnOnInvestment:g(a.grossProfit,a.data.totalAssets)},a.$dirty=!0}b(f,c.Base);var i=a("round");return f.validates({organizationId:{required:!0,numeric:!0},month:{numeric:!0,range:{from:1,to:12}},year:{numeric:!0,range:{from:1e3,to:9999}}}),f}]);var sdkModelLegalEntity=angular.module("ag.sdk.model.legal-entity",["ag.sdk.library","ag.sdk.model.base","ag.sdk.model.asset","ag.sdk.model.liability"]);sdkModelLegalEntity.factory("LegalEntity",["Asset","inheritModel","Liability","Model","readOnlyProperty","underscore",function(a,b,c,d,e,f){function g(b){d.Base.apply(this,arguments),this.data=b&&b.data||{},f.isUndefined(b)||0===arguments.length||(this.addressCity=b.addressCity,this.addressCode=b.addressCode,this.addressDistrict=b.addressDistrict,this.addressStreet=b.addressStreet,this.email=b.email,this.fax=b.fax,this.id=b.id||b.$id,this.mobile=b.mobile,this.name=b.name,this.organizationId=b.organizationId,this.registrationNumber=b.registrationNumber,this.telephone=b.telephone,this.type=b.type,this.uuid=b.uuid,this.assets=f.map(b.assets,function(b){return a.newCopy(b)}),this.liabilities=f.map(b.liabilities,function(a){return c.newCopy(a)}))}return b(g,d.Base),e(g,"legalEntityTypes",["Individual","Sole Proprietary","Joint account","Partnership","Close Corporation","Private Company","Public Company","Trust","Non-Profitable companies","Cooperatives","In- Cooperatives","Other Financial Intermediaries"]),g.validates({addressCity:{length:{min:1,max:255}},addressCode:{length:{min:1,max:255}},addressDistrict:{length:{min:1,max:255}},addressStreet:{length:{min:1,max:255}},email:{required:!0,format:{email:!0}},fax:{format:{telephone:!0}},mobile:{format:{telephone:!0}},name:{required:!0,length:{min:1,max:255}},organizationId:{required:!0,numeric:!0},registrationNumber:{length:{min:1,max:255}},telephone:{format:{telephone:!0}},type:{required:!0,inclusion:{"in":g.legalEntityTypes}},uuid:{format:{uuid:!0}}}),g}]);var sdkModelLiability=angular.module("ag.sdk.model.liability",["ag.sdk.library","ag.sdk.utilities","ag.sdk.model.base"]);sdkModelLiability.factory("Liability",["$filter","computedProperty","inheritModel","Model","moment","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e,f,g,h){function i(){return{opening:0,repayment:{},withdrawal:0,balance:0,interest:0,closing:0}}function j(a,b,c){for(;b.length<=c;)b.push(i());k(a,b)}function k(a,b){var c=e(a.startDate,"YYYY-MM-DD").month(),d=a.paymentMonths,f=p[a.frequency]>12?p[a.frequency]/12:1;h.each(b,function(e,g){var i=(g+c)%12;if(e.opening=0===g?a.getLiabilityOpening():b[g-1].closing,"once"===this.frequency&&0===g||a.installmentPayment>0&&h.contains(d,i)){var j="once"===this.frequency?e.opening:a.installmentPayment*f;e.opening>0&&(e.repayment.bank=e.opening<=j?e.opening:j)}var k=h.reduce(e.repayment,function(a,b){return a+(b||0)},0);e.balance=t(e.opening-k+e.withdrawal<=0?0:e.opening-k+e.withdrawal),e.interest=t(a.interestRate/12*e.balance/100),e.closing=t(0===e.balance?0:e.balance+e.interest)})}function l(a){d.Base.apply(this,arguments),this.data=a&&a.data||{},b(this,"title",function(){return this.name||this.category}),b(this,"paymentMonths",function(){var a=p[this.frequency],b=e(this.offsetDate,"YYYY-MM-DD").month();return h.range(b,b+12,12>a?12/a:1).map(function(a){return a%12}).sort(function(a,b){return a-b})}),b(this,"offsetDate",function(){return this.startDate&&this.openingDate?e(this.startDate).isBefore(this.openingDate)?this.openingDate:this.startDate:this.startDate?this.startDate:this.openingDate}),f(this,"liabilityInMonth",function(a){var b=e(this.offsetDate,"YYYY-MM-DD"),c=e(a,"YYYY-MM-DD"),d=c.diff(b,"months"),f=angular.copy(this.data.monthly||[]);return j(this,f,d),f[d]||i()}),f(this,"balanceInMonth",function(a){return this.liabilityInMonth(a).closing||0}),b(this,"currentBalance",function(){return"rent"!==this.type?this.balanceInMonth(e().startOf("month")):0}),f(this,"recalculate",function(){this.data.monthly=this.data.monthly||[],k(this,this.data.monthly)}),f(this,"resetWithdrawalAndRepayments",function(){this.data.monthly=[]}),f(this,"resetRepayments",function(){h.each(this.data.monthly,function(a){a.repayment={}}),k(this,this.data.monthly)}),f(this,"resetWithdrawalsInRange",function(a,b){var c=e(this.offsetDate,"YYYY-MM-DD"),d=e(a,"YYYY-MM-DD").diff(c,"months"),f=e(b,"YYYY-MM-DD").diff(c,"months");this.data.monthly=this.data.monthly||[],d=0>d?0:d,f=f>this.data.monthly.length?this.data.monthly.length-1:f;for(var g=d;f>g;g++)this.data.monthly[g].withdrawal=0;k(this,this.data.monthly)}),f(this,"addRepaymentInMonth",function(a,b,c){var d=e(this.offsetDate,"YYYY-MM-DD"),f=e(b,"YYYY-MM-DD"),g=f.diff(d,"months");c=c||"bank";var i=a;if(g>-1){this.data.monthly=this.data.monthly||[],j(this,this.data.monthly,g);var l=this.data.monthly[g],m=h.reduce(l.repayment,function(a,b){return a+(b||0)},0),n=l.opening+l.withdrawal-m,o=a>=n?n:a;i=t(a-o),l.repayment[c]=l.repayment[c]||0,l.repayment[c]+=o,k(this,this.data.monthly)}return i}),f(this,"setRepaymentInMonth",function(a,b,c){var d=e(this.offsetDate,"YYYY-MM-DD"),f=e(b,"YYYY-MM-DD"),g=f.diff(d,"months");c=c||"bank";var i=a;if(g>-1){this.data.monthly=this.data.monthly||[],j(this,this.data.monthly,g);var l=this.data.monthly[g],m=h.reduce(l.repayment,function(a,b,d){return a+(d===c?0:b||0)},0),n=l.opening+l.withdrawal-m,o=a>=n?n:a;i=t(a-o),l.repayment[c]=o,k(this,this.data.monthly)}return i}),f(this,"addWithdrawalInMonth",function(a,b){var c=e(this.offsetDate,"YYYY-MM-DD"),d=e(b,"YYYY-MM-DD"),f=d.diff(c,"months");if(f>-1){this.data.monthly=this.data.monthly||[],j(this,this.data.monthly,f);var g=this.data.monthly[f],i=a+g.withdrawal,l=g.opening-h.reduce(g.repayment,function(a,b){return a+(b||0)},0),m=this.creditLimit>0?Math.min(Math.max(0,this.creditLimit-l),i):i,n=t(i-m);g.withdrawal=m,k(this,this.data.monthly)}return n}),f(this,"setWithdrawalInMonth",function(a,b){var c=e(this.offsetDate,"YYYY-MM-DD"),d=e(b,"YYYY-MM-DD"),f=d.diff(c,"months");if(f>-1){this.data.monthly=this.data.monthly||[],j(this,this.data.monthly,f);var g=this.data.monthly[f],i=g.opening-h.reduce(g.repayment,function(a,b){return a+(b||0)},0),l=this.creditLimit>0?Math.min(Math.max(0,this.creditLimit-i),a):a,m=t(a-l);g.withdrawal=l,k(this,this.data.monthly)}return m}),f(this,"liabilityInRange",function(a,b){var c=e(this.offsetDate,"YYYY-MM-DD"),d=e(a,"YYYY-MM-DD"),f=e(b,"YYYY-MM-DD"),g=d.diff(c,"months"),k=f.diff(c,"months"),l=0>g?Math.min(f.diff(d,"months"),Math.abs(g)):0,m=angular.copy(this.data.monthly||[]);return j(this,m,k),h.range(l).map(i).concat(m.slice(g+l,k))}),f(this,"totalLiabilityInRange",function(a,b){return h.reduce(this.liabilityInRange(a,b),function(a,b){return a+("number"==typeof b.repayment?b.repayment:h.reduce(b.repayment,function(a,b){return a+(b||0)},0))},0)}),f(this,"getLiabilityOpening",function(){return e(this.startDate).isBefore(this.openingDate)&&!h.isUndefined(this.openingBalance)?this.openingBalance:this.amount}),h.isUndefined(a)||0===arguments.length||(this.id=a.id||a.$id,this.uuid=a.uuid,this.merchantUuid=a.merchantUuid,this.name=a.name,this.type=a.type,this.category=a.category,this.openingBalance=a.openingBalance||0,this.installmentPayment=a.installmentPayment,this.interestRate=a.interestRate||0,this.creditLimit=a.creditLimit,this.frequency=a.frequency,this.startDate=a.startDate&&e(a.startDate).format("YYYY-MM-DD"),this.endDate=a.endDate&&e(a.endDate).format("YYYY-MM-DD"),this.openingDate=a.openingDate&&e(a.openingDate).format("YYYY-MM-DD")||this.startDate,this.amount=a.amount||this.openingBalance,this.merchant=a.merchant)}function m(a,b){return"rent"===b.type}function n(a,b){return"other"===b.type}function o(a,b){return!h.isEmpty(l.liabilityCategories[b.type])}var p={monthly:12,"bi-monthly":24,quarterly:4,"bi-yearly":2,yearly:1},q={"short-term":"Short-term","medium-term":"Medium-term","long-term":"Long-term","production-credit":"Production Credit",rent:"Rent"},r=["short-term","medium-term","long-term","rent"],s=["production-credit","other"],t=a("round");return c(l,d.Base),g(l,"frequencyTypes",{once:"One Time","bi-monthly":"Bi-Monthly",monthly:"Monthly",quarterly:"Quarterly","bi-yearly":"Bi-Yearly",yearly:"Yearly"}),g(l,"frequencyTypesWithCustom",h.extend({custom:"Custom"},l.frequencyTypes)),f(l,"getFrequencyTitle",function(a){return l.frequencyTypesWithCustom[a]||""}),g(l,"liabilityTypes",q),g(l,"liabilityTypesWithOther",h.extend({other:"Other"},l.liabilityTypes)),f(l,"getTypeTitle",function(a){return l.liabilityTypesWithOther[a]||""}),g(l,"liabilityCategories",{"long-term":["Bonds","Loans","Other"],"medium-term":["Terms Loans","Instalment Sale Credit","Leases","Other"],"short-term":["Bank","Co-operative","Creditors","Income Tax","Bills Payable","Portion of Term Commitments","Other"],"production-credit":["Off Taker","Input Supplier","Input Financing"]}),l.validates({amount:{requiredIf:function(a,b,c){return!m(a,b,c)},numeric:!0},openingBalance:{required:!0,numeric:!0},installmentPayment:{requiredIf:function(a,b){return h.contains(r,b.type)&&"production-credit"!==b.type&&!angular.isNumber(b.interestRate)},range:{from:0},numeric:!0},interestRate:{required:!0,range:{from:0,to:100},numeric:!0},creditLimit:{requiredIf:function(a,b){return"production-credit"===b.type&&"Input Financing"===b.data.category||"production-credit"!==b.type&&!angular.isNumber(b.installmentPayment)},range:{from:0},numeric:!0},merchantUuid:{requiredIf:function(a,b,c){return!n(a,b,c)},format:{uuid:!0}},frequency:{required:!0,inclusion:{"in":h.keys(l.frequencyTypesWithCustom)}},type:{required:!0,inclusion:{"in":h.keys(l.liabilityTypesWithOther)}},category:{requiredIf:o,inclusion:{"in":function(a,b){return l.liabilityCategories[b.type]}}},data:{required:!0,object:!0},name:{requiredIf:function(a,b){return h.contains(s,b.type)},length:{min:1,max:255}},startDate:{required:!0,format:{date:!0}},openingDate:{required:!1,format:{date:!0}},endDate:{requiredIf:function(a,b,c){return m(a,b,c)||"custom"===b.type},format:{date:!0}}}),l}]);var sdkModelProductionSchedule=angular.module("ag.sdk.model.production-schedule",["ag.sdk.library","ag.sdk.utilities","ag.sdk.model"]);sdkModelProductionSchedule.factory("ProductionGroup",["$filter","computedProperty","EnterpriseBudgetBase","inheritModel","moment","privateProperty","ProductionSchedule","underscore",function(a,b,c,d,e,f,g,h){function i(a){c.apply(this,arguments),this.data.details=this.data.details||{},this.productionSchedules=[],f(this,"addProductionSchedule",function(a){(h.isUndefined(this.startDate)||e(a.startDate).isBefore(this.startDate))&&(this.startDate=e(a.startDate).format("YYYY-MM-DD")),(h.isUndefined(this.endDate)||e(a.endDate).isAfter(this.endDate))&&(this.endDate=e(a.endDate).format("YYYY-MM-DD")),this.productionSchedules.push(a),this.data.details.size=m(h.reduce(this.productionSchedules,function(a,b){return a+b.allocatedSize},0),2),this.recalculate()}),f(this,"adjustCategory",function(a,b,c,d){return j(this,a,b,c,d)}),f(this,"getCategoryOptions",function(a){return h.chain(this.productionSchedules).map(function(b){return b.getCategoryOptions(a)}).reduce(function(a,b){return h.extend(a||{},b)},{}).value()}),f(this,"recalculate",function(){l(this)}),b(this,"allocatedSize",function(){return m(this.data.details.size||0,2)}),b(this,"numberOfMonths",function(){return e(this.endDate).diff(this.startDate,"months")}),h.isUndefined(a)||0===arguments.length||(this.endDate=a.endDate&&e(a.endDate).format("YYYY-MM-DD"),this.startDate=a.startDate&&e(a.startDate).format("YYYY-MM-DD"),h.each(a.productionSchedules,this.addProductionSchedule,this))}function j(a,b,c,d,f){var g=a.getCategory(b,c,d),i=0;if(g&&!h.isUndefined(g[f])){h.contains(["valuePerLSU","pricePerUnit","quantityPerLSU","quantityPerHa"],f)?i=m(h.reduce(g.categories,function(a,b){return a+b[f]},0)/g.categories.length,2):h.contains(["value","quantity"],f)?i=m(h.reduce(g.categories,function(a,b){return a+b[f]},0),2):"valuePerHa"===f&&(i=m(g.value/a.allocatedSize,2));var j=h.reject(a.productionSchedules,function(a){return h.isUndefined(a.getCategory(b,c,d))});if("schedule"!==f){var l=100/i*g[f],n=g[f];h.each(j,function(a,e,g){var i=a.getCategory(b,c,d);i[f]=h.isFinite(l)&&0!=i[f]?i[f]/100*l:e<g.length-1?i[f]/g.length:n,n=m(n-a.adjustCategory(b,c,d,f),2)})}else if("schedule"===f){var o=h.reduce(g.schedule,function(a,b,c){return a[c]=g.value/100*b,a},k(a.numberOfMonths));h.each(g.valuePerMonth,function(f,i){var k=h.chain(g.categories).filter(function(a){return i>=a.offset&&i<a.offset+a.valuePerMonth.length}).size();h.each(j,function(g){var h=e(g.startDate).diff(a.startDate,"months"),j=g.getCategory(b,c,d);i>=h&&i<h+j.valuePerMonth.length&&(j.valuePerMonth[i-h]=0==f?o[i]/k:o[i]*(j.valuePerMonth[i-h]/f))})}),h.each(j,function(a){var e=a.getCategory(b,c,d);e.value=h.reduce(e.valuePerMonth,function(a,b){return a+(b||0)},0),e.schedule=h.map(e.valuePerMonth,function(a){return e.value>0?m(100/e.value*a,2):0}),a.adjustCategory(b,c,d,f)})}}}function k(a){return h.range(a).map(function(){return 0})}function l(a){a.data.sections=[],angular.forEach(a.productionSchedules,function(b){var c=e(b.startDate).diff(a.startDate,"months");b.recalculate(),angular.forEach(b.data.sections,function(d){if(b.data.details.applyEstablishmentCosts||d.costStage===b.defaultCostStage){angular.forEach(d.productCategoryGroups,function(e){angular.forEach(e.productCategories,function(f){var g=a.addCategory(d.code,e.name,f.code,d.costStage);g.per=f.per,g.categories=g.categories||[],g.categories.push(h.extend({offset:c,size:b.allocatedSize},f)),g.valuePerMonth=h.reduce(f.valuePerMonth,function(a,b,d){return a[d+c]=m(a[d+c]+b),a},g.valuePerMonth||k(a.numberOfMonths)),g.value=m(h.reduce(g.valuePerMonth,function(a,b){return a+b},0),2),g.quantityPerMonth=h.reduce(f.quantityPerMonth,function(a,b,d){return a[d+c]=m(a[d+c]+b),a},g.quantityPerMonth||k(a.numberOfMonths)),g.quantity=m(h.reduce(g.quantityPerMonth,function(a,b){return a+b},0),2),g.pricePerUnit=m(h.reduce(g.categories,function(a,b){return a+b.pricePerUnit},0)/g.categories.length,2),g.schedule=h.reduce(g.valuePerMonth,function(a,b,c){return a[c]=m(100/g.value*b,2),a},k(a.numberOfMonths)),"livestock"==b.type?(g.quantityPerLSU=m(h.reduce(g.categories,function(a,b){return a+b.quantityPerLSU},0)/g.categories.length,2),g.valuePerLSU=m(h.reduce(g.categories,function(a,b){return a+b.valuePerLSU},0)/g.categories.length,2)):g.quantityPerHa=m(h.reduce(g.categories,function(a,b){return a+b.quantityPerHa},0)/g.categories.length,2),"EXP"===d.code&&(g.valuePerHa=m(g.value/a.allocatedSize,2))});var f=a.getGroup(d.code,e.name,d.costStage);f&&(f.total.value=h.reduce(f.productCategories,function(a,b){return a+b.value},0),f.total.valuePerMonth=h.chain(f.productCategories).pluck("valuePerMonth").reduce(function(a,b){return a?h.map(b,function(b,c){return a[c]+b}):angular.copy(b)}).value(),"livestock"==b.type&&(f.total.valuePerLSU=h.reduce(f.productCategories,function(a,b){return a+b.valuePerLSU},0)))});var e=a.getSection(d.code,d.costStage);e&&(e.total.value=h.reduce(e.productCategoryGroups,function(a,b){return a+b.total.value},0),e.total.valuePerMonth=h.chain(e.productCategoryGroups).pluck("total").pluck("valuePerMonth").reduce(function(a,b){return a?h.map(b,function(b,c){return a[c]+b}):angular.copy(b)}).value(),"livestock"==b.type&&(e.total.valuePerLSU=h.reduce(e.productCategoryGroups,function(a,b){return a+b.total.valuePerLSU},0)),a.data.details.grossProfit+="INC"==e.code?a.data.details.grossProfit+e.total.value:a.data.details.grossProfit-e.total.value)}})}),a.data.details.grossProfit=h.reduce(a.data.sections,function(a,b){return"INC"==b.code?a+b.total.value:a-b.total.value},0)}d(i,c);var m=a("round");return i}]),sdkModelProductionSchedule.factory("ProductionSchedule",["$filter","computedProperty","EnterpriseBudget","EnterpriseBudgetBase","inheritModel","moment","privateProperty","readOnlyProperty","underscore",function(a,b,c,d,e,f,g,h,i){function j(a){d.apply(this,arguments),this.data.details=this.data.details||{},g(this,"setDate",function(a){a=f(a),a.date(1),this.startDate=a.format("YYYY-MM-DD");var b=12/Math.floor(12/this.numberOfAllocatedMonths),c=this.budget?b*Math.floor((a.month()-this.budget.cycleStart)/b)+this.budget.cycleStart:a.month(),d=f([a.year()]).add(c,"M");if(this.startDate=d.format("YYYY-MM-DD"),this.endDate=d.add(1,"y").format("YYYY-MM-DD"),this.asset){var e=this.asset.data.establishedDate?f(this.startDate).diff(this.asset.data.establishedDate,"years"):0;e!=this.data.details.assetAge&&(this.data.details.assetAge=e,this.recalculate())}}),g(this,"setAsset",function(a){this.asset=i.omit(a,["liabilities","productionSchedules"]),this.assetId=this.asset.id||this.asset.$id,this.type="cropland"===a.type?"crop":"permanent crop"===a.type?"horticulture":"livestock",this.data.details.fieldName=this.asset.data.fieldName,this.data.details.assetAge=this.asset.data.establishedDate?f(this.startDate).diff(this.asset.data.establishedDate,"years"):0,a.data.crop&&(this.data.details.commodity=a.data.crop),"livestock"===this.type&&(this.data.details.pastureType=this.asset.data.irrigated?"pasture":"grazing",this.budget&&this.budget.data.details.stockingDensity&&this.setLivestockStockingDensity(this.budget.data.details.stockingDensity[this.data.details.pastureType])),this.setSize(this.asset.data.size)}),g(this,"setBudget",function(a){this.budget=c["new"](a),this.budgetUuid=this.budget.uuid,this.type=this.budget.assetType,this.data.budget=this.budget,this.data.details=i.extend(this.data.details,{applyEstablishmentCosts:!1,commodity:this.budget.commodityType,grossProfit:0}),"livestock"===this.type&&(this.data.details=i.extend(this.data.details,{calculatedLSU:0,grossProfitPerLSU:0,herdSize:this.budget.data.details.herdSize||0,stockingDensity:0,multiplicationFactor:0})),this.data.details.pastureType&&this.budget.data.details.stockingDensity&&this.setLivestockStockingDensity(this.budget.data.details.stockingDensity[this.data.details.pastureType]),this.recalculate(),this.startDate&&this.setDate(this.startDate)}),g(this,"setLivestockStockingDensity",function(a){"livestock"==this.type&&this.data.details.stockingDensity!=a&&(this.data.details.stockingDensity=a,this.setSize(this.allocatedSize))}),g(this,"setSize",function(a){this.data.details.size=a,"livestock"==this.type?(this.data.details.calculatedLSU=this.data.details.stockingDensity?this.allocatedSize/this.data.details.stockingDensity:0,this.data.details.multiplicationFactor=m(this.data.details.calculatedLSU?(this.data.details.stockingDensity?this.allocatedSize/this.data.details.stockingDensity:0)/this.data.details.calculatedLSU:0,2),this.budget&&(this.data.details.herdSize=this.budget.data.details.herdSize*this.data.details.multiplicationFactor,this.data.details.grossProfit=this.budget.data.details.grossProfit*this.data.details.multiplicationFactor,this.data.details.grossProfitPerLSU=this.data.details.calculatedLSU?this.data.details.grossProfit/this.data.details.calculatedLSU:0)):this.budget&&(this.data.details.grossProfit=this.budget.data.details.grossProfit*this.data.details.size),this.recalculate()}),g(this,"adjustCategory",function(a,b,c,d){return k(this,a,b,c,d)}),g(this,"recalculate",function(){l(this)}),b(this,"scheduleKey",function(){return(this.budgetUuid?this.budgetUuid+"-":"")+(this.data.details.fieldName?this.data.details.fieldName+"-":"")+(this.startDate?f(this.startDate).unix()+"-":"")+(this.endDate?f(this.endDate).unix():"")
},{enumerable:!0}),b(this,"assetType",function(){return this.budget?this.budget.assetType:this.type}),b(this,"commodityType",function(){return this.budget?this.budget.commodityType:this.data.details.commodity}),b(this,"allocatedSize",function(){return m(this.data.details.size||0,2)}),b(this,"title",function(){return this.allocatedSize+"ha "+(this.commodityType?"of "+this.commodityType:"")+(this.startDate?" starting "+f(this.startDate).format("MMM YYYY"):"")}),b(this,"numberOfMonths",function(){return f(this.endDate).diff(this.startDate,"months")}),g(this,"getAllocationIndex",function(a,b){return this.budget?this.budget.getAllocationIndex(a,b):0}),g(this,"getLastAllocationIndex",function(a,b){return this.budget?this.budget.getLastAllocationIndex(a,b):this.numberOfMonths}),g(this,"getAllocationMonth",function(a,b){return f(this.startDate).add(this.getAllocationIndex(a,b),"M")}),g(this,"getLastAllocationMonth",function(a,b){return f(this.startDate).add(this.getLastAllocationIndex(a,b),"M")}),b(this,"numberOfAllocatedMonths",function(){return this.budget?this.budget.numberOfAllocatedMonths:this.numberOfMonths}),b(this,"income",function(){return i.findWhere(this.data.sections,{code:"INC",costStage:this.defaultCostStage})}),b(this,"expenses",function(){return i.findWhere(this.data.sections,{code:"EXP",costStage:this.defaultCostStage})}),i.isUndefined(a)||0===arguments.length||(this.assetId=a.assetId,this.budgetUuid=a.budgetUuid,this.type=a.type,this.endDate=a.endDate&&f(a.endDate).format("YYYY-MM-DD"),this.id=a.id||a.$id,this.organizationId=a.organizationId,this.startDate=a.startDate&&f(a.startDate).format("YYYY-MM-DD"),this.organization=a.organization,a.asset&&this.setAsset(a.asset),(this.data.budget||a.budget)&&this.setBudget(this.data.budget||a.budget))}function k(a,b,c,d,e){var f=a.getCategory(b,c,d),g=a.budget.getCategory(b,c,d);return f&&g?("value"===e?(g.value=f.value/("livestock"==a.type?a.data.details.multiplicationFactor:a.allocatedSize),"Total"===g.unit?(g.pricePerUnit=g.value,f.pricePerUnit=g.value):(g.quantity=g.value/g.pricePerUnit,f.quantity=f.value/f.pricePerUnit),f.value=m(g.value*("livestock"==a.type?a.data.details.multiplicationFactor:a.allocatedSize),2)):"valuePerHa"===e?(g.value=m(f.valuePerHa,2),"Total"===g.unit&&(g.pricePerUnit=g.value,f.pricePerUnit=g.value),g.quantity=m(g.value/g.pricePerUnit,2),f.value=m(g.value*a.allocatedSize,2),f.valuePerHa=g.value,f.quantity=m(f.value/f.pricePerUnit,2)):"valuePerLSU"===e?(g.valuePerLSU=m(f.valuePerLSU,2),g.pricePerUnit=g.valuePerLSU*a.budget.getConversionRate(g.name),g.value=(g.pricePerUnit||0)*(g.quantity||0),f.value=m(g.value*a.data.details.multiplicationFactor,2),f.valuePerLSU=m(g.valuePerLSU*a.data.details.multiplicationFactor,2),f.quantity=m(f.value/f.pricePerUnit,2)):"quantityPerHa"===e?(g.quantity=f.quantityPerHa,g.value=(g.pricePerUnit||0)*(g.quantity||0),f.value=m(g.value*a.allocatedSize,2),f.quantity=m(f.value/f.pricePerUnit,2),f.quantityPerHa=g.quantity):"quantityPerLSU"===e?(g.quantity=f.quantityPerLSU,g.value=(g.pricePerUnit||0)*(g.quantity||0),f.value=m(g.value*a.data.details.multiplicationFactor,2),f.quantity=m(f.value/f.pricePerUnit,2),f.quantityPerLSU=g.quantity):"quantity"===e?(g.quantity=f.quantity/("livestock"==a.type?a.data.details.multiplicationFactor:a.allocatedSize),g.value=(g.pricePerUnit||0)*(g.quantity||0),f.value=m(g.value*("livestock"==a.type?a.data.details.multiplicationFactor:a.allocatedSize),2),f.quantity=m(f.value/f.pricePerUnit,2)):"pricePerUnit"===e?(g.pricePerUnit=f.pricePerUnit,g.value=(g.pricePerUnit||0)*(g.quantity||0),f.value=m(g.value*("livestock"==a.type?a.data.details.multiplicationFactor:a.allocatedSize),2),f.pricePerUnit=g.pricePerUnit):"stock"===e?g.stock=f.stock:"schedule"===e&&(g.schedule=a.budget.unshiftMonthlyArray(f.schedule),g.value=f.value/("livestock"==a.type?a.data.details.multiplicationFactor:a.allocatedSize),"Total"===g.unit?(g.pricePerUnit=g.value,f.pricePerUnit=g.value):(g.quantity=g.value/g.pricePerUnit,f.quantity=f.value/f.pricePerUnit),g.value=(g.pricePerUnit||0)*(g.quantity||0)/100*i.reduce(g.schedule,function(a,b){return a+(b||0)},0),g.valuePerMonth=i.map(g.schedule,function(a){return g.value/100*a}),f.valuePerMonth=i.map(a.budget.shiftMonthlyArray(g.valuePerMonth),function(b){return b*("livestock"==a.type?a.data.details.multiplicationFactor:a.allocatedSize)}),f.value=m(i.reduce(f.valuePerMonth,function(a,b){return a+b},0),2)),"livestock"==a.type&&(g.valuePerLSU=(g.pricePerUnit||0)/a.budget.getConversionRate(g.name)),"EXP"===b&&(f.valuePerHa=g.value),a.$dirty=!0,f[e]):void 0}function l(a){a.budget&&(a.budget.recalculate(),a.data.sections=[],a.data.details.grossProfit=0,angular.forEach(a.budget.data.sections,function(b){if(a.data.details.applyEstablishmentCosts||b.costStage===a.defaultCostStage){angular.forEach(b.productCategoryGroups,function(c){angular.forEach(c.productCategories,function(d){var e=a.addCategory(b.code,c.name,d.code,b.costStage);e.pricePerUnit=d.pricePerUnit,"livestock"==a.type?(e.valuePerLSU+=m(d.valuePerLSU*a.data.details.multiplicationFactor,2),e.quantityPerLSU=d.quantity,"INC-LSS"===c.code&&(e.stock=d.stock||(d.name==a.getRepresentativeAnimal()?a.data.details.herdSize:0))):e.quantityPerHa=d.quantity,"EXP"===b.code&&(e.valuePerHa=d.value),e.schedule=a.budget.getShiftedSchedule(d.schedule),e.valuePerMonth=i.map(a.budget.shiftMonthlyArray(d.valuePerMonth),function(b){return m(b*("livestock"==a.type?a.data.details.multiplicationFactor:a.allocatedSize),2)}),e.quantityPerMonth=i.map(a.budget.shiftMonthlyArray(d.quantityPerMonth),function(b){return m(b*("livestock"==a.type?a.data.details.multiplicationFactor:a.allocatedSize),2)}),e.value=m(i.reduce(e.valuePerMonth,function(a,b){return a+b},0),2),e.quantity=m(i.reduce(e.quantityPerMonth,function(a,b){return a+b},0),2)});var d=a.getGroup(b.code,c.name,b.costStage);d&&(d.total.value=i.reduce(d.productCategories,function(a,b){return a+b.value},0),d.total.valuePerMonth=i.chain(d.productCategories).pluck("valuePerMonth").reduce(function(a,b){return a?i.map(b,function(b,c){return a[c]+b}):angular.copy(b)}).value(),d.total.quantityPerMonth=i.chain(d.productCategories).pluck("quantityPerMonth").reduce(function(a,b){return a?i.map(b,function(b,c){return a[c]+b}):angular.copy(b)}).value(),"livestock"==a.type&&(d.total.valuePerLSU=i.reduce(d.productCategories,function(a,b){return a+b.valuePerLSU},0)))});var c=a.getSection(b.code,b.costStage);c&&(c.total.value=i.reduce(c.productCategoryGroups,function(a,b){return a+b.total.value},0),c.total.valuePerMonth=i.chain(c.productCategoryGroups).pluck("total").pluck("valuePerMonth").reduce(function(a,b){return a?i.map(b,function(b,c){return a[c]+b}):angular.copy(b)}).value(),c.total.quantityPerMonth=i.chain(c.productCategoryGroups).pluck("total").pluck("quantityPerMonth").reduce(function(a,b){return a?i.map(b,function(b,c){return a[c]+b}):angular.copy(b)}).value(),"livestock"==a.type&&(c.total.valuePerLSU=i.reduce(c.productCategoryGroups,function(a,b){return a+b.total.valuePerLSU},0)),a.data.details.grossProfit="INC"==c.code?a.data.details.grossProfit+c.total.value:a.data.details.grossProfit-c.total.value)}}),"livestock"==a.type&&(a.data.details.grossProfitPerLSU=a.data.details.calculatedLSU?a.data.details.grossProfit/a.data.details.calculatedLSU:0))}var m=a("round");return e(j,d),h(j,"productionScheduleTypes",{crop:"Crop",horticulture:"Horticulture",livestock:"Livestock"}),h(j,"allowedLandUse",["Conservation","Cropland","Grazing","Horticulture (Perennial)","Irrigated Cropland","Planted Pastures"]),h(j,"allowedAssets",["cropland","pasture","permanent crop"]),g(j,"getTypeTitle",function(a){return j.productionScheduleTypes[a]||""}),j.validates({assetId:{required:!0,numeric:!0},budget:{required:!0,object:!0},budgetUuid:{required:!0,format:{uuid:!0}},data:{required:!0,object:!0},endDate:{required:!0,format:{date:!0}},organizationId:{required:!0,numeric:!0},startDate:{required:!0,format:{date:!0}}}),j}]);var sdkModelErrors=angular.module("ag.sdk.model.errors",["ag.sdk.library","ag.sdk.model.base"]);sdkModelErrors.factory("Errorable",["privateProperty","underscore",function(a,b){function c(){var c={};a(c,"count",0),a(c,"countFor",function(a){return b.isUndefined(a)?c.count:c[a]?c[a].length:0}),a(c,"add",function(a,d){b.isUndefined(c[a])&&(c[a]=[]),b.contains(c[a],d)===!1&&(c[a].push(d),c.count++)}),a(c,"clear",function(a,d){if(b.isUndefined(d)===!1)b.contains(c[a],d)&&(c[a]=b.without(c[a],d),c.count--,0===c[a].length&&delete c[a]);else{var e=[];b.isArray(a)&&(e=a),b.isString(a)&&e.push(a),b.isUndefined(a)&&(e=b.keys(c)),b.each(e,function(a){if(b.isUndefined(c[a])===!1){var d=c[a].length;delete c[a],c.count-=d}})}}),a(this,"__$errors",c)}return c}]);var sdkModelStore=angular.module("ag.sdk.model.store",["ag.sdk.library","ag.sdk.model.base"]);sdkModelStore.factory("Storable",["computedProperty","privateProperty",function(a,b){function c(){var a={};b(a,"set",function(a,b){b&&(a.$complete=b.$complete===!0,a.$dirty=b.$dirty===!0,a.$id=b.$id,a.$local=b.$local===!0,a.$saved=b.$saved===!0,a.$uri=b.$uri)}),b(this,"storable",function(b){a.set(this,b)})}return c}]);var sdkModelValidation=angular.module("ag.sdk.model.validation",["ag.sdk.library","ag.sdk.model.base","ag.sdk.model.validators"]);sdkModelValidation.factory("Validatable",["computedProperty","privateProperty","underscore","Validatable.Field","Validator.dateRange","Validator.equal","Validator.format","Validator.inclusion","Validator.inclusion.in","Validator.length","Validator.object","Validator.numeric","Validator.range","Validator.required","Validator.requiredIf",function(a,b,c,d){function e(){function e(a,b){b.validate(a)===!1?a.$errors.add(b.field,b.message):a.$errors.clear(b.field,b.message)}function f(a){return a&&g[a]?g[a]:c.chain(g).map(function(a){return a}).flatten().value()}var g={};b(g,"add",function(a){c.each(a,function(a,b){g[b]?g[b].addValidators(a):g[b]=new d(b,a)})}),b(g,"validate",function(a,b){var d=f(b);return c.each(d,function(b){e(a,b)}),0===a.$errors.countFor(b)}),b(this,"validations",g),b(this,"validates",g.add),b(this,"__validate",function(a){return this.constructor.validations.validate(this,a)}),a(this,"__$valid",function(){return this.constructor.validations.validate(this)}),a(this,"__$invalid",function(){return!this.constructor.validations.validate(this)})}return e}]),sdkModelValidation.factory("Validatable.DuplicateValidatorError",[function(){function a(a){this.name="DuplicateValidatorError",this.message="A validator by the name "+a+" is already registered"}return a.prototype=Error.prototype,a}]),sdkModelValidation.factory("Validatable.ValidationMessageNotFoundError",[function(){function a(a,b){this.name="ValidationMessageNotFound",this.message="Validation message not found for validator "+a+" on the field "+b+". Validation messages must be added to validators in order to provide your users with useful error messages."}return a.prototype=Error.prototype,a}]),sdkModelValidation.factory("Validatable.Field",["privateProperty","underscore","Validatable.Validation","Validatable.ValidationMessageNotFoundError","Validatable.Validator","Validatable.validators",function(a,b,c,d,e,f){function g(g,h){var i=[];return a(i,"addValidator",function(a,h){var j=f.find(h)||new e(a,h),k=b.flatten([j.configure(a)]);if(b.isUndefined(j.message))throw new d(h,g);b.each(k,function(a){i.push(new c(g,a))})}),a(i,"addValidators",function(a){b.each(a,i.addValidator)}),i.addValidators(h),i}return g}]),sdkModelValidation.factory("Validatable.Validation",["privateProperty",function(a){function b(b,c){a(this,"field",b),a(this,"message",c.message),a(this,"validate",function(a){return c(a[b],a,b)})}return b}]),sdkModelValidation.factory("Validatable.ValidationFunction",["underscore",function(a){function b(b,c){function d(){return a.isFunction(c.message)?c.message.apply(c):c.message}var e=a.bind(b,c);return e.message=d(),e}return b}]),sdkModelValidation.factory("Validatable.ValidatorNotFoundError",[function(){function a(a){this.name="ValidatorNotFoundError",this.message="No validator found by the name of "+a+". Custom validators must define a validator key containing the custom validation function"}return a.prototype=Error.prototype,a}]),sdkModelValidation.factory("Validatable.Validator",["privateProperty","underscore","Validatable.ValidationFunction","Validatable.ValidatorNotFoundError","Validatable.validators",function(a,b,c,d,e){function f(a,c){return b.isFunction(a.validator)?(a.message&&(a.validator.message=a.message),new g(a.validator,c)):void 0}function g(g,h){function i(a){b.each(a,function(a,b){"Validator"===a.constructor.name&&(l.childValidators[b]=a)})}function j(a){return b.chain(l.childValidators).map(function(b,c){return void 0!==a[c]?b.configure(a[c]):void 0}).compact().value()}function k(a){return("object"!=typeof a||b.isArray(a))&&(a={value:a,message:l.message}),0==b.isUndefined(g.name)&&(a[g.name]=a.value),a}if(g.validator)return new f(g,h);if(b.isFunction(g)===!1)throw new d(h);var l=this;a(l,"name",g.name),a(l,"message",g.message),a(l,"childValidators",{}),a(l,"configure",function(a){return a=k(a),b.size(l.childValidators)>0?j(a):new c(g,b.defaults(a,this))}),i(g.options),e.register(l)}return g}]),sdkModelValidation.factory("Validatable.validators",["Validatable.DuplicateValidatorError","privateProperty","underscore",function(a,b,c){var d={};return b(d,"register",function(b){if(!c.isUndefined(d[b.name]))throw new a(b.name);d[b.name]=b}),b(d,"find",function(a){return d[a]}),d}]);var sdkModelValidators=angular.module("ag.sdk.model.validators",["ag.sdk.library","ag.sdk.model.validation"]);sdkModelValidators.factory("Validator.dateRange",["moment","underscore","Validatable.Validator","Validator.dateRange.after","Validator.dateRange.before",function(a,b,c,d,e){function f(){}return f.message=function(){return"Is not a valid date"},f.options={after:d,before:e},new c(f)}]),sdkModelValidators.factory("Validator.dateRange.after",["moment","underscore","Validatable.Validator",function(a,b,c){function d(c){return b.isUndefined(this.after)||b.isUndefined(c)||b.isNull(c)||""===c?!0:a(c)>=a(this.after)}return d.message=function(){return"Must be at least "+a(this.after).format("dddd, MMMM Do YYYY, h:mm:ss a")},new c(d)}]),sdkModelValidators.factory("Validator.dateRange.before",["moment","underscore","Validatable.Validator",function(a,b,c){function d(c){return b.isUndefined(this.before)||b.isUndefined(c)||b.isNull(c)||""===c?!0:a(c)<=a(this.before)}return d.message=function(){return"Must be no more than "+a(this.before).format("dddd, MMMM Do YYYY, h:mm:ss a")},new c(d)}]),sdkModelValidators.factory("Validator.equal",["underscore","Validatable.Validator",function(a,b){function c(b){if(a.isUndefined(this.to))throw"Equal validator must specify an 'to' attribute";return b===this.to}return c.message=function(){return"Must be equal to '"+this.to+"'"},new b(c)}]),sdkModelValidators.factory("Validator.format",["underscore","Validatable.Validator","Validator.format.date","Validator.format.email","Validator.format.telephone","Validator.format.uuid",function(a,b,c,d,e,f){function g(){}return g.message=function(){return"Must be the correct format"},g.options={date:c,email:d,telephone:e,uuid:f},new b(g)}]),sdkModelValidators.factory("Validator.format.date",["moment","underscore","Validatable.Validator",function(a,b,c){function d(c){return b.isUndefined(c)||b.isNull(c)||""===c?!0:a(c).isValid()}return d.message=function(){return"Must be a valid date"},new c(d)}]),sdkModelValidators.factory("Validator.format.email",["moment","underscore","Validatable.Validator",function(a,b,c){function d(a){return b.isUndefined(a)||b.isNull(a)||""===a?!0:e.test(a)}var e=new RegExp("^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,6}$");return d.message=function(){return"Must be a valid email address"},new c(d)}]),sdkModelValidators.factory("Validator.format.telephone",["moment","underscore","Validatable.Validator",function(a,b,c){function d(a){return b.isUndefined(a)||b.isNull(a)||""===a?!0:e.test(a)}var e=new RegExp("^(\\(?\\+?[0-9]*\\)?)?[0-9_\\- \\(\\)]*$");return d.message=function(){return"Must be a valid telephone number"},new c(d)}]),sdkModelValidators.factory("Validator.format.uuid",["moment","underscore","Validatable.Validator",function(a,b,c){function d(a){return b.isUndefined(a)||b.isNull(a)||""===a?!0:e.test(a)}var e=new RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$","i");return d.message=function(){return"Must be a valid UUID"},new c(d)}]),sdkModelValidators.factory("Validator.inclusion",["underscore","Validatable.Validator","Validator.inclusion.in",function(a,b,c){function d(){}return d.message=function(){return"Must have an included value"},d.options={"in":c},new b(d)}]),sdkModelValidators.factory("Validator.inclusion.in",["underscore","Validatable.Validator",function(a,b){function c(b,c,d){var e="function"==typeof this.value?this.value(b,c,d):this.value;return a.isUndefined(b)||a.isNull(b)?!0:0==e.length?!0:a.some(e,function(a){return b===a})}return c.message=function(){return"Must be in array of values"},new b(c)}]),sdkModelValidators.factory("Validator.length",["Validatable.Validator","Validator.length.min","Validator.length.max",function(a,b,c){function d(){return!0}return d.message="does not meet the length requirement",d.options={min:b,max:c},new a(d)}]),sdkModelValidators.factory("Validator.length.min",["underscore","Validatable.Validator",function(a,b){function c(b){return a.isUndefined(b)||a.isNull(b)?!0:b.length>=this.min}return c.message=function(){return"Must be at least "+this.min+" characters"},new b(c)}]),sdkModelValidators.factory("Validator.length.max",["underscore","Validatable.Validator",function(a,b){function c(b){return a.isUndefined(b)||a.isNull(b)?!0:b.length<=this.max}return c.message=function(){return"Must be no more than "+this.max+" characters"},new b(c)}]),sdkModelValidators.factory("Validator.numeric",["underscore","Validatable.Validator",function(a,b){function c(b){return a.isUndefined(b)||a.isNull(b)?!0:"number"==typeof b&&a.isNumber(b)}return c.message=function(){return"Must be a number"},new b(c)}]),sdkModelValidators.factory("Validator.object",["underscore","Validatable.Validator",function(a,b){function c(b){return a.isUndefined(b)||a.isNull(b)?!0:"object"==typeof b}return c.message=function(){return"Must be an object"},new b(c)}]),sdkModelValidators.factory("Validator.range",["Validatable.Validator","Validator.range.from","Validator.range.to",function(a,b,c){function d(){return!0}return d.message="Must be with the range requirement",d.options={from:b,to:c},new a(d)}]),sdkModelValidators.factory("Validator.range.from",["underscore","Validatable.Validator",function(a,b){function c(b){return a.isUndefined(b)||a.isNull(b)||""===b?!0:b>=this.from}return c.message=function(){return"Must be at least "+this.from},new b(c)}]),sdkModelValidators.factory("Validator.range.to",["underscore","Validatable.Validator",function(a,b){function c(b){return a.isUndefined(b)||a.isNull(b)||""===b?!0:b<=this.to}return c.message=function(){return"Must be no more than "+this.to},new b(c)}]),sdkModelValidators.factory("Validator.required",["underscore","Validatable.Validator",function(a,b){function c(b){return a.isUndefined(b)||a.isNull(b)?!1:"String"===b.constructor.name?!!(b&&b.length||"object"==typeof b):void 0!==b}return c.message="cannot be blank",new b(c)}]),sdkModelValidators.factory("Validator.requiredIf",["underscore","Validatable.Validator",function(a,b){function c(b,c,d){return this.value(b,c,d)?a.isUndefined(b)||a.isNull(b)?!1:"String"==b.constructor.name?!!(b&&b.length||"object"==typeof b):void 0!==b:!0}return c.message="Is a required field",new b(c)}]);var sdkTestDataApp=angular.module("ag.sdk.test.data",["ag.sdk.utilities","ag.sdk.id","ag.sdk.library"]);sdkTestDataApp.provider("mockDataService",["underscore",function(a){var b={},c={localStore:!0};this.config=function(b){c=a.defaults(b,c)},this.$get=["localStore","objectId","promiseService",function(d,e,f){return c.localStore&&(b=d.getItem("mockdata")||{}),{setItem:function(a,f){f instanceof Array?(b[a]={},angular.forEach(f,function(c){c.id=c.id||e().toString(),b[a][c.id]=c})):(f.id=f.id||e().toString(),b[a]=b[a]||{},b[a][f.id]=f),c.localStore&&d.setItem("mockdata",b)},getItem:function(c,d){return f.wrap(function(e){b[c]=b[c]||{},void 0===d?e.resolve(a.toArray(b[c]||{})):b[c][d]?e.resolve(b[c][d]):e.reject()})}}}]}]),angular.module("ag.sdk.helper",["ag.sdk.helper.asset","ag.sdk.helper.attachment","ag.sdk.helper.crop-inspection","ag.sdk.helper.document","ag.sdk.helper.enterprise-budget","ag.sdk.helper.expense","ag.sdk.helper.farmer","ag.sdk.helper.favourites","ag.sdk.helper.merchant","ag.sdk.helper.production-plan","ag.sdk.helper.region","ag.sdk.helper.task","ag.sdk.helper.team","ag.sdk.helper.user"]),angular.module("ag.sdk.interface",["ag.sdk.interface.geocledian","ag.sdk.interface.ui","ag.sdk.interface.list","ag.sdk.interface.map","ag.sdk.interface.navigation"]),angular.module("ag.sdk.model",["ag.sdk.model.asset","ag.sdk.model.base","ag.sdk.model.business-plan","ag.sdk.model.document","ag.sdk.model.enterprise-budget","ag.sdk.model.farm","ag.sdk.model.farm-valuation","ag.sdk.model.financial","ag.sdk.model.legal-entity","ag.sdk.model.liability","ag.sdk.model.production-schedule","ag.sdk.model.errors","ag.sdk.model.store","ag.sdk.model.validation","ag.sdk.model.validators"]),angular.module("ag.sdk.test",["ag.sdk.test.data"]),angular.module("ag.sdk",["ag.sdk.authorization","ag.sdk.id","ag.sdk.utilities","ag.sdk.model","ag.sdk.api","ag.sdk.helper","ag.sdk.library","ag.sdk.interface.map","ag.sdk.test"]);