var sdkApiApp=angular.module("ag.sdk.api",["ag.sdk.config","ag.sdk.utilities","ag.sdk.library"]);sdkApiApp.factory("userApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getUsers:function(a){return b.page(e+"api/users",a)},getUsersByRole:function(b,d){return c.wrap(function(c){a.get(e+"api/users/farmer/"+b+"?rolename="+d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},createUser:function(b){return c.wrap(function(c){a.post(e+"api/user",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getUser:function(b,d){if(d)var f="?username="+d;return c.wrap(function(c){a.get(e+"api/user/"+b+(f?f:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateUser:function(b){return c.wrap(function(c){a.post(e+"api/user/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteUser:function(b){return c.wrap(function(c){a.post(e+"api/user/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("roleApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getRoles:function(){return b.wrap(function(b){a.get(d+"api/roles",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateRoleApps:function(c){return b.wrap(function(b){a.post(d+"api/role-apps",c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("teamApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getTeams:function(){return b.wrap(function(b){a.get(d+"api/teams",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},createTeam:function(c){return b.wrap(function(b){a.post(d+"api/team",c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getTeam:function(c){return b.wrap(function(b){a.get(d+"api/team/"+c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getTeamUsers:function(c){return b.wrap(function(b){a.get(d+"api/team/"+c+"/users",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateTeam:function(c){return b.wrap(function(b){a.post(d+"api/team/"+c.id,c,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},deleteTeam:function(c){return b.wrap(function(b){a.post(d+"api/team/"+c+"/delete",{},{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("organizationalUnitApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getOrganizationalUnits:function(a){return"string"==typeof a&&(a={type:a}),b.page(e+"api/organizational-units",a)},getOrganizationalUnit:function(b){return c.wrap(function(c){a.get(e+"api/organizational-unit/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateOrganizationalUnit:function(b){return c.wrap(function(c){a.post(e+"api/organizational-unit/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("notificationApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getNotifications:function(a){return b.page(e+"api/notifications",a)},createNotification:function(b){return c.wrap(function(c){a.post(e+"api/notification",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getNotification:function(b){return c.wrap(function(c){a.get(e+"api/notification/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},rejectNotification:function(b,d){return c.wrap(function(c){a.post(e+"api/notification/"+b+"/reject",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},acceptNotification:function(b){return c.wrap(function(c){a.post(e+"api/notification/"+b+"/accept",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("taskApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getTasks:function(a){return b.page(e+"api/tasks",a)},createTask:function(b){return c.wrap(function(c){a.post(e+"api/task",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getTask:function(b){return c.wrap(function(c){a.get(e+"api/task/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},sendTask:function(b,d){return c.wrap(function(c){a.post(e+"api/task/"+b+"/send",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateTask:function(b){return c.wrap(function(c){a.post(e+"api/task/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateTaskStatus:function(b){return c.wrap(function(c){a.post(e+"api/task/"+b.id+"/status",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateTaskAssignment:function(b){return c.wrap(function(c){a.post(e+"api/task/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteTask:function(b){return c.wrap(function(c){a.post(e+"api/task/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("merchantApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getMerchants:function(a){return b.page(e+"api/merchants",a)},searchMerchants:function(b){return c.wrap(function(c){a.get(e+"api/merchants?search="+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},searchByService:function(b,d){return c.wrap(function(c){a.get(e+"api/merchants/services?search="+b+(d?"&x="+d[0]+"&y="+d[1]:""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},createMerchant:function(b){return c.wrap(function(c){a.post(e+"api/merchant",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},inviteMerchant:function(b){return c.wrap(function(c){a.post(e+"api/merchant/"+b+"/invite",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},inviteMerchantUser:function(b){return c.wrap(function(c){a.post(e+"api/merchant/"+b+"/invite-user",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getMerchant:function(b,d){return c.wrap(function(c){a.get(e+"api/merchant/"+b+(d?"?uuid=true":""),{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getMerchantActivities:function(b){return c.wrap(function(c){a.get(e+"api/merchant/"+b+"/activities",{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateMerchant:function(b){return c.wrap(function(c){a.post(e+"api/merchant/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteMerchant:function(b){return c.wrap(function(c){a.post(e+"api/merchant/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("serviceApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getServices:function(a){return b.page(e+"api/services",a)},getServiceTypes:function(){return c.wrap(function(b){a.get(e+"api/service/types",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getService:function(b){return c.wrap(function(c){a.get(e+"api/service/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("farmerApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getFarmers:function(a,c){return"object"==typeof a&&(c=a,a=void 0),b.page(e+"api/farmers"+(a?"/"+a:""),c)},searchFarmers:function(b){return c.wrap(function(c){a.get(e+"api/farmers?search="+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},createFarmer:function(b){return c.wrap(function(c){a.post(e+"api/farmer",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},inviteFarmer:function(b){return c.wrap(function(c){a.post(e+"api/farmer/"+b+"/invite",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getFarmer:function(b){return c.wrap(function(c){a.get(e+"api/farmer/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateFarmer:function(b){return c.wrap(function(c){a.post(e+"api/farmer/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteFarmer:function(b){return c.wrap(function(c){a.post(e+"api/farmer/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("legalEntityApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getEntities:function(a,c){return"object"==typeof a&&(c=a,a=void 0),b.page(e+"api/legalentities"+(a?"/"+a:""),c)},updateEntity:function(b){return c.wrap(function(c){a.post(e+"api/legalentity/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},uploadEntityAttachments:function(b,d){return c.wrap(function(c){a.post(e+"api/legalentity/"+b+"/attach",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getEntity:function(b){return c.wrap(function(c){a.get(e+"api/legalentity/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},createEntity:function(b){return c.wrap(function(c){a.post(e+"api/legalentity",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteEntity:function(b){return c.wrap(function(c){a.post(e+"api/legalentity/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("farmApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getFarms:function(a,c){return"object"==typeof a&&(c=a,a=void 0),b.page(e+"api/farms"+(a?"/"+a:""),c)},createFarm:function(b){return c.wrap(function(c){a.post(e+"api/farm",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getFarm:function(b){return c.wrap(function(c){a.get(e+"api/farm/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateFarm:function(b){return c.wrap(function(c){a.post(e+"api/farm/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteFarm:function(b){return c.wrap(function(c){a.post(e+"api/farm/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("assetApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getAssets:function(a,c){return"object"==typeof a&&(c=a,a=void 0),b.page(e+"api/assets"+(a?"/"+a:""),c)},createAsset:function(b){return c.wrap(function(c){a.post(e+"api/asset",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getAsset:function(b){return c.wrap(function(c){a.get(e+"api/asset/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateAsset:function(b){return c.wrap(function(c){a.post(e+"api/asset/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteAsset:function(b){return c.wrap(function(c){a.post(e+"api/asset/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},uploadAssetAttachments:function(b,d){return c.wrap(function(c){a.post(e+"api/asset/"+b+"/attach",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("documentApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getDocuments:function(a,c){return"object"==typeof a&&(c=a,a=void 0),b.page(e+"api/documents"+(a?"/"+a:""),c)},createDocument:function(b){return c.wrap(function(c){a.post(e+"api/document",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getDocument:function(b){return c.wrap(function(c){a.get(e+"api/document/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},sendDocument:function(b,d){return c.wrap(function(c){a.post(e+"api/document/"+b+"/send",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},updateDocument:function(b){return c.wrap(function(c){a.post(e+"api/document/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteDocument:function(b){return c.wrap(function(c){a.post(e+"api/document/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},uploadDocumentAttachments:function(b,d){return c.wrap(function(c){a.post(e+"api/document/"+b+"/attach",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getDocumentPdf:function(b){return c.wrap(function(c){var d=encodeURIComponent(b).match(/%[89ABab]/g),f={responseType:"blob",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":b.length+(d?d.length:0),Connection:"keep-alive","Transfer-Encoding":"chunked",Accept:"application/pdf"}};a.post(e+"api/document/pdf/get",b,f).success(function(a,b){var d=new Blob([a],{type:"application/pdf"}),e=URL.createObjectURL(d);c.resolve({status:b,url:e})}).error(function(a,b){c.reject({status:b})})})},saveDocumentPdf:function(b){return c.wrap(function(c){var d=encodeURIComponent(b).match(/%[89ABab]/g),f={headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":b.length+(d?d.length:0),Connection:"keep-alive","Transfer-Encoding":"chunked"}};a.post(e+"api/document/pdf/save",b,f).success(function(a){c.resolve(a)}).error(function(a,b){c.reject({status:b})})})}}}]),sdkApiApp.factory("activityApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getActivities:function(a,c,d){return"object"==typeof c&&(d=c,c=void 0),"object"==typeof a&&(d=a,a=void 0),b.page(e+"api/activities"+(a?"/"+a:"")+(c?"/"+c:""),d)},createActivity:function(b){return c.wrap(function(c){a.post(e+"api/activity",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getActivity:function(b){return c.wrap(function(c){a.get(e+"api/activity/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteActivity:function(b){return c.wrap(function(c){a.post(e+"api/activity/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("agristaApi",["$http","pagingService","promiseService","configuration",function(a,b,c,d){var e=d.getServer();return{getMerchants:function(){return c.wrap(function(b){a.get(e+"api/agrista/merchants",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},searchMerchants:function(b){return c.wrap(function(c){a.get(e+"api/agrista/merchants?search="+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]),sdkApiApp.factory("attachmentApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getAttachmentUri:function(c){return b.wrap(function(b){a.get(d+"api/file-attachment/"+c+"/url",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getPDFPreviewImage:function(c){return b.wrap(function(b){a.get(d+"api/attachment/pdf/preview-image/"+encodeURIComponent(c),{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("aggregationApi",["$http","configuration","promiseService","pagingService",function(a,b,c,d){var e=b.getServer();return{getCustomerLocations:function(){return c.wrap(function(b){a.get(e+"api/aggregation/customer-locations",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getCustomerFarmlands:function(b,d,f,g){return c.wrap(function(c){a.get(e+"api/aggregation/customer-geodata?x1="+g+"&y1="+b+"&x2="+d+"&y2="+f,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getSubRegionBoundaries:function(b,d,f,g){return c.wrap(function(c){a.get(e+"api/aggregation/guideline-subregions?x1="+g+"&y1="+b+"&x2="+d+"&y2="+f,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getGroupCustomerLocations:function(){return c.wrap(function(b){a.get(e+"api/aggregation/customer-locations-group",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getGroupCustomerFarmlands:function(b,d,f,g){return c.wrap(function(c){a.get(e+"api/aggregation/customer-geodata-group?x1="+g+"&y1="+b+"&x2="+d+"&y2="+f,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getFarmlandOverlaps:function(a){return d.page(e+"api/aggregation/farmland-overlap",a)},getGuidelineExceptions:function(a){return d.page(e+"api/aggregation/guideline-exceptions",a)}}}]),sdkApiApp.factory("applicationApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getAuthenticationType:function(){return b.wrap(function(b){a.get(d+"util/authentication-type",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("pipGeoApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{getFieldPolygon:function(c,e){return b.wrap(function(b){a.get(d+"api/geo/field-polygon?x="+c+"&y="+e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getPortionPolygon:function(c,e){return b.wrap(function(b){a.get(d+"api/geo/portion-polygon?x="+c+"&y="+e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getDistrictPolygon:function(c,e){return b.wrap(function(b){a.get(d+"api/geo/district-polygon?x="+c+"&y="+e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getProvincePolygon:function(c,e){return b.wrap(function(b){a.get(d+"api/geo/province-polygon?x="+c+"&y="+e,{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})}}}]),sdkApiApp.factory("enterpriseBudgetApi",["$http","pagingService","promiseService","configuration","underscore",function(a,b,c,d,e){var f=d.getServer();return{getEnterpriseBudgets:function(a,c){return"object"==typeof a&&(c=a,a=void 0),b.page(f+"api/budgets"+(a?"/"+a:""),c)},searchEnterpriseBudgets:function(b){return b=e.chain(b).map(function(a,b){return b+"="+a}).join("&").value(),c.wrap(function(c){a.get(f+"api/budgets/search?"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},createEnterpriseBudget:function(b){return c.wrap(function(c){a.post(f+"api/budget",b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getEnterpriseBudget:function(b){return c.wrap(function(c){a.get(f+"api/budget/"+b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},getEnterpriseBudgetPublishers:function(){return c.wrap(function(b){a.get(f+"api/budget/publishers",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},getEnterpriseBudgetRegions:function(){return c.wrap(function(b){a.get(f+"api/budget/regions",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},updateEnterpriseBudget:function(b){return c.wrap(function(c){a.post(f+"api/budget/"+b.id,b,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},publishEnterpriseBudget:function(b){return c.wrap(function(c){a.post(f+"api/budget/"+b+"/publish",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},deleteEnterpriseBudget:function(b){return c.wrap(function(c){a.post(f+"api/budget/"+b+"/delete",{},{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})},uploadEnterpriseBudgetAttachments:function(b,d){return c.wrap(function(c){a.post(f+"api/budget/"+b+"/attach",d,{withCredentials:!0}).then(function(a){c.resolve(a.data)},c.reject)})}}}]);var sdkAuthorizationApp=angular.module("ag.sdk.authorization",["ag.sdk.config","ag.sdk.utilities"]);sdkAuthorizationApp.factory("authorizationApi",["$http","promiseService","configuration",function(a,b,c){var d=c.getServer();return{login:function(c,e){return b.wrap(function(b){a.post(d+"login",{email:c,password:e}).then(function(a){b.resolve(a.data)},b.reject)})},resetPassword:function(c,e){return b.wrap(function(b){a.post(d+"api/password-reset",{hash:c,password:e}).then(function(a){b.resolve(a.data)},b.reject)})},requestResetPasswordEmail:function(c){return b.wrap(function(b){a.post(d+"api/password-reset-email",{email:c}).then(function(a){b.resolve(a.data)},b.reject)})},changePassword:function(c,e,f){return b.wrap(function(b){a.post(d+"api/user/password",{password:e,newPassword:f}).then(function(a){b.resolve(a.data)},b.reject)})},getUser:function(){return b.wrap(function(b){a.get(d+"current-user",{withCredentials:!0}).then(function(a){b.resolve(a.data)},b.reject)})},registerUser:function(c){return b.wrap(function(b){a.post(d+"api/register",c).then(function(a){b.resolve(a.data)},b.reject)})},logout:function(){return a.post(d+"logout")}}}]),sdkAuthorizationApp.provider("authorization",["$httpProvider",function(a){var b={open:1,user:2,admin:4},c={open:b.open|b.user|b.admin,user:b.user|b.admin,admin:b.admin},d={email:"",role:b.open},e=void 0;return a.interceptors.push(["$q","$injector","$rootScope",function(a,b,c){return{responseError:function(b){return 401===b.status&&c.$broadcast("authorization::unauthorized"),a.reject(b)}}}]),{userRole:b,accessLevel:c,$get:["$rootScope","authorizationApi","localStore","promiseService",function(a,f,g,h){function i(){return g.getItem("user")||d}function j(a){return a=a||d,void 0===a.role&&(a.role="admin"==a.accessLevel?b.admin:b.user),g.setItem("user",a),a}var k=i();return f.getUser().then(function(b){null!==b.user?(k=j(b.user),a.$broadcast("authorization::login",k)):k.isActive!==!0&&a.$broadcast("authorization::unauthorized")}),{userRole:b,accessLevel:c,lastError:function(){return e},currentUser:function(){return k},isAllowed:function(a){return 0!=(a&k.role)},isLoggedIn:function(){return 0!=(c.user&k.role)},login:function(b,c){return h.wrap(function(g){f.login(b,c).then(function(b){null!==b.user?(e=void 0,k=j(b.user),g.resolve(k),a.$broadcast("authorization::login",k)):(e={type:"error",message:"The entered e-mail and/or password is incorrect. Please try again."},k=j(d),g.reject())},function(a){k=j(d),g.reject(a)})})},requestResetPasswordEmail:f.requestResetPasswordEmail,resetPassword:f.resetPassword,changePassword:function(a,b){return f.changePassword(k.id,a,b)},changeUserDetails:function(a){return f.updateUser(k.id,a).then(function(){k=j(a)})},register:function(b){return h.wrap(function(c){f.registerUser(b).then(function(b){null!==b?(e=void 0,k=j(b),c.resolve(k),a.$broadcast("authorization::login",k)):(k=j(d),c.reject())},function(a){e={type:"error",message:"There is already an Agrista account associated with this email address. Please login."},k=j(d),c.reject(a)})})},logout:function(){return a.$broadcast("authorization::logout"),f.logout().then(function(){k=j(d)})}}}]}}]);var sdkConfigApp=angular.module("ag.sdk.config",[]);sdkConfigApp.provider("configuration",["$httpProvider",function(a){var b="",c="local",d=[],e={local:"",testing:"https://uat.enterprise.agrista.com/",staging:"https://staging.enterprise.agrista.com/",production:"https://enterprise.agrista.com/"},f=function(a){return-1!==d.indexOf(a)},g=function(a){0==f(a)&&d.push(a)};return{addModule:g,hasModule:f,setServers:function(a){angular.forEach(a,function(a,b){a.lastIndexOf("/")!==a.length-1&&(a+="/"),e[b]=a}),this.useHost(c,b)},useHost:function(d,f,g){"function"==typeof f&&(g=f,f=""),b=f||"",void 0!==e[d]&&(c=d,a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]),"function"==typeof g&&g(e[c])},$get:function(){return{addModule:g,hasModule:f,getVersion:function(){return b},getHost:function(){return c},getServer:function(){return e[c]}}}}}]);var sdkIdApp=angular.module("ag.sdk.id",["ag.sdk.utilities"]);sdkIdApp.factory("objectId",["localStore",function(a){var b=function(){function c(){return this instanceof b?void("object"==typeof arguments[0]?(this.timestamp=arguments[0].timestamp,this.machine=arguments[0].machine,this.pid=arguments[0].pid,this.increment=arguments[0].increment):"string"==typeof arguments[0]&&24==arguments[0].length?(this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))):4==arguments.length&&null!=arguments[0]?(this.timestamp=arguments[0],this.machine=arguments[1],this.pid=arguments[2],this.increment=arguments[3]):(this.timestamp=Math.floor((new Date).valueOf()/1e3),this.machine=f,this.pid=e,this.increment=d++,d>16777215&&(d=0))):new b(arguments[0],arguments[1],arguments[2],arguments[3]).toString()}var d=0,e=Math.floor(32767*Math.random()),f=Math.floor(16777216*Math.random()),g=parseInt(a.getItem("mongoMachineId"));return g>=0&&16777215>=g&&(f=Math.floor(a.getItem("mongoMachineId"))),a.setItem("mongoMachineId",f),c}();return b.prototype.getDate=function(){return new Date(1e3*this.timestamp)},b.prototype.toArray=function(){var a,b=this.toString(),c=[];for(a=0;12>a;a++)c[a]=parseInt(b.slice(2*a,2*a+2),16);return c},b.prototype.toString=function(){var a=this.timestamp.toString(16),b=this.machine.toString(16),c=this.pid.toString(16),d=this.increment.toString(16);return"00000000".substr(0,8-a.length)+a+"000000".substr(0,6-b.length)+b+"0000".substr(0,4-c.length)+c+"000000".substr(0,6-d.length)+d},b.prototype.toBase64String=function(){return window.btoa(this.toString())},function(){return new b}}]),sdkIdApp.factory("generateUUID",function(){function a(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:7&c|8).toString(16)});return b}return function(){return a()}});var sdkLibraryApp=angular.module("ag.sdk.library",[]);sdkLibraryApp.constant("underscore",window._),sdkLibraryApp.constant("geojsonUtils",window.gju);var sdkMonitorApp=angular.module("ag.sdk.monitor",["ag.sdk.utilities"]);sdkMonitorApp.factory("promiseMonitor",["$log","safeApply",function(a,b){function c(d){if(!(this instanceof c))return new c(d);var e={total:0,complete:0,resolved:0,rejected:0,percent:0},f=function(){e.complete++,e.percent=100/e.total*e.complete,a.debug("MONITOR TOTAL: "+e.total+" COMPLETE: "+e.complete+" PERCENT: "+e.percent),b(function(){d(e.complete==e.total?{type:"complete",percent:e.percent,stats:e}:{type:"progress",percent:e.percent,stats:e})})};return{stats:function(){return e},clear:function(){e={total:0,complete:0,resolved:0,rejected:0,percent:0}},add:function(a){return e.total++,a.then(function(){e.resolved++,f()},function(a){e.rejected++,b(function(){d({type:"error"},a)}),f()}),a}}}return function(a){return new c(a)}}]);var skdUtilitiesApp=angular.module("ag.sdk.utilities",["ngCookies"]);skdUtilitiesApp.factory("safeApply",["$rootScope",function(a){return function(b){a.$$phase?b():a.$apply(b)}}]),skdUtilitiesApp.factory("dataMapService",[function(){return function(a,b,c){var d=[];a instanceof Array==!1&&(a=void 0!==a?[a]:[]);for(var e=0;e<a.length;e++){var f,g=a[e];if("function"==typeof b)f=b(g);else{f={};for(var h in b)b.hasOwnProperty(h)&&(f[h]=g[b[h]])}f instanceof Array?d=d.concat(f):"object"==typeof f?(c!==!0&&(f.id=f.id||g.id),d.push(f)):void 0!==f&&d.push(f)}return d}}]),skdUtilitiesApp.factory("pagingService",["$rootScope","$http","promiseService","dataMapService",function(a,b,c,d){return{initialize:function(b,e,f){f=f||function(b){a.$broadcast("paging::items",b)};var g={page:{limit:50},busy:!1,complete:!1,disabled:function(){return g.busy||g.complete},request:function(a){var h=a||g.page;return c.wrap(function(a){void 0!==h.search&&h.search===g.search?a.reject():(g.busy=!0,b(h).then(function(b){void 0===h.search?(g.page.offset=void 0===g.page.offset?b.length:g.page.offset+b.length,g.complete=b.length!==g.page.limit):g.search=h.search,g.busy=!1,e&&(b=d(b,e)),f(b),a.resolve(b)},a.reject))})}};return g},page:function(a,d){return c.wrap(function(c){var e=function(a){c.resolve(a.data)};void 0!==d?"string"==typeof d?b.get(d,{withCredentials:!0}).then(e,c.reject):b.get(a,{params:d,withCredentials:!0}).then(e,c.reject):b.get(a,{withCredentials:!0}).then(e,c.reject)})}}}]),skdUtilitiesApp.factory("promiseService",["$q","safeApply",function(a,b){var c=function(){var c=a.defer();return{resolve:function(a){b(function(){c.resolve(a)})},reject:function(a){b(function(){c.reject(a)})},promise:c.promise}},d=function(b,c){var d=c;return b(d),a.all(d)};return{all:function(b){return a.all(b)},wrap:function(a){var b=c();return a(b),b.promise},wrapAll:function(a){return d(a,[])},arrayWrap:function(a){return d(a,[])},objectWrap:function(a){return d(a,{})},defer:c}}]),skdUtilitiesApp.factory("localStore",["$cookieStore","$window",function(a,b){return{setItem:function(c,d){b.localStorage?b.localStorage.setItem(c,JSON.stringify(d)):a.put(c,d)},getItem:function(c){return b.localStorage?JSON.parse(b.localStorage.getItem(c)):a.get(c)},removeItem:function(c){b.localStorage?b.localStorage.removeItem(c):a.remove(c)}}}]),skdUtilitiesApp.directive("signature",["$compile",function(a){return{restrict:"E",replace:!0,template:'<div class="panel panel-default signature"><div class="panel-heading">{{ title }}<div class="btn btn-default btn-sm pull-right" ng-click="reset()">Clear</div></div></div>',scope:{onsigned:"=",name:"@",title:"@"},link:function(b,c,d){var e=a('<div class="panel-body signature-body"></div>')(b);c.append(e),b.reset=function(){e.jSignature("reset"),b.onsigned(d.name,null)},e.jSignature({width:d.width,height:d.height,showUndoButton:!1}),e.bind("change",function(){b.onsigned(d.name,e.jSignature("getData","svgbase64"))})}}}]);var sdkHelperAssetApp=angular.module("ag.sdk.helper.asset",["ag.sdk.helper.farmer","ag.sdk.library"]);sdkHelperAssetApp.factory("assetHelper",["$filter","landUseHelper","underscore",function(a,b,c){var d=function(b,d){var e={id:b.id||b.__id,type:b.type,updatedAt:b.updatedAt};if(b.data&&("crop"==b.type?(e.title=(b.data.plantedArea?b.data.plantedArea.toFixed(2)+"Ha of ":"")+(b.data.crop?b.data.crop:"")+(b.data.fieldName?" on field "+b.data.fieldName:""),e.subtitle=b.data.season?b.data.season:"",e.groupby=b.farmId):"farmland"==b.type?(e.title=0==b.data.portionNumber?"Remainder of farm":"Portion "+b.data.portionNumber,e.subtitle="Area: "+b.data.area.toFixed(2)+"Ha",e.groupby=b.farmId):"improvement"==b.type?(e.title=b.data.name,e.subtitle=b.data.type+" - "+b.data.category,e.summary=b.data.description||"",e.groupby=b.farmId):"irrigated cropland"==b.type?(e.title=b.data.irrigation+(b.data.fieldName?" on field "+b.data.fieldName:""),e.subtitle="Equipped Area: "+b.data.size.toFixed(2)+"Ha",e.groupby=b.farmId):"livestock"==b.type?(e.title=b.data.type+" - "+b.data.category,e.subtitle=(b.data.breed?b.data.breed+" for ":"For ")+b.data.purpose,e.summary=b.data.description||"",e.groupby=b.data.type):"pasture"==b.type?(e.title=(b.data.crop?b.data.crop:"Natural")+(b.data.fieldName?" on field "+b.data.fieldName:""),e.subtitle=b.data.plantedDate?"Planted: "+a("date")(b.data.plantedDate,"dd/MM/yy"):"",e.groupby=b.farmId):"permanent crop"==b.type?(e.title=b.data.crop+(b.data.fieldName?" on field "+b.data.fieldName:""),e.subtitle=b.data.establishedDate?"Established: "+a("date")(b.data.establishedDate,"dd/MM/yy"):"",e.groupby=b.farmId):"plantation"==b.type?(e.title=b.data.crop+(b.data.fieldName?" on field "+b.data.fieldName:""),e.subtitle=b.data.establishedDate?"Established: "+a("date")(b.data.establishedDate,"dd/MM/yy"):"",e.groupby=b.farmId):"vme"==b.type?(e.title=b.data.category+(b.data.model?" model "+b.data.model:""),e.subtitle="Quantity: "+b.data.quantity,e.summary=b.data.description||"",e.groupby=b.data.type):"water right"==b.type&&(e.title=b.data.waterSource+(b.data.fieldName?" on field "+b.data.fieldName:""),e.subtitle="Irrigatable Extent: "+b.data.size.toFixed(2)+"Ha",e.groupby=b.farmId),b.data.attachments))for(var f=["png","jpg","jpeg","gif"],g=0;g<b.data.attachments.length;g++)for(var h=b.data.attachments[g],i=0;i<f.length;i++)-1!=h.key.indexOf(f[i])&&(e.image=h.src);return d&&(e=c.extend(e,d)),e},e={crop:"Crops",farmland:"Farmlands",improvement:"Fixed Improvements","irrigated cropland":"Irrigated Cropland",livestock:"Livestock",pasture:"Pastures","permanent crop":"Permanent Crops",plantation:"Plantations",vme:"Vehicles, Machinery & Equipment","water right":"Water Rights"},f={improvement:["Livestock & Game","Crop Cultivation & Processing","Residential","Business","Equipment & Utilities","Infrastructure","Recreational & Misc."],livestock:["Cattle","Sheep","Pigs","Chickens","Ostriches","Goats"],vme:["Vehicles","Machinery","Equipment"]},g={improvement:{"Livestock & Game":["Abattoir","Animal Cages","Animal Camp","Animal Feedlot","Animal Growing House","Animal Handling Equiment","Animal Handling Facility","Animal Pens","Animal Sale Facility","Animal Shelter","Animal Stable","Anti-Poaching Training Facility","Arena","Auction Facilities","Aviary","Barn","Beekeeping Room","Bottling Facility","Breeding Facility","Broiler House","Broiler House - Atmosphere","Broiler House - Semi","Broiler Unit","Cheese Factory","Chicken Coop","Chicken Run","Cooling Facility","Crocodile Dams","Dairy","Deboning Room","Dry Oven","Dry Storage","Drying Facility","Drying Ovens","Drying Racks","Drying Strips","Drying Tunnels","Egg Grading Facility","Egg Packaging Building","Elephant Enclosures","Embryo Room","Feed Dispensers","Feed Mill","Feed Storeroom","Feeding Lot","Feeding Pens","Feeding Shelter","Feeding Troughs","Filter Station","Fish Market Buildings","Flavour Shed","Game Cage Facility","Game Lodge","Game Pens","Game Room","Game Slaughter Area","Game Viewing Area","Grading Room","Handling Facilities","Hatchery","Hide Store","Hing Pen","Horse Walker","Hunters","Hide Storeroom","Inspection Room","Kennels","Kraal","Laying Hen House","Maternity House","Maternity Pens","Meat Processing Facility","Milk Bottling Plant","Milk Tank Room","Milking Parlour","Other","Packaging Complex","Packaging Facility","Paddocks","Pasteurising Facility","Pens","Pig Sty","Poison Store","Post-Feeding Shed","Processing Facility","Quarantine Area","Racing Track","Rankin Game","Refrigeration Facility","Rehab Facility","Saddle Room","Sales Facility","Selling Kraal","Shearing Facility","Shed","Shelter","Shooting Range","Skinning Facility","Slaughter Facility","Sorting Facility","Stable","Stall","Stock Handling Facility","Storage Facility","Sty","Surgery","Treatment Area","Trout Dam","Warehouse"],"Crop Cultivation & Processing":["Crop Cultivation & Processing","Barrel Maturation Room","Bottling Facility","Carton Shed","Cellar","Chemical Shed","Compost Pasteurising Unit","Compost Preparing Unit","Cooling Facility","Crushing Plant","Dark Room","Degreening Room","Dehusking Shed","Dry Oven","Dry Sow House","Dry Storage","Drying Facility","Drying Ovens","Drying Racks","Drying Strips","Drying Tunnels","Farrowing House","Fertilizer Shed","Flavour Shed","Food Plant Shed","Fruit Dry Tracks","Fruit Hopper","Gardening Facility","Germination Facility","Grading Room","Grain Handling Equipment","Grain Loading Facility","Grain Mill","Grain Silos","Grain Store","Greenhouse","Grower Unit","Handling Facilities","Hopper","Hothouse","Igloo","Inspection Room","Irrigation Dam","Irrigation Pump","Irrigation Reservoir","Irrigation System","Mill","Milling Store","Mushroom Cultivation Building","Mushroom Sweat Room","Nursery (Plant)","Nut Cracking Facility","Nut Factory","Oil Store","Onion Drying Shed","Other","Packaging Complex","Packaging Facility","Pesticide Store","Poison Store","Processing Facility","Refrigeration Facility","Sales Facility","Seed Store","Seedling Growing Facility","Seedling Packaging Facility","Shed","Silo","Sorting Facility","Sprinklers","Storage Facility","Tea Drying Facility","Tea Room","Tobacco Dryers","Warehouse","Wine Cellar","Wine Storage Shed","Wine Tanks","Winery Building"],Residential:["Ablution Facility","Accommodation Units","Attic","Balcony","Bathroom","Bedroom","Building","Bungalow","Bunk House","Cabin","Camp Accommodation","Canteen","Caretaker's Dwelling","Chalet","Cloak Room","Community Dwelling","Cottage","Dining Area","Dining Facility","Dormitory","Dressing Rooms","Drivers' Accommodation","Dwelling","Estate House","Flat","Foreman's Dwelling","Game Lodge","Guest Accommodation","Homestead","Hostels","House","Hunters' Accommodation","Hunters' Kitchen","Hut","Kitchen","Lapa","Lean-to","Lodge","Loft","Log Cabin","Longdavel","Lounge","Luncheon Areas","Luxury Accommodation","Manager's Dwelling","Manor House","Maternity House","Other","Owner's Dwelling","Parlor","Shed","Shower","Staff Ablutions","Staff Accommodation","Staff Building","Staff Compound","Staff Dining Facility","Stoop","Tavern","Teachers' Dwellings","Toilet - Outdoor","Toilet Block","Toilets","Toilets - Staff","Veranda","Winemakers' Dwelling","Workers' Ablutions","Workers' Accommodation","Workers' Kitchen","Workers' School"],Business:["Ablution Facility","Administration Block","Administrative Building","Administrative Offices","Animal Sale Facility","Auction Facilities","Barrel Maturation Room","Bathroom","Bottling Facility","Building","Charcoal Factory","Cheese Factory","Cloak Room","Cloth House","Commercial Buildings","Conference Facility","Cooling Facility","Distribution Centre","Factory Building","Fish Market Buildings","Functions Centre","Furniture Factory","Grading Room","Industrial Warehouse","Inspection Room","Ironing Room","Kiosk","Laboratory","Laundry Facility","Lean-to","Liquor Store","Loading Area","Loading Bay","Loading Platform","Loading Shed","Locker Room","Lockup Shed","Mechanical Workshop","Office","Office Building","Office Complex","Other","Packaging Complex","Packaging Facility","Pallet Factory","Pallet Stacking Area","Pill Factory","Processing Facility","Reception Area","Refrigeration Facility","Sales Facility","Saw Mill","Security Office","Shed","Shop","Sorting Facility","Staff Building","Staff Compound","Storage Facility","Studio","Toilet - Outdoor","Toilet Block","Toilets","Toilets - Client","Toilets - Office","Toilets - Staff","Transport Depot","Warehouse","Wine Cellar","Wine Shop","Wine Tasting Room","Winery Building","Work Station","Workers' Ablutions","Workers' Accommodation","Workers' Kitchen","Workers' School","Workshop"],"Equipment & Utilities":["Air Conditioners","Aircraft Hangar","Backup Generator","Boiler Room","Borehole","Borehole - Equipped","Borehole - Pump","Bulk Tank Room","Caravan Room","Carport","Carport - Double","Carton Shed","Chemical Shed","Compressor Room","Control Hut","Cooling Facility","Diesel Room","Electricity Room","Engine Room","Equipment Stores","Eskom Transformer","Filter Station","Fuel Depot","Fuel Store","Fuel Tank","Garage","Garage - Double","Garage - Triple","Generator Room","Hangar","Helipad","Hydro Tanks","Hydrophonic Pond","Laying Hen House Equipment","Machinery Room","Mechanical Workshop","Oil Store","Other","Oven","Petrol Storage","Poison Store","Power Room","Pump","Pump House Equipment","Pumphouse","Refuelling Canopy","Scale","Shed","Solar Power Room","Tank Stand","Tanks","Tool Shed","Tractor Shed","Transformer Room","Transport Depot","Truck Shelter","Truck Wash","Turbine Room","Twin Engine Generator Unit","Tyre Shed","Utility Building","Utility Room","Water Purification Plant","Water Reticulation Works","Water Storage Tanks","Water Tower"],Infrastructure:["Ablution Facility","Access Roads","All Infrastructure","Attic","Balcony","Barn","Bathroom","Bedroom","Bell Arch","Bin Compartments","Boiler Room","Borehole","Borehole - Equipped","Borehole - Pump","Building","Bulk Tank Room","Bunker","Canopy","Canteen","Cellar","Classroom","Cloak Room","Concrete Slab","Concrete Surfaces","Courtyard","Covered Area","Dam","Dam - Filter","Debris Filter Pond","Deck","Driveway","Electric Fencing","Electric Gate","Electricity Room","Entrance Building","Entrance Gate","Fencing","Fencing (Game)","Fencing (Perimeter)","Fencing (Security)","Flooring","Foyer","Gate","Gate - Sliding","Gate House","Gazebo","Guardhouse","Hall","House","Hut","Hydro Tanks","Hydrophonic Pond","Infrastructure","Irrigation Dam","Irrigation Pump","Irrigation Reservoir","Irrigation System","Kiosk","Kitchen","Koi Pond","Kraal","Laboratory","Landing Strip","Laundry Facility","Lean-to","Lockup Shed","Longdavel","Mezzanine","Other","Outbuilding","Outdoor Room","Outhouse","Parking Area","Parlor","Patio","Paving","Pens","Poles","Pool Facility","Pool House","Porch","Porte Cochere","Reservoir","Reservoir Pumphouse","Reservoir Tower","Road Stall","Rondavel","Roofing","Room","Ruin","Runway","Security Office","Shade Netting","Shade Port","Shed","Shooting Range","Shower","Silo","Slab","Splash Pool","Sprinklers","Stable","Stoop","Storage Facility","Studio","Surrounding Works","Tarmac","Tarred Area","Tarred Road Surfaces","Terrace","Toilet - Outdoor","Toilet Block","Toilets","Toilets - Client","Toilets - Office","Toilets - Staff","Trench","Tunnel","Tunnel Building","Vacant Areas","Veranda","Walkways","Walls","Walls (Boundary)","Walls (Retaining)","Walls (Security)","Warehouse","Water Feature","Water Storage Tanks","Water Tower","Wire Enclosures","Work Station"],"Recreational & Misc.":["Anti-Poaching Training Facility","Archive Room","Arena","Art Gallery","Bar","Barrel Maturation Room","BBQ","BBQ Facility","CafÃ©","Canteen","Caravan Room","Chapel","Church","Church Facility","Classroom","Cloth House","Clubhouse","Coffee Shop","Community Centre","Compost Pasteurising Unit","Compost Preparing Unit","Dark Room","Entertainment Area","Entertainment Facility","Functions Centre","Funeral Building","Furniture Factory","Gallery","Game Room","Golf Clubhouse","Gymnasium","Helipad","Hydro Tanks","Hydrophonic Pond","Igloo","Ironing Room","Jacuzzi","Judging Booth","Kiosk","Koi Pond","Laundry Facility","Liquor Store","Locker Room","Lounge","Luncheon Areas","Museum","Nursery School","Nursing Home","Other","Parlor","Pill Factory","Play Area","Pool Facility","Pool House","Pottery Room","Pub","Reception Area","Recreation Facility","Rehab Facility","Restaurant","Retirement Centre","Salon","Sauna","Saw Mill","School","Spa Baths","Spa Complex","Splash Pool","Squash Court","Sulphur Room","Surgery","Swimming Pool - Indoor","Swimming Pool - Outdoor","Swimming Pool Ablution","Tavern","Tea Room","Tennis Court","Treatment Area","Trout Dam","Venue Hall","Vitamin Room","Wedding Venue","Weigh Bridge","Weigh Bridge Control Room","Wellness Centre","Windmill"]},livestock:{Cattle:{Breeding:["Phase A Bulls","Phase B Bulls","Phase C Bulls","Phase D Bulls","Heifers","Bull Calves","Heifer Calves","Tollies 1-2","Heifers 1-2","Culls"],Dairy:["Bulls","Dry Cows","Lactating Cows","Heifers","Calves","Culls"],Slaughter:["Bulls","Cows","Heifers","Weaners","Calves","Culls"]},Sheep:{Breeding:["Rams","Young Rams","Ewes","Young Ewes","Lambs","Wethers","Culls"],Slaughter:["Rams","Ewes","Lambs","Wethers","Culls"]},Pigs:{Slaughter:["Boars","Breeding Sows","Weaned pigs","Piglets","Porkers","Baconers","Culls"]},Chickens:{Broilers:["Day Old Chicks","Broilers"],Layers:["Hens","Point of Laying Hens","Culls"]},Ostriches:{Slaughter:["Breeding Stock","Slaughter Birds > 3 months","Slaughter Birds < 3 months","Chicks"]},Goats:{Slaughter:["Rams","Breeding Ewes","Young Ewes","Kids"]}},vme:{Vehicles:["Bakkie","Car","Truck","Tractor"],Machinery:["Mower","Mower Conditioner","Hay Rake","Hay Baler","Harvester"],Equipment:["Plough","Harrow","Ridgers","Rotovator","Cultivator","Planter","Combine","Spreader","Sprayer","Mixer"]}},h=["Good","Good to fair","Fair","Fair to poor","Poor"],i={livestock:{Cattle:["Breeding","Dairy","Slaughter"],Sheep:["Breeding","Slaughter"],Pigs:["Slaughter"],Chickens:["Broilers","Layers"],Ostriches:["Slaughter"],Goats:["Slaughter"]}},j=["Cape","Summer","Fruit","Winter"],k={crop:["Cropland"],farmland:[],improvement:[],"irrigated cropland":["Cropland","Irrigated Cropland"],livestock:["Grazing","Planted Pastures","Conservation"],pasture:["Grazing","Planted Pastures","Conservation"],"permanent crop":["Horticulture (Perennial)"],plantation:["Plantation"],vme:[],"water right":["Water Right"]},l={crop:"Field Crops",horticulture:"Horticulture",livestock:"Livestock"},m={crop:["Barley","Cabbage","Canola","Chicory","Citrus (Hardpeel)","Cotton","Cow Peas","Dry Bean","Dry Grapes","Dry Peas","Garlic","Grain Sorghum","Green Bean","Ground Nut","Hybrid Maize Seed","Lentils","Lucerne","Maize (Fodder)","Maize (Green)","Maize (Seed)","Maize (White)","Maize (Yellow)","Oats","Onion","Onion (Seed)","Popcorn","Potato","Pumpkin","Rye","Soya Bean","Sugar Cane","Sunflower","Sweetcorn","Tobacco","Tobacco (Oven dry)","Tomatoes","Watermelon","Wheat"],horticulture:["Almonds","Apples","Apricots","Avo","Avocado","Bananas","Cherries","Chilli","Citrus (Hardpeel Class 1)","Citrus (Softpeel)","Coffee","Figs","Grapes (Table)","Grapes (Wine)","Guavas","Hops","Kiwi Fruit","Lemons","Macadamia Nut","Mango","Mangos","Melons","Nectarines","Olives","Oranges","Papaya","Peaches","Peanut","Pears","Pecan Nuts","Persimmons","Pineapples","Pistachio Nuts","Plums","Pomegranates","Prunes","Quinces","Rooibos","Strawberries","Triticale","Watermelons"],livestock:["Cattle (Extensive)","Cattle (Feedlot)","Cattle (Stud)","Chicken (Broilers)","Chicken (Layers)","Dairy","Game","Goats","Horses","Ostrich","Pigs","Sheep (Extensive)","Sheep (Feedlot)","Sheep (Stud)"]};
return{assetTypes:function(){return e},seasonTypes:function(){return j},listServiceMap:function(){return d},getAssetTitle:function(a){return e[a]},getAssetLandUse:function(a){return k[a]},getAssetSubtypes:function(a){return f[a]||[]},getAssetCategories:function(a,b){return g[a]?g[a][b]||[]:[]},getAssetPurposes:function(a,b){return i[a]?i[a][b]||[]:[]},getCommodities:function(a){return m[a]||""},commodityTypes:function(){return l},commodities:function(){return m},conditionTypes:function(){return h},isFieldApplicable:function(a,b){var c=k[a]&&-1!==k[a].indexOf(b.landUse);return"irrigated cropland"==a?c&&b.irrigated:c},cleanAssetData:function(a){return"vme"==a.type&&(a.data.quantity=a.data.identificationNo&&a.data.identificationNo.length>0?1:a.data.quantity,a.data.identificationNo=1!=a.data.quantity?"":a.data.identificationNo),a}}}]),sdkHelperAssetApp.factory("assetValuationHelper",["assetHelper","underscore",function(a,b){function c(a,b){var c=12*(b.getFullYear()-a.getFullYear());return c-=a.getMonth()+1,c+=b.getMonth(),0>=c?0:c}var d=function(a){return{title:a.organization.name,date:a.date}};return{listServiceMap:function(){return d},calculateValuation:function(a,c){return"vme"==a.type&&0==isNaN(a.data.quantity)?c.assetValue=a.data.quantity*(c.unitValue||0):"livestock"==a.type&&0==isNaN(c.totalStock)?c.assetValue=c.totalStock*(c.unitValue||0):"crop"==a.type&&0==isNaN(c.expectedYield)?c.assetValue=c.expectedYield*(c.unitValue||0):"improvement"==a.type&&0==isNaN(c.replacementValue)?(c.totalDepreciation=b.reduce(["physicalDepreciation","functionalDepreciation","economicDepreciation"],function(a,b){return isNaN(c[b])?a:a+c[b]/100},0),c.assetValue=Math.round(c.replacementValue*(1-Math.min(c.totalDepreciation,1)))):"improvement"!=a.type&&0==isNaN(a.data.size)&&(c.assetValue=a.data.size*(c.unitValue||0)),c},getApplicableGuideline:function(d,e,f){var g=a.getAssetLandUse(e.type),h=b.chain(d).filter(function(a){return-1!==g.indexOf(a.assetClass)});if("crop"===e.type||"irrigated cropland"===e.type)h=h.where({assetClass:f.landUse}).filter(function(a){return void 0===a.soilPotential||a.soilPotential===f.croppingPotential});else if("pasture"===e.type)h=h.where({assetClass:f.landUse}).filter(function(a){return(void 0===a.crop||-1!==a.crop.indexOf(e.data.crop))&&(void 0===a.terrain||a.terrain===f.terrain)&&(void 0===a.minFarmSize||f.size>=a.minFarmSize)&&(void 0===a.maxFarmSize||f.size<a.maxFarmSize)});else if("permanent crop"===e.type){var i=new Date(Date.parse(e.data.establishedDate)),j=c(i,new Date);h=h.filter(function(a){return(void 0===a.crop||-1!==a.crop.indexOf(e.data.crop))&&(void 0===a.irrigationType||-1!==a.irrigationType.indexOf(f.irrigation))&&(void 0===a.minAge||j>=a.minAge)&&(void 0===a.maxAge||j<a.maxAge)})}else"plantation"===e.type?h=h.filter(function(a){return void 0===a.crop||-1!==a.crop.indexOf(e.data.crop)}):"water right"===e.type&&(h=h.filter(function(a){return void 0===a.waterSource||-1!==a.waterSource.indexOf(e.data.waterSource)}));return h.first().value()}}}]);var sdkHelperCropInspectionApp=angular.module("ag.sdk.helper.crop-inspection",["ag.sdk.helper.document"]);sdkHelperCropInspectionApp.factory("cropInspectionHelper",["documentHelper",function(a){var b=["Approved","Not Approved","Not Planted"],c=[["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12","R13","R14"],["V0","V1","V2","V3","V4","V5","R1","R2","R3","R4","R5","R6"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","R1","R2","R3","R4","R5","R6","R7","R8","R9"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","V17","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12"],["V0","V1","V2","V3","V4","V5","V6","V7","V8","V9","V10","V11","V12","V13","V14","V15","V16","V17","V18","V19","V20","V21","V22","V23","V24","V25","V26","V27","V28","R1","R2","R3","R4","R5","R6","R7","R8"],["V0","V1","V2","V3","V4","V5","V6","V7","R1","R2","R3","R4","R5","R6","R7","R8","R9"],["V0","V1","V2","V3","V4","V5","V6","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12","R13","R14","R15","R16","R17","R18"],["V0","V1","V2","V3","V4","R1","R2","R3","R4","R5","R6"],["V0","V1","V2","V3","V4","V5","V6","V7","R1","R2","R3","R4","R5","R6"]],d={Barley:c[1],Bean:c[5],"Bean (Broad)":c[5],"Bean (Dry)":c[5],"Bean (Sugar)":c[5],"Bean (Green)":c[5],"Bean (Kidney)":c[5],Canola:c[7],Cotton:c[6],"Grain Sorghum":c[3],Maize:c[0],"Maize (White)":c[0],"Maize (Yellow)":c[0],Soybean:c[2],Sunflower:c[4],Wheat:c[1],"Wheat (Durum)":c[1]},e={emergence:"Emergence Inspection",hail:"Hail Inspection",harvest:"Harvest Inspection",preharvest:"Pre Harvest Inspection",progress:"Progress Inspection"},f=[["Maize Commodity","Maize Hybrid","Maize Silo Fodder"]],g={Maize:f[0],"Maize (White)":f[0],"Maize (Yellow)":f[0]},h={hail:"Hail","multi peril":"Multi Peril"},i={hail:{hail:e.hail},"multi peril":e},j={disease:"Disease",fading:"Fading",uneven:"Uneven",other:"Other",root:"Root",shortage:"Shortage",weed:"Weed"},k=function(b){var c=a.listServiceWithTaskMap()(b);return c&&b.data.request&&(c.subtitle=c.title+" - "+b.data.enterprise,c.title=b.documentId,c.group=e[b.data.inspectionType]||""),c};return{listServiceMap:function(){return k},approvalTypes:function(){return b},inspectionTypes:function(){return e},policyTypes:function(){return h},policyInspectionTypes:function(a){return i[a]||{}},problemTypes:function(){return j},getGrowthStages:function(a){return d[a]||c[0]},getSeedTypes:function(a){return g[a]},getInspectionTitle:function(a){return e[a]||""},getPolicyTitle:function(a){return h[a]||""},getProblemTitle:function(a){return j[a]||""},hasSeedTypes:function(a){return void 0!==g[a]}}}]);var sdkHelperDocumentApp=angular.module("ag.sdk.helper.document",["ag.sdk.helper.task","ag.sdk.library"]);sdkHelperDocumentApp.provider("documentHelper",function(){var a=[],b={},c=function(a,b){return 1!=b?a.lastIndexOf("y")==a.length-1?a.substr(0,a.length-1)+"ies":a+"s":a};this.registerDocuments=function(c){c instanceof Array==!1&&(c=[c]),angular.forEach(c,function(c){-1===a.indexOf(c.docType)&&a.push(c.docType),c.deletable=c.deletable===!0,c.state=c.state||"document."+c.docType.replace(" ","-"),b[c.docType]=c})},this.getDocument=function(a){return b[a]},this.$get=["$injector","taskHelper","underscore",function(d,e,f){var g=function(a){if(b[a.docType]){var c=b[a.docType],e={id:a.id||a.__id,title:a.author?a.author:"",subtitle:"",docType:a.docType,group:c.title,updatedAt:a.updatedAt};return a.organization&&a.organization.name&&(e.subtitle=a.author?"From "+a.author+": ":"",e.title=a.organization.name),a.data&&c&&c.listServiceMap&&(c.listServiceMap instanceof Array&&(c.listServiceMap=d.invoke(c.listServiceMap)),c.listServiceMap(e,a)),e}},h=function(a){if(b[a.docType]){var c=g(a),d=f.findWhere(a.tasks,{type:"parent"});return c&&d&&(c.status={text:d.status,label:e.getTaskLabel(d.status)}),c}};return{listServiceMap:function(){return g},listServiceWithTaskMap:function(){return h},pluralMap:function(a,b){return c(a,b)},documentTypes:function(){return a},documentTitles:function(){return f.pluck(b,"title")},getDocumentTitle:function(a){return b[a]?b[a].title:void 0},getDocumentState:function(a){return b[a]?b[a].state:void 0},getDocumentMap:function(a){return b[a]}}}]});var sdkHelperEnterpriseBudgetApp=angular.module("ag.sdk.helper.enterprise-budget",["ag.sdk.library"]);sdkHelperEnterpriseBudgetApp.factory("enterpriseBudgetHelper",["underscore",function(){function a(a){a.data=a.data||{},a.data.details=a.data.details||{},a.data.sections=a.data.sections||[]}var b=function(a){return{id:a.id||a.__id,title:a.name,subtitle:a.commodityType+(a.region&&a.region.properties?" in "+a.region.properties.name:"")}},c={crop:"Field Crop",livestock:"Livestock",horticulture:"Horticulture"},d={expense:{code:"EXP",name:"Expenses"},income:{code:"INC",name:"Income"}},e={"Crop Sales":{code:"INC-CPS",name:"Crop Sales"},"Fruit Sales":{code:"INC-FRS",name:"Fruit Sales"},Harvest:{code:"HVT",name:"Harvest"},Preharvest:{code:"HVP",name:"Preharvest"},"Livestock Sales":{code:"INC-LSS",name:"Livestock Sales"},"Product Sales":{code:"INC-LSP",name:"Product Sales"},"Animal Feed":{code:"EXP-AMF",name:"Animal Feed"},Husbandry:{code:"HBD",name:"Husbandry"},"Indirect Costs":{code:"IDR",name:"Indirect Costs"},Marketing:{code:"MRK",name:"Marketing"},Replacements:{code:"RPM",name:"Replacements"}},f={"INC-LSS-SLAMB":{code:"INC-LSS-SLAMB",name:"Lamb",unit:"head"},"INC-LSS-SWEAN":{code:"INC-LSS-SWEAN",name:"Weaner lambs",unit:"head"},"INC-LSS-SEWE":{code:"INC-LSS-SEWE",name:"Ewe",unit:"head"},"INC-LSS-SWTH":{code:"INC-LSS-SWTH",name:"Wether (2-tooth plus)",unit:"head"},"INC-LSS-SRAM":{code:"INC-LSS-SRAM",name:"Ram",unit:"head"},"INC-LSS-CCALV":{code:"INC-LSS-CCALV",name:"Calf",unit:"head"},"INC-LSS-CWEN":{code:"INC-LSS-CWEN",name:"Weaner calves",unit:"head"},"INC-LSS-CCOW":{code:"INC-LSS-CCOW",name:"Cow or heifer",unit:"head"},"INC-LSS-CST18":{code:"INC-LSS-CST18",name:"Steer (18 moths plus)",unit:"head"},"INC-LSS-CST36":{code:"INC-LSS-CST36",name:"Steer (3 years plus)",unit:"head"},"INC-LSS-CBULL":{code:"INC-LSS-CBULL",name:"Bull (3 years plus)",unit:"head"},"INC-LSS-GKID":{code:"INC-LSS-GKID",name:"Kid",unit:"head"},"INC-LSS-GWEAN":{code:"INC-LSS-GWEAN",name:"Weaner kids",unit:"head"},"INC-LSS-GEWE":{code:"INC-LSS-GEWE",name:"Ewe (2-tooth plus)",unit:"head"},"INC-LSS-GCAST":{code:"INC-LSS-GCAST",name:"Castrate (2-tooth plus)",unit:"head"},"INC-LSS-GRAM":{code:"INC-LSS-GRAM",name:"Ram (2-tooth plus)",unit:"head"},"INC-LSP-MILK":{code:"INC-LSP-MILK",name:"Milk",unit:"l"},"INC-LSP-WOOL":{code:"INC-LSP-WOOL",name:"Wool",unit:"kg"},"INC-HVT-CROP":{code:"INC-HVT-CROP",name:"Crop",unit:"t"},"INC-HVT-FRUT":{code:"INC-HVT-FRUT",name:"Fruit",unit:"t"},"EXP-HVP-SEED":{code:"EXP-HVP-SEED",name:"Seed",unit:"kg"},"EXP-HVP-PLTM":{code:"EXP-HVP-PLTM",name:"Plant Material",unit:"each"},"EXP-HVP-FERT":{code:"EXP-HVP-FERT",name:"Fertiliser",unit:"t"},"EXP-HVP-LIME":{code:"EXP-HVP-LIME",name:"Lime",unit:"t"},"EXP-HVP-HERB":{code:"EXP-HVP-HERB",name:"Herbicides",unit:"l"},"EXP-HVP-PEST":{code:"EXP-HVP-PEST",name:"Pesticides",unit:"l"},"EXP-HVP-SPYA":{code:"EXP-HVP-SPYA",name:"Aerial spraying",unit:"ha"},"EXP-HVP-INSH":{code:"EXP-HVP-INSH",name:"Crop Insurance (Hail)",unit:"t"},"EXP-HVP-INSM":{code:"EXP-HVP-INSM",name:"Crop Insurance (Multiperil)",unit:"t"},"EXP-HVP-HEDG":{code:"EXP-HVP-HEDG",name:"Hedging cost",unit:"t"},"EXP-HVT-LABC":{code:"EXP-HVT-LABC",name:"Contract work (Harvest)",unit:"ha"},"EXP-HVT-STOR":{code:"EXP-HVT-STOR",name:"Storage",unit:"days"},"EXP-HVT-PAKM":{code:"EXP-HVT-PAKM",name:"Packaging material",unit:"each"},"EXP-HVT-DYCL":{code:"EXP-HVT-DYCL",name:"Drying and cleaning",unit:"t"},"EXP-HVT-PAKC":{code:"EXP-HVT-PAKC",name:"Packing cost",unit:"each"},"EXP-IDR-FUEL":{code:"EXP-IDR-FUEL",name:"Fuel",unit:"l"},"EXP-IDR-REPP":{code:"EXP-IDR-REPP",name:"Repairs & parts",unit:"Total"},"EXP-IDR-ELEC":{code:"EXP-IDR-ELEC",name:"Electricity",unit:"Total"},"EXP-IDR-WATR":{code:"EXP-IDR-WATR",name:"Water",unit:"Total"},"EXP-IDR-LABP":{code:"EXP-IDR-LABP",name:"Permanent labour",unit:"Total"},"EXP-IDR-SCHED":{code:"EXP-IDR-SCHED",name:"Scheduling",unit:"Total"},"EXP-IDR-LICS":{code:"EXP-IDR-LICS",name:"License",unit:"Total"},"EXP-IDR-INSA":{code:"EXP-IDR-INSA",name:"Insurance assets",unit:"Total"},"EXP-IDR-OTHER":{code:"EXP-IDR-OTHER",name:"Other costs",unit:"Total"},"EXP-RPM-SLAMB":{code:"EXP-RPM-SLAMB",name:"Lamb",unit:"head"},"EXP-RPM-SWEAN":{code:"EXP-RPM-SWEAN",name:"Weaner lambs",unit:"head"},"EXP-RPM-SEWE":{code:"EXP-RPM-SEWE",name:"Ewe",unit:"head"},"EXP-RPM-SWTH":{code:"EXP-RPM-SWTH",name:"Wether (2-tooth plus)",unit:"head"},"EXP-RPM-SRAM":{code:"EXP-RPM-SRAM",name:"Ram",unit:"head"},"EXP-RPM-CCALV":{code:"EXP-RPM-CCALV",name:"Calf",unit:"head"},"EXP-RPM-CWEN":{code:"EXP-RPM-CWEN",name:"Weaner calves",unit:"head"},"EXP-RPM-CCOW":{code:"EXP-RPM-CCOW",name:"Cow or heifer",unit:"head"},"EXP-RPM-CST18":{code:"EXP-RPM-CST18",name:"Steer (18 moths plus)",unit:"head"},"EXP-RPM-CST36":{code:"EXP-RPM-CST36",name:"Steer (3 years plus)",unit:"head"},"EXP-RPM-CBULL":{code:"EXP-RPM-CBULL",name:"Bull (3 years plus)",unit:"head"},"EXP-RPM-GKID":{code:"EXP-RPM-GKID",name:"Kid",unit:"head"},"EXP-RPM-GWEAN":{code:"EXP-RPM-GWEAN",name:"Weaner kids",unit:"head"},"EXP-RPM-GEWE":{code:"EXP-RPM-GEWE",name:"Ewe (2-tooth plus)",unit:"head"},"EXP-RPM-GCAST":{code:"EXP-RPM-GCAST",name:"Castrate (2-tooth plus)",unit:"head"},"EXP-RPM-GRAM":{code:"EXP-RPM-GRAM",name:"Ram (2-tooth plus)",unit:"head"},"EXP-AMF-LICK":{code:"EXP-AMF-LICK",name:"Lick",unit:"kg"},"EXP-HBD-VACC":{code:"EXP-HBD-VACC",name:"Drenching & vaccination",unit:"head"},"EXP-HBD-DIPP":{code:"EXP-HBD-DIPP",name:"Dipping & jetting",unit:"head"},"EXP-HBD-VETY":{code:"EXP-HBD-VETY",name:"Veterinary",unit:"head"},"EXP-HBD-SHER":{code:"EXP-HBD-SHER",name:"Shearing",unit:"head"},"EXP-HBD-CRCH":{code:"EXP-HBD-CRCH",name:"Crutching",unit:"head"},"EXP-MRK-LSSF":{code:"EXP-MRK-LSSF",name:"Livestock sales marketing fees",calculationFactor:"Livestock Sales",unit:"%"},"EXP-MRK-LSPF":{code:"EXP-MRK-LSPF",name:"Livestock products marketing fees",calculationFactor:"Product Sales",unit:"%"},"EXP-MRK-HOTF":{code:"EXP-MRK-HOTF",name:"Horticulture marketing fees",calculationFactor:"Fruit Sales",unit:"%"},"EXP-MRK-CRPF":{code:"EXP-MRK-CRPF",name:"Crop marketing fees",calculationFactor:"Crop Sales",unit:"%"},"EXP-MRK-LSTP":{code:"EXP-MRK-LSTP",name:"Livestock transport",unit:"head"},"EXP-MRK-HOTT":{code:"EXP-MRK-HOTT",name:"Horticulture transport",unit:"t"},"EXP-MRK-CRPT":{code:"EXP-MRK-CRPT",name:"Crop transport",unit:"t"}},g={crop:{income:{"Crop Sales":[f["INC-HVT-CROP"]]},expense:{Preharvest:[f["EXP-HVP-SEED"],f["EXP-HVP-FERT"],f["EXP-HVP-LIME"],f["EXP-HVP-HERB"],f["EXP-HVP-PEST"],f["EXP-HVP-SPYA"],f["EXP-HVP-INSH"],f["EXP-HVP-INSM"],f["EXP-HVP-HEDG"]],Harvest:[f["EXP-HVT-LABC"]],Marketing:[f["EXP-MRK-CRPF"],f["EXP-MRK-CRPT"]],"Indirect Costs":[f["EXP-IDR-FUEL"],f["EXP-IDR-REPP"],f["EXP-IDR-ELEC"],f["EXP-IDR-WATR"],f["EXP-IDR-LABP"],f["EXP-IDR-SCHED"],f["EXP-IDR-OTHER"]]}},horticulture:{income:{"Fruit Sales":[f["INC-HVT-FRUT"]]},expense:{Preharvest:[f["EXP-HVP-PLTM"],f["EXP-HVP-FERT"],f["EXP-HVP-LIME"],f["EXP-HVP-HERB"],f["EXP-HVP-PEST"],f["EXP-HVP-SPYA"],f["EXP-HVP-INSH"],f["EXP-HVP-INSM"]],Harvest:[f["EXP-HVT-LABC"],f["EXP-HVT-STOR"],f["EXP-HVT-PAKM"],f["EXP-HVT-DYCL"],f["EXP-HVT-PAKC"]],Marketing:[f["EXP-MRK-HOTF"],f["EXP-MRK-HOTT"]],"Indirect Costs":[f["EXP-IDR-FUEL"],f["EXP-IDR-REPP"],f["EXP-IDR-ELEC"],f["EXP-IDR-WATR"],f["EXP-IDR-LABP"],f["EXP-IDR-SCHED"],f["EXP-IDR-LICS"],f["EXP-IDR-INSA"],f["EXP-IDR-OTHER"]]}},livestock:{Cattle:{income:{"Livestock Sales":[f["INC-LSS-CCALV"],f["INC-LSS-CWEN"],f["INC-LSS-CCOW"],f["INC-LSS-CST18"],f["INC-LSS-CST36"],f["INC-LSS-CBULL"]],"Product Sales":[f["INC-LSP-MILK"]]},expense:{Replacements:[f["EXP-RPM-CCALV"],f["EXP-RPM-CWEN"],f["EXP-RPM-CCOW"],f["EXP-RPM-CST18"],f["EXP-RPM-CST36"],f["EXP-RPM-CBULL"]],"Animal Feed":[f["EXP-AMF-LICK"]],Husbandry:[f["EXP-HBD-VACC"],f["EXP-HBD-DIPP"],f["EXP-HBD-VETY"]],Marketing:[f["EXP-MRK-LSSF"],f["EXP-MRK-LSPF"],f["EXP-MRK-LSTP"]],"Indirect Costs":[f["EXP-IDR-FUEL"],f["EXP-IDR-REPP"],f["EXP-IDR-ELEC"],f["EXP-IDR-WATR"],f["EXP-IDR-LABP"],f["EXP-IDR-LICS"],f["EXP-IDR-INSA"],f["EXP-IDR-OTHER"]]}},Goats:{income:{"Livestock Sales":[f["INC-LSS-GKID"],f["INC-LSS-GWEAN"],f["INC-LSS-GEWE"],f["INC-LSS-GCAST"],f["INC-LSS-GRAM"]],"Product Sales":[f["INC-LSP-WOOL"],f["INC-LSP-MILK"]]},expense:{Replacements:[f["EXP-RPM-GID"],f["EXP-RPM-GWEAN"],f["EXP-RPM-GEWE"],f["EXP-RPM-GCAST"],f["EXP-RPM-GRAM"]],"Animal Feed":[f["EXP-AMF-LICK"]],Husbandry:[f["EXP-HBD-VACC"],f["EXP-HBD-DIPP"],f["EXP-HBD-VETY"],f["EXP-HBD-SHER"],f["EXP-HBD-CRCH"]],Marketing:[f["EXP-MRK-LSSF"],f["EXP-MRK-LSPF"],f["EXP-MRK-LSTP"]],"Indirect Costs":[f["EXP-IDR-FUEL"],f["EXP-IDR-REPP"],f["EXP-IDR-ELEC"],f["EXP-IDR-WATR"],f["EXP-IDR-LABP"],f["EXP-IDR-LICS"],f["EXP-IDR-INSA"],f["EXP-IDR-OTHER"]]}},Sheep:{income:{"Livestock Sales":[f["INC-LSS-SLAMB"],f["INC-LSS-SWEAN"],f["INC-LSS-SEWE"],f["INC-LSS-SWTH"],f["INC-LSS-SRAM"]],"Product Sales":[f["INC-LSP-WOOL"],f["INC-LSP-MILK"]]},expense:{Replacements:[f["EXP-RPM-SLAMB"],f["EXP-RPM-SWEAN"],f["EXP-RPM-SEWE"],f["EXP-RPM-SWTH"],f["EXP-RPM-SRAM"]],"Animal Feed":[f["EXP-AMF-LICK"]],Husbandry:[f["EXP-HBD-VACC"],f["EXP-HBD-DIPP"],f["EXP-HBD-VETY"],f["EXP-HBD-SHER"],f["EXP-HBD-CRCH"]],Marketing:[f["EXP-MRK-LSSF"],f["EXP-MRK-LSPF"],f["EXP-MRK-LSTP"]],"Indirect Costs":[f["EXP-IDR-FUEL"],f["EXP-IDR-REPP"],f["EXP-IDR-ELEC"],f["EXP-IDR-WATR"],f["EXP-IDR-LABP"],f["EXP-IDR-LICS"],f["EXP-IDR-INSA"],f["EXP-IDR-OTHER"]]}}}},h={Cattle:"Cow or heifer",Sheep:"Ewe",Goats:"Ewe (2-tooth plus)"},i={Cattle:{Calf:.32,"Weaner calves":.44,"Cow or heifer":1.1,"Steer (18  months plus)":.75,"Steer (3 years plus)":1.1,"Bull (3 years plus)":1.36},Sheep:{Lamb:.08,"Weaner Lambs":.11,Ewe:.16,"Wether (2-tooth plus)":.23,"Ram (2-tooth plus)":.23},Goats:{Kid:.12,"Weaner kids":.12,"Ewe (2-tooth plus)":.17,"Castrate (2-tooth plus)":.17,"Ram (2-tooth plus)":.12}},j={Pears:["1-7 years","7-12 years","12-20 years","20+ years"],Apples:["1-7 years","7-12 years","12-20 years","20+ years"],Olives:["2-3 years","5-7 years","9-19 years","21-25 years","25+ years"],"Pecan nuts":["1-2 years","4-5 years","6-8 years","8+ years"],Peaches:["1-2 years","3-5 years","5-8 years","8+ years"],"Stone Fruit":["2-3 years","5-7 years","9-19 years","21-25 years","25+ years"],Grapes:["0-1 years","1-2 years","2-3 years","3+ years"],Citrus:["2-3 years","5-7 years","9-19 years","21-25 years","25+ years"],Macadamia:["0-1 years","2-3 years","4-6 years","7-9 years","10+ years"]};return{listServiceMap:function(){return b},getRepresentativeAnimal:function(a){return h[a]},getConversionRate:function(a){return i[a][h[a]]},getConversionRates:function(a){return i[a]},getHorticultureStages:function(a){return j[a]||[]},getCategories:function(a,b,c,d,e){var f={};"livestock"==b&&g[b][c]&&(f=angular.copy(g[b][c][d])||{}),"crop"==b&&g[b][d]&&(f=angular.copy(g[b][d])||{}),"horticulture"==b&&g[b][d]&&(f=angular.copy(g[b][d])||{}),angular.forEach(a.data.sections,function(b){b.name.toLowerCase().indexOf(d)>-1&&("horticulture"!=a.assetType||"horticulture"==a.assetType&&b.horticultureStage==e)&&angular.forEach(b.productCategoryGroups,function(a){angular.forEach(a.productCategories,function(b){angular.forEach(f[a.name],function(c,d){c.code==b.code&&f[a.name].splice(d,1)})})})});var h=[];for(var i in f)f[i].forEach(function(a){a.groupBy=i,h.push(a)});return h},getModelType:function(a){return c[a]||""},validateBudgetData:function(b){return a(b),this.calculateTotals(b)},addExpenseCategory:function(a,b,c,g,h){var j=angular.copy(f[g]);j.quantity=0,j.pricePerUnit=0,j.value=0,j.valuePerLSU=0,"livestock"==a.assetType&&i[a.commodityType][j.name]&&(j.conversionRate=i[a.commodityType][j.name]);var k=!0,l=!0,m=-1,n=-1,o=angular.copy(d[b]),p=angular.copy(e[c]);return o.productCategoryGroups=[],p.productCategories=[],angular.forEach(a.data.sections,function(b,d){("horticulture"!=a.assetType&&b.name==o.name||"horticulture"==a.assetType&&b.name==o.name&&b.horticultureStage==h)&&(k=!1,m=d,o=b,b.productCategoryGroups.forEach(function(a,b){a.name==c&&(l=!1,n=b,p=a)}))}),k&&("horticulture"==a.assetType&&h&&(o.horticultureStage=h),a.data.sections.push(o),m=a.data.sections.length-1),l&&(a.data.sections[m].productCategoryGroups.push(p),n=a.data.sections[m].productCategoryGroups.length-1),a.data.sections[m].productCategoryGroups[n].productCategories.push(j),a},calculateTotals:function(b){a(b),"livestock"==b.assetType&&(b.data.details.calculatedLSU=b.data.details.herdSize*i[b.commodityType][h[b.commodityType]]);var c=0,d=0;return angular.forEach(b.data.sections,function(a){a.total={value:0,valuePerLSU:0},angular.forEach(a.productCategoryGroups,function(c){c.total={value:0,valuePerLSU:0},angular.forEach(c.productCategories,function(a){if("%"==a.unit){var d=0;angular.forEach(b.data.sections,function(b){angular.forEach(b.productCategoryGroups,function(b){b.name==a.calculationFactor&&(d=b.total.value)})}),a.value=a.pricePerUnit*d/100,"livestock"==b.assetType&&(a.valuePerLSU=a.pricePerUnit/i[b.commodityType][a.name])}else"Total"==a.unit&&(a.quantity=1),a.value=a.pricePerUnit*a.quantity,"livestock"==b.assetType&&(a.valuePerLSU=a.pricePerUnit/i[b.commodityType][a.name]);c.total.value+=a.value,"livestock"==b.assetType&&(c.total.valuePerLSU+=a.valuePerLSU)}),a.total.value+=c.total.value,"livestock"==b.assetType&&(a.total.valuePerLSU+=c.total.valuePerLSU)}),"Income"==a.name?c=a.total.value:d+=a.total.value}),b.data.details.grossProfit=c-d,"horticulture"==b.assetType&&(b.data.details.grossProfitByStage={},angular.forEach(j[b.commodityType],function(a){var c=0,d=0;angular.forEach(b.data.sections,function(b){b.horticultureStage==a&&"Income"==b.name&&(c=b.total.value),b.horticultureStage==a&&"Expenses"==b.name&&(d=b.total.value)}),b.data.details.grossProfitByStage[a]=c-d})),"livestock"==b.assetType&&(b.data.details.grossProfitPerLSU=b.data.details.grossProfit/b.data.details.calculatedLSU),b}}}]);var sdkHelperFarmerApp=angular.module("ag.sdk.helper.farmer",["ag.sdk.interface.map","ag.sdk.library"]);sdkHelperFarmerApp.factory("farmerHelper",["geoJSONHelper",function(a){var b=function(a){function b(a){var b=[];return angular.forEach(a.legalEntities,function(a){b.push(a.name),a.registrationNumber&&b.push(a.registrationNumber)}),b}return{id:a.id||a.__id,title:a.name,subtitle:a.operationType,profileImage:a.profilePhotoSrc,searchingIndex:b(a)}},c=["Commercial","Cooperative","Corporate","Smallholder"];return{listServiceMap:function(){return b},businessEntityTypes:function(){return c},getFarmerLocation:function(b){if(b){if(b.data&&b.data.loc)return b.data.loc.coordinates;if(b.legalEntities){var c=a();return angular.forEach(b.legalEntities,function(a){a.assets&&angular.forEach(a.assets,function(a){c.addGeometry(a.loc)})}),c.getCenter()}}return null}}}]),sdkHelperFarmerApp.factory("legalEntityHelper",["underscore",function(a){function b(b){this.enterprises=a.map(b||[],function(a){return a.name?a.name:a}),this.selection={category:void 0,item:void 0}}var c=function(a){return{id:a.id||a.__id,title:a.name,subtitle:a.type}},d=["Individual","Sole Proprietary","Joint account","Partnership","Close Corporation","Private Company","Public Company","Trust","Non-Profitable companies","Cooperatives","In- Cooperatives","Other Financial Intermediaries"],e={"Field Crops":["Barley","Cabbage","Canola","Chicory","Citrus (Hardpeel)","Cotton","Cow Peas","Dry Bean","Dry Grapes","Dry Peas","Garlic","Grain Sorghum","Green Bean","Ground Nut","Hybrid Maize Seed","Lentils","Lucerne","Maize (Fodder)","Maize (Green)","Maize (Seed)","Maize (White)","Maize (Yellow)","Oats","Onion","Onion (Seed)","Popcorn","Potato","Pumpkin","Rye","Soya Bean","Sugar Cane","Sunflower","Sweetcorn","Tobacco","Tobacco (Oven dry)","Tomatoes","Watermelon","Wheat"],Horticulture:["Almonds","Apples","Apricots","Avo","Avocado","Bananas","Cherries","Chilli","Citrus (Hardpeel Class 1)","Citrus (Softpeel)","Coffee","Figs","Grapes (Table)","Grapes (Wine)","Guavas","Hops","Kiwi Fruit","Lemons","Macadamia Nut","Mango","Mangos","Melons","Nectarines","Olives","Oranges","Papaya","Peaches","Peanut","Pears","Pecan Nuts","Persimmons","Pineapples","Pistachio Nuts","Plums","Pomegranates","Prunes","Quinces","Rooibos","Strawberries","Triticale","Watermelons"],Livestock:["Cattle (Extensive)","Cattle (Feedlot)","Cattle (Stud)","Chicken (Broilers)","Chicken (Layers)","Dairy","Game","Goats","Horses","Ostrich","Pigs","Sheep (Extensive)","Sheep (Feedlot)","Sheep (Stud)"]};return b.prototype.addEnterprise=function(a){a=a||this.selection.item,-1==this.enterprises.indexOf(a)&&(this.enterprises.push(a),this.selection.item=void 0)},b.prototype.removeEnterprise=function(a){"string"==typeof a&&(a=this.enterprises.indexOf(a)),-1!==a&&this.enterprises.splice(a,1)},{listServiceMap:function(){return c},legalEntityTypes:function(){return d},enterpriseTypes:function(){return e},enterpriseEditor:function(a){return new b(a)}}}]),sdkHelperFarmerApp.factory("landUseHelper",function(){var a=["High","Medium","Low"],b=["0 - 30cm","30 - 60cm","60 - 90cm","90 - 120cm","120cm +"],c=["Centre-Pivot","Flood","Micro","Sub-drainage","Sprinkler","Drip"],d=["Cropland","Grazing","Horticulture (Intensive)","Horticulture (Perennial)","Horticulture (Seasonal)","Housing","Plantation","Planted Pastures","Structures (Handling)","Structures (Processing)","Structures (Storage)","Utilities","Wasteland","Conservation"],e=["Sand","Loamy Sand","Clay Sand","Sandy Loam","Fine Sandy Loam","Loam","Silty Loam","Sandy Clay Loam","Clay Loam","Clay","Gravel","Other","Fine Sandy Clay","Medium Sandy Clay Loam","Fine Sandy Clay Loam","Loamy Medium Sand","Medium Sandy Loam","Coarse Sandy Clay Loam","Coarse Sand","Loamy Fine Sand","Loamy Coarse Sand","Fine Sand","Silty Clay","Coarse Sandy Loam","Medium Sand","Medium Sandy Clay","Coarse Sandy Clay","Sandy Clay"],f=["Plains","Mountains"],g=["Irrigation Scheme","River","Dam","Borehole"],h={Cropland:["Barley","Bean","Bean (Broad)","Bean (Dry)","Bean (Sugar)","Bean (Green)","Bean (Kidney)","Canola","Cassava","Cotton","Cowpea","Grain Sorghum","Groundnut","Maize","Maize (White)","Maize (Yellow)","Oats","Pearl Millet","Potato","Rape","Rice","Rye","Soybean","Sunflower","Sweet Corn","Sweet Potato","Tobacco","Triticale","Wheat","Wheat (Durum)"],Grazing:["Bahia-Notatum","Bottle Brush","Buffalo","Buffalo (Blue)","Buffalo (White)","Bush","Cocksfoot","Common Setaria","Dallis","Phalaris","Rescue","Rhodes","Smuts Finger","Tall Fescue","Teff","Veld","Weeping Lovegrass"],"Horticulture (Perennial)":["Almond","Aloe","Apple","Apricot","Avocado","Banana","Cherry","Coconut","Coffee","Grape","Grape (Bush Vine)","Grape (Red)","Grape (Table)","Grape (White)","Grapefruit","Guava","Hops","Kiwi Fruit","Lemon","Litchi","Macadamia Nut","Mandarin","Mango","Nectarine","Olive","Orange","Papaya","Peach","Pear","Pecan Nut","Persimmon","Pineapple","Pistachio Nut","Plum","Rooibos","Sisal","Sugarcane","Tea","Walnuts"],"Horticulture (Seasonal)":["Asparagus","Beet","Beetroot","Blackberry","Borecole","Brinjal","Broccoli","Brussel Sprout","Cabbage","Cabbage (Chinese)","Cabbage (Savoy)","Cactus Pear","Carrot","Cauliflower","Celery","Chicory","Chilly","Cucumber","Cucurbit","Dry Pea","Garlic","Ginger","Granadilla","Kale","Kohlrabi","Leek","Lespedeza","Lettuce","Makataan","Mustard","Mustard (White)","Onion","Paprika","Parsley","Parsnip","Pea","Pepper","Pumpkin","Quince","Radish","Squash","Strawberry","Swede","Sweet Melon","Swiss Chard","Tomato","Turnip","Vetch (Common)","Vetch (Hairy)","Watermelon","Youngberry"],Plantation:["Bluegum","Pine","Wattle"],"Planted Pastures":["Birdsfoot Trefoil","Carribean Stylo","Clover","Clover (Arrow Leaf)","Clover (Crimson)","Clover (Persian)","Clover (Red)","Clover (Rose)","Clover (Strawberry)","Clover (Subterranean)","Clover (White)","Kikuyu","Lucerne","Lupin","Lupin (Narrow Leaf)","Lupin (White)","Lupin (Yellow)","Medic","Medic (Barrel)","Medic (Burr)","Medic (Gama)","Medic (Snail)","Medic (Strand)","Ryegrass","Ryegrass (Hybrid)","Ryegrass (Italian)","Ryegrass (Westerwolds)","Serradella","Serradella (Yellow)","Silver Leaf Desmodium"]};return{croppingPotentialTypes:function(){return a},effectiveDepthTypes:function(){return b},irrigationTypes:function(){return c},landUseTypes:function(){return d},soilTextureTypes:function(){return e},terrainTypes:function(){return f},waterSourceTypes:function(){return g},getCropsForLandUse:function(a){return h[a]||[]},isCroppingPotentialRequired:function(a){return"Cropland"==a},isTerrainRequired:function(a){return"Grazing"==a}}}),sdkHelperFarmerApp.factory("farmHelper",["geoJSONHelper","geojsonUtils","underscore",function(a,b,c){var d=function(a){return{id:a.id||a.__id,title:a.name}};return{listServiceMap:function(){return d},containsPoint:function(a,c,d){var e=!1;return angular.forEach(c,function(c){"farmland"==c.type&&c.farmId&&c.farmId==d.id&&b.pointInPolygon(a,c.data.loc)&&(e=!0)}),e},getCenter:function(b,c){var d=a();return angular.forEach(b,function(a){"farmland"==a.type&&a.farmId&&a.farmId==c.id&&d.addGeometry(a.data.loc)}),d.getCenterAsGeojson()},validateFieldName:function(a,b,d){b.fieldName=b.fieldName?b.fieldName.toUpperCase().replace(/[^0-9A-Z]/g,""):b.fieldName;var e=c.findWhere(a.data.fields,{fieldName:b.fieldName});return angular.isObject(e)?angular.isObject(d)&&e.fieldName===d.fieldName:!0}}}]);var sdkHelperFavouritesApp=angular.module("ag.sdk.helper.favourites",["ag.sdk.helper.document","ag.sdk.helper.task"]);sdkHelperFavouritesApp.factory("activityHelper",["documentHelper",function(a){var b=function(b){var f={id:b.id||b.__id,date:b.date};return"object"==typeof b.actor?(b.actor.displayName?(f.title=b.actor.displayName,f.subtitle=b.actor.displayName):(f.title=b.actor.firstName+" "+b.actor.lastName,f.subtitle=b.actor.firstName+" "+b.actor.lastName),b.actor.position&&(f.title+=" ("+b.actor.position+")"),f.profilePhotoSrc=b.actor.profilePhotoSrc):b.organization?(f.title=b.organization.name,f.subtitle=b.organization.name):(f.title="Someone",f.subtitle="Someone"),f.subtitle+=" "+d(b.action)+" ",f.referenceId="farmer"==b.referenceType?b.organization.id:b[b.referenceType+"Id"],"farmer"==b.referenceType?(f.subtitle+="invite"==b.action?b.organization.name+" to create an Agrista account":"register"==b.action?"your request to join Agrista":"create"==b.action?"a customer portfolio for "+b.organization.name:"decline"==b.action?"a task for "+b.organization.name:"the portfolio of "+b.organization.name,f.referenceState="customer.details"):(void 0!==b[b.referenceType]?"document"==b.referenceType?(f.subtitle+=e(b[b.referenceType].docType)+" "+a.getDocumentTitle(b[b.referenceType].docType)+" "+b.referenceType,f.referenceState=a.getDocumentState(b[b.referenceType].docType)):"task"==b.referenceType?(f.subtitle+="the "+taskHelper.getTaskTitle(b[b.referenceType].todo)+" "+b.referenceType,f.referenceState=a.getTaskState(b[b.referenceType].todo)):f.subtitle+=e(b.referenceType)+" "+b.referenceType:f.subtitle+=e(b.referenceType)+" "+b.referenceType,b.actor&&b.organization&&b.organization.name&&(f.subtitle+=" "+c(b.action)+" "+b.organization.name)),f},c=function(a){return f[a]||"for"},d=function(a){return g[a]||(a.lastIndexOf("e")==a.length-1?a+"d":a+"ed")},e=function(a){var b=["a","e","i","o","u"];return h[a]||(-1!=b.indexOf(a.substr(0,1))?"an":"a")},f={share:"with",sent:"to"},g={register:"accepted",sent:"sent"},h={"asset register":"an"};return{listServiceMap:function(){return b},getActionVerb:d,getReferenceArticle:e}}]),sdkHelperFavouritesApp.factory("notificationHelper",["taskHelper","documentHelper",function(a,b){var c=function(c){var f={id:c.id||c.__id,title:c.sender,subtitle:e[c.notificationType].title,state:d(c.notificationType,c.dataType)};return"task"==c.dataType?f.subtitle+=" "+a.getTaskTitle(c.sharedData.todo):"document"==c.dataType&&(f.subtitle+=" "+b.getDocumentTitle(c.sharedData.docType)),f.subtitle+=" "+c.dataType+(null==c.organization?"":" for "+c.organization.name),f},d=function(a,b){var c=e[a]?e[a].state:"view";return"notification."+c+"-"+b},e={reassign:{title:"Reassign",state:"manage"},"import":{title:"Import",state:"import"},view:{title:"View",state:"view"},reject:{title:"Rejected",state:"view"},review:{title:"Review",state:"view"}};return{listServiceMap:function(){return c},getNotificationState:function(a,b){return d(a,b)},getNotificationTitle:function(a){return e[a]?e[a].title:""}}}]);var sdkHelperMerchantApp=angular.module("ag.sdk.helper.merchant",["ag.sdk.library"]);sdkHelperMerchantApp.factory("merchantHelper",["underscore",function(a){function b(b,c){b=b||[],this.services=a.map(c||[],function(a){return a.name?a.name:a}),this.selection={list:b,mode:0==b.length?"add":"select",text:""}}var c=function(a){return{id:a.id||a.__id,title:a.name,subtitle:(a.subscriptionPlan?g(a.subscriptionPlan)+" ":"")+(a.partnerType?f(a.partnerType)+" partner":""),status:a.registered?{text:"registered",label:"label-success"}:!1}
},d={benefit:"Benefit",standard:"Standard"},e={small:"Small",medium:"Medium",large:"Large",association:"Association"},f=function(a){return d[a]||""},g=function(a){return e[a]||""};return b.prototype.toggleMode=function(){this.selection.list.length>0&&(this.selection.mode="select"==this.selection.mode?"add":"select",this.selection.text="")},b.prototype.addService=function(a){a=a||this.selection.text,-1==this.services.indexOf(a)&&(this.services.push(a),this.selection.text="")},b.prototype.removeService=function(a){"string"==typeof a&&(a=this.services.indexOf(a)),-1!==a&&this.services.splice(a,1)},{listServiceMap:function(){return c},partnerTypes:function(){return d},getPartnerType:f,subscriptionPlans:function(){return e},getSubscriptionPlan:g,serviceEditor:function(a,c){return new b(a,c)}}}]);var sdkHelperTaskApp=angular.module("ag.sdk.helper.task",["ag.sdk.authorization","ag.sdk.utilities","ag.sdk.interface.list","ag.sdk.library"]);sdkHelperTaskApp.provider("taskHelper",["underscore",function(a){var b=["assigned","in progress","in review"],c=function(c){var d=c.documentKey,e=a.filter(c.subtasks,function(a){return a.type&&-1!==b.indexOf(a.status)&&"child"==a.type}).map(function(a){return{id:a.id||c.__id,title:c.organization.name,subtitle:g(a.todo),todo:a.todo,groupby:d,status:{text:a.status||" ",label:j(a.status)}}});return e.length?e:void 0},d=function(a){return{id:a.documentId,title:a.organization.name,subtitle:a.documentKey,status:{text:a.status||" ",label:j(a.status)}}},e={},f=function(a){return e[a]?e[a].state:void 0},g=function(a){return e[a]?e[a].title:void 0},h=function(a){return k[a]||a||" "},i=function(a){return l[a]||a||" "},j=function(a){switch(a){case"in progress":case"in review":return"label-warning";case"done":return"label-success";default:return"label-default"}},k={backlog:"Backlog",assigned:"Assigned","in progress":"In Progress","in review":"In Review",done:"Done",archive:"Archived"},l={accept:"Accept",decline:"Decline",assign:"Assign",start:"Start",complete:"Complete",approve:"Approve",reject:"Reject",release:"Release"};this.addTasks=function(b){e=a.extend(e,b)},this.$get=["authorization","listService","dataMapService",function(e,k,l){return{listServiceMap:function(){return c},parentListServiceMap:function(){return d},getTaskState:f,getTaskTitle:g,getTaskStatusTitle:h,getTaskActionTitle:i,getTaskLabel:j,filterTasks:function(b){return a.filter(b,function(a){return void 0!==f(a.todo)})},updateListService:function(d,f,g,h){var i=e.currentUser(),j=a.findWhere(g,{id:d});k.addItems(l({id:j.parentTaskId,documentKey:j.documentKey,type:"parent",todo:f,organization:h,subtasks:a.filter(g,function(a){return a&&a.assignedTo==i.username})},c)),j&&-1===b.indexOf(j.status)&&k.removeItems(j.id)}}}]}]),sdkHelperTaskApp.factory("taskWorkflowHelper",function(){var a={accept:["backlog","assigned","in progress","in review","complete"],decline:["assigned"],start:["assigned","in progress"],assign:["backlog","assigned","in progress","in review"],complete:["assigned","in progress"],approve:["in review"],reject:["assigned","in review"],release:["done"]};return{canChangeToState:function(b,c){return a[c]?-1!==a[c].indexOf(b.status):!0}}});var sdkHelperTeamApp=angular.module("ag.sdk.helper.team",["ag.sdk.library"]);sdkHelperTeamApp.factory("teamHelper",["underscore",function(a){function b(b,c){b=b||[],this.teams=a.map(c||[],function(a){return a.name?a.name:a}),this.teamsDetails=a.map(c||[],function(a){return a}),this.selection={list:b,mode:0==b.length?"add":"select",text:""}}return b.prototype.toggleMode=function(){this.selection.list.length>0&&(this.selection.mode="select"==this.selection.mode?"add":"select",this.selection.text="")},b.prototype.addTeam=function(b){b=b||this.selection.text,-1!=this.teams.indexOf(b)||a.findWhere(this.teamsDetails,b)||(this.teams.push(b),this.teamsDetails.push(b),this.selection.text="")},b.prototype.removeTeam=function(a){"string"==typeof a&&(a=this.teams.indexOf(a)),-1!==a&&(this.teams.splice(a,1),this.teamsDetails.splice(a,1))},{teamEditor:function(a,c){return new b(a,c)}}}]);var sdkHelperUserApp=angular.module("ag.sdk.helper.user",[]);sdkHelperUserApp.factory("userHelper",[function(){var a=function(a){return{id:a.id||a.__id,title:a.firstName+" "+a.lastName,subtitle:a.position,teams:a.teams}},b=["English"];return{listServiceMap:function(){return a},languageList:function(){return b}}}]);var sdkInterfaceListApp=angular.module("ag.sdk.interface.list",["ag.sdk.id"]);sdkInterfaceListApp.factory("listService",["$rootScope","objectId",function(a,b){var c,d,e,f,g,h=[],i=function(){a.$broadcast("list::button__clicked")},j=function(b){c!==b&&("object"==typeof b?(c=b,c.click=c.click||i):c=void 0,a.$broadcast("list::button__changed",c))},k=function(b){d!==b&&(d=void 0!==b?b:void 0,a.$broadcast("list::groupby__changed",d))},l=function(b){e!==b&&(void 0!==b?(h=[],e=b):e=void 0,a.$broadcast("list::scroll__changed",e))},m=function(b){f!==b&&(f=void 0!==b?b:void 0,a.$broadcast("list::search__changed",f))},n=function(a){if(g=a,h instanceof Array)for(var b=0;b<h.length;b++)h[b].active=!1,void 0!==a&&(h[b].id==a?h[b].active=!0:h[b].type==a&&(h[b].active=!0));else for(var c in h)h.hasOwnProperty(c)&&(h[c].active=c==a)},o=function(){if(h instanceof Array){for(var a=0;a<h.length;a++)if(h[a].id==g)return h[a]}else for(var b in h)if(h.hasOwnProperty(b)&&b==g)return h[b];return null};return a.$on("$stateChangeSuccess",function(a,b,c){n(c.id?c.id:c.type)}),a.$on("list::item__selected",function(a,b){n("object"==typeof b?b.id?b.id:b.type:b)}),{config:function(a){a.reset&&(c=void 0,d=void 0,e=void 0,f=void 0,h=[],g=void 0),j(a.button),k(a.groupby),l(a.infiniteScroll),m(a.search)},button:function(a){return 1==arguments.length&&j(a),c},groupby:function(a){return 1==arguments.length&&k(a),d},infiniteScroll:function(a){return 1==arguments.length&&l(a),e},search:function(a){return 1==arguments.length&&m(a),f},items:function(b){return void 0!==b&&(h=angular.copy(b),g=void 0,a.$broadcast("list::items__changed",h)),h},length:function(){return h.length},addItems:function(c){if(void 0!==c){c instanceof Array==!1&&(c=[c]);for(var d=0;d<c.length;d++){var e=c[d];if(e.id=e.id||b().toBase64String(),h instanceof Array){for(var f=!1,i=0;i<h.length;i++)if(e.id==h[i].id){h[i]=e,h[i].active=void 0!==g&&g==e.id,f=!0;break}0==f&&h.push(e)}else h[e.id]=e,h[e.id].active=void 0!==g&&g==e.id}a.$broadcast("list::items__changed",h)}},removeItems:function(b){if(void 0!==b){b instanceof Array==!1&&(b=[b]);for(var c=0;c<b.length;c++){var d=b[c];if(h instanceof Array){for(var e=0;e<h.length;e++)if(d==h[e].id){if(h.splice(e,1),d==g&&h.length){var f=h[e]?h[e]:h[e-1];a.$broadcast("list::item__selected",f)}break}}else delete h[d]}h instanceof Array&&0==h.length&&a.$broadcast("list::items__empty"),a.$broadcast("list::items__changed",h)}},selectFirstItem:function(){a.$broadcast("list::selectFirst__requested")},setActiveItem:function(a){n(a)},getActiveItem:function(){return o()}}}]);var sdkInterfaceMapApp=angular.module("ag.sdk.interface.map",["ag.sdk.utilities","ag.sdk.id","ag.sdk.config","ag.sdk.library"]);sdkInterfaceMapApp.factory("geoJSONHelper",function(){function a(b,c){return this instanceof a?void this.addGeometry(b,c):new a(b,c)}function b(a,c){c&&(angular.isArray(c[0])?angular.forEach(c,function(c){b(a,c)}):angular.isArray(c)&&a.push([c[1],c[0]]))}return a.prototype={getJson:function(){return this._json},getType:function(){return this._json.type},getGeometryType:function(){return this._json.geometry?this._json.geometry.type:this._json.type},getBounds:function(){var a=[];if(this._json){var c=this._json.features||[this._json];angular.forEach(c,function(c){var d=c.geometry||c;b(a,d.coordinates)})}return a},getCenter:function(a){var b=[0,0];return a=a||this.getBounds(),angular.forEach(a,function(a){b[0]+=a[0],b[1]+=a[1]}),a.length?[b[0]/a.length,b[1]/a.length]:null},getCenterAsGeojson:function(a){return{coordinates:this.getCenter(a).reverse(),type:"Point"}},getProperty:function(a){return this._json&&this._json.properties?this._json.properties[a]:void 0},setCoordinates:function(a){this._json&&"FeatureCollection"!=this._json.type&&(this._json.geometry?this._json.geometry.coordinates=a:this._json.coordinates=a)},addProperties:function(a){var b=this;return this._json&&a&&("FeatureCollection"!=b._json.type&&"Feature"!=b._json.type?b._json={type:"Feature",geometry:b._json,properties:a}:(b._json.properties=b._json.properties||{},angular.forEach(a,function(a,c){b._json.properties[c]=a}))),b},addGeometry:function(a,b){return a&&(void 0===this._json?(this._json=a,this.addProperties(b)):("FeatureCollection"!=this._json.type&&"Feature"!=this._json.type&&(this._json={type:"Feature",geometry:this._json}),"Feature"==this._json.type&&(this._json={type:"FeatureCollection",features:[this._json]}),"FeatureCollection"==this._json.type&&this._json.features.push({type:"Feature",geometry:a,properties:b}))),this}},function(b,c){return new a(b,c)}}),sdkInterfaceMapApp.provider("mapMarkerHelper",["underscore",function(a){var b=function(b,c,d){return a.defaults(d||{},{iconUrl:"img/icons/"+b+"."+(c?c:"default")+".png",shadowUrl:"img/icons/"+b+".shadow.png",iconSize:[48,48],iconAnchor:[22,42],shadowSize:[73,48],shadowAnchor:[22,40],labelAnchor:[12,-24]})},c=this.getMarker=function(a,c,d){return"object"==typeof c&&(d=c,c="default"),b(a,c,d)},d=this.getMarkerStates=function(a,c,d){var e={};return"string"==typeof a&&angular.forEach(c,function(c){e[c]=b(a,c,d)}),e};this.$get=function(){return{getMarker:c,getMarkerStates:d}}}]),sdkInterfaceMapApp.provider("mapStyleHelper",["mapMarkerHelperProvider",function(a){var b={asset:a.getMarkerStates("asset",["default","success","error"]),zone:a.getMarkerStates("marker",["default","success","error"])},c={foreground:{district:{style:{weight:2,color:"white",opacity:.8,fillColor:"#0094D6",fillOpacity:.5}},farmland:{style:{weight:2,color:"white",opacity:.8,fillColor:"blue",fillOpacity:.3}},field:{icon:"success",style:{weight:2,color:"white",opacity:.8,fillColor:"#5b4723",fillOpacity:.8}},crop:{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#aa64b0",fillOpacity:.8}},improvement:{icon:"success",style:{weight:4,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.8}},"irrigated cropland":{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#4573d5",fillOpacity:.8}},pasture:{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#ffde40",fillOpacity:.8}},"permanent crop":{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#487811",fillOpacity:.8}},plantation:{icon:b.asset.success,style:{weight:2,color:"white",opacity:.8,fillColor:"#00e64a",fillOpacity:.8}},zone:{icon:b.zone.success,draggable:!0,style:{weight:4,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.8}},farmgate:{icon:"success"},homestead:{icon:"success"}},background:{district:{style:{weight:1,color:"white",opacity:.8,fillColor:"#0094D6",fillOpacity:.2}},farmland:{style:{weight:1,color:"white",opacity:.8,fillColor:"blue",fillOpacity:.1}},field:{icon:"default",style:{weight:1,color:"white",opacity:.8,fillColor:"#5b4723",fillOpacity:.4}},crop:{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#aa64b0",fillOpacity:.4}},improvement:{icon:"default",style:{weight:4,color:"white",opacity:.8,fillColor:"#ff6666",fillOpacity:.5}},"irrigated cropland":{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#4573d5",fillOpacity:.4}},pasture:{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#ffde40",fillOpacity:.4}},"permanent crop":{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#487811",fillOpacity:.4}},plantation:{icon:b.asset.default,style:{weight:1,color:"white",opacity:.8,fillColor:"#00e64a",fillOpacity:.4}},zone:{icon:b.asset.default,style:{weight:2,color:"white",opacity:.5,fillColor:"#ff6666",fillOpacity:.5}},farmgate:{icon:"default"},homestead:{icon:"default",label:{message:"Homestead"}}}},d=this.getStyle=function(d,e,f){var g=c[d]&&c[d][e]?angular.copy(c[d][e]):{};return"string"==typeof g.icon&&(void 0===b[e]&&(b[e]=a.getMarkerStates(e,["default","success","error"])),g.icon=b[e][g.icon]),"object"==typeof f&&(g.label=f),g},e=this.setStyle=function(a,b,d){c[a]=c[a]||{},c[a][b]=d};this.$get=function(){return{getStyle:d,setStyle:e}}}]),sdkInterfaceMapApp.provider("mapboxService",["underscore",function(a){var b={options:{attributionControl:!0,layersControl:!0,scrollWheelZoom:!1,zoomControl:!0},layerControl:{baseTile:"agrista.map-65ftbmpi",baseLayers:{Agrista:{base:!0,type:"mapbox"},Google:{type:"google",tiles:"SATELLITE"}},overlays:{}},controls:{},events:{},view:{coordinates:[-28.691,24.714],zoom:6},bounds:{},layers:{},geojson:{}},c={};this.config=function(c){b=a.defaults(c||{},b)},this.$get=["$rootScope","objectId",function(d,e){function f(a,c){var e=this;e._id=a,e._ready=!1,e._options=c,e._show=e._options.show||!1,e._config=angular.copy(b),e._requestQueue=[],d.$on("mapbox-"+e._id+"::init",function(){e.dequeueRequests(),e._ready=!0}),d.$on("mapbox-"+e._id+"::destroy",function(){e._ready=!1,e._options.persist!==!0&&(e._config=angular.copy(b))})}return f.prototype={getId:function(){return this._id},reset:function(){this._config=angular.copy(b),d.$broadcast("mapbox-"+this._id+"::reset")},clearLayers:function(){this.removeOverlays(),this.removeLayers(),this.removeGeoJSON()},enqueueRequest:function(a,b){this._ready?d.$broadcast(a,b):this._requestQueue.push({event:a,args:b})},dequeueRequests:function(){if(this._requestQueue.length)do{var a=this._requestQueue.shift();d.$broadcast(a.event,a.args)}while(this._requestQueue.length)},shouldShow:function(){return this._show},hide:function(){this._show=!1,this.enqueueRequest("mapbox-"+this._id+"::hide",{})},show:function(){this._show=!0,this.enqueueRequest("mapbox-"+this._id+"::show",{})},invalidateSize:function(){this.enqueueRequest("mapbox-"+this._id+"::invalidate-size",{})},getOptions:function(){return this._config.options},setOptions:function(a){var b=this;angular.forEach(a,function(a,c){b._config.options[c]=a})},getMapCenter:function(a){this.enqueueRequest("mapbox-"+this._id+"::get-center",a)},getMapBounds:function(a){this.enqueueRequest("mapbox-"+this._id+"::get-bounds",a)},getMapControl:function(a,b){this.enqueueRequest("mapbox-"+this._id+"::get-control",{control:a,handler:b})},getBaseTile:function(){return this._config.layerControl.baseTile},setBaseTile:function(a){this._config.layerControl.baseTile=a,this.enqueueRequest("mapbox-"+this._id+"::set-basetile",a)},getBaseLayers:function(){return this._config.layerControl.baseLayers},setBaseLayers:function(a){this._config.layerControl.baseLayers=a,this.enqueueRequest("mapbox-"+this._id+"::set-baselayers",a)},getOverlays:function(){return this._config.layerControl.overlays},addOverlay:function(a,b){a&&void 0==this._config.layerControl.overlays[a]&&(this._config.layerControl.overlays[a]=b,this.enqueueRequest("mapbox-"+this._id+"::add-overlay",{layerName:a,name:b||a}))},removeOverlay:function(a){a&&this._config.layerControl.overlays[a]&&(d.$broadcast("mapbox-"+this._id+"::remove-overlay",a),delete this._config.layerControl.overlays[a])},removeOverlays:function(){var a=this;angular.forEach(this._config.layerControl.overlays,function(b,c){d.$broadcast("mapbox-"+a._id+"::remove-overlay",c),delete a._config.layerControl.overlays[c]})},getControls:function(){return this._config.controls},addControl:function(a,b){this._config.controls[a]={name:a,options:b},d.$broadcast("mapbox-"+this._id+"::add-control",this._config.controls[a])},removeControl:function(a){delete this._config.controls[a],d.$broadcast("mapbox-"+this._id+"::remove-control",a)},getEventHandlers:function(){return this._config.events},addEventHandler:function(a,b){a=a instanceof Array?a:[a];var c=this;angular.forEach(a,function(a){c.removeEventHandler(a),c._config.events[a]=b,d.$broadcast("mapbox-"+c._id+"::add-event-handler",{event:a,handler:b})})},removeEventHandler:function(a){a=a instanceof Array?a:[a];var b=this;angular.forEach(a,function(a){void 0!==b._config.events[a]&&(d.$broadcast("mapbox-"+b._id+"::remove-event-handler",{event:a,handler:b._config.events[handler]}),delete b._config.events[a])})},getView:function(){return{coordinates:this._config.view.coordinates,zoom:this._config.view.zoom}},setView:function(a,b){a instanceof Array&&(this._config.view.coordinates=a,this._config.view.zoom=b||this._config.view.zoom,d.$broadcast("mapbox-"+this._id+"::set-view",this._config.view))},getBounds:function(){return this._config.bounds},setBounds:function(a,b){this._config.bounds={coordinates:a,options:b||{reset:!1}},d.$broadcast("mapbox-"+this._id+"::set-bounds",this._config.bounds)},zoomTo:function(a,b,c){d.$broadcast("mapbox-"+this._id+"::zoom-to",{coordinates:a,zoom:b,options:c})},createLayer:function(a,b,c,d){"function"==typeof c&&(d=c,c={});var e=this;this.enqueueRequest("mapbox-"+this._id+"::create-layer",{name:a,type:b,options:c,handler:function(b){e._config.layers[a]=b,d(b)}})},getLayer:function(a){return this._config.layers[a]},getLayers:function(){return this._config.layers},addLayer:function(a,b){this._config.layers[a]=b,d.$broadcast("mapbox-"+this._id+"::add-layer",a)},removeLayer:function(a){a instanceof Array==!1&&(a=[a]);var b=this;angular.forEach(a,function(a){d.$broadcast("mapbox-"+b._id+"::remove-layer",a),delete b._config.layers[a]})},removeLayers:function(){var a=this;angular.forEach(this._config.layers,function(b,c){d.$broadcast("mapbox-"+-this._id+"::remove-layer",c),delete a._config.layers[c]})},showLayer:function(a){d.$broadcast("mapbox-"+this._id+"::show-layer",a)},hideLayer:function(a){d.$broadcast("mapbox-"+this._id+"::hide-layer",a)},fitLayer:function(a,b){this.enqueueRequest("mapbox-"+this._id+"::fit-layer",{name:a,options:b||{reset:!1}})},getGeoJSON:function(){return this._config.geojson},getGeoJSONFeature:function(a,b){return this._config.geojson[a]&&this._config.geojson[a][b]?this._config.geojson[a][b]:null},getGeoJSONLayer:function(a){return this._config.geojson[a]?this._config.geojson[a]:null},addGeoJSON:function(b,c,f,g,h){"function"==typeof g&&(h=g,g={}),g=a.defaults(g||{},{featureId:e().toString()});var i={layerName:b,geojson:c,options:f,properties:g,onAddCallback:h};return this._config.geojson[b]=this._config.geojson[b]||{},this._config.geojson[b][g.featureId]=i,d.$broadcast("mapbox-"+this._id+"::add-geojson",i),g.featureId},removeGeoJSONFeature:function(a,b){this._config.geojson[a]&&this._config.geojson[a][b]&&(d.$broadcast("mapbox-"+this._id+"::remove-geojson-feature",this._config.geojson[a][b]),delete this._config.geojson[a][b])},removeGeoJSONLayer:function(a){a instanceof Array==!1&&(a=[a]);var b=this;angular.forEach(a,function(a){b._config.geojson[a]&&(d.$broadcast("mapbox-"+b._id+"::remove-geojson-layer",a),delete b._config.geojson[a])})},removeGeoJSON:function(){var a=this;angular.forEach(a._config.geojson,function(b,c){d.$broadcast("mapbox-"+a._id+"::remove-geojson-layer",c),delete a._config.geojson[c]})},editingOn:function(a,b,c,d,e){"string"==typeof c&&(c={exclude:"exclude"==c}),this.enqueueRequest("mapbox-"+this._id+"::edit-on",{layerName:a,controls:b,controlOptions:c,styleOptions:d,addLayer:e})},editingUpdate:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-update")},editingClear:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-clear")},editingOff:function(){this.enqueueRequest("mapbox-"+this._id+"::edit-off")},pickPortionOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-portion-on")},pickDistrictOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-district-on")},pickFieldOn:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-field-on")},defineFarmOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-on")},defineServiceAreaOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-service-area-on")},defineFieldGroupOn:function(){this.enqueueRequest("mapbox-"+this._id+"::define-field-group-on")},featureClickOn:function(){this.enqueueRequest("mapbox-"+this._id+"::feature-click-on")},pickPortionOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-portion-off")},pickDistrictOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-district-off")},pickFieldOff:function(){this.enqueueRequest("mapbox-"+this._id+"::pick-field-off")},defineFarmOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-off")},defineServiceAreaOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-farm-off")},defineFieldGroupOff:function(){this.enqueueRequest("mapbox-"+this._id+"::define-field-group-off")},featureClickOff:function(){this.enqueueRequest("mapbox-"+this._id+"::feature-click-off")}},function(a,b){return b=b||{},void 0===c[a]&&(c[a]=new f(a,b)),b.clean===!0&&c[a].reset(),c[a]}}]}]),sdkInterfaceMapApp.directive("mapbox",["$rootScope","$http","$log","$timeout","configuration","mapboxService","geoJSONHelper","objectId","underscore",function(a,b,c,d,e,f,g,h,i){function j(a,b){var c=this;c._id=a.id,c._optionSchema={},c._editing=!1,c._editableLayer,c._editableFeature=L.featureGroup(),c._featureClickable,c._geoJSON={},c._layers={},c._controls={},c._layerControls={baseTile:"",baseLayers:{},overlays:{}},c._draw={exclude:!1,addLayer:!0,options:{},controls:{}},a.delay=a.delay||0,d(function(){c.mapInit(),c.addListeners(b),c.broadcast("mapbox-"+c._mapboxServiceInstance.getId()+"::init",c._map)},a.delay)}var k={};return j.prototype.mapInit=function(){var a=this;a._mapboxServiceInstance=f(a._id);var b=a._mapboxServiceInstance.getView(),c=a._mapboxServiceInstance.getOptions();a._map=L.map(a._id,c).setView(b.coordinates,b.zoom),a._map.whenReady(function(){a.broadcast("mapbox-"+a._mapboxServiceInstance.getId()+"::ready",a._map)}),a._editableFeature=L.featureGroup(),a._editableFeature.addTo(a._map),a.setEventHandlers(a._mapboxServiceInstance.getEventHandlers()),a.resetLayers(a._mapboxServiceInstance.getLayers()),a.resetGeoJSON(a._mapboxServiceInstance.getGeoJSON()),a.resetLayerControls(a._mapboxServiceInstance.getBaseTile(),a._mapboxServiceInstance.getBaseLayers(),a._mapboxServiceInstance.getOverlays()),a.addControls(a._mapboxServiceInstance.getControls()),a.setBounds(a._mapboxServiceInstance.getBounds()),a._map.on("draw:drawstart",a.onDrawStart,a),a._map.on("draw:editstart",a.onDrawStart,a),a._map.on("draw:deletestart",a.onDrawStart,a),a._map.on("draw:drawstop",a.onDrawStop,a),a._map.on("draw:editstop",a.onDrawStop,a),a._map.on("draw:deletestop",a.onDrawStop,a)},j.prototype.addListeners=function(a){a.hidden=!this._mapboxServiceInstance.shouldShow();var b=this,c=this._mapboxServiceInstance.getId();a.$on("mapbox-"+c+"::get-center",function(a,c){"function"==typeof c&&c(b._map.getCenter())}),a.$on("mapbox-"+c+"::get-bounds",function(a,c){"function"==typeof c&&c(b._map.getBounds())}),a.$on("mapbox-"+c+"::get-control",function(a,c){"function"==typeof c.handler&&c.handler(b._controls[c.control])}),a.$on("$destroy",function(){delete k[c],b.mapDestroy(),b.broadcast("mapbox-"+c+"::destroy")}),a.$on("mapbox-"+c+"::set-basetile",function(a,c){b.setBaseTile(c)}),a.$on("mapbox-"+c+"::set-baselayers",function(a,c){b.setBaseLayers(c)}),a.$on("mapbox-"+c+"::add-overlay",function(a,c){b.addOverlay(c.layerName,c.name)}),a.$on("mapbox-"+c+"::remove-overlay",function(a,c){b.removeOverlay(c)}),a.$on("mapbox-"+c+"::add-control",function(a,c){b.addControls({control:c})}),a.$on("mapbox-"+c+"::remove-control",function(a,c){b.removeControl(c)}),a.$on("mapbox-"+c+"::add-event-handler",function(a,c){b.addEventHandler(c.event,c.handler)}),a.$on("mapbox-"+c+"::remove-event-handler",function(a,c){b.removeEventHandler(c.event,c.handler)}),a.$on("mapbox-"+c+"::set-view",function(a,c){b.setView(c)}),a.$on("mapbox-"+c+"::set-bounds",function(a,c){b.setBounds(c)}),a.$on("mapbox-"+c+"::zoom-to",function(a,c){b.zoomTo(c)}),a.$on("mapbox-"+c+"::create-layer",function(a,c){"function"==typeof c.handler&&c.handler(b.createLayer(c.name,c.type,c.options))}),a.$on("mapbox-"+c+"::add-layer",function(a,c){b.addLayer(c)}),a.$on("mapbox-"+c+"::remove-layer",function(a,c){b.removeLayer(c)}),a.$on("mapbox-"+c+"::show-layer",function(a,c){b.showLayer(c)}),a.$on("mapbox-"+c+"::hide-layer",function(a,c){b.hideLayer(c)}),a.$on("mapbox-"+c+"::fit-layer",function(a,c){b.fitLayer(c)}),a.$on("mapbox-"+c+"::add-geojson",function(a,c){b.addGeoJSONFeature(c)}),a.$on("mapbox-"+c+"::remove-geojson-feature",function(a,c){b.removeGeoJSONFeature(c)}),a.$on("mapbox-"+c+"::remove-geojson-layer",function(a,c){b.removeGeoJSONLayer(c)}),a.$on("mapbox-"+c+"::hide",function(){a.hidden=!0}),a.$on("mapbox-"+c+"::show",function(){a.hidden=!1}),a.$on("mapbox-"+c+"::invalidate-size",function(){b._map.invalidateSize()}),a.$on("mapbox-"+c+"::edit-on",function(a,c){b.setOptionSchema(c.styleOptions),b.makeEditable(c.layerName,c.addLayer,!0),b.setDrawControls(c.controls,c.controlOptions),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-update",function(){b.makeEditable(b._editableLayer,b._draw.addLayer,!1),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-clear",function(){b.cleanEditable(),b.updateDrawControls()}),a.$on("mapbox-"+c+"::edit-off",function(){b.makeEditable(void 0,{},!0),b.updateDrawControls()}),a.$on("mapbox-"+c+"::pick-portion-on",function(){b._map.on("click",b.pickPortion,b)}),a.$on("mapbox-"+c+"::pick-district-on",function(){b._map.on("click",b.pickDistrict,b)}),a.$on("mapbox-"+c+"::pick-field-on",function(){b._map.on("click",b.pickField,b)}),a.$on("mapbox-"+c+"::define-farm-on",function(){b._map.on("click",b.defineNewFarm,b)}),a.$on("mapbox-"+c+"::define-service-area-on",function(){b._map.on("click",b.defineServiceArea,b)}),a.$on("mapbox-"+c+"::define-field-group-on",function(){b._map.on("click",b.defineFieldGroup,b)}),a.$on("mapbox-"+c+"::feature-click-on",function(){b._featureClickable=!0}),a.$on("mapbox-"+c+"::pick-portion-off",function(){b._map.off("click",b.pickPortion,b)}),a.$on("mapbox-"+c+"::pick-field-off",function(){b._map.off("click",b.pickField,b)}),a.$on("mapbox-"+c+"::pick-district-off",function(){b._map.off("click",b.pickDistrict,b)}),a.$on("mapbox-"+c+"::define-farm-off",function(){b._map.off("click",b.defineNewFarm,b)}),a.$on("mapbox-"+c+"::define-service-area-off",function(){b._map.off("click",b.defineServiceArea,b)}),a.$on("mapbox-"+c+"::define-field-group-off",function(){b._map.off("click",b.defineFieldGroup,b)}),a.$on("mapbox-"+c+"::feature-click-off",function(){b._featureClickable=!1})},j.prototype.mapDestroy=function(){for(var a in this._map._layers)this._map._layers.hasOwnProperty(a)&&this._map.removeLayer(this._map._layers[a]);this._optionSchema={},this._editing=!1,this._editableLayer=null,this._editableFeature=null,this._geoJSON={},this._layers={},this._layerControls={baseTile:"",baseLayers:{},overlays:{}},this._draw={exclude:!1,addLayer:!0,options:{},controls:{}},this._map.remove(),this._map=null},j.prototype.broadcast=function(b,d){c.debug(b),a.$broadcast(b,d)},j.prototype.resetLayerControls=function(a,b,c){this._layerControls.baseTile=a;try{this.map.removeControl(this._layerControls.control)}catch(d){}this.setBaseLayers(b),this.setOverlays(c)},j.prototype.resetLayers=function(a){var b=this;angular.forEach(b._layers,function(a,c){b._map.removeLayer(a),delete b._layers[c]}),angular.forEach(a,function(a,c){b._layers[c]=a,b._map.addLayer(a)})},j.prototype.resetGeoJSON=function(a){var b=this;angular.forEach(b._geoJSON,function(a,c){b._layers[c]&&(b._map.removeLayer(b._layers[c]),delete b._layers[c])}),angular.forEach(a,function(a){b.addGeoJSONLayer(a)})},j.prototype.setBaseTile=function(a){var b=this;b._layerControls.baseTile=a,angular.forEach(b._layerControls.baseLayers,function(b){b.base&&b.layer&&b.layer.setUrl(a)})},j.prototype.setBaseLayers=function(a){var b=this,c=b._mapboxServiceInstance.getOptions();void 0===b._layerControls.control&&(b._layerControls.control=L.control.layers({},{}),c.layersControl&&b._map.addControl(b._layerControls.control)),angular.forEach(b._layerControls.baseLayers,function(c,d){void 0===a[d]?b._layerControls.control.removeLayer(c.layer):void 0===c.layer&&b.addBaseLayer(c,d)}),angular.forEach(a,function(a,c){void 0===b._layerControls.baseLayers[c]?b.addBaseLayer(a,c):(a=b._layerControls.baseLayers[c],a.base&&a.layer.addTo(this._map))})},j.prototype.addBaseLayer=function(a,b){a.base&&(a.tiles=this._layerControls.baseTile),"tile"==a.type?a.layer=L.tileLayer(a.tiles):"mapbox"==a.type?a.layer=L.mapbox.tileLayer(a.tiles):"google"==a.type&&"function"==typeof L.Google&&(a.layer=new L.Google(a.tiles)),a.base&&a.layer.addTo(this._map),this._layerControls.baseLayers[b]=a,this._layerControls.control.addBaseLayer(a.layer,b)},j.prototype.setOverlays=function(a){var b=this;angular.forEach(b._layerControls.overlays,function(c,d){void 0===a[d]&&b.removeOverlay(d,c)}),angular.forEach(a,function(a,c){b.addOverlay(c,a)})},j.prototype.addOverlay=function(a,b){var c=this._layers[a];b=b||a,this._layerControls.control&&c&&void 0===this._layerControls.overlays[a]&&(this._layerControls.overlays[a]=c,this._layerControls.control.addOverlay(c,b))},j.prototype.removeOverlay=function(a,b){var c=b||this._layers[a];this._layerControls.control&&c&&(this._layerControls.control.removeLayer(c),delete this._layerControls.overlays[a])},j.prototype.addControls=function(a){var b=this;angular.forEach(a,function(a){"function"==typeof L.control[a.name]&&(b.removeControl(a.name),b._controls[a.name]=L.control[a.name](a.options),b._map.addControl(b._controls[a.name]))})},j.prototype.removeControl=function(a){this._controls[a]&&(this._map.removeControl(this._controls[a]),delete this._controls[a])},j.prototype.setEventHandlers=function(a){var b=this;angular.forEach(a,function(a,c){b.addEventHandler(c,a)})},j.prototype.addEventHandler=function(a,b){this._map.on(a,b)},j.prototype.removeEventHandler=function(a,b){this._map.off(a,b)},j.prototype.setView=function(a){this._map&&void 0!==a&&this._map.setView(a.coordinates,a.zoom)},j.prototype.setBounds=function(a){this._map&&a.coordinates&&(a.coordinates instanceof Array?a.coordinates.length>1&&this._map.fitBounds(a.coordinates,a.options):this._map.fitBounds(a.coordinates,a.options))},j.prototype.zoomTo=function(a){this._map&&a.coordinates&&a.zoom&&this._map.setZoomAround(a.coordinates,a.zoom,a.options)},j.prototype.createLayer=function(a,b,c){return b=b||"featureGroup",c=c||{},void 0===this._layers[a]&&("featureGroup"==b&&L.featureGroup?this._layers[a]=L.featureGroup(c):"markerClusterGroup"==b&&L.markerClusterGroup&&(this._layers[a]=L.markerClusterGroup(c)),this._layers[a]&&this._layers[a].addTo(this._map)),this._layers[a]},j.prototype.addLayer=function(a){var b=this._mapboxServiceInstance.getLayer(a);b&&(this._layers[a]=b,this._map.addLayer(b))},j.prototype.addLayerToLayer=function(a,b,c){var d=this._layers[c];d&&(this._layers[a]=b,d.addLayer(b))},j.prototype.removeLayer=function(a){var b=this._layers[a];b&&(this.removeOverlay(a),this._map.removeLayer(b),delete this._layers[a])},j.prototype.removeLayerFromLayer=function(a,b){var c=this._layers[b],d=this._layers[a];c&&(c.removeLayer(d),delete this._layers[a])},j.prototype.showLayer=function(a){var b=this._layers[a];b&&0==this._map.hasLayer(b)&&(this._map.addLayer(b),b.eachLayer(function(a){a.bindLabel&&a.feature.properties.label&&a.bindLabel(a.feature.properties.label.message,a.feature.properties.label.options)}))},j.prototype.hideLayer=function(a){var b=this._layers[a];b&&this._map.hasLayer(b)&&this._map.removeLayer(b)},j.prototype.fitLayer=function(a){if(a.name){var b=this._layers[a.name];if(b&&this._map.hasLayer(b)){var c=b.getBounds();this._map.fitBounds(c,a.options)}}},j.prototype.addGeoJSONLayer=function(a){var b=this;angular.forEach(a,function(a){b.addGeoJSONFeature(a)})},j.prototype.makeIcon=function(a){return a?a.type&&L[a.type]&&L[a.type].icon?L[a.type].icon(a):L.icon(a):L.Icon.Default()},j.prototype.addLabel=function(a,b,c){var d=this,e=g(b);if("object"==typeof a&&"Point"!==b.geometry.type)if(a.options=a.options||{},(a.options.centered||a.options.noHide)&&"function"==typeof d._map.showLabel){var f=new L.Label(i.extend(a.options),{offset:[6,-15]});
f.setContent(a.message),f.setLatLng(e.getCenter()),1==a.options.noHide?(d._map.showLabel(f),c.on("add",function(){d._map.showLabel(f)}),c.on("remove",function(){d._map.removeLayer(f)})):(c.on("mouseover",function(){d._map.showLabel(f)}),c.on("mouseout",function(){d._map.removeLayer(f)}))}else"function"==typeof c.bindLabel&&c.bindLabel(a.message,a.options)},j.prototype.addGeoJSONFeature=function(a){var b=this,c=g(a.geojson,a.properties);b.createLayer(a.layerName),b._geoJSON[a.layerName]=b._geoJSON[a.layerName]||{},b._geoJSON[a.layerName][a.properties.featureId]=a;var d=a.options?angular.copy(a.options):{};d.icon&&(d.icon=b.makeIcon(d.icon)),L.geoJson(c.getJson(),{style:d.style,pointToLayer:function(a,b){var c=L.marker(b,d);return d.label&&c.bindLabel(d.label.message,d.label.options),c},onEachFeature:function(c,e){b.addLayerToLayer(c.properties.featureId,e,a.layerName),b.addLabel(d.label,c,e),"function"==typeof a.onAddCallback&&a.onAddCallback(c,e),!b._featureClickable||"Polygon"!==c.geometry.type&&"MultiPolygon"!==c.geometry.type||e.on("click",function(){c&&c.properties&&(c.properties.highlighted?(c.properties.highlighted=!1,e.setStyle({color:e.options.fillColor||"blue",opacity:e.options.fillOpacity||.4})):(c.properties.highlighted=!0,e.setStyle({color:"white",opacity:1,fillColor:e.options.fillColor||"blue",fillOpacity:e.options.fillOpacity||.4}))),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::polygon-clicked",{properties:c.properties,highlighted:c.properties.highlighted})})}})},j.prototype.removeGeoJSONFeature=function(a){this._geoJSON[a.layerName]&&this._geoJSON[a.layerName][a.properties.featureId]&&(this.removeLayerFromLayer(a.properties.featureId,a.layerName),delete this._geoJSON[a.layerName][a.properties.featureId])},j.prototype.removeGeoJSONLayer=function(a){this._geoJSON[a]&&(this.removeLayer(a),delete this._geoJSON[a])},j.prototype.makeEditable=function(a,b,c){var d=this;1==c&&d.cleanEditable(),a&&d._layers[a]&&d._layers[a].eachLayer(function(b){d._layers[a].removeLayer(b),d._editableFeature.addLayer(b)}),d._editableLayer=a,d._draw.addLayer=void 0==b?!0:b},j.prototype.cleanEditable=function(){var a=this;a._editableFeature.eachLayer(function(b){a._editableFeature.removeLayer(b)})},j.prototype.setDrawControls=function(a,b){this._draw.controlOptions=b||{},this._draw.controls={},a instanceof Array&&"function"==typeof L.Control.Draw&&(this._draw.controls.polyline=new L.Control.Draw({draw:{polyline:-1!=a.indexOf("polyline"),polygon:!1,rectangle:!1,circle:!1,marker:!1}}),this._draw.controls.polygon=new L.Control.Draw({draw:{polyline:!1,polygon:-1==a.indexOf("polygon")?!1:{allowIntersection:!1,showArea:!0,metric:!0},rectangle:!1,circle:!1,marker:!1}}),this._draw.controls.marker=new L.Control.Draw({draw:{polyline:!1,polygon:!1,rectangle:!1,circle:!1,marker:-1==a.indexOf("marker")?!1:{icon:this._optionSchema.icon?L.icon(this._optionSchema.icon):L.Icon.Default()}}}),this._draw.controls.edit=new L.Control.Draw({draw:!1,edit:{featureGroup:this._editableFeature,remove:1!=this._draw.controlOptions.nodelete}}))},j.prototype.setOptionSchema=function(a){this._optionSchema=a||{}},j.prototype.updateDrawControls=function(){try{this._map.removeControl(this._draw.controls.polyline)}catch(a){}try{this._map.removeControl(this._draw.controls.polygon)}catch(a){}try{this._map.removeControl(this._draw.controls.marker)}catch(a){}try{this._map.removeControl(this._draw.controls.edit)}catch(a){}try{this._map.off("draw:created",this.onDrawn,this),this._map.off("draw:edited",this.onEdited,this),this._map.off("draw:deleted",this.onDeleted,this)}catch(a){}if(this._editableFeature.getLayers().length>0&&(this._map.on("draw:edited",this.onEdited,this),this._map.on("draw:deleted",this.onDeleted,this),this._draw.controls.edit&&this._map.addControl(this._draw.controls.edit)),this._editableLayer&&(0==this._editableFeature.getLayers().length||this._draw.controlOptions.multidraw)){var b={polyline:!0,polygon:!0,marker:!0};this._editableFeature.eachLayer(function(a){if(a.feature&&a.feature.geometry&&a.feature.geometry.type)switch(a.feature.geometry.type){case"LineString":b.polyline=!1;break;case"Polygon":b.polygon=!1;break;case"Point":b.marker=!1}}),this._draw.controlOptions.exclude?(b.polyline&&this._map.addControl(this._draw.controls.polyline),b.polygon&&this._map.addControl(this._draw.controls.polygon),b.marker&&this._map.addControl(this._draw.controls.marker),this._map.on("draw:created",this.onDrawn,this)):(this._draw.controls.polyline&&this._map.addControl(this._draw.controls.polyline),this._draw.controls.polygon&&this._map.addControl(this._draw.controls.polygon),this._draw.controls.marker&&this._map.addControl(this._draw.controls.marker),this._map.on("draw:created",this.onDrawn,this))}},j.prototype.pickPortion=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/portion-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::portion-added",a))}).error(function(a){c.debug(a)})}},j.prototype.defineNewFarm=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/portion-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey,portion:a}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::portion-added",a))}).error(function(a){c.debug(a)})}},j.prototype.pickDistrict=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/district-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::district-added",a))}).error(function(a){c.debug(a)})}},j.prototype.defineServiceArea=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/district-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{featureId:a.sgKey,districtName:a.name}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::district-added",a))}).error(function(a){c.debug(a)})}},j.prototype.pickField=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/field-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.removeGeoJSONLayer(d._editableLayer),d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{}),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::field-added",a))}).error(function(a){c.debug(a)})}},j.prototype.defineFieldGroup=function(a){var d=this;if(0==d._editing){var f=e.getServer(),g="?x="+a.latlng.lng+"&y="+a.latlng.lat;b.get(f+"api/geo/field-polygon"+g).success(function(a){d._mapboxServiceInstance.getGeoJSONFeature(d._editableLayer,a.sgKey)||(d._mapboxServiceInstance.addGeoJSON(d._editableLayer,a.position,d._optionSchema,{}),d.makeEditable(d._editableLayer,d._draw.addLayer,!1),d.updateDrawControls(),d.broadcast("mapbox-"+d._mapboxServiceInstance.getId()+"::field-added",a))}).error(function(a){c.debug(a)})}},j.prototype.onDrawStart=function(){this._editing=!0,this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-editing",this._editing)},j.prototype.onDrawStop=function(){this._editing=!1,this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-editing",this._editing)},j.prototype.onDrawn=function(a){var b={type:"Feature",geometry:{},properties:{featureId:h().toString()}};switch(a.layerType){case"polyline":b.geometry={type:"LineString",coordinates:[]},angular.forEach(a.layer._latlngs,function(a){b.geometry.coordinates.push([a.lng,a.lat])}),this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b);break;case"polygon":if(b.geometry={type:"Polygon",coordinates:[[]]},angular.forEach(a.layer._latlngs,function(a){b.geometry.coordinates[0].push([a.lng,a.lat])}),b.geometry.coordinates[0].length>0&&b.geometry.coordinates[0][0]!=b.geometry.coordinates[0][b.geometry.coordinates[0].length-1]&&b.geometry.coordinates[0].push(b.geometry.coordinates[0][0]),this._draw.controls.polygon.options.draw.polygon.showArea){var c=L.GeometryUtil.geodesicArea(a.layer._latlngs),d=1.19599*c;b.properties.area={m_sq:c,ha:1e-4*c,mi_sq:d/3097600,acres:d/4840,yd_sq:d}}this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b);break;case"marker":b.geometry={type:"Point",coordinates:[a.layer._latlng.lng,a.layer._latlng.lat]},this.broadcast("mapbox-"+this._mapboxServiceInstance.getId()+"::geometry-created",b)}this._draw.addLayer&&(this._mapboxServiceInstance.addGeoJSON(this._editableLayer,b,this._optionSchema,b.properties),this.makeEditable(this._editableLayer),this.updateDrawControls())},j.prototype.onEdited=function(a){var b=this;a.layers.eachLayer(function(a){var c={type:"Feature",geometry:{type:a.feature.geometry.type},properties:{featureId:a.feature.properties.featureId}};switch(a.feature.geometry.type){case"Point":c.geometry.coordinates=[a._latlng.lng,a._latlng.lat],b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-edited",c);break;case"Polygon":if(c.geometry.coordinates=[[]],angular.forEach(a._latlngs,function(a){c.geometry.coordinates[0].push([a.lng,a.lat])}),c.geometry.coordinates[0].length>0&&c.geometry.coordinates[0][0]!=c.geometry.coordinates[0][c.geometry.coordinates[0].length-1]&&c.geometry.coordinates[0].push(c.geometry.coordinates[0][0]),b._draw.controls.polygon.options.draw.polygon.showArea){var d=L.GeometryUtil.geodesicArea(a._latlngs),e=1.19599*d;c.properties.area={m_sq:d,ha:1e-4*d,mi_sq:e/3097600,acres:e/4840,yd_sq:e}}b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-edited",c);break;case"LineString":c.geometry.coordinates=[],angular.forEach(a._latlngs,function(a){c.geometry.coordinates.push([a.lng,a.lat])}),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-edited",c)}})},j.prototype.onDeleted=function(a){var b=this;a.layers.getLayers().length>0?a.layers.eachLayer(function(a){b._editableFeature.removeLayer(a),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-deleted",a.feature.properties.featureId)}):(b._editableFeature.clearLayers(),b.broadcast("mapbox-"+b._mapboxServiceInstance.getId()+"::geometry-deleted")),b.updateDrawControls()},{restrict:"E",template:'<div class="map" ng-hide="hidden" ng-transclude></div>',replace:!0,transclude:!0,link:function(a,b,c){void 0===k[c.id]&&(k[c.id]=new j(c,a))},controller:function(a,b){this.getMap=function(){return k[b.id]._map}}}}]),sdkInterfaceMapApp.directive("mapboxControl",["$rootScope",function(a){function b(b){var e=b.parent();a.$on("mapbox-"+e.attr("id")+"::init",function(){e.find(".leaflet-control-container "+d[c]).prepend(b)})}var c,d={topleft:".leaflet-top.leaflet-left",topright:".leaflet-top.leaflet-right",bottomleft:".leaflet-bottom.leaflet-left",bottomright:".leaflet-bottom.leaflet-right"};return{restrict:"E",require:"^mapbox",replace:!0,transclude:!0,template:'<div class="leaflet-control"><div class="leaflet-bar" ng-transclude></div></div>',link:function(a,b,d){c=void 0==d.position?"bottomright":d.position},controller:function(a){b(a)}}}]);var sdkInterfaceNavigiationApp=angular.module("ag.sdk.interface.navigation",["ag.sdk.authorization","ag.sdk.library"]);sdkInterfaceNavigiationApp.provider("navigationService",["underscore",function(a){var b={},c=[],d={Favourites:1,Assets:2,Apps:3,Administration:4},e={left:[],right:[]},f=function(a,b){return a.order-b.order},g=this.registerApps=function(c){c=c instanceof Array?c:[c],angular.forEach(c,function(c){c=a.defaults(c,{id:c.title,order:100,group:"Apps",include:function(a,b){return-1!==b.indexOf(a.id)}}),c.title&&c.state&&(b[c.title]=c)})};this.$get=["$rootScope","$state","authorization",function(h,i,j){var k=!1,l="",m=function(b){var e=a.findWhere(c,{title:b.group});void 0===e&&(e={title:b.group,order:d[b.group]||100,items:[]},c.push(e),c=c.sort(f));var g=a.findWhere(e.items,{id:b.id});void 0===g&&(b.active=i.includes(b.state),e.items.push(b),e.items=e.items.sort(f),h.$broadcast("navigation::items__changed",c),h.$broadcast("navigation::app__allowed",b))},n=function(){c=[],h.$broadcast("navigation::items__changed",c)},o=function(c){var d=c||j.currentUser(),e=d.userRole?a.pluck(d.userRole.apps,"name"):[],f=d.organization?a.pluck(d.organization.services,"serviceType"):[];n(),angular.forEach(b,function(a){("function"==typeof a.include&&a.include(a,e,f)||a.include===!0)&&m(a)})},p=function(a,b){b&&(b instanceof Array==!1?e[a].push(b):e[a]=b,h.$broadcast("navigation::"+a+"-buttons__changed",e[a]),h.$broadcast("navigation::buttons__changed"))};return h.$on("$stateChangeSuccess",function(){angular.forEach(c,function(a){angular.forEach(a.items,function(a){a.active=i.includes(a.state)})})}),h.$on("navigation::item__selected",function(a,b){i.go(b)}),h.$on("authorization::login",function(a,b){o(b)}),h.$on("authorization::unauthorized",function(){n()}),h.$on("authorization::logout",function(){n()}),o(),{getGroupedApps:function(){return c},renameApp:function(d,e){var f=a.findWhere(b,{id:d});f&&(f.title=e,h.$broadcast("navigation::items__changed",c))},registerApps:function(a){g(a)},unregisterApps:function(){b={},c=[]},allowApp:function(a){b[a]&&m(b[a])},toggleSlim:function(){k=!k,h.$broadcast("navigation::slim__changed",k)},isSlim:function(){return k},footerText:function(a){return void 0!==a&&(l=a,h.$broadcast("navigation::footerText",l)),l},leftButtons:function(a){return p("left",a),e.left},rightButtons:function(a){return p("right",a),e.right}}}]}]);var sdkTestDataApp=angular.module("ag.sdk.test.data",["ag.sdk.utilities","ag.sdk.id","ag.sdk.library"]);sdkTestDataApp.provider("mockDataService",["underscore",function(a){var b={},c={localStore:!0};this.config=function(b){c=a.defaults(b,c)},this.$get=["localStore","objectId","promiseService",function(d,e,f){return c.localStore&&(b=d.getItem("mockdata")||{}),{setItem:function(a,f){f instanceof Array?(b[a]={},angular.forEach(f,function(c){c.id=c.id||e().toString(),b[a][c.id]=c})):(f.id=f.id||e().toString(),b[a]=b[a]||{},b[a][f.id]=f),c.localStore&&d.setItem("mockdata",b)},getItem:function(c,d){return f.wrap(function(e){b[c]=b[c]||{},void 0===d?e.resolve(a.toArray(b[c]||{})):b[c][d]?e.resolve(b[c][d]):e.reject()})}}}]}]),angular.module("ag.sdk.helper",["ag.sdk.helper.asset","ag.sdk.helper.crop-inspection","ag.sdk.helper.document","ag.sdk.helper.enterprise-budget","ag.sdk.helper.farmer","ag.sdk.helper.favourites","ag.sdk.helper.merchant","ag.sdk.helper.task","ag.sdk.helper.team","ag.sdk.helper.user"]),angular.module("ag.sdk.interface",["ag.sdk.interface.list","ag.sdk.interface.map","ag.sdk.interface.navigation"]),angular.module("ag.sdk.test",["ag.sdk.test.data"]),angular.module("ag.sdk",["ag.sdk.authorization","ag.sdk.id","ag.sdk.utilities","ag.sdk.api","ag.sdk.helper","ag.sdk.library","ag.sdk.interface.map","ag.sdk.test"]);